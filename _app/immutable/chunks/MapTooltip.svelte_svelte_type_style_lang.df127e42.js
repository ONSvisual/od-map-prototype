//js
import{d as cc,g as _n,e as mn}from"./utils.eb6832fa.js";import{S as ai,i as ii,s as fi,e as go,f as dc,U as mc,h as Eo,l as Ht,m as hc,j as vc,z as zt,p as yc,o as ei,t as Qr,B as Go,b as St,w as Do,V as Io,W as $n,y as oi,X as ui,Y as bc,c as si,u as li,g as ci,a as di,C as _c,v as xo,Z as ri,r as pc}from"./index.eeb75380.js";import{w as gc}from"./index.8612578d.js";var Fo={exports:{}};(function(r,t){(function(a,s){r.exports=s()})(cc,function(){var a=function(e){return e instanceof Uint8Array||e instanceof Uint16Array||e instanceof Uint32Array||e instanceof Int8Array||e instanceof Int16Array||e instanceof Int32Array||e instanceof Float32Array||e instanceof Float64Array||e instanceof Uint8ClampedArray},s=function(e,i){for(var m=Object.keys(i),w=0;w<m.length;++w)e[m[w]]=i[m[w]];return e},h=`
`;function R(e){return typeof atob<"u"?atob(e):"base64:"+e}function D(e){var i=new Error("(regl) "+e);throw console.error(i),i}function N(e,i){e||D(i)}function Z(e){return e?": "+e:""}function Ae(e,i,m){e in i||D("unknown parameter ("+e+")"+Z(m)+". possible values: "+Object.keys(i).join())}function he(e,i){a(e)||D("invalid parameter type"+Z(i)+". must be a typed array")}function me(e,i){switch(i){case"number":return typeof e=="number";case"object":return typeof e=="object";case"string":return typeof e=="string";case"boolean":return typeof e=="boolean";case"function":return typeof e=="function";case"undefined":return typeof e>"u";case"symbol":return typeof e=="symbol"}}function Fe(e,i,m){me(e,i)||D("invalid parameter type"+Z(m)+". expected "+i+", got "+typeof e)}function Me(e,i){e>=0&&(e|0)===e||D("invalid parameter type, ("+e+")"+Z(i)+". must be a nonnegative integer")}function Ue(e,i,m){i.indexOf(e)<0&&D("invalid value"+Z(m)+". must be one of: "+i)}var Be=["gl","canvas","container","attributes","pixelRatio","extensions","optionalExtensions","profile","onDone"];function qe(e){Object.keys(e).forEach(function(i){Be.indexOf(i)<0&&D('invalid regl constructor argument "'+i+'". must be one of '+Be)})}function Qe(e,i){for(e=e+"";e.length<i;)e=" "+e;return e}function Oe(){this.name="unknown",this.lines=[],this.index={},this.hasErrors=!1}function dr(e,i){this.number=e,this.line=i,this.errors=[]}function Ke(e,i,m){this.file=e,this.line=i,this.message=m}function tr(){var e=new Error,i=(e.stack||e).toString(),m=/compileProcedure.*\n\s*at.*\((.*)\)/.exec(i);if(m)return m[1];var w=/compileProcedure.*\n\s*at\s+(.*)(\n|$)/.exec(i);return w?w[1]:"unknown"}function je(){var e=new Error,i=(e.stack||e).toString(),m=/at REGLCommand.*\n\s+at.*\((.*)\)/.exec(i);if(m)return m[1];var w=/at REGLCommand.*\n\s+at\s+(.*)\n/.exec(i);return w?w[1]:"unknown"}function br(e,i){var m=e.split(`
`),w=1,B=0,S={unknown:new Oe,0:new Oe};S.unknown.name=S[0].name=i||tr(),S.unknown.lines.push(new dr(0,""));for(var C=0;C<m.length;++C){var z=m[C],V=/^\s*#\s*(\w+)\s+(.+)\s*$/.exec(z);if(V)switch(V[1]){case"line":var q=/(\d+)(\s+\d+)?/.exec(V[2]);q&&(w=q[1]|0,q[2]&&(B=q[2]|0,B in S||(S[B]=new Oe)));break;case"define":var K=/SHADER_NAME(_B64)?\s+(.*)$/.exec(V[2]);K&&(S[B].name=K[1]?R(K[2]):K[2]);break}S[B].lines.push(new dr(w++,z))}return Object.keys(S).forEach(function(Y){var J=S[Y];J.lines.forEach(function(j){J.index[j.number]=j})}),S}function ve(e){var i=[];return e.split(`
`).forEach(function(m){if(!(m.length<5)){var w=/^ERROR:\s+(\d+):(\d+):\s*(.*)$/.exec(m);w?i.push(new Ke(w[1]|0,w[2]|0,w[3].trim())):m.length>0&&i.push(new Ke("unknown",0,m))}}),i}function He(e,i){i.forEach(function(m){var w=e[m.file];if(w){var B=w.index[m.line];if(B){B.errors.push(m),w.hasErrors=!0;return}}e.unknown.hasErrors=!0,e.unknown.lines[0].errors.push(m)})}function sr(e,i,m,w,B){if(!e.getShaderParameter(i,e.COMPILE_STATUS)){var S=e.getShaderInfoLog(i),C=w===e.FRAGMENT_SHADER?"fragment":"vertex";ot(m,"string",C+" shader source must be a string",B);var z=br(m,B),V=ve(S);He(z,V),Object.keys(z).forEach(function(q){var K=z[q];if(!K.hasErrors)return;var Y=[""],J=[""];function j(W,g){Y.push(W),J.push(g||"")}j("file number "+q+": "+K.name+`
`,"color:red;text-decoration:underline;font-weight:bold"),K.lines.forEach(function(W){if(W.errors.length>0){j(Qe(W.number,4)+"|  ","background-color:yellow; font-weight:bold"),j(W.line+h,"color:red; background-color:yellow; font-weight:bold");var g=0;W.errors.forEach(function(O){var X=O.message,fe=/^\s*'(.*)'\s*:\s*(.*)$/.exec(X);if(fe){var U=fe[1];switch(X=fe[2],U){case"assign":U="=";break}g=Math.max(W.line.indexOf(U,g),0)}else g=0;j(Qe("| ",6)),j(Qe("^^^",g+3)+h,"font-weight:bold"),j(Qe("| ",6)),j(X+h,"font-weight:bold")}),j(Qe("| ",6)+h)}else j(Qe(W.number,4)+"|  "),j(W.line+h,"color:red")}),typeof document<"u"&&!window.chrome?(J[0]=Y.join("%c"),console.log.apply(console,J)):console.log(Y.join(""))}),N.raise("Error compiling "+C+" shader, "+z[0].name)}}function kr(e,i,m,w,B){if(!e.getProgramParameter(i,e.LINK_STATUS)){var S=e.getProgramInfoLog(i),C=br(m,B),z=br(w,B),V='Error linking program with vertex shader, "'+z[0].name+'", and fragment shader "'+C[0].name+'"';typeof document<"u"?console.log("%c"+V+h+"%c"+S,"color:red;text-decoration:underline;font-weight:bold","color:red"):console.log(V+h+S),N.raise(V)}}function Te(e){e._commandRef=tr()}function Ze(e,i,m,w){Te(e);function B(V){return V?w.id(V):0}e._fragId=B(e.static.frag),e._vertId=B(e.static.vert);function S(V,q){Object.keys(q).forEach(function(K){V[w.id(K)]=!0})}var C=e._uniformSet={};S(C,i.static),S(C,i.dynamic);var z=e._attributeSet={};S(z,m.static),S(z,m.dynamic),e._hasCount="count"in e.static||"count"in e.dynamic||"elements"in e.static||"elements"in e.dynamic}function Ir(e,i){var m=je();D(e+" in command "+(i||tr())+(m==="unknown"?"":" called from "+m))}function Je(e,i,m){e||Ir(i,m||tr())}function Jr(e,i,m,w){e in i||Ir("unknown parameter ("+e+")"+Z(m)+". possible values: "+Object.keys(i).join(),w||tr())}function ot(e,i,m,w){me(e,i)||Ir("invalid parameter type"+Z(m)+". expected "+i+", got "+typeof e,w||tr())}function pr(e){e()}function ke(e,i,m){e.texture?Ue(e.texture._texture.internalformat,i,"unsupported texture format for attachment"):Ue(e.renderbuffer._renderbuffer.format,m,"unsupported renderbuffer format for attachment")}var Fr=33071,gr=9728,_r=9984,zr=9985,Sr=9986,$r=9987,ut=5120,st=5121,wt=5122,le=5123,$e=5124,xr=5125,qt=5126,vi=32819,yi=32820,bi=33635,_i=34042,Yo=36193,wr={};wr[ut]=wr[st]=1,wr[wt]=wr[le]=wr[Yo]=wr[bi]=wr[vi]=wr[yi]=2,wr[$e]=wr[xr]=wr[qt]=wr[_i]=4;function pi(e,i){return e===yi||e===vi||e===bi?2:e===_i?4:wr[e]*i}function gn(e){return!(e&e-1)&&!!e}function Ko(e,i,m){var w,B=i.width,S=i.height,C=i.channels;N(B>0&&B<=m.maxTextureSize&&S>0&&S<=m.maxTextureSize,"invalid texture shape"),(e.wrapS!==Fr||e.wrapT!==Fr)&&N(gn(B)&&gn(S),"incompatible wrap mode for texture, both width and height must be power of 2"),i.mipmask===1?B!==1&&S!==1&&N(e.minFilter!==_r&&e.minFilter!==Sr&&e.minFilter!==zr&&e.minFilter!==$r,"min filter requires mipmap"):(N(gn(B)&&gn(S),"texture must be a square power of 2 to support mipmapping"),N(i.mipmask===(B<<1)-1,"missing or incomplete mipmap data")),i.type===qt&&(m.extensions.indexOf("oes_texture_float_linear")<0&&N(e.minFilter===gr&&e.magFilter===gr,"filter not supported, must enable oes_texture_float_linear"),N(!e.genMipmaps,"mipmap generation not supported with float textures"));var z=i.images;for(w=0;w<16;++w)if(z[w]){var V=B>>w,q=S>>w;N(i.mipmask&1<<w,"missing mipmap data");var K=z[w];if(N(K.width===V&&K.height===q,"invalid shape for mip images"),N(K.format===i.format&&K.internalformat===i.internalformat&&K.type===i.type,"incompatible type for mip image"),!K.compressed)if(K.data){var Y=Math.ceil(pi(K.type,C)*V/K.unpackAlignment)*K.unpackAlignment;N(K.data.byteLength===Y*q,"invalid data for image, buffer size is inconsistent with image format")}else K.element||K.copy}else e.genMipmaps||N((i.mipmask&1<<w)===0,"extra mipmap data");i.compressed&&N(!e.genMipmaps,"mipmap generation for compressed images not supported")}function Zo(e,i,m,w){var B=e.width,S=e.height,C=e.channels;N(B>0&&B<=w.maxTextureSize&&S>0&&S<=w.maxTextureSize,"invalid texture shape"),N(B===S,"cube map must be square"),N(i.wrapS===Fr&&i.wrapT===Fr,"wrap mode not supported by cube map");for(var z=0;z<m.length;++z){var V=m[z];N(V.width===B&&V.height===S,"inconsistent cube map face shape"),i.genMipmaps&&(N(!V.compressed,"can not generate mipmap for compressed textures"),N(V.mipmask===1,"can not specify mipmaps and generate mipmaps"));for(var q=V.images,K=0;K<16;++K){var Y=q[K];if(Y){var J=B>>K,j=S>>K;N(V.mipmask&1<<K,"missing mipmap data"),N(Y.width===J&&Y.height===j,"invalid shape for mip images"),N(Y.format===e.format&&Y.internalformat===e.internalformat&&Y.type===e.type,"incompatible type for mip image"),Y.compressed||(Y.data?N(Y.data.byteLength===J*j*Math.max(pi(Y.type,C),Y.unpackAlignment),"invalid data for image, buffer size is inconsistent with image format"):Y.element||Y.copy)}}}}var f=s(N,{optional:pr,raise:D,commandRaise:Ir,command:Je,parameter:Ae,commandParameter:Jr,constructor:qe,type:Fe,commandType:ot,isTypedArray:he,nni:Me,oneOf:Ue,shaderError:sr,linkError:kr,callSite:je,saveCommandRef:Te,saveDrawInfo:Ze,framebufferFormat:ke,guessCommand:tr,texture2D:Ko,textureCube:Zo}),Qo=0,Jo=0,$o=5,eu=6;function lt(e,i){this.id=Qo++,this.type=e,this.data=i}function gi(e){return e.replace(/\\/g,"\\\\").replace(/"/g,'\\"')}function Yt(e){if(e.length===0)return[];var i=e.charAt(0),m=e.charAt(e.length-1);if(e.length>1&&i===m&&(i==='"'||i==="'"))return['"'+gi(e.substr(1,e.length-2))+'"'];var w=/\[(false|true|null|\d+|'[^']*'|"[^"]*")\]/.exec(e);if(w)return Yt(e.substr(0,w.index)).concat(Yt(w[1])).concat(Yt(e.substr(w.index+w[0].length)));var B=e.split(".");if(B.length===1)return['"'+gi(e)+'"'];for(var S=[],C=0;C<B.length;++C)S=S.concat(Yt(B[C]));return S}function Ei(e){return"["+Yt(e).join("][")+"]"}function ru(e,i){return new lt(e,Ei(i+""))}function tu(e){return typeof e=="function"&&!e._reglType||e instanceof lt}function xi(e,i){if(typeof e=="function")return new lt(Jo,e);if(typeof e=="number"||typeof e=="boolean")return new lt($o,e);if(Array.isArray(e))return new lt(eu,e.map(function(m,w){return xi(m,i+"["+w+"]")}));if(e instanceof lt)return e;f(!1,"invalid option type in uniform "+i)}var Lr={DynamicVariable:lt,define:ru,isDynamic:tu,unbox:xi,accessor:Ei},ra={next:typeof requestAnimationFrame=="function"?function(e){return requestAnimationFrame(e)}:function(e){return setTimeout(e,16)},cancel:typeof cancelAnimationFrame=="function"?function(e){return cancelAnimationFrame(e)}:clearTimeout},Ai=typeof performance<"u"&&performance.now?function(){return performance.now()}:function(){return+new Date};function nu(){var e={"":0},i=[""];return{id:function(m){var w=e[m];return w||(w=e[m]=i.length,i.push(m),w)},str:function(m){return i[m]}}}function au(e,i,m){var w=document.createElement("canvas");s(w.style,{border:0,margin:0,padding:0,top:0,left:0,width:"100%",height:"100%"}),e.appendChild(w),e===document.body&&(w.style.position="absolute",s(e.style,{margin:0,padding:0}));function B(){var z=window.innerWidth,V=window.innerHeight;if(e!==document.body){var q=w.getBoundingClientRect();z=q.right-q.left,V=q.bottom-q.top}w.width=m*z,w.height=m*V}var S;e!==document.body&&typeof ResizeObserver=="function"?(S=new ResizeObserver(function(){setTimeout(B)}),S.observe(e)):window.addEventListener("resize",B,!1);function C(){S?S.disconnect():window.removeEventListener("resize",B),e.removeChild(w)}return B(),{canvas:w,onDestroy:C}}function iu(e,i){function m(w){try{return e.getContext(w,i)}catch{return null}}return m("webgl")||m("experimental-webgl")||m("webgl-experimental")}function fu(e){return typeof e.nodeName=="string"&&typeof e.appendChild=="function"&&typeof e.getBoundingClientRect=="function"}function ou(e){return typeof e.drawArrays=="function"||typeof e.drawElements=="function"}function Ti(e){return typeof e=="string"?e.split():(f(Array.isArray(e),"invalid extension array"),e)}function Si(e){return typeof e=="string"?(f(typeof document<"u","not supported outside of DOM"),document.querySelector(e)):e}function uu(e){var i=e||{},m,w,B,S,C={},z=[],V=[],q=typeof window>"u"?1:window.devicePixelRatio,K=!1,Y=function(W){W&&f.raise(W)},J=function(){};if(typeof i=="string"?(f(typeof document<"u","selector queries only supported in DOM enviroments"),m=document.querySelector(i),f(m,"invalid query string for element")):typeof i=="object"?fu(i)?m=i:ou(i)?(S=i,B=S.canvas):(f.constructor(i),"gl"in i?S=i.gl:"canvas"in i?B=Si(i.canvas):"container"in i&&(w=Si(i.container)),"attributes"in i&&(C=i.attributes,f.type(C,"object","invalid context attributes")),"extensions"in i&&(z=Ti(i.extensions)),"optionalExtensions"in i&&(V=Ti(i.optionalExtensions)),"onDone"in i&&(f.type(i.onDone,"function","invalid or missing onDone callback"),Y=i.onDone),"profile"in i&&(K=!!i.profile),"pixelRatio"in i&&(q=+i.pixelRatio,f(q>0,"invalid pixel ratio"))):f.raise("invalid arguments to regl"),m&&(m.nodeName.toLowerCase()==="canvas"?B=m:w=m),!S){if(!B){f(typeof document<"u","must manually specify webgl context outside of DOM environments");var j=au(w||document.body,Y,q);if(!j)return null;B=j.canvas,J=j.onDestroy}C.premultipliedAlpha===void 0&&(C.premultipliedAlpha=!0),S=iu(B,C)}return S?{gl:S,canvas:B,container:w,extensions:z,optionalExtensions:V,pixelRatio:q,profile:K,onDone:Y,onDestroy:J}:(J(),Y("webgl not supported, try upgrading your browser or graphics drivers http://get.webgl.org"),null)}function su(e,i){var m={};function w(C){f.type(C,"string","extension name must be string");var z=C.toLowerCase(),V;try{V=m[z]=e.getExtension(z)}catch{}return!!V}for(var B=0;B<i.extensions.length;++B){var S=i.extensions[B];if(!w(S))return i.onDestroy(),i.onDone('"'+S+'" extension is not supported by the current WebGL context, try upgrading your system or a different browser'),null}return i.optionalExtensions.forEach(w),{extensions:m,restore:function(){Object.keys(m).forEach(function(C){if(m[C]&&!w(C))throw new Error("(regl): error restoring extension "+C)})}}}function Or(e,i){for(var m=Array(e),w=0;w<e;++w)m[w]=i(w);return m}var lu=5120,cu=5121,du=5122,mu=5123,hu=5124,vu=5125,yu=5126;function bu(e){for(var i=16;i<=1<<28;i*=16)if(e<=i)return i;return 0}function wi(e){var i,m;return i=(e>65535)<<4,e>>>=i,m=(e>255)<<3,e>>>=m,i|=m,m=(e>15)<<2,e>>>=m,i|=m,m=(e>3)<<1,e>>>=m,i|=m,i|e>>1}function Li(){var e=Or(8,function(){return[]});function i(S){var C=bu(S),z=e[wi(C)>>2];return z.length>0?z.pop():new ArrayBuffer(C)}function m(S){e[wi(S.byteLength)>>2].push(S)}function w(S,C){var z=null;switch(S){case lu:z=new Int8Array(i(C),0,C);break;case cu:z=new Uint8Array(i(C),0,C);break;case du:z=new Int16Array(i(2*C),0,C);break;case mu:z=new Uint16Array(i(2*C),0,C);break;case hu:z=new Int32Array(i(4*C),0,C);break;case vu:z=new Uint32Array(i(4*C),0,C);break;case yu:z=new Float32Array(i(4*C),0,C);break;default:return null}return z.length!==C?z.subarray(0,C):z}function B(S){m(S.buffer)}return{alloc:i,free:m,allocType:w,freeType:B}}var nr=Li();nr.zero=Li();var _u=3408,pu=3410,gu=3411,Eu=3412,xu=3413,Au=3414,Tu=3415,Su=33901,wu=33902,Lu=3379,Ou=3386,Cu=34921,Ru=36347,Gu=36348,Du=35661,Iu=35660,Fu=34930,Bu=36349,Nu=34076,ku=34024,Pu=7936,Mu=7937,Uu=7938,Vu=35724,zu=34047,ju=36063,Hu=34852,En=3553,Oi=34067,Xu=34069,Wu=33984,Kt=6408,ta=5126,Ci=5121,na=36160,qu=36053,Yu=36064,Ku=16384,Zu=function(e,i){var m=1;i.ext_texture_filter_anisotropic&&(m=e.getParameter(zu));var w=1,B=1;i.webgl_draw_buffers&&(w=e.getParameter(Hu),B=e.getParameter(ju));var S=!!i.oes_texture_float;if(S){var C=e.createTexture();e.bindTexture(En,C),e.texImage2D(En,0,Kt,1,1,0,Kt,ta,null);var z=e.createFramebuffer();if(e.bindFramebuffer(na,z),e.framebufferTexture2D(na,Yu,En,C,0),e.bindTexture(En,null),e.checkFramebufferStatus(na)!==qu)S=!1;else{e.viewport(0,0,1,1),e.clearColor(1,0,0,1),e.clear(Ku);var V=nr.allocType(ta,4);e.readPixels(0,0,1,1,Kt,ta,V),e.getError()?S=!1:(e.deleteFramebuffer(z),e.deleteTexture(C),S=V[0]===1),nr.freeType(V)}}var q=typeof navigator<"u"&&(/MSIE/.test(navigator.userAgent)||/Trident\//.test(navigator.appVersion)||/Edge/.test(navigator.userAgent)),K=!0;if(!q){var Y=e.createTexture(),J=nr.allocType(Ci,36);e.activeTexture(Wu),e.bindTexture(Oi,Y),e.texImage2D(Xu,0,Kt,3,3,0,Kt,Ci,J),nr.freeType(J),e.bindTexture(Oi,null),e.deleteTexture(Y),K=!e.getError()}return{colorBits:[e.getParameter(pu),e.getParameter(gu),e.getParameter(Eu),e.getParameter(xu)],depthBits:e.getParameter(Au),stencilBits:e.getParameter(Tu),subpixelBits:e.getParameter(_u),extensions:Object.keys(i).filter(function(j){return!!i[j]}),maxAnisotropic:m,maxDrawbuffers:w,maxColorAttachments:B,pointSizeDims:e.getParameter(Su),lineWidthDims:e.getParameter(wu),maxViewportDims:e.getParameter(Ou),maxCombinedTextureUnits:e.getParameter(Du),maxCubeMapSize:e.getParameter(Nu),maxRenderbufferSize:e.getParameter(ku),maxTextureUnits:e.getParameter(Fu),maxTextureSize:e.getParameter(Lu),maxAttributes:e.getParameter(Cu),maxVertexUniforms:e.getParameter(Ru),maxVertexTextureUnits:e.getParameter(Iu),maxVaryingVectors:e.getParameter(Gu),maxFragmentUniforms:e.getParameter(Bu),glsl:e.getParameter(Vu),renderer:e.getParameter(Mu),vendor:e.getParameter(Pu),version:e.getParameter(Uu),readFloat:S,npotTextureCube:K}};function Pr(e){return!!e&&typeof e=="object"&&Array.isArray(e.shape)&&Array.isArray(e.stride)&&typeof e.offset=="number"&&e.shape.length===e.stride.length&&(Array.isArray(e.data)||a(e.data))}var Cr=function(e){return Object.keys(e).map(function(i){return e[i]})},xn={shape:es,flatten:$u};function Qu(e,i,m){for(var w=0;w<i;++w)m[w]=e[w]}function Ju(e,i,m,w){for(var B=0,S=0;S<i;++S)for(var C=e[S],z=0;z<m;++z)w[B++]=C[z]}function Ri(e,i,m,w,B,S){for(var C=S,z=0;z<i;++z)for(var V=e[z],q=0;q<m;++q)for(var K=V[q],Y=0;Y<w;++Y)B[C++]=K[Y]}function Gi(e,i,m,w,B){for(var S=1,C=m+1;C<i.length;++C)S*=i[C];var z=i[m];if(i.length-m===4){var V=i[m+1],q=i[m+2],K=i[m+3];for(C=0;C<z;++C)Ri(e[C],V,q,K,w,B),B+=S}else for(C=0;C<z;++C)Gi(e[C],i,m+1,w,B),B+=S}function $u(e,i,m,w){var B=1;if(i.length)for(var S=0;S<i.length;++S)B*=i[S];else B=0;var C=w||nr.allocType(m,B);switch(i.length){case 0:break;case 1:Qu(e,i[0],C);break;case 2:Ju(e,i[0],i[1],C);break;case 3:Ri(e,i[0],i[1],i[2],C,0);break;default:Gi(e,i,0,C,0)}return C}function es(e){for(var i=[],m=e;m.length;m=m[0])i.push(m.length);return i}var aa={"[object Int8Array]":5120,"[object Int16Array]":5122,"[object Int32Array]":5124,"[object Uint8Array]":5121,"[object Uint8ClampedArray]":5121,"[object Uint16Array]":5123,"[object Uint32Array]":5125,"[object Float32Array]":5126,"[object Float64Array]":5121,"[object ArrayBuffer]":5121},rs=5120,ts=5122,ns=5124,as=5121,is=5123,fs=5125,os=5126,us=5126,ct={int8:rs,int16:ts,int32:ns,uint8:as,uint16:is,uint32:fs,float:os,float32:us},ss=35048,ls=35040,An={dynamic:ss,stream:ls,static:35044},ia=xn.flatten,Di=xn.shape,Ii=35044,cs=35040,fa=5121,oa=5126,et=[];et[5120]=1,et[5122]=2,et[5124]=4,et[5121]=1,et[5123]=2,et[5125]=4,et[5126]=4;function Tn(e){return aa[Object.prototype.toString.call(e)]|0}function Fi(e,i){for(var m=0;m<i.length;++m)e[m]=i[m]}function Bi(e,i,m,w,B,S,C){for(var z=0,V=0;V<m;++V)for(var q=0;q<w;++q)e[z++]=i[B*V+S*q+C]}function ds(e,i,m,w){var B=0,S={};function C(g){this.id=B++,this.buffer=e.createBuffer(),this.type=g,this.usage=Ii,this.byteLength=0,this.dimension=1,this.dtype=fa,this.persistentData=null,m.profile&&(this.stats={size:0})}C.prototype.bind=function(){e.bindBuffer(this.type,this.buffer)},C.prototype.destroy=function(){J(this)};var z=[];function V(g,O){var X=z.pop();return X||(X=new C(g)),X.bind(),Y(X,O,cs,0,1,!1),X}function q(g){z.push(g)}function K(g,O,X){g.byteLength=O.byteLength,e.bufferData(g.type,O,X)}function Y(g,O,X,fe,U,ae){var te;if(g.usage=X,Array.isArray(O)){if(g.dtype=fe||oa,O.length>0){var be;if(Array.isArray(O[0])){te=Di(O);for(var k=1,F=1;F<te.length;++F)k*=te[F];g.dimension=k,be=ia(O,te,g.dtype),K(g,be,X),ae?g.persistentData=be:nr.freeType(be)}else if(typeof O[0]=="number"){g.dimension=U;var se=nr.allocType(g.dtype,O.length);Fi(se,O),K(g,se,X),ae?g.persistentData=se:nr.freeType(se)}else a(O[0])?(g.dimension=O[0].length,g.dtype=fe||Tn(O[0])||oa,be=ia(O,[O.length,O[0].length],g.dtype),K(g,be,X),ae?g.persistentData=be:nr.freeType(be)):f.raise("invalid buffer data")}}else if(a(O))g.dtype=fe||Tn(O),g.dimension=U,K(g,O,X),ae&&(g.persistentData=new Uint8Array(new Uint8Array(O.buffer)));else if(Pr(O)){te=O.shape;var $=O.stride,H=O.offset,ee=0,re=0,Se=0,xe=0;te.length===1?(ee=te[0],re=1,Se=$[0],xe=0):te.length===2?(ee=te[0],re=te[1],Se=$[0],xe=$[1]):f.raise("invalid shape"),g.dtype=fe||Tn(O.data)||oa,g.dimension=re;var ne=nr.allocType(g.dtype,ee*re);Bi(ne,O.data,ee,re,Se,xe,H),K(g,ne,X),ae?g.persistentData=ne:nr.freeType(ne)}else O instanceof ArrayBuffer?(g.dtype=fa,g.dimension=U,K(g,O,X),ae&&(g.persistentData=new Uint8Array(new Uint8Array(O)))):f.raise("invalid buffer data")}function J(g){i.bufferCount--,w(g);var O=g.buffer;f(O,"buffer must not be deleted already"),e.deleteBuffer(O),g.buffer=null,delete S[g.id]}function j(g,O,X,fe){i.bufferCount++;var U=new C(O);S[U.id]=U;function ae(k){var F=Ii,se=null,$=0,H=0,ee=1;return Array.isArray(k)||a(k)||Pr(k)||k instanceof ArrayBuffer?se=k:typeof k=="number"?$=k|0:k&&(f.type(k,"object","buffer arguments must be an object, a number or an array"),"data"in k&&(f(se===null||Array.isArray(se)||a(se)||Pr(se),"invalid data for buffer"),se=k.data),"usage"in k&&(f.parameter(k.usage,An,"invalid buffer usage"),F=An[k.usage]),"type"in k&&(f.parameter(k.type,ct,"invalid buffer type"),H=ct[k.type]),"dimension"in k&&(f.type(k.dimension,"number","invalid dimension"),ee=k.dimension|0),"length"in k&&(f.nni($,"buffer length must be a nonnegative integer"),$=k.length|0)),U.bind(),se?Y(U,se,F,H,ee,fe):($&&e.bufferData(U.type,$,F),U.dtype=H||fa,U.usage=F,U.dimension=ee,U.byteLength=$),m.profile&&(U.stats.size=U.byteLength*et[U.dtype]),ae}function te(k,F){f(F+k.byteLength<=U.byteLength,"invalid buffer subdata call, buffer is too small.  Can't write data of size "+k.byteLength+" starting from offset "+F+" to a buffer of size "+U.byteLength),e.bufferSubData(U.type,F,k)}function be(k,F){var se=(F||0)|0,$;if(U.bind(),a(k)||k instanceof ArrayBuffer)te(k,se);else if(Array.isArray(k)){if(k.length>0)if(typeof k[0]=="number"){var H=nr.allocType(U.dtype,k.length);Fi(H,k),te(H,se),nr.freeType(H)}else if(Array.isArray(k[0])||a(k[0])){$=Di(k);var ee=ia(k,$,U.dtype);te(ee,se),nr.freeType(ee)}else f.raise("invalid buffer data")}else if(Pr(k)){$=k.shape;var re=k.stride,Se=0,xe=0,ne=0,ie=0;$.length===1?(Se=$[0],xe=1,ne=re[0],ie=0):$.length===2?(Se=$[0],xe=$[1],ne=re[0],ie=re[1]):f.raise("invalid shape");var pe=Array.isArray(k.data)?U.dtype:Tn(k.data),we=nr.allocType(pe,Se*xe);Bi(we,k.data,Se,xe,ne,ie,k.offset),te(we,se),nr.freeType(we)}else f.raise("invalid data for buffer subdata");return ae}return X||ae(g),ae._reglType="buffer",ae._buffer=U,ae.subdata=be,m.profile&&(ae.stats=U.stats),ae.destroy=function(){J(U)},ae}function W(){Cr(S).forEach(function(g){g.buffer=e.createBuffer(),e.bindBuffer(g.type,g.buffer),e.bufferData(g.type,g.persistentData||g.byteLength,g.usage)})}return m.profile&&(i.getTotalBufferSize=function(){var g=0;return Object.keys(S).forEach(function(O){g+=S[O].stats.size}),g}),{create:j,createStream:V,destroyStream:q,clear:function(){Cr(S).forEach(J),z.forEach(J)},getBuffer:function(g){return g&&g._buffer instanceof C?g._buffer:null},restore:W,_initBuffer:Y}}var ms=0,hs=0,vs=1,ys=1,bs=4,_s=4,rt={points:ms,point:hs,lines:vs,line:ys,triangles:bs,triangle:_s,"line loop":2,"line strip":3,"triangle strip":5,"triangle fan":6},ps=0,gs=1,Zt=4,Es=5120,Lt=5121,Ni=5122,Ot=5123,ki=5124,dt=5125,ua=34963,xs=35040,As=35044;function Ts(e,i,m,w){var B={},S=0,C={uint8:Lt,uint16:Ot};i.oes_element_index_uint&&(C.uint32=dt);function z(W){this.id=S++,B[this.id]=this,this.buffer=W,this.primType=Zt,this.vertCount=0,this.type=0}z.prototype.bind=function(){this.buffer.bind()};var V=[];function q(W){var g=V.pop();return g||(g=new z(m.create(null,ua,!0,!1)._buffer)),Y(g,W,xs,-1,-1,0,0),g}function K(W){V.push(W)}function Y(W,g,O,X,fe,U,ae){W.buffer.bind();var te;if(g){var be=ae;!ae&&(!a(g)||Pr(g)&&!a(g.data))&&(be=i.oes_element_index_uint?dt:Ot),m._initBuffer(W.buffer,g,O,be,3)}else e.bufferData(ua,U,O),W.buffer.dtype=te||Lt,W.buffer.usage=O,W.buffer.dimension=3,W.buffer.byteLength=U;if(te=ae,!ae){switch(W.buffer.dtype){case Lt:case Es:te=Lt;break;case Ot:case Ni:te=Ot;break;case dt:case ki:te=dt;break;default:f.raise("unsupported type for element array")}W.buffer.dtype=te}W.type=te,f(te!==dt||!!i.oes_element_index_uint,"32 bit element buffers not supported, enable oes_element_index_uint first");var k=fe;k<0&&(k=W.buffer.byteLength,te===Ot?k>>=1:te===dt&&(k>>=2)),W.vertCount=k;var F=X;if(X<0){F=Zt;var se=W.buffer.dimension;se===1&&(F=ps),se===2&&(F=gs),se===3&&(F=Zt)}W.primType=F}function J(W){w.elementsCount--,f(W.buffer!==null,"must not double destroy elements"),delete B[W.id],W.buffer.destroy(),W.buffer=null}function j(W,g){var O=m.create(null,ua,!0),X=new z(O._buffer);w.elementsCount++;function fe(U){if(!U)O(),X.primType=Zt,X.vertCount=0,X.type=Lt;else if(typeof U=="number")O(U),X.primType=Zt,X.vertCount=U|0,X.type=Lt;else{var ae=null,te=As,be=-1,k=-1,F=0,se=0;Array.isArray(U)||a(U)||Pr(U)?ae=U:(f.type(U,"object","invalid arguments for elements"),"data"in U&&(ae=U.data,f(Array.isArray(ae)||a(ae)||Pr(ae),"invalid data for element buffer")),"usage"in U&&(f.parameter(U.usage,An,"invalid element buffer usage"),te=An[U.usage]),"primitive"in U&&(f.parameter(U.primitive,rt,"invalid element buffer primitive"),be=rt[U.primitive]),"count"in U&&(f(typeof U.count=="number"&&U.count>=0,"invalid vertex count for elements"),k=U.count|0),"type"in U&&(f.parameter(U.type,C,"invalid buffer type"),se=C[U.type]),"length"in U?F=U.length|0:(F=k,se===Ot||se===Ni?F*=2:(se===dt||se===ki)&&(F*=4))),Y(X,ae,te,be,k,F,se)}return fe}return fe(W),fe._reglType="elements",fe._elements=X,fe.subdata=function(U,ae){return O.subdata(U,ae),fe},fe.destroy=function(){J(X)},fe}return{create:j,createStream:q,destroyStream:K,getElements:function(W){return typeof W=="function"&&W._elements instanceof z?W._elements:null},clear:function(){Cr(B).forEach(J)}}}var Pi=new Float32Array(1),Ss=new Uint32Array(Pi.buffer),ws=5123;function Mi(e){for(var i=nr.allocType(ws,e.length),m=0;m<e.length;++m)if(isNaN(e[m]))i[m]=65535;else if(e[m]===1/0)i[m]=31744;else if(e[m]===-1/0)i[m]=64512;else{Pi[0]=e[m];var w=Ss[0],B=w>>>31<<15,S=(w<<1>>>24)-127,C=w>>13&1024-1;if(S<-24)i[m]=B;else if(S<-14){var z=-14-S;i[m]=B+(C+1024>>z)}else S>15?i[m]=B+31744:i[m]=B+(S+15<<10)+C}return i}function Xe(e){return Array.isArray(e)||a(e)}var Ui=function(e){return!(e&e-1)&&!!e},Ls=34467,jr=3553,sa=34067,Sn=34069,mt=6408,la=6406,wn=6407,Qt=6409,Ln=6410,Vi=32854,ca=32855,zi=36194,Os=32819,Cs=32820,Rs=33635,Gs=34042,da=6402,On=34041,ma=35904,ha=35906,Ct=36193,va=33776,ya=33777,ba=33778,_a=33779,ji=35986,Hi=35987,Xi=34798,Wi=35840,qi=35841,Yi=35842,Ki=35843,Zi=36196,Rt=5121,pa=5123,ga=5125,Jt=5126,Ds=10242,Is=10243,Fs=10497,Ea=33071,Bs=33648,Ns=10240,ks=10241,xa=9728,Ps=9729,Aa=9984,Qi=9985,Ji=9986,Ta=9987,Ms=33170,Cn=4352,Us=4353,Vs=4354,zs=34046,js=3317,Hs=37440,Xs=37441,Ws=37443,$i=37444,$t=33984,qs=[Aa,Ji,Qi,Ta],Rn=[0,Qt,Ln,wn,mt],Br={};Br[Qt]=Br[la]=Br[da]=1,Br[On]=Br[Ln]=2,Br[wn]=Br[ma]=3,Br[mt]=Br[ha]=4;function Gt(e){return"[object "+e+"]"}var ef=Gt("HTMLCanvasElement"),rf=Gt("OffscreenCanvas"),tf=Gt("CanvasRenderingContext2D"),nf=Gt("ImageBitmap"),af=Gt("HTMLImageElement"),ff=Gt("HTMLVideoElement"),Ys=Object.keys(aa).concat([ef,rf,tf,nf,af,ff]),Dt=[];Dt[Rt]=1,Dt[Jt]=4,Dt[Ct]=2,Dt[pa]=2,Dt[ga]=4;var mr=[];mr[Vi]=2,mr[ca]=2,mr[zi]=2,mr[On]=4,mr[va]=.5,mr[ya]=.5,mr[ba]=1,mr[_a]=1,mr[ji]=.5,mr[Hi]=1,mr[Xi]=1,mr[Wi]=.5,mr[qi]=.25,mr[Yi]=.5,mr[Ki]=.25,mr[Zi]=.5;function of(e){return Array.isArray(e)&&(e.length===0||typeof e[0]=="number")}function uf(e){if(!Array.isArray(e))return!1;var i=e.length;return!(i===0||!Xe(e[0]))}function ht(e){return Object.prototype.toString.call(e)}function sf(e){return ht(e)===ef}function lf(e){return ht(e)===rf}function Ks(e){return ht(e)===tf}function Zs(e){return ht(e)===nf}function Qs(e){return ht(e)===af}function Js(e){return ht(e)===ff}function Sa(e){if(!e)return!1;var i=ht(e);return Ys.indexOf(i)>=0?!0:of(e)||uf(e)||Pr(e)}function cf(e){return aa[Object.prototype.toString.call(e)]|0}function $s(e,i){var m=i.length;switch(e.type){case Rt:case pa:case ga:case Jt:var w=nr.allocType(e.type,m);w.set(i),e.data=w;break;case Ct:e.data=Mi(i);break;default:f.raise("unsupported texture type, must specify a typed array")}}function df(e,i){return nr.allocType(e.type===Ct?Jt:e.type,i)}function mf(e,i){e.type===Ct?(e.data=Mi(i),nr.freeType(i)):e.data=i}function el(e,i,m,w,B,S){for(var C=e.width,z=e.height,V=e.channels,q=C*z*V,K=df(e,q),Y=0,J=0;J<z;++J)for(var j=0;j<C;++j)for(var W=0;W<V;++W)K[Y++]=i[m*j+w*J+B*W+S];mf(e,K)}function Gn(e,i,m,w,B,S){var C;if(typeof mr[e]<"u"?C=mr[e]:C=Br[e]*Dt[i],S&&(C*=6),B){for(var z=0,V=m;V>=1;)z+=C*V*V,V/=2;return z}else return C*m*w}function rl(e,i,m,w,B,S,C){var z={"don't care":Cn,"dont care":Cn,nice:Vs,fast:Us},V={repeat:Fs,clamp:Ea,mirror:Bs},q={nearest:xa,linear:Ps},K=s({mipmap:Ta,"nearest mipmap nearest":Aa,"linear mipmap nearest":Qi,"nearest mipmap linear":Ji,"linear mipmap linear":Ta},q),Y={none:0,browser:$i},J={uint8:Rt,rgba4:Os,rgb565:Rs,"rgb5 a1":Cs},j={alpha:la,luminance:Qt,"luminance alpha":Ln,rgb:wn,rgba:mt,rgba4:Vi,"rgb5 a1":ca,rgb565:zi},W={};i.ext_srgb&&(j.srgb=ma,j.srgba=ha),i.oes_texture_float&&(J.float32=J.float=Jt),i.oes_texture_half_float&&(J.float16=J["half float"]=Ct),i.webgl_depth_texture&&(s(j,{depth:da,"depth stencil":On}),s(J,{uint16:pa,uint32:ga,"depth stencil":Gs})),i.webgl_compressed_texture_s3tc&&s(W,{"rgb s3tc dxt1":va,"rgba s3tc dxt1":ya,"rgba s3tc dxt3":ba,"rgba s3tc dxt5":_a}),i.webgl_compressed_texture_atc&&s(W,{"rgb atc":ji,"rgba atc explicit alpha":Hi,"rgba atc interpolated alpha":Xi}),i.webgl_compressed_texture_pvrtc&&s(W,{"rgb pvrtc 4bppv1":Wi,"rgb pvrtc 2bppv1":qi,"rgba pvrtc 4bppv1":Yi,"rgba pvrtc 2bppv1":Ki}),i.webgl_compressed_texture_etc1&&(W["rgb etc1"]=Zi);var g=Array.prototype.slice.call(e.getParameter(Ls));Object.keys(W).forEach(function(c){var L=W[c];g.indexOf(L)>=0&&(j[c]=L)});var O=Object.keys(j);m.textureFormats=O;var X=[];Object.keys(j).forEach(function(c){var L=j[c];X[L]=c});var fe=[];Object.keys(J).forEach(function(c){var L=J[c];fe[L]=c});var U=[];Object.keys(q).forEach(function(c){var L=q[c];U[L]=c});var ae=[];Object.keys(K).forEach(function(c){var L=K[c];ae[L]=c});var te=[];Object.keys(V).forEach(function(c){var L=V[c];te[L]=c});var be=O.reduce(function(c,L){var T=j[L];return T===Qt||T===la||T===Qt||T===Ln||T===da||T===On||i.ext_srgb&&(T===ma||T===ha)?c[T]=T:T===ca||L.indexOf("rgba")>=0?c[T]=mt:c[T]=wn,c},{});function k(){this.internalformat=mt,this.format=mt,this.type=Rt,this.compressed=!1,this.premultiplyAlpha=!1,this.flipY=!1,this.unpackAlignment=1,this.colorSpace=$i,this.width=0,this.height=0,this.channels=0}function F(c,L){c.internalformat=L.internalformat,c.format=L.format,c.type=L.type,c.compressed=L.compressed,c.premultiplyAlpha=L.premultiplyAlpha,c.flipY=L.flipY,c.unpackAlignment=L.unpackAlignment,c.colorSpace=L.colorSpace,c.width=L.width,c.height=L.height,c.channels=L.channels}function se(c,L){if(!(typeof L!="object"||!L)){if("premultiplyAlpha"in L&&(f.type(L.premultiplyAlpha,"boolean","invalid premultiplyAlpha"),c.premultiplyAlpha=L.premultiplyAlpha),"flipY"in L&&(f.type(L.flipY,"boolean","invalid texture flip"),c.flipY=L.flipY),"alignment"in L&&(f.oneOf(L.alignment,[1,2,4,8],"invalid texture unpack alignment"),c.unpackAlignment=L.alignment),"colorSpace"in L&&(f.parameter(L.colorSpace,Y,"invalid colorSpace"),c.colorSpace=Y[L.colorSpace]),"type"in L){var T=L.type;f(i.oes_texture_float||!(T==="float"||T==="float32"),"you must enable the OES_texture_float extension in order to use floating point textures."),f(i.oes_texture_half_float||!(T==="half float"||T==="float16"),"you must enable the OES_texture_half_float extension in order to use 16-bit floating point textures."),f(i.webgl_depth_texture||!(T==="uint16"||T==="uint32"||T==="depth stencil"),"you must enable the WEBGL_depth_texture extension in order to use depth/stencil textures."),f.parameter(T,J,"invalid texture type"),c.type=J[T]}var ue=c.width,Ce=c.height,o=c.channels,n=!1;"shape"in L?(f(Array.isArray(L.shape)&&L.shape.length>=2,"shape must be an array"),ue=L.shape[0],Ce=L.shape[1],L.shape.length===3&&(o=L.shape[2],f(o>0&&o<=4,"invalid number of channels"),n=!0),f(ue>=0&&ue<=m.maxTextureSize,"invalid width"),f(Ce>=0&&Ce<=m.maxTextureSize,"invalid height")):("radius"in L&&(ue=Ce=L.radius,f(ue>=0&&ue<=m.maxTextureSize,"invalid radius")),"width"in L&&(ue=L.width,f(ue>=0&&ue<=m.maxTextureSize,"invalid width")),"height"in L&&(Ce=L.height,f(Ce>=0&&Ce<=m.maxTextureSize,"invalid height")),"channels"in L&&(o=L.channels,f(o>0&&o<=4,"invalid number of channels"),n=!0)),c.width=ue|0,c.height=Ce|0,c.channels=o|0;var v=!1;if("format"in L){var p=L.format;f(i.webgl_depth_texture||!(p==="depth"||p==="depth stencil"),"you must enable the WEBGL_depth_texture extension in order to use depth/stencil textures."),f.parameter(p,j,"invalid texture format");var E=c.internalformat=j[p];c.format=be[E],p in J&&("type"in L||(c.type=J[p])),p in W&&(c.compressed=!0),v=!0}!n&&v?c.channels=Br[c.format]:n&&!v?c.channels!==Rn[c.format]&&(c.format=c.internalformat=Rn[c.channels]):v&&n&&f(c.channels===Br[c.format],"number of channels inconsistent with specified format")}}function $(c){e.pixelStorei(Hs,c.flipY),e.pixelStorei(Xs,c.premultiplyAlpha),e.pixelStorei(Ws,c.colorSpace),e.pixelStorei(js,c.unpackAlignment)}function H(){k.call(this),this.xOffset=0,this.yOffset=0,this.data=null,this.needsFree=!1,this.element=null,this.needsCopy=!1}function ee(c,L){var T=null;if(Sa(L)?T=L:L&&(f.type(L,"object","invalid pixel data type"),se(c,L),"x"in L&&(c.xOffset=L.x|0),"y"in L&&(c.yOffset=L.y|0),Sa(L.data)&&(T=L.data)),f(!c.compressed||T instanceof Uint8Array,"compressed texture data must be stored in a uint8array"),L.copy){f(!T,"can not specify copy and data field for the same texture");var ue=B.viewportWidth,Ce=B.viewportHeight;c.width=c.width||ue-c.xOffset,c.height=c.height||Ce-c.yOffset,c.needsCopy=!0,f(c.xOffset>=0&&c.xOffset<ue&&c.yOffset>=0&&c.yOffset<Ce&&c.width>0&&c.width<=ue&&c.height>0&&c.height<=Ce,"copy texture read out of bounds")}else if(!T)c.width=c.width||1,c.height=c.height||1,c.channels=c.channels||4;else if(a(T))c.channels=c.channels||4,c.data=T,!("type"in L)&&c.type===Rt&&(c.type=cf(T));else if(of(T))c.channels=c.channels||4,$s(c,T),c.alignment=1,c.needsFree=!0;else if(Pr(T)){var o=T.data;!Array.isArray(o)&&c.type===Rt&&(c.type=cf(o));var n=T.shape,v=T.stride,p,E,b,y,_,u;n.length===3?(b=n[2],u=v[2]):(f(n.length===2,"invalid ndarray pixel data, must be 2 or 3D"),b=1,u=1),p=n[0],E=n[1],y=v[0],_=v[1],c.alignment=1,c.width=p,c.height=E,c.channels=b,c.format=c.internalformat=Rn[b],c.needsFree=!0,el(c,o,y,_,u,T.offset)}else if(sf(T)||lf(T)||Ks(T))sf(T)||lf(T)?c.element=T:c.element=T.canvas,c.width=c.element.width,c.height=c.element.height,c.channels=4;else if(Zs(T))c.element=T,c.width=T.width,c.height=T.height,c.channels=4;else if(Qs(T))c.element=T,c.width=T.naturalWidth,c.height=T.naturalHeight,c.channels=4;else if(Js(T))c.element=T,c.width=T.videoWidth,c.height=T.videoHeight,c.channels=4;else if(uf(T)){var d=c.width||T[0].length,l=c.height||T.length,A=c.channels;Xe(T[0][0])?A=A||T[0][0].length:A=A||1;for(var x=xn.shape(T),I=1,P=0;P<x.length;++P)I*=x[P];var Q=df(c,I);xn.flatten(T,x,"",Q),mf(c,Q),c.alignment=1,c.width=d,c.height=l,c.channels=A,c.format=c.internalformat=Rn[A],c.needsFree=!0}c.type===Jt?f(m.extensions.indexOf("oes_texture_float")>=0,"oes_texture_float extension not enabled"):c.type===Ct&&f(m.extensions.indexOf("oes_texture_half_float")>=0,"oes_texture_half_float extension not enabled")}function re(c,L,T){var ue=c.element,Ce=c.data,o=c.internalformat,n=c.format,v=c.type,p=c.width,E=c.height;$(c),ue?e.texImage2D(L,T,n,n,v,ue):c.compressed?e.compressedTexImage2D(L,T,o,p,E,0,Ce):c.needsCopy?(w(),e.copyTexImage2D(L,T,n,c.xOffset,c.yOffset,p,E,0)):e.texImage2D(L,T,n,p,E,0,n,v,Ce||null)}function Se(c,L,T,ue,Ce){var o=c.element,n=c.data,v=c.internalformat,p=c.format,E=c.type,b=c.width,y=c.height;$(c),o?e.texSubImage2D(L,Ce,T,ue,p,E,o):c.compressed?e.compressedTexSubImage2D(L,Ce,T,ue,v,b,y,n):c.needsCopy?(w(),e.copyTexSubImage2D(L,Ce,T,ue,c.xOffset,c.yOffset,b,y)):e.texSubImage2D(L,Ce,T,ue,b,y,p,E,n)}var xe=[];function ne(){return xe.pop()||new H}function ie(c){c.needsFree&&nr.freeType(c.data),H.call(c),xe.push(c)}function pe(){k.call(this),this.genMipmaps=!1,this.mipmapHint=Cn,this.mipmask=0,this.images=Array(16)}function we(c,L,T){var ue=c.images[0]=ne();c.mipmask=1,ue.width=c.width=L,ue.height=c.height=T,ue.channels=c.channels=4}function Re(c,L){var T=null;if(Sa(L))T=c.images[0]=ne(),F(T,c),ee(T,L),c.mipmask=1;else if(se(c,L),Array.isArray(L.mipmap))for(var ue=L.mipmap,Ce=0;Ce<ue.length;++Ce)T=c.images[Ce]=ne(),F(T,c),T.width>>=Ce,T.height>>=Ce,ee(T,ue[Ce]),c.mipmask|=1<<Ce;else T=c.images[0]=ne(),F(T,c),ee(T,L),c.mipmask=1;F(c,c.images[0]),c.compressed&&(c.internalformat===va||c.internalformat===ya||c.internalformat===ba||c.internalformat===_a)&&f(c.width%4===0&&c.height%4===0,"for compressed texture formats, mipmap level 0 must have width and height that are a multiple of 4")}function We(c,L){for(var T=c.images,ue=0;ue<T.length;++ue){if(!T[ue])return;re(T[ue],L,ue)}}var Ye=[];function De(){var c=Ye.pop()||new pe;k.call(c),c.mipmask=0;for(var L=0;L<16;++L)c.images[L]=null;return c}function fr(c){for(var L=c.images,T=0;T<L.length;++T)L[T]&&ie(L[T]),L[T]=null;Ye.push(c)}function ze(){this.minFilter=xa,this.magFilter=xa,this.wrapS=Ea,this.wrapT=Ea,this.anisotropic=1,this.genMipmaps=!1,this.mipmapHint=Cn}function ir(c,L){if("min"in L){var T=L.min;f.parameter(T,K),c.minFilter=K[T],qs.indexOf(c.minFilter)>=0&&!("faces"in L)&&(c.genMipmaps=!0)}if("mag"in L){var ue=L.mag;f.parameter(ue,q),c.magFilter=q[ue]}var Ce=c.wrapS,o=c.wrapT;if("wrap"in L){var n=L.wrap;typeof n=="string"?(f.parameter(n,V),Ce=o=V[n]):Array.isArray(n)&&(f.parameter(n[0],V),f.parameter(n[1],V),Ce=V[n[0]],o=V[n[1]])}else{if("wrapS"in L){var v=L.wrapS;f.parameter(v,V),Ce=V[v]}if("wrapT"in L){var p=L.wrapT;f.parameter(p,V),o=V[p]}}if(c.wrapS=Ce,c.wrapT=o,"anisotropic"in L){var E=L.anisotropic;f(typeof E=="number"&&E>=1&&E<=m.maxAnisotropic,"aniso samples must be between 1 and "),c.anisotropic=L.anisotropic}if("mipmap"in L){var b=!1;switch(typeof L.mipmap){case"string":f.parameter(L.mipmap,z,"invalid mipmap hint"),c.mipmapHint=z[L.mipmap],c.genMipmaps=!0,b=!0;break;case"boolean":b=c.genMipmaps=L.mipmap;break;case"object":f(Array.isArray(L.mipmap),"invalid mipmap type"),c.genMipmaps=!1,b=!0;break;default:f.raise("invalid mipmap type")}b&&!("min"in L)&&(c.minFilter=Aa)}}function or(c,L){e.texParameteri(L,ks,c.minFilter),e.texParameteri(L,Ns,c.magFilter),e.texParameteri(L,Ds,c.wrapS),e.texParameteri(L,Is,c.wrapT),i.ext_texture_filter_anisotropic&&e.texParameteri(L,zs,c.anisotropic),c.genMipmaps&&(e.hint(Ms,c.mipmapHint),e.generateMipmap(L))}var ur=0,cr={},hr=m.maxTextureUnits,er=Array(hr).map(function(){return null});function Le(c){k.call(this),this.mipmask=0,this.internalformat=mt,this.id=ur++,this.refCount=1,this.target=c,this.texture=e.createTexture(),this.unit=-1,this.bindCount=0,this.texInfo=new ze,C.profile&&(this.stats={size:0})}function vr(c){e.activeTexture($t),e.bindTexture(c.target,c.texture)}function Ne(){var c=er[0];c?e.bindTexture(c.target,c.texture):e.bindTexture(jr,null)}function _e(c){var L=c.texture;f(L,"must not double destroy texture");var T=c.unit,ue=c.target;T>=0&&(e.activeTexture($t+T),e.bindTexture(ue,null),er[T]=null),e.deleteTexture(L),c.texture=null,c.params=null,c.pixels=null,c.refCount=0,delete cr[c.id],S.textureCount--}s(Le.prototype,{bind:function(){var c=this;c.bindCount+=1;var L=c.unit;if(L<0){for(var T=0;T<hr;++T){var ue=er[T];if(ue){if(ue.bindCount>0)continue;ue.unit=-1}er[T]=c,L=T;break}L>=hr&&f.raise("insufficient number of texture units"),C.profile&&S.maxTextureUnits<L+1&&(S.maxTextureUnits=L+1),c.unit=L,e.activeTexture($t+L),e.bindTexture(c.target,c.texture)}return L},unbind:function(){this.bindCount-=1},decRef:function(){--this.refCount<=0&&_e(this)}});function Ge(c,L){var T=new Le(jr);cr[T.id]=T,S.textureCount++;function ue(n,v){var p=T.texInfo;ze.call(p);var E=De();return typeof n=="number"?typeof v=="number"?we(E,n|0,v|0):we(E,n|0,n|0):n?(f.type(n,"object","invalid arguments to regl.texture"),ir(p,n),Re(E,n)):we(E,1,1),p.genMipmaps&&(E.mipmask=(E.width<<1)-1),T.mipmask=E.mipmask,F(T,E),f.texture2D(p,E,m),T.internalformat=E.internalformat,ue.width=E.width,ue.height=E.height,vr(T),We(E,jr),or(p,jr),Ne(),fr(E),C.profile&&(T.stats.size=Gn(T.internalformat,T.type,E.width,E.height,p.genMipmaps,!1)),ue.format=X[T.internalformat],ue.type=fe[T.type],ue.mag=U[p.magFilter],ue.min=ae[p.minFilter],ue.wrapS=te[p.wrapS],ue.wrapT=te[p.wrapT],ue}function Ce(n,v,p,E){f(!!n,"must specify image data");var b=v|0,y=p|0,_=E|0,u=ne();return F(u,T),u.width=0,u.height=0,ee(u,n),u.width=u.width||(T.width>>_)-b,u.height=u.height||(T.height>>_)-y,f(T.type===u.type&&T.format===u.format&&T.internalformat===u.internalformat,"incompatible format for texture.subimage"),f(b>=0&&y>=0&&b+u.width<=T.width&&y+u.height<=T.height,"texture.subimage write out of bounds"),f(T.mipmask&1<<_,"missing mipmap data"),f(u.data||u.element||u.needsCopy,"missing image data"),vr(T),Se(u,jr,b,y,_),Ne(),ie(u),ue}function o(n,v){var p=n|0,E=v|0||p;if(p===T.width&&E===T.height)return ue;ue.width=T.width=p,ue.height=T.height=E,vr(T);for(var b=0;T.mipmask>>b;++b){var y=p>>b,_=E>>b;if(!y||!_)break;e.texImage2D(jr,b,T.format,y,_,0,T.format,T.type,null)}return Ne(),C.profile&&(T.stats.size=Gn(T.internalformat,T.type,p,E,!1,!1)),ue}return ue(c,L),ue.subimage=Ce,ue.resize=o,ue._reglType="texture2d",ue._texture=T,C.profile&&(ue.stats=T.stats),ue.destroy=function(){T.decRef()},ue}function Ie(c,L,T,ue,Ce,o){var n=new Le(sa);cr[n.id]=n,S.cubeCount++;var v=new Array(6);function p(y,_,u,d,l,A){var x,I=n.texInfo;for(ze.call(I),x=0;x<6;++x)v[x]=De();if(typeof y=="number"||!y){var P=y|0||1;for(x=0;x<6;++x)we(v[x],P,P)}else if(typeof y=="object")if(_)Re(v[0],y),Re(v[1],_),Re(v[2],u),Re(v[3],d),Re(v[4],l),Re(v[5],A);else if(ir(I,y),se(n,y),"faces"in y){var Q=y.faces;for(f(Array.isArray(Q)&&Q.length===6,"cube faces must be a length 6 array"),x=0;x<6;++x)f(typeof Q[x]=="object"&&!!Q[x],"invalid input for cube map face"),F(v[x],n),Re(v[x],Q[x])}else for(x=0;x<6;++x)Re(v[x],y);else f.raise("invalid arguments to cube map");for(F(n,v[0]),f.optional(function(){m.npotTextureCube||f(Ui(n.width)&&Ui(n.height),"your browser does not support non power or two texture dimensions")}),I.genMipmaps?n.mipmask=(v[0].width<<1)-1:n.mipmask=v[0].mipmask,f.textureCube(n,I,v,m),n.internalformat=v[0].internalformat,p.width=v[0].width,p.height=v[0].height,vr(n),x=0;x<6;++x)We(v[x],Sn+x);for(or(I,sa),Ne(),C.profile&&(n.stats.size=Gn(n.internalformat,n.type,p.width,p.height,I.genMipmaps,!0)),p.format=X[n.internalformat],p.type=fe[n.type],p.mag=U[I.magFilter],p.min=ae[I.minFilter],p.wrapS=te[I.wrapS],p.wrapT=te[I.wrapT],x=0;x<6;++x)fr(v[x]);return p}function E(y,_,u,d,l){f(!!_,"must specify image data"),f(typeof y=="number"&&y===(y|0)&&y>=0&&y<6,"invalid face");var A=u|0,x=d|0,I=l|0,P=ne();return F(P,n),P.width=0,P.height=0,ee(P,_),P.width=P.width||(n.width>>I)-A,P.height=P.height||(n.height>>I)-x,f(n.type===P.type&&n.format===P.format&&n.internalformat===P.internalformat,"incompatible format for texture.subimage"),f(A>=0&&x>=0&&A+P.width<=n.width&&x+P.height<=n.height,"texture.subimage write out of bounds"),f(n.mipmask&1<<I,"missing mipmap data"),f(P.data||P.element||P.needsCopy,"missing image data"),vr(n),Se(P,Sn+y,A,x,I),Ne(),ie(P),p}function b(y){var _=y|0;if(_!==n.width){p.width=n.width=_,p.height=n.height=_,vr(n);for(var u=0;u<6;++u)for(var d=0;n.mipmask>>d;++d)e.texImage2D(Sn+u,d,n.format,_>>d,_>>d,0,n.format,n.type,null);return Ne(),C.profile&&(n.stats.size=Gn(n.internalformat,n.type,p.width,p.height,!1,!0)),p}}return p(c,L,T,ue,Ce,o),p.subimage=E,p.resize=b,p._reglType="textureCube",p._texture=n,C.profile&&(p.stats=n.stats),p.destroy=function(){n.decRef()},p}function rr(){for(var c=0;c<hr;++c)e.activeTexture($t+c),e.bindTexture(jr,null),er[c]=null;Cr(cr).forEach(_e),S.cubeCount=0,S.textureCount=0}C.profile&&(S.getTotalTextureSize=function(){var c=0;return Object.keys(cr).forEach(function(L){c+=cr[L].stats.size}),c});function Xr(){for(var c=0;c<hr;++c){var L=er[c];L&&(L.bindCount=0,L.unit=-1,er[c]=null)}Cr(cr).forEach(function(T){T.texture=e.createTexture(),e.bindTexture(T.target,T.texture);for(var ue=0;ue<32;++ue)if(T.mipmask&1<<ue)if(T.target===jr)e.texImage2D(jr,ue,T.internalformat,T.width>>ue,T.height>>ue,0,T.internalformat,T.type,null);else for(var Ce=0;Ce<6;++Ce)e.texImage2D(Sn+Ce,ue,T.internalformat,T.width>>ue,T.height>>ue,0,T.internalformat,T.type,null);or(T.texInfo,T.target)})}function Et(){for(var c=0;c<hr;++c){var L=er[c];L&&(L.bindCount=0,L.unit=-1,er[c]=null),e.activeTexture($t+c),e.bindTexture(jr,null),e.bindTexture(sa,null)}}return{create2D:Ge,createCube:Ie,clear:rr,getTexture:function(c){return null},restore:Xr,refresh:Et}}var tt=36161,Dn=32854,hf=32855,vf=36194,yf=33189,bf=36168,_f=34041,pf=35907,gf=34836,Ef=34842,xf=34843,Mr=[];Mr[Dn]=2,Mr[hf]=2,Mr[vf]=2,Mr[yf]=2,Mr[bf]=1,Mr[_f]=4,Mr[pf]=4,Mr[gf]=16,Mr[Ef]=8,Mr[xf]=6;function Af(e,i,m){return Mr[e]*i*m}var tl=function(e,i,m,w,B){var S={rgba4:Dn,rgb565:vf,"rgb5 a1":hf,depth:yf,stencil:bf,"depth stencil":_f};i.ext_srgb&&(S.srgba=pf),i.ext_color_buffer_half_float&&(S.rgba16f=Ef,S.rgb16f=xf),i.webgl_color_buffer_float&&(S.rgba32f=gf);var C=[];Object.keys(S).forEach(function(j){var W=S[j];C[W]=j});var z=0,V={};function q(j){this.id=z++,this.refCount=1,this.renderbuffer=j,this.format=Dn,this.width=0,this.height=0,B.profile&&(this.stats={size:0})}q.prototype.decRef=function(){--this.refCount<=0&&K(this)};function K(j){var W=j.renderbuffer;f(W,"must not double destroy renderbuffer"),e.bindRenderbuffer(tt,null),e.deleteRenderbuffer(W),j.renderbuffer=null,j.refCount=0,delete V[j.id],w.renderbufferCount--}function Y(j,W){var g=new q(e.createRenderbuffer());V[g.id]=g,w.renderbufferCount++;function O(fe,U){var ae=0,te=0,be=Dn;if(typeof fe=="object"&&fe){var k=fe;if("shape"in k){var F=k.shape;f(Array.isArray(F)&&F.length>=2,"invalid renderbuffer shape"),ae=F[0]|0,te=F[1]|0}else"radius"in k&&(ae=te=k.radius|0),"width"in k&&(ae=k.width|0),"height"in k&&(te=k.height|0);"format"in k&&(f.parameter(k.format,S,"invalid renderbuffer format"),be=S[k.format])}else typeof fe=="number"?(ae=fe|0,typeof U=="number"?te=U|0:te=ae):fe?f.raise("invalid arguments to renderbuffer constructor"):ae=te=1;if(f(ae>0&&te>0&&ae<=m.maxRenderbufferSize&&te<=m.maxRenderbufferSize,"invalid renderbuffer size"),!(ae===g.width&&te===g.height&&be===g.format))return O.width=g.width=ae,O.height=g.height=te,g.format=be,e.bindRenderbuffer(tt,g.renderbuffer),e.renderbufferStorage(tt,be,ae,te),f(e.getError()===0,"invalid render buffer format"),B.profile&&(g.stats.size=Af(g.format,g.width,g.height)),O.format=C[g.format],O}function X(fe,U){var ae=fe|0,te=U|0||ae;return ae===g.width&&te===g.height||(f(ae>0&&te>0&&ae<=m.maxRenderbufferSize&&te<=m.maxRenderbufferSize,"invalid renderbuffer size"),O.width=g.width=ae,O.height=g.height=te,e.bindRenderbuffer(tt,g.renderbuffer),e.renderbufferStorage(tt,g.format,ae,te),f(e.getError()===0,"invalid render buffer format"),B.profile&&(g.stats.size=Af(g.format,g.width,g.height))),O}return O(j,W),O.resize=X,O._reglType="renderbuffer",O._renderbuffer=g,B.profile&&(O.stats=g.stats),O.destroy=function(){g.decRef()},O}B.profile&&(w.getTotalRenderbufferSize=function(){var j=0;return Object.keys(V).forEach(function(W){j+=V[W].stats.size}),j});function J(){Cr(V).forEach(function(j){j.renderbuffer=e.createRenderbuffer(),e.bindRenderbuffer(tt,j.renderbuffer),e.renderbufferStorage(tt,j.format,j.width,j.height)}),e.bindRenderbuffer(tt,null)}return{create:Y,clear:function(){Cr(V).forEach(K)},restore:J}},qr=36160,wa=36161,vt=3553,In=34069,Tf=36064,Sf=36096,wf=36128,Lf=33306,Of=36053,nl=36054,al=36055,il=36057,fl=36061,ol=36193,ul=5121,sl=5126,Cf=6407,Rf=6408,ll=6402,cl=[Cf,Rf],La=[];La[Rf]=4,La[Cf]=3;var Fn=[];Fn[ul]=1,Fn[sl]=4,Fn[ol]=2;var dl=32854,ml=32855,hl=36194,vl=33189,yl=36168,Gf=34041,bl=35907,_l=34836,pl=34842,gl=34843,El=[dl,ml,hl,bl,pl,gl,_l],It={};It[Of]="complete",It[nl]="incomplete attachment",It[il]="incomplete dimensions",It[al]="incomplete, missing attachment",It[fl]="unsupported";function xl(e,i,m,w,B,S){var C={cur:null,next:null,dirty:!1,setFBO:null},z=["rgba"],V=["rgba4","rgb565","rgb5 a1"];i.ext_srgb&&V.push("srgba"),i.ext_color_buffer_half_float&&V.push("rgba16f","rgb16f"),i.webgl_color_buffer_float&&V.push("rgba32f");var q=["uint8"];i.oes_texture_half_float&&q.push("half float","float16"),i.oes_texture_float&&q.push("float","float32");function K(H,ee,re){this.target=H,this.texture=ee,this.renderbuffer=re;var Se=0,xe=0;ee?(Se=ee.width,xe=ee.height):re&&(Se=re.width,xe=re.height),this.width=Se,this.height=xe}function Y(H){H&&(H.texture&&H.texture._texture.decRef(),H.renderbuffer&&H.renderbuffer._renderbuffer.decRef())}function J(H,ee,re){if(H)if(H.texture){var Se=H.texture._texture,xe=Math.max(1,Se.width),ne=Math.max(1,Se.height);f(xe===ee&&ne===re,"inconsistent width/height for supplied texture"),Se.refCount+=1}else{var ie=H.renderbuffer._renderbuffer;f(ie.width===ee&&ie.height===re,"inconsistent width/height for renderbuffer"),ie.refCount+=1}}function j(H,ee){ee&&(ee.texture?e.framebufferTexture2D(qr,H,ee.target,ee.texture._texture.texture,0):e.framebufferRenderbuffer(qr,H,wa,ee.renderbuffer._renderbuffer.renderbuffer))}function W(H){var ee=vt,re=null,Se=null,xe=H;typeof H=="object"&&(xe=H.data,"target"in H&&(ee=H.target|0)),f.type(xe,"function","invalid attachment data");var ne=xe._reglType;return ne==="texture2d"?(re=xe,f(ee===vt)):ne==="textureCube"?(re=xe,f(ee>=In&&ee<In+6,"invalid cube map target")):ne==="renderbuffer"?(Se=xe,ee=wa):f.raise("invalid regl object for attachment"),new K(ee,re,Se)}function g(H,ee,re,Se,xe){if(re){var ne=w.create2D({width:H,height:ee,format:Se,type:xe});return ne._texture.refCount=0,new K(vt,ne,null)}else{var ie=B.create({width:H,height:ee,format:Se});return ie._renderbuffer.refCount=0,new K(wa,null,ie)}}function O(H){return H&&(H.texture||H.renderbuffer)}function X(H,ee,re){H&&(H.texture?H.texture.resize(ee,re):H.renderbuffer&&H.renderbuffer.resize(ee,re),H.width=ee,H.height=re)}var fe=0,U={};function ae(){this.id=fe++,U[this.id]=this,this.framebuffer=e.createFramebuffer(),this.width=0,this.height=0,this.colorAttachments=[],this.depthAttachment=null,this.stencilAttachment=null,this.depthStencilAttachment=null}function te(H){H.colorAttachments.forEach(Y),Y(H.depthAttachment),Y(H.stencilAttachment),Y(H.depthStencilAttachment)}function be(H){var ee=H.framebuffer;f(ee,"must not double destroy framebuffer"),e.deleteFramebuffer(ee),H.framebuffer=null,S.framebufferCount--,delete U[H.id]}function k(H){var ee;e.bindFramebuffer(qr,H.framebuffer);var re=H.colorAttachments;for(ee=0;ee<re.length;++ee)j(Tf+ee,re[ee]);for(ee=re.length;ee<m.maxColorAttachments;++ee)e.framebufferTexture2D(qr,Tf+ee,vt,null,0);e.framebufferTexture2D(qr,Lf,vt,null,0),e.framebufferTexture2D(qr,Sf,vt,null,0),e.framebufferTexture2D(qr,wf,vt,null,0),j(Sf,H.depthAttachment),j(wf,H.stencilAttachment),j(Lf,H.depthStencilAttachment);var Se=e.checkFramebufferStatus(qr);!e.isContextLost()&&Se!==Of&&f.raise("framebuffer configuration not supported, status = "+It[Se]),e.bindFramebuffer(qr,C.next?C.next.framebuffer:null),C.cur=C.next,e.getError()}function F(H,ee){var re=new ae;S.framebufferCount++;function Se(ne,ie){var pe;f(C.next!==re,"can not update framebuffer which is currently in use");var we=0,Re=0,We=!0,Ye=!0,De=null,fr=!0,ze="rgba",ir="uint8",or=1,ur=null,cr=null,hr=null,er=!1;if(typeof ne=="number")we=ne|0,Re=ie|0||we;else if(!ne)we=Re=1;else{f.type(ne,"object","invalid arguments for framebuffer");var Le=ne;if("shape"in Le){var vr=Le.shape;f(Array.isArray(vr)&&vr.length>=2,"invalid shape for framebuffer"),we=vr[0],Re=vr[1]}else"radius"in Le&&(we=Re=Le.radius),"width"in Le&&(we=Le.width),"height"in Le&&(Re=Le.height);("color"in Le||"colors"in Le)&&(De=Le.color||Le.colors,Array.isArray(De)&&f(De.length===1||i.webgl_draw_buffers,"multiple render targets not supported")),De||("colorCount"in Le&&(or=Le.colorCount|0,f(or>0,"invalid color buffer count")),"colorTexture"in Le&&(fr=!!Le.colorTexture,ze="rgba4"),"colorType"in Le&&(ir=Le.colorType,fr?(f(i.oes_texture_float||!(ir==="float"||ir==="float32"),"you must enable OES_texture_float in order to use floating point framebuffer objects"),f(i.oes_texture_half_float||!(ir==="half float"||ir==="float16"),"you must enable OES_texture_half_float in order to use 16-bit floating point framebuffer objects")):ir==="half float"||ir==="float16"?(f(i.ext_color_buffer_half_float,"you must enable EXT_color_buffer_half_float to use 16-bit render buffers"),ze="rgba16f"):(ir==="float"||ir==="float32")&&(f(i.webgl_color_buffer_float,"you must enable WEBGL_color_buffer_float in order to use 32-bit floating point renderbuffers"),ze="rgba32f"),f.oneOf(ir,q,"invalid color type")),"colorFormat"in Le&&(ze=Le.colorFormat,z.indexOf(ze)>=0?fr=!0:V.indexOf(ze)>=0?fr=!1:f.optional(function(){fr?f.oneOf(Le.colorFormat,z,"invalid color format for texture"):f.oneOf(Le.colorFormat,V,"invalid color format for renderbuffer")}))),("depthTexture"in Le||"depthStencilTexture"in Le)&&(er=!!(Le.depthTexture||Le.depthStencilTexture),f(!er||i.webgl_depth_texture,"webgl_depth_texture extension not supported")),"depth"in Le&&(typeof Le.depth=="boolean"?We=Le.depth:(ur=Le.depth,Ye=!1)),"stencil"in Le&&(typeof Le.stencil=="boolean"?Ye=Le.stencil:(cr=Le.stencil,We=!1)),"depthStencil"in Le&&(typeof Le.depthStencil=="boolean"?We=Ye=Le.depthStencil:(hr=Le.depthStencil,We=!1,Ye=!1))}var Ne=null,_e=null,Ge=null,Ie=null;if(Array.isArray(De))Ne=De.map(W);else if(De)Ne=[W(De)];else for(Ne=new Array(or),pe=0;pe<or;++pe)Ne[pe]=g(we,Re,fr,ze,ir);f(i.webgl_draw_buffers||Ne.length<=1,"you must enable the WEBGL_draw_buffers extension in order to use multiple color buffers."),f(Ne.length<=m.maxColorAttachments,"too many color attachments, not supported"),we=we||Ne[0].width,Re=Re||Ne[0].height,ur?_e=W(ur):We&&!Ye&&(_e=g(we,Re,er,"depth","uint32")),cr?Ge=W(cr):Ye&&!We&&(Ge=g(we,Re,!1,"stencil","uint8")),hr?Ie=W(hr):!ur&&!cr&&Ye&&We&&(Ie=g(we,Re,er,"depth stencil","depth stencil")),f(!!ur+!!cr+!!hr<=1,"invalid framebuffer configuration, can specify exactly one depth/stencil attachment");var rr=null;for(pe=0;pe<Ne.length;++pe)if(J(Ne[pe],we,Re),f(!Ne[pe]||Ne[pe].texture&&cl.indexOf(Ne[pe].texture._texture.format)>=0||Ne[pe].renderbuffer&&El.indexOf(Ne[pe].renderbuffer._renderbuffer.format)>=0,"framebuffer color attachment "+pe+" is invalid"),Ne[pe]&&Ne[pe].texture){var Xr=La[Ne[pe].texture._texture.format]*Fn[Ne[pe].texture._texture.type];rr===null?rr=Xr:f(rr===Xr,"all color attachments much have the same number of bits per pixel.")}return J(_e,we,Re),f(!_e||_e.texture&&_e.texture._texture.format===ll||_e.renderbuffer&&_e.renderbuffer._renderbuffer.format===vl,"invalid depth attachment for framebuffer object"),J(Ge,we,Re),f(!Ge||Ge.renderbuffer&&Ge.renderbuffer._renderbuffer.format===yl,"invalid stencil attachment for framebuffer object"),J(Ie,we,Re),f(!Ie||Ie.texture&&Ie.texture._texture.format===Gf||Ie.renderbuffer&&Ie.renderbuffer._renderbuffer.format===Gf,"invalid depth-stencil attachment for framebuffer object"),te(re),re.width=we,re.height=Re,re.colorAttachments=Ne,re.depthAttachment=_e,re.stencilAttachment=Ge,re.depthStencilAttachment=Ie,Se.color=Ne.map(O),Se.depth=O(_e),Se.stencil=O(Ge),Se.depthStencil=O(Ie),Se.width=re.width,Se.height=re.height,k(re),Se}function xe(ne,ie){f(C.next!==re,"can not resize a framebuffer which is currently in use");var pe=Math.max(ne|0,1),we=Math.max(ie|0||pe,1);if(pe===re.width&&we===re.height)return Se;for(var Re=re.colorAttachments,We=0;We<Re.length;++We)X(Re[We],pe,we);return X(re.depthAttachment,pe,we),X(re.stencilAttachment,pe,we),X(re.depthStencilAttachment,pe,we),re.width=Se.width=pe,re.height=Se.height=we,k(re),Se}return Se(H,ee),s(Se,{resize:xe,_reglType:"framebuffer",_framebuffer:re,destroy:function(){be(re),te(re)},use:function(ne){C.setFBO({framebuffer:Se},ne)}})}function se(H){var ee=Array(6);function re(xe){var ne;f(ee.indexOf(C.next)<0,"can not update framebuffer which is currently in use");var ie={color:null},pe=0,we=null,Re="rgba",We="uint8",Ye=1;if(typeof xe=="number")pe=xe|0;else if(!xe)pe=1;else{f.type(xe,"object","invalid arguments for framebuffer");var De=xe;if("shape"in De){var fr=De.shape;f(Array.isArray(fr)&&fr.length>=2,"invalid shape for framebuffer"),f(fr[0]===fr[1],"cube framebuffer must be square"),pe=fr[0]}else"radius"in De&&(pe=De.radius|0),"width"in De?(pe=De.width|0,"height"in De&&f(De.height===pe,"must be square")):"height"in De&&(pe=De.height|0);("color"in De||"colors"in De)&&(we=De.color||De.colors,Array.isArray(we)&&f(we.length===1||i.webgl_draw_buffers,"multiple render targets not supported")),we||("colorCount"in De&&(Ye=De.colorCount|0,f(Ye>0,"invalid color buffer count")),"colorType"in De&&(f.oneOf(De.colorType,q,"invalid color type"),We=De.colorType),"colorFormat"in De&&(Re=De.colorFormat,f.oneOf(De.colorFormat,z,"invalid color format for texture"))),"depth"in De&&(ie.depth=De.depth),"stencil"in De&&(ie.stencil=De.stencil),"depthStencil"in De&&(ie.depthStencil=De.depthStencil)}var ze;if(we)if(Array.isArray(we))for(ze=[],ne=0;ne<we.length;++ne)ze[ne]=we[ne];else ze=[we];else{ze=Array(Ye);var ir={radius:pe,format:Re,type:We};for(ne=0;ne<Ye;++ne)ze[ne]=w.createCube(ir)}for(ie.color=Array(ze.length),ne=0;ne<ze.length;++ne){var or=ze[ne];f(typeof or=="function"&&or._reglType==="textureCube","invalid cube map"),pe=pe||or.width,f(or.width===pe&&or.height===pe,"invalid cube map shape"),ie.color[ne]={target:In,data:ze[ne]}}for(ne=0;ne<6;++ne){for(var ur=0;ur<ze.length;++ur)ie.color[ur].target=In+ne;ne>0&&(ie.depth=ee[0].depth,ie.stencil=ee[0].stencil,ie.depthStencil=ee[0].depthStencil),ee[ne]?ee[ne](ie):ee[ne]=F(ie)}return s(re,{width:pe,height:pe,color:ze})}function Se(xe){var ne,ie=xe|0;if(f(ie>0&&ie<=m.maxCubeMapSize,"invalid radius for cube fbo"),ie===re.width)return re;var pe=re.color;for(ne=0;ne<pe.length;++ne)pe[ne].resize(ie);for(ne=0;ne<6;++ne)ee[ne].resize(ie);return re.width=re.height=ie,re}return re(H),s(re,{faces:ee,resize:Se,_reglType:"framebufferCube",destroy:function(){ee.forEach(function(xe){xe.destroy()})}})}function $(){C.cur=null,C.next=null,C.dirty=!0,Cr(U).forEach(function(H){H.framebuffer=e.createFramebuffer(),k(H)})}return s(C,{getFramebuffer:function(H){if(typeof H=="function"&&H._reglType==="framebuffer"){var ee=H._framebuffer;if(ee instanceof ae)return ee}return null},create:F,createCube:se,clear:function(){Cr(U).forEach(be)},restore:$})}var Al=5126,Df=34962,Bn=34963,If=["attributes","elements","offset","count","primitive","instances"];function Oa(){this.state=0,this.x=0,this.y=0,this.z=0,this.w=0,this.buffer=null,this.size=0,this.normalized=!1,this.type=Al,this.offset=0,this.stride=0,this.divisor=0}function Tl(e,i,m,w,B,S,C){for(var z=m.maxAttributes,V=new Array(z),q=0;q<z;++q)V[q]=new Oa;var K=0,Y={},J={Record:Oa,scope:{},state:V,currentVAO:null,targetVAO:null,restore:W()?te:function(){},createVAO:be,getVAO:O,destroyBuffer:j,setVAO:W()?X:fe,clear:W()?U:function(){}};function j(k){for(var F=0;F<V.length;++F){var se=V[F];se.buffer===k&&(e.disableVertexAttribArray(F),se.buffer=null)}}function W(){return i.oes_vertex_array_object}function g(){return i.angle_instanced_arrays}function O(k){return typeof k=="function"&&k._vao?k._vao:null}function X(k){if(k!==J.currentVAO){var F=W();k?F.bindVertexArrayOES(k.vao):F.bindVertexArrayOES(null),J.currentVAO=k}}function fe(k){if(k!==J.currentVAO){if(k)k.bindAttrs();else{for(var F=g(),se=0;se<V.length;++se){var $=V[se];$.buffer?(e.enableVertexAttribArray(se),$.buffer.bind(),e.vertexAttribPointer(se,$.size,$.type,$.normalized,$.stride,$.offfset),F&&$.divisor&&F.vertexAttribDivisorANGLE(se,$.divisor)):(e.disableVertexAttribArray(se),e.vertexAttrib4f(se,$.x,$.y,$.z,$.w))}C.elements?e.bindBuffer(Bn,C.elements.buffer.buffer):e.bindBuffer(Bn,null)}J.currentVAO=k}}function U(){Cr(Y).forEach(function(k){k.destroy()})}function ae(){this.id=++K,this.attributes=[],this.elements=null,this.ownsElements=!1,this.count=0,this.offset=0,this.instances=-1,this.primitive=4;var k=W();k?this.vao=k.createVertexArrayOES():this.vao=null,Y[this.id]=this,this.buffers=[]}ae.prototype.bindAttrs=function(){for(var k=g(),F=this.attributes,se=0;se<F.length;++se){var $=F[se];$.buffer?(e.enableVertexAttribArray(se),e.bindBuffer(Df,$.buffer.buffer),e.vertexAttribPointer(se,$.size,$.type,$.normalized,$.stride,$.offset),k&&$.divisor&&k.vertexAttribDivisorANGLE(se,$.divisor)):(e.disableVertexAttribArray(se),e.vertexAttrib4f(se,$.x,$.y,$.z,$.w))}for(var H=F.length;H<z;++H)e.disableVertexAttribArray(H);var ee=S.getElements(this.elements);ee?e.bindBuffer(Bn,ee.buffer.buffer):e.bindBuffer(Bn,null)},ae.prototype.refresh=function(){var k=W();k&&(k.bindVertexArrayOES(this.vao),this.bindAttrs(),J.currentVAO=null,k.bindVertexArrayOES(null))},ae.prototype.destroy=function(){if(this.vao){var k=W();this===J.currentVAO&&(J.currentVAO=null,k.bindVertexArrayOES(null)),k.deleteVertexArrayOES(this.vao),this.vao=null}this.ownsElements&&(this.elements.destroy(),this.elements=null,this.ownsElements=!1),Y[this.id]&&(delete Y[this.id],w.vaoCount-=1)};function te(){var k=W();k&&Cr(Y).forEach(function(F){F.refresh()})}function be(k){var F=new ae;w.vaoCount+=1;function se($){var H;if(Array.isArray($))H=$,F.elements&&F.ownsElements&&F.elements.destroy(),F.elements=null,F.ownsElements=!1,F.offset=0,F.count=0,F.instances=-1,F.primitive=4;else{if(f(typeof $=="object","invalid arguments for create vao"),f("attributes"in $,"must specify attributes for vao"),$.elements){var ee=$.elements;F.ownsElements?typeof ee=="function"&&ee._reglType==="elements"?(F.elements.destroy(),F.ownsElements=!1):(F.elements(ee),F.ownsElements=!1):S.getElements($.elements)?(F.elements=$.elements,F.ownsElements=!1):(F.elements=S.create($.elements),F.ownsElements=!0)}else F.elements=null,F.ownsElements=!1;H=$.attributes,F.offset=0,F.count=-1,F.instances=-1,F.primitive=4,F.elements&&(F.count=F.elements._elements.vertCount,F.primitive=F.elements._elements.primType),"offset"in $&&(F.offset=$.offset|0),"count"in $&&(F.count=$.count|0),"instances"in $&&(F.instances=$.instances|0),"primitive"in $&&(f($.primitive in rt,"bad primitive type: "+$.primitive),F.primitive=rt[$.primitive]),f.optional(()=>{for(var We=Object.keys($),Ye=0;Ye<We.length;++Ye)f(If.indexOf(We[Ye])>=0,'invalid option for vao: "'+We[Ye]+'" valid options are '+If)}),f(Array.isArray(H),"attributes must be an array")}f(H.length<z,"too many attributes"),f(H.length>0,"must specify at least one attribute");var re={},Se=F.attributes;Se.length=H.length;for(var xe=0;xe<H.length;++xe){var ne=H[xe],ie=Se[xe]=new Oa,pe=ne.data||ne;if(Array.isArray(pe)||a(pe)||Pr(pe)){var we;F.buffers[xe]&&(we=F.buffers[xe],a(pe)&&we._buffer.byteLength>=pe.byteLength?we.subdata(pe):(we.destroy(),F.buffers[xe]=null)),F.buffers[xe]||(we=F.buffers[xe]=B.create(ne,Df,!1,!0)),ie.buffer=B.getBuffer(we),ie.size=ie.buffer.dimension|0,ie.normalized=!1,ie.type=ie.buffer.dtype,ie.offset=0,ie.stride=0,ie.divisor=0,ie.state=1,re[xe]=1}else B.getBuffer(ne)?(ie.buffer=B.getBuffer(ne),ie.size=ie.buffer.dimension|0,ie.normalized=!1,ie.type=ie.buffer.dtype,ie.offset=0,ie.stride=0,ie.divisor=0,ie.state=1):B.getBuffer(ne.buffer)?(ie.buffer=B.getBuffer(ne.buffer),ie.size=(+ne.size||ie.buffer.dimension)|0,ie.normalized=!!ne.normalized||!1,"type"in ne?(f.parameter(ne.type,ct,"invalid buffer type"),ie.type=ct[ne.type]):ie.type=ie.buffer.dtype,ie.offset=(ne.offset||0)|0,ie.stride=(ne.stride||0)|0,ie.divisor=(ne.divisor||0)|0,ie.state=1,f(ie.size>=1&&ie.size<=4,"size must be between 1 and 4"),f(ie.offset>=0,"invalid offset"),f(ie.stride>=0&&ie.stride<=255,"stride must be between 0 and 255"),f(ie.divisor>=0,"divisor must be positive"),f(!ie.divisor||!!i.angle_instanced_arrays,"ANGLE_instanced_arrays must be enabled to use divisor")):"x"in ne?(f(xe>0,"first attribute must not be a constant"),ie.x=+ne.x||0,ie.y=+ne.y||0,ie.z=+ne.z||0,ie.w=+ne.w||0,ie.state=2):f(!1,"invalid attribute spec for location "+xe)}for(var Re=0;Re<F.buffers.length;++Re)!re[Re]&&F.buffers[Re]&&(F.buffers[Re].destroy(),F.buffers[Re]=null);return F.refresh(),se}return se.destroy=function(){for(var $=0;$<F.buffers.length;++$)F.buffers[$]&&F.buffers[$].destroy();F.buffers.length=0,F.ownsElements&&(F.elements.destroy(),F.elements=null,F.ownsElements=!1),F.destroy()},se._vao=F,se._reglType="vao",se(k)}return J}var Ff=35632,Sl=35633,wl=35718,Ll=35721;function Ol(e,i,m,w){var B={},S={};function C(g,O,X,fe){this.name=g,this.id=O,this.location=X,this.info=fe}function z(g,O){for(var X=0;X<g.length;++X)if(g[X].id===O.id){g[X].location=O.location;return}g.push(O)}function V(g,O,X){var fe=g===Ff?B:S,U=fe[O];if(!U){var ae=i.str(O);U=e.createShader(g),e.shaderSource(U,ae),e.compileShader(U),f.shaderError(e,U,ae,g,X),fe[O]=U}return U}var q={},K=[],Y=0;function J(g,O){this.id=Y++,this.fragId=g,this.vertId=O,this.program=null,this.uniforms=[],this.attributes=[],this.refCount=1,w.profile&&(this.stats={uniformsCount:0,attributesCount:0})}function j(g,O,X){var fe,U,ae=V(Ff,g.fragId),te=V(Sl,g.vertId),be=g.program=e.createProgram();if(e.attachShader(be,ae),e.attachShader(be,te),X)for(fe=0;fe<X.length;++fe){var k=X[fe];e.bindAttribLocation(be,k[0],k[1])}e.linkProgram(be),f.linkError(e,be,i.str(g.fragId),i.str(g.vertId),O);var F=e.getProgramParameter(be,wl);w.profile&&(g.stats.uniformsCount=F);var se=g.uniforms;for(fe=0;fe<F;++fe)if(U=e.getActiveUniform(be,fe),U){if(U.size>1)for(var $=0;$<U.size;++$){var H=U.name.replace("[0]","["+$+"]");z(se,new C(H,i.id(H),e.getUniformLocation(be,H),U))}var ee=U.name;U.size>1&&(ee=ee.replace("[0]","")),z(se,new C(ee,i.id(ee),e.getUniformLocation(be,ee),U))}var re=e.getProgramParameter(be,Ll);w.profile&&(g.stats.attributesCount=re);var Se=g.attributes;for(fe=0;fe<re;++fe)U=e.getActiveAttrib(be,fe),U&&z(Se,new C(U.name,i.id(U.name),e.getAttribLocation(be,U.name),U))}w.profile&&(m.getMaxUniformsCount=function(){var g=0;return K.forEach(function(O){O.stats.uniformsCount>g&&(g=O.stats.uniformsCount)}),g},m.getMaxAttributesCount=function(){var g=0;return K.forEach(function(O){O.stats.attributesCount>g&&(g=O.stats.attributesCount)}),g});function W(){B={},S={};for(var g=0;g<K.length;++g)j(K[g],null,K[g].attributes.map(function(O){return[O.location,O.name]}))}return{clear:function(){var g=e.deleteShader.bind(e);Cr(B).forEach(g),B={},Cr(S).forEach(g),S={},K.forEach(function(O){e.deleteProgram(O.program)}),K.length=0,q={},m.shaderCount=0},program:function(g,O,X,fe){f.command(g>=0,"missing vertex shader",X),f.command(O>=0,"missing fragment shader",X);var U=q[O];U||(U=q[O]={});var ae=U[g];if(ae&&(ae.refCount++,!fe))return ae;var te=new J(O,g);return m.shaderCount++,j(te,X,fe),ae||(U[g]=te),K.push(te),s(te,{destroy:function(){if(te.refCount--,te.refCount<=0){e.deleteProgram(te.program);var be=K.indexOf(te);K.splice(be,1),m.shaderCount--}U[te.vertId].refCount<=0&&(e.deleteShader(S[te.vertId]),delete S[te.vertId],delete q[te.fragId][te.vertId]),Object.keys(q[te.fragId]).length||(e.deleteShader(B[te.fragId]),delete B[te.fragId],delete q[te.fragId])}})},restore:W,shader:V,frag:-1,vert:-1}}var Cl=6408,en=5121,Rl=3333,Nn=5126;function Gl(e,i,m,w,B,S,C){function z(K){var Y;i.next===null?(f(B.preserveDrawingBuffer,'you must create a webgl context with "preserveDrawingBuffer":true in order to read pixels from the drawing buffer'),Y=en):(f(i.next.colorAttachments[0].texture!==null,"You cannot read from a renderbuffer"),Y=i.next.colorAttachments[0].texture._texture.type,f.optional(function(){S.oes_texture_float?(f(Y===en||Y===Nn,"Reading from a framebuffer is only allowed for the types 'uint8' and 'float'"),Y===Nn&&f(C.readFloat,"Reading 'float' values is not permitted in your browser. For a fallback, please see: https://www.npmjs.com/package/glsl-read-float")):f(Y===en,"Reading from a framebuffer is only allowed for the type 'uint8'")}));var J=0,j=0,W=w.framebufferWidth,g=w.framebufferHeight,O=null;a(K)?O=K:K&&(f.type(K,"object","invalid arguments to regl.read()"),J=K.x|0,j=K.y|0,f(J>=0&&J<w.framebufferWidth,"invalid x offset for regl.read"),f(j>=0&&j<w.framebufferHeight,"invalid y offset for regl.read"),W=(K.width||w.framebufferWidth-J)|0,g=(K.height||w.framebufferHeight-j)|0,O=K.data||null),O&&(Y===en?f(O instanceof Uint8Array,"buffer must be 'Uint8Array' when reading from a framebuffer of type 'uint8'"):Y===Nn&&f(O instanceof Float32Array,"buffer must be 'Float32Array' when reading from a framebuffer of type 'float'")),f(W>0&&W+J<=w.framebufferWidth,"invalid width for read pixels"),f(g>0&&g+j<=w.framebufferHeight,"invalid height for read pixels"),m();var X=W*g*4;return O||(Y===en?O=new Uint8Array(X):Y===Nn&&(O=O||new Float32Array(X))),f.isTypedArray(O,"data buffer for regl.read() must be a typedarray"),f(O.byteLength>=X,"data buffer for regl.read() too small"),e.pixelStorei(Rl,4),e.readPixels(J,j,W,g,Cl,Y,O),O}function V(K){var Y;return i.setFBO({framebuffer:K.framebuffer},function(){Y=z(K)}),Y}function q(K){return!K||!("framebuffer"in K)?z(K):V(K)}return q}function Ft(e){return Array.prototype.slice.call(e)}function Bt(e){return Ft(e).join("")}function Dl(){var e=0,i=[],m=[];function w(Y){for(var J=0;J<m.length;++J)if(m[J]===Y)return i[J];var j="g"+e++;return i.push(j),m.push(Y),j}function B(){var Y=[];function J(){Y.push.apply(Y,Ft(arguments))}var j=[];function W(){var g="v"+e++;return j.push(g),arguments.length>0&&(Y.push(g,"="),Y.push.apply(Y,Ft(arguments)),Y.push(";")),g}return s(J,{def:W,toString:function(){return Bt([j.length>0?"var "+j.join(",")+";":"",Bt(Y)])}})}function S(){var Y=B(),J=B(),j=Y.toString,W=J.toString;function g(O,X){J(O,X,"=",Y.def(O,X),";")}return s(function(){Y.apply(Y,Ft(arguments))},{def:Y.def,entry:Y,exit:J,save:g,set:function(O,X,fe){g(O,X),Y(O,X,"=",fe,";")},toString:function(){return j()+W()}})}function C(){var Y=Bt(arguments),J=S(),j=S(),W=J.toString,g=j.toString;return s(J,{then:function(){return J.apply(J,Ft(arguments)),this},else:function(){return j.apply(j,Ft(arguments)),this},toString:function(){var O=g();return O&&(O="else{"+O+"}"),Bt(["if(",Y,"){",W(),"}",O])}})}var z=B(),V={};function q(Y,J){var j=[];function W(){var U="a"+j.length;return j.push(U),U}J=J||0;for(var g=0;g<J;++g)W();var O=S(),X=O.toString,fe=V[Y]=s(O,{arg:W,toString:function(){return Bt(["function(",j.join(),"){",X(),"}"])}});return fe}function K(){var Y=['"use strict";',z,"return {"];Object.keys(V).forEach(function(W){Y.push('"',W,'":',V[W].toString(),",")}),Y.push("}");var J=Bt(Y).replace(/;/g,`;
`).replace(/}/g,`}
`).replace(/{/g,`{
`),j=Function.apply(null,i.concat(J));return j.apply(null,m)}return{global:z,link:w,block:B,proc:q,scope:S,cond:C,compile:K}}var Nt="xyzw".split(""),Bf=5121,kt=1,Ca=2,Ra=0,Ga=1,Da=2,Ia=3,kn=4,Nf=5,kf=6,Pf="dither",Mf="blend.enable",Uf="blend.color",Fa="blend.equation",Ba="blend.func",Vf="depth.enable",zf="depth.func",jf="depth.range",Hf="depth.mask",Na="colorMask",Xf="cull.enable",Wf="cull.face",ka="frontFace",Pa="lineWidth",qf="polygonOffset.enable",Ma="polygonOffset.offset",Yf="sample.alpha",Kf="sample.enable",Ua="sample.coverage",Zf="stencil.enable",Qf="stencil.mask",Va="stencil.func",za="stencil.opFront",rn="stencil.opBack",Jf="scissor.enable",Pn="scissor.box",Yr="viewport",tn="profile",yt="framebuffer",nn="vert",an="frag",bt="elements",_t="primitive",pt="count",Mn="offset",Un="instances",fn="vao",ja="Width",Ha="Height",Pt=yt+ja,Mt=yt+Ha,Il=Yr+ja,Fl=Yr+Ha,$f="drawingBuffer",eo=$f+ja,ro=$f+Ha,Bl=[Ba,Fa,Va,za,rn,Ua,Yr,Pn,Ma],Ut=34962,Xa=34963,Nl=35632,kl=35633,to=3553,Pl=34067,Ml=2884,Ul=3042,Vl=3024,zl=2960,jl=2929,Hl=3089,Xl=32823,Wl=32926,ql=32928,Wa=5126,Vn=35664,zn=35665,jn=35666,qa=5124,Hn=35667,Xn=35668,Wn=35669,Ya=35670,qn=35671,Yn=35672,Kn=35673,on=35674,un=35675,sn=35676,ln=35678,cn=35680,Ka=4,dn=1028,gt=1029,no=2304,Za=2305,Yl=32775,Kl=32776,Zl=519,nt=7680,ao=0,io=1,fo=32774,Ql=513,oo=36160,Jl=36064,Hr={0:0,1:1,zero:0,one:1,"src color":768,"one minus src color":769,"src alpha":770,"one minus src alpha":771,"dst color":774,"one minus dst color":775,"dst alpha":772,"one minus dst alpha":773,"constant color":32769,"one minus constant color":32770,"constant alpha":32771,"one minus constant alpha":32772,"src alpha saturate":776},uo=["constant color, constant alpha","one minus constant color, constant alpha","constant color, one minus constant alpha","one minus constant color, one minus constant alpha","constant alpha, constant color","constant alpha, one minus constant color","one minus constant alpha, constant color","one minus constant alpha, one minus constant color"],Vt={never:512,less:513,"<":513,equal:514,"=":514,"==":514,"===":514,lequal:515,"<=":515,greater:516,">":516,notequal:517,"!=":517,"!==":517,gequal:518,">=":518,always:519},at={0:0,zero:0,keep:7680,replace:7681,increment:7682,decrement:7683,"increment wrap":34055,"decrement wrap":34056,invert:5386},so={frag:Nl,vert:kl},Qa={cw:no,ccw:Za};function Zn(e){return Array.isArray(e)||a(e)||Pr(e)}function lo(e){return e.sort(function(i,m){return i===Yr?-1:m===Yr?1:i<m?-1:1})}function lr(e,i,m,w){this.thisDep=e,this.contextDep=i,this.propDep=m,this.append=w}function it(e){return e&&!(e.thisDep||e.contextDep||e.propDep)}function ar(e){return new lr(!1,!1,!1,e)}function Ar(e,i){var m=e.type;if(m===Ra){var w=e.data.length;return new lr(!0,w>=1,w>=2,i)}else if(m===kn){var B=e.data;return new lr(B.thisDep,B.contextDep,B.propDep,i)}else{if(m===Nf)return new lr(!1,!1,!1,i);if(m===kf){for(var S=!1,C=!1,z=!1,V=0;V<e.data.length;++V){var q=e.data[V];if(q.type===Ga)z=!0;else if(q.type===Da)C=!0;else if(q.type===Ia)S=!0;else if(q.type===Ra){S=!0;var K=q.data;K>=1&&(C=!0),K>=2&&(z=!0)}else q.type===kn&&(S=S||q.data.thisDep,C=C||q.data.contextDep,z=z||q.data.propDep)}return new lr(S,C,z,i)}else return new lr(m===Ia,m===Da,m===Ga,i)}}var co=new lr(!1,!1,!1,function(){});function $l(e,i,m,w,B,S,C,z,V,q,K,Y,J,j,W){var g=q.Record,O={add:32774,subtract:32778,"reverse subtract":32779};m.ext_blend_minmax&&(O.min=Yl,O.max=Kl);var X=m.angle_instanced_arrays,fe=m.webgl_draw_buffers,U=m.oes_vertex_array_object,ae={dirty:!0,profile:W.profile},te={},be=[],k={},F={};function se(o){return o.replace(".","_")}function $(o,n,v){var p=se(o);be.push(o),te[p]=ae[p]=!!v,k[p]=n}function H(o,n,v){var p=se(o);be.push(o),Array.isArray(v)?(ae[p]=v.slice(),te[p]=v.slice()):ae[p]=te[p]=v,F[p]=n}$(Pf,Vl),$(Mf,Ul),H(Uf,"blendColor",[0,0,0,0]),H(Fa,"blendEquationSeparate",[fo,fo]),H(Ba,"blendFuncSeparate",[io,ao,io,ao]),$(Vf,jl,!0),H(zf,"depthFunc",Ql),H(jf,"depthRange",[0,1]),H(Hf,"depthMask",!0),H(Na,Na,[!0,!0,!0,!0]),$(Xf,Ml),H(Wf,"cullFace",gt),H(ka,ka,Za),H(Pa,Pa,1),$(qf,Xl),H(Ma,"polygonOffset",[0,0]),$(Yf,Wl),$(Kf,ql),H(Ua,"sampleCoverage",[1,!1]),$(Zf,zl),H(Qf,"stencilMask",-1),H(Va,"stencilFunc",[Zl,0,-1]),H(za,"stencilOpSeparate",[dn,nt,nt,nt]),H(rn,"stencilOpSeparate",[gt,nt,nt,nt]),$(Jf,Hl),H(Pn,"scissor",[0,0,e.drawingBufferWidth,e.drawingBufferHeight]),H(Yr,Yr,[0,0,e.drawingBufferWidth,e.drawingBufferHeight]);var ee={gl:e,context:J,strings:i,next:te,current:ae,draw:Y,elements:S,buffer:B,shader:K,attributes:q.state,vao:q,uniforms:V,framebuffer:z,extensions:m,timer:j,isBufferArgs:Zn},re={primTypes:rt,compareFuncs:Vt,blendFuncs:Hr,blendEquations:O,stencilOps:at,glTypes:ct,orientationType:Qa};f.optional(function(){ee.isArrayLike=Xe}),fe&&(re.backBuffer=[gt],re.drawBuffer=Or(w.maxDrawbuffers,function(o){return o===0?[0]:Or(o,function(n){return Jl+n})}));var Se=0;function xe(){var o=Dl(),n=o.link,v=o.global;o.id=Se++,o.batchId="0";var p=n(ee),E=o.shared={props:"a0"};Object.keys(ee).forEach(function(d){E[d]=v.def(p,".",d)}),f.optional(function(){o.CHECK=n(f),o.commandStr=f.guessCommand(),o.command=n(o.commandStr),o.assert=function(d,l,A){d("if(!(",l,"))",this.CHECK,".commandRaise(",n(A),",",this.command,");")},re.invalidBlendCombinations=uo});var b=o.next={},y=o.current={};Object.keys(F).forEach(function(d){Array.isArray(ae[d])&&(b[d]=v.def(E.next,".",d),y[d]=v.def(E.current,".",d))});var _=o.constants={};Object.keys(re).forEach(function(d){_[d]=v.def(JSON.stringify(re[d]))}),o.invoke=function(d,l){switch(l.type){case Ra:var A=["this",E.context,E.props,o.batchId];return d.def(n(l.data),".call(",A.slice(0,Math.max(l.data.length+1,4)),")");case Ga:return d.def(E.props,l.data);case Da:return d.def(E.context,l.data);case Ia:return d.def("this",l.data);case kn:return l.data.append(o,d),l.data.ref;case Nf:return l.data.toString();case kf:return l.data.map(function(x){return o.invoke(d,x)})}},o.attribCache={};var u={};return o.scopeAttrib=function(d){var l=i.id(d);if(l in u)return u[l];var A=q.scope[l];A||(A=q.scope[l]=new g);var x=u[l]=n(A);return x},o}function ne(o){var n=o.static,v=o.dynamic,p;if(tn in n){var E=!!n[tn];p=ar(function(y,_){return E}),p.enable=E}else if(tn in v){var b=v[tn];p=Ar(b,function(y,_){return y.invoke(_,b)})}return p}function ie(o,n){var v=o.static,p=o.dynamic;if(yt in v){var E=v[yt];return E?(E=z.getFramebuffer(E),f.command(E,"invalid framebuffer object"),ar(function(y,_){var u=y.link(E),d=y.shared;_.set(d.framebuffer,".next",u);var l=d.context;return _.set(l,"."+Pt,u+".width"),_.set(l,"."+Mt,u+".height"),u})):ar(function(y,_){var u=y.shared;_.set(u.framebuffer,".next","null");var d=u.context;return _.set(d,"."+Pt,d+"."+eo),_.set(d,"."+Mt,d+"."+ro),"null"})}else if(yt in p){var b=p[yt];return Ar(b,function(y,_){var u=y.invoke(_,b),d=y.shared,l=d.framebuffer,A=_.def(l,".getFramebuffer(",u,")");f.optional(function(){y.assert(_,"!"+u+"||"+A,"invalid framebuffer object")}),_.set(l,".next",A);var x=d.context;return _.set(x,"."+Pt,A+"?"+A+".width:"+x+"."+eo),_.set(x,"."+Mt,A+"?"+A+".height:"+x+"."+ro),A})}else return null}function pe(o,n,v){var p=o.static,E=o.dynamic;function b(u){if(u in p){var d=p[u];f.commandType(d,"object","invalid "+u,v.commandStr);var l=!0,A=d.x|0,x=d.y|0,I,P;return"width"in d?(I=d.width|0,f.command(I>=0,"invalid "+u,v.commandStr)):l=!1,"height"in d?(P=d.height|0,f.command(P>=0,"invalid "+u,v.commandStr)):l=!1,new lr(!l&&n&&n.thisDep,!l&&n&&n.contextDep,!l&&n&&n.propDep,function(ye,oe){var M=ye.shared.context,G=I;"width"in d||(G=oe.def(M,".",Pt,"-",A));var de=P;return"height"in d||(de=oe.def(M,".",Mt,"-",x)),[A,x,G,de]})}else if(u in E){var Q=E[u],Ee=Ar(Q,function(ye,oe){var M=ye.invoke(oe,Q);f.optional(function(){ye.assert(oe,M+"&&typeof "+M+'==="object"',"invalid "+u)});var G=ye.shared.context,de=oe.def(M,".x|0"),ce=oe.def(M,".y|0"),ge=oe.def('"width" in ',M,"?",M,".width|0:","(",G,".",Pt,"-",de,")"),Pe=oe.def('"height" in ',M,"?",M,".height|0:","(",G,".",Mt,"-",ce,")");return f.optional(function(){ye.assert(oe,ge+">=0&&"+Pe+">=0","invalid "+u)}),[de,ce,ge,Pe]});return n&&(Ee.thisDep=Ee.thisDep||n.thisDep,Ee.contextDep=Ee.contextDep||n.contextDep,Ee.propDep=Ee.propDep||n.propDep),Ee}else return n?new lr(n.thisDep,n.contextDep,n.propDep,function(ye,oe){var M=ye.shared.context;return[0,0,oe.def(M,".",Pt),oe.def(M,".",Mt)]}):null}var y=b(Yr);if(y){var _=y;y=new lr(y.thisDep,y.contextDep,y.propDep,function(u,d){var l=_.append(u,d),A=u.shared.context;return d.set(A,"."+Il,l[2]),d.set(A,"."+Fl,l[3]),l})}return{viewport:y,scissor_box:b(Pn)}}function we(o,n){var v=o.static,p=typeof v[an]=="string"&&typeof v[nn]=="string";if(p){if(Object.keys(n.dynamic).length>0)return null;var E=n.static,b=Object.keys(E);if(b.length>0&&typeof E[b[0]]=="number"){for(var y=[],_=0;_<b.length;++_)f(typeof E[b[_]]=="number","must specify all vertex attribute locations when using vaos"),y.push([E[b[_]]|0,b[_]]);return y}}return null}function Re(o,n,v){var p=o.static,E=o.dynamic;function b(l){if(l in p){var A=i.id(p[l]);f.optional(function(){K.shader(so[l],A,f.guessCommand())});var x=ar(function(){return A});return x.id=A,x}else if(l in E){var I=E[l];return Ar(I,function(P,Q){var Ee=P.invoke(Q,I),ye=Q.def(P.shared.strings,".id(",Ee,")");return f.optional(function(){Q(P.shared.shader,".shader(",so[l],",",ye,",",P.command,");")}),ye})}return null}var y=b(an),_=b(nn),u=null,d;return it(y)&&it(_)?(u=K.program(_.id,y.id,null,v),d=ar(function(l,A){return l.link(u)})):d=new lr(y&&y.thisDep||_&&_.thisDep,y&&y.contextDep||_&&_.contextDep,y&&y.propDep||_&&_.propDep,function(l,A){var x=l.shared.shader,I;y?I=y.append(l,A):I=A.def(x,".",an);var P;_?P=_.append(l,A):P=A.def(x,".",nn);var Q=x+".program("+P+","+I;return f.optional(function(){Q+=","+l.command}),A.def(Q+")")}),{frag:y,vert:_,progVar:d,program:u}}function We(o,n){var v=o.static,p=o.dynamic,E={},b=!1;function y(){if(fn in v){var oe=v[fn];return oe!==null&&q.getVAO(oe)===null&&(oe=q.createVAO(oe)),b=!0,E.vao=oe,ar(function(G){var de=q.getVAO(oe);return de?G.link(de):"null"})}else if(fn in p){b=!0;var M=p[fn];return Ar(M,function(G,de){var ce=G.invoke(de,M);return de.def(G.shared.vao+".getVAO("+ce+")")})}return null}var _=y(),u=!1;function d(){if(bt in v){var oe=v[bt];if(E.elements=oe,Zn(oe)){var M=E.elements=S.create(oe,!0);oe=S.getElements(M),u=!0}else oe&&(oe=S.getElements(oe),u=!0,f.command(oe,"invalid elements",n.commandStr));var G=ar(function(ce,ge){if(oe){var Pe=ce.link(oe);return ce.ELEMENTS=Pe,Pe}return ce.ELEMENTS=null,null});return G.value=oe,G}else if(bt in p){u=!0;var de=p[bt];return Ar(de,function(ce,ge){var Pe=ce.shared,yr=Pe.isBufferArgs,xt=Pe.elements,Kr=ce.invoke(ge,de),Wr=ge.def("null"),ft=ge.def(yr,"(",Kr,")"),At=ce.cond(ft).then(Wr,"=",xt,".createStream(",Kr,");").else(Wr,"=",xt,".getElements(",Kr,");");return f.optional(function(){ce.assert(At.else,"!"+Kr+"||"+Wr,"invalid elements")}),ge.entry(At),ge.exit(ce.cond(ft).then(xt,".destroyStream(",Wr,");")),ce.ELEMENTS=Wr,Wr})}else if(b)return new lr(_.thisDep,_.contextDep,_.propDep,function(ce,ge){return ge.def(ce.shared.vao+".currentVAO?"+ce.shared.elements+".getElements("+ce.shared.vao+".currentVAO.elements):null")});return null}var l=d();function A(){if(_t in v){var oe=v[_t];return E.primitive=oe,f.commandParameter(oe,rt,"invalid primitve",n.commandStr),ar(function(G,de){return rt[oe]})}else if(_t in p){var M=p[_t];return Ar(M,function(G,de){var ce=G.constants.primTypes,ge=G.invoke(de,M);return f.optional(function(){G.assert(de,ge+" in "+ce,"invalid primitive, must be one of "+Object.keys(rt))}),de.def(ce,"[",ge,"]")})}else{if(u)return it(l)?l.value?ar(function(G,de){return de.def(G.ELEMENTS,".primType")}):ar(function(){return Ka}):new lr(l.thisDep,l.contextDep,l.propDep,function(G,de){var ce=G.ELEMENTS;return de.def(ce,"?",ce,".primType:",Ka)});if(b)return new lr(_.thisDep,_.contextDep,_.propDep,function(G,de){return de.def(G.shared.vao+".currentVAO?"+G.shared.vao+".currentVAO.primitive:"+Ka)})}return null}function x(oe,M){if(oe in v){var G=v[oe]|0;return M?E.offset=G:E.instances=G,f.command(!M||G>=0,"invalid "+oe,n.commandStr),ar(function(ce,ge){return M&&(ce.OFFSET=G),G})}else if(oe in p){var de=p[oe];return Ar(de,function(ce,ge){var Pe=ce.invoke(ge,de);return M&&(ce.OFFSET=Pe,f.optional(function(){ce.assert(ge,Pe+">=0","invalid "+oe)})),Pe})}else if(M){if(u)return ar(function(ce,ge){return ce.OFFSET=0,0});if(b)return new lr(_.thisDep,_.contextDep,_.propDep,function(ce,ge){return ge.def(ce.shared.vao+".currentVAO?"+ce.shared.vao+".currentVAO.offset:0")})}else if(b)return new lr(_.thisDep,_.contextDep,_.propDep,function(ce,ge){return ge.def(ce.shared.vao+".currentVAO?"+ce.shared.vao+".currentVAO.instances:-1")});return null}var I=x(Mn,!0);function P(){if(pt in v){var oe=v[pt]|0;return E.count=oe,f.command(typeof oe=="number"&&oe>=0,"invalid vertex count",n.commandStr),ar(function(){return oe})}else if(pt in p){var M=p[pt];return Ar(M,function(ge,Pe){var yr=ge.invoke(Pe,M);return f.optional(function(){ge.assert(Pe,"typeof "+yr+'==="number"&&'+yr+">=0&&"+yr+"===("+yr+"|0)","invalid vertex count")}),yr})}else if(u)if(it(l)){if(l)return I?new lr(I.thisDep,I.contextDep,I.propDep,function(ge,Pe){var yr=Pe.def(ge.ELEMENTS,".vertCount-",ge.OFFSET);return f.optional(function(){ge.assert(Pe,yr+">=0","invalid vertex offset/element buffer too small")}),yr}):ar(function(ge,Pe){return Pe.def(ge.ELEMENTS,".vertCount")});var G=ar(function(){return-1});return f.optional(function(){G.MISSING=!0}),G}else{var de=new lr(l.thisDep||I.thisDep,l.contextDep||I.contextDep,l.propDep||I.propDep,function(ge,Pe){var yr=ge.ELEMENTS;return ge.OFFSET?Pe.def(yr,"?",yr,".vertCount-",ge.OFFSET,":-1"):Pe.def(yr,"?",yr,".vertCount:-1")});return f.optional(function(){de.DYNAMIC=!0}),de}else if(b){var ce=new lr(_.thisDep,_.contextDep,_.propDep,function(ge,Pe){return Pe.def(ge.shared.vao,".currentVAO?",ge.shared.vao,".currentVAO.count:-1")});return ce}return null}var Q=A(),Ee=P(),ye=x(Un,!1);return{elements:l,primitive:Q,count:Ee,instances:ye,offset:I,vao:_,vaoActive:b,elementsActive:u,static:E}}function Ye(o,n){var v=o.static,p=o.dynamic,E={};return be.forEach(function(b){var y=se(b);function _(u,d){if(b in v){var l=u(v[b]);E[y]=ar(function(){return l})}else if(b in p){var A=p[b];E[y]=Ar(A,function(x,I){return d(x,I,x.invoke(I,A))})}}switch(b){case Xf:case Mf:case Pf:case Zf:case Vf:case Jf:case qf:case Yf:case Kf:case Hf:return _(function(u){return f.commandType(u,"boolean",b,n.commandStr),u},function(u,d,l){return f.optional(function(){u.assert(d,"typeof "+l+'==="boolean"',"invalid flag "+b,u.commandStr)}),l});case zf:return _(function(u){return f.commandParameter(u,Vt,"invalid "+b,n.commandStr),Vt[u]},function(u,d,l){var A=u.constants.compareFuncs;return f.optional(function(){u.assert(d,l+" in "+A,"invalid "+b+", must be one of "+Object.keys(Vt))}),d.def(A,"[",l,"]")});case jf:return _(function(u){return f.command(Xe(u)&&u.length===2&&typeof u[0]=="number"&&typeof u[1]=="number"&&u[0]<=u[1],"depth range is 2d array",n.commandStr),u},function(u,d,l){f.optional(function(){u.assert(d,u.shared.isArrayLike+"("+l+")&&"+l+".length===2&&typeof "+l+'[0]==="number"&&typeof '+l+'[1]==="number"&&'+l+"[0]<="+l+"[1]","depth range must be a 2d array")});var A=d.def("+",l,"[0]"),x=d.def("+",l,"[1]");return[A,x]});case Ba:return _(function(u){f.commandType(u,"object","blend.func",n.commandStr);var d="srcRGB"in u?u.srcRGB:u.src,l="srcAlpha"in u?u.srcAlpha:u.src,A="dstRGB"in u?u.dstRGB:u.dst,x="dstAlpha"in u?u.dstAlpha:u.dst;return f.commandParameter(d,Hr,y+".srcRGB",n.commandStr),f.commandParameter(l,Hr,y+".srcAlpha",n.commandStr),f.commandParameter(A,Hr,y+".dstRGB",n.commandStr),f.commandParameter(x,Hr,y+".dstAlpha",n.commandStr),f.command(uo.indexOf(d+", "+A)===-1,"unallowed blending combination (srcRGB, dstRGB) = ("+d+", "+A+")",n.commandStr),[Hr[d],Hr[A],Hr[l],Hr[x]]},function(u,d,l){var A=u.constants.blendFuncs;f.optional(function(){u.assert(d,l+"&&typeof "+l+'==="object"',"invalid blend func, must be an object")});function x(M,G){var de=d.def('"',M,G,'" in ',l,"?",l,".",M,G,":",l,".",M);return f.optional(function(){u.assert(d,de+" in "+A,"invalid "+b+"."+M+G+", must be one of "+Object.keys(Hr))}),de}var I=x("src","RGB"),P=x("dst","RGB");f.optional(function(){var M=u.constants.invalidBlendCombinations;u.assert(d,M+".indexOf("+I+'+", "+'+P+") === -1 ","unallowed blending combination for (srcRGB, dstRGB)")});var Q=d.def(A,"[",I,"]"),Ee=d.def(A,"[",x("src","Alpha"),"]"),ye=d.def(A,"[",P,"]"),oe=d.def(A,"[",x("dst","Alpha"),"]");return[Q,ye,Ee,oe]});case Fa:return _(function(u){if(typeof u=="string")return f.commandParameter(u,O,"invalid "+b,n.commandStr),[O[u],O[u]];if(typeof u=="object")return f.commandParameter(u.rgb,O,b+".rgb",n.commandStr),f.commandParameter(u.alpha,O,b+".alpha",n.commandStr),[O[u.rgb],O[u.alpha]];f.commandRaise("invalid blend.equation",n.commandStr)},function(u,d,l){var A=u.constants.blendEquations,x=d.def(),I=d.def(),P=u.cond("typeof ",l,'==="string"');return f.optional(function(){function Q(Ee,ye,oe){u.assert(Ee,oe+" in "+A,"invalid "+ye+", must be one of "+Object.keys(O))}Q(P.then,b,l),u.assert(P.else,l+"&&typeof "+l+'==="object"',"invalid "+b),Q(P.else,b+".rgb",l+".rgb"),Q(P.else,b+".alpha",l+".alpha")}),P.then(x,"=",I,"=",A,"[",l,"];"),P.else(x,"=",A,"[",l,".rgb];",I,"=",A,"[",l,".alpha];"),d(P),[x,I]});case Uf:return _(function(u){return f.command(Xe(u)&&u.length===4,"blend.color must be a 4d array",n.commandStr),Or(4,function(d){return+u[d]})},function(u,d,l){return f.optional(function(){u.assert(d,u.shared.isArrayLike+"("+l+")&&"+l+".length===4","blend.color must be a 4d array")}),Or(4,function(A){return d.def("+",l,"[",A,"]")})});case Qf:return _(function(u){return f.commandType(u,"number",y,n.commandStr),u|0},function(u,d,l){return f.optional(function(){u.assert(d,"typeof "+l+'==="number"',"invalid stencil.mask")}),d.def(l,"|0")});case Va:return _(function(u){f.commandType(u,"object",y,n.commandStr);var d=u.cmp||"keep",l=u.ref||0,A="mask"in u?u.mask:-1;return f.commandParameter(d,Vt,b+".cmp",n.commandStr),f.commandType(l,"number",b+".ref",n.commandStr),f.commandType(A,"number",b+".mask",n.commandStr),[Vt[d],l,A]},function(u,d,l){var A=u.constants.compareFuncs;f.optional(function(){function Q(){u.assert(d,Array.prototype.join.call(arguments,""),"invalid stencil.func")}Q(l+"&&typeof ",l,'==="object"'),Q('!("cmp" in ',l,")||(",l,".cmp in ",A,")")});var x=d.def('"cmp" in ',l,"?",A,"[",l,".cmp]",":",nt),I=d.def(l,".ref|0"),P=d.def('"mask" in ',l,"?",l,".mask|0:-1");return[x,I,P]});case za:case rn:return _(function(u){f.commandType(u,"object",y,n.commandStr);var d=u.fail||"keep",l=u.zfail||"keep",A=u.zpass||"keep";return f.commandParameter(d,at,b+".fail",n.commandStr),f.commandParameter(l,at,b+".zfail",n.commandStr),f.commandParameter(A,at,b+".zpass",n.commandStr),[b===rn?gt:dn,at[d],at[l],at[A]]},function(u,d,l){var A=u.constants.stencilOps;f.optional(function(){u.assert(d,l+"&&typeof "+l+'==="object"',"invalid "+b)});function x(I){return f.optional(function(){u.assert(d,'!("'+I+'" in '+l+")||("+l+"."+I+" in "+A+")","invalid "+b+"."+I+", must be one of "+Object.keys(at))}),d.def('"',I,'" in ',l,"?",A,"[",l,".",I,"]:",nt)}return[b===rn?gt:dn,x("fail"),x("zfail"),x("zpass")]});case Ma:return _(function(u){f.commandType(u,"object",y,n.commandStr);var d=u.factor|0,l=u.units|0;return f.commandType(d,"number",y+".factor",n.commandStr),f.commandType(l,"number",y+".units",n.commandStr),[d,l]},function(u,d,l){f.optional(function(){u.assert(d,l+"&&typeof "+l+'==="object"',"invalid "+b)});var A=d.def(l,".factor|0"),x=d.def(l,".units|0");return[A,x]});case Wf:return _(function(u){var d=0;return u==="front"?d=dn:u==="back"&&(d=gt),f.command(!!d,y,n.commandStr),d},function(u,d,l){return f.optional(function(){u.assert(d,l+'==="front"||'+l+'==="back"',"invalid cull.face")}),d.def(l,'==="front"?',dn,":",gt)});case Pa:return _(function(u){return f.command(typeof u=="number"&&u>=w.lineWidthDims[0]&&u<=w.lineWidthDims[1],"invalid line width, must be a positive number between "+w.lineWidthDims[0]+" and "+w.lineWidthDims[1],n.commandStr),u},function(u,d,l){return f.optional(function(){u.assert(d,"typeof "+l+'==="number"&&'+l+">="+w.lineWidthDims[0]+"&&"+l+"<="+w.lineWidthDims[1],"invalid line width")}),l});case ka:return _(function(u){return f.commandParameter(u,Qa,y,n.commandStr),Qa[u]},function(u,d,l){return f.optional(function(){u.assert(d,l+'==="cw"||'+l+'==="ccw"',"invalid frontFace, must be one of cw,ccw")}),d.def(l+'==="cw"?'+no+":"+Za)});case Na:return _(function(u){return f.command(Xe(u)&&u.length===4,"color.mask must be length 4 array",n.commandStr),u.map(function(d){return!!d})},function(u,d,l){return f.optional(function(){u.assert(d,u.shared.isArrayLike+"("+l+")&&"+l+".length===4","invalid color.mask")}),Or(4,function(A){return"!!"+l+"["+A+"]"})});case Ua:return _(function(u){f.command(typeof u=="object"&&u,y,n.commandStr);var d="value"in u?u.value:1,l=!!u.invert;return f.command(typeof d=="number"&&d>=0&&d<=1,"sample.coverage.value must be a number between 0 and 1",n.commandStr),[d,l]},function(u,d,l){f.optional(function(){u.assert(d,l+"&&typeof "+l+'==="object"',"invalid sample.coverage")});var A=d.def('"value" in ',l,"?+",l,".value:1"),x=d.def("!!",l,".invert");return[A,x]})}}),E}function De(o,n){var v=o.static,p=o.dynamic,E={};return Object.keys(v).forEach(function(b){var y=v[b],_;if(typeof y=="number"||typeof y=="boolean")_=ar(function(){return y});else if(typeof y=="function"){var u=y._reglType;u==="texture2d"||u==="textureCube"?_=ar(function(d){return d.link(y)}):u==="framebuffer"||u==="framebufferCube"?(f.command(y.color.length>0,'missing color attachment for framebuffer sent to uniform "'+b+'"',n.commandStr),_=ar(function(d){return d.link(y.color[0])})):f.commandRaise('invalid data for uniform "'+b+'"',n.commandStr)}else Xe(y)?_=ar(function(d){var l=d.global.def("[",Or(y.length,function(A){return f.command(typeof y[A]=="number"||typeof y[A]=="boolean","invalid uniform "+b,d.commandStr),y[A]}),"]");return l}):f.commandRaise('invalid or missing data for uniform "'+b+'"',n.commandStr);_.value=y,E[b]=_}),Object.keys(p).forEach(function(b){var y=p[b];E[b]=Ar(y,function(_,u){return _.invoke(u,y)})}),E}function fr(o,n){var v=o.static,p=o.dynamic,E={};return Object.keys(v).forEach(function(b){var y=v[b],_=i.id(b),u=new g;if(Zn(y))u.state=kt,u.buffer=B.getBuffer(B.create(y,Ut,!1,!0)),u.type=0;else{var d=B.getBuffer(y);if(d)u.state=kt,u.buffer=d,u.type=0;else if(f.command(typeof y=="object"&&y,"invalid data for attribute "+b,n.commandStr),"constant"in y){var l=y.constant;u.buffer="null",u.state=Ca,typeof l=="number"?u.x=l:(f.command(Xe(l)&&l.length>0&&l.length<=4,"invalid constant for attribute "+b,n.commandStr),Nt.forEach(function(ye,oe){oe<l.length&&(u[ye]=l[oe])}))}else{Zn(y.buffer)?d=B.getBuffer(B.create(y.buffer,Ut,!1,!0)):d=B.getBuffer(y.buffer),f.command(!!d,'missing buffer for attribute "'+b+'"',n.commandStr);var A=y.offset|0;f.command(A>=0,'invalid offset for attribute "'+b+'"',n.commandStr);var x=y.stride|0;f.command(x>=0&&x<256,'invalid stride for attribute "'+b+'", must be integer betweeen [0, 255]',n.commandStr);var I=y.size|0;f.command(!("size"in y)||I>0&&I<=4,'invalid size for attribute "'+b+'", must be 1,2,3,4',n.commandStr);var P=!!y.normalized,Q=0;"type"in y&&(f.commandParameter(y.type,ct,"invalid type for attribute "+b,n.commandStr),Q=ct[y.type]);var Ee=y.divisor|0;f.optional(function(){"divisor"in y&&(f.command(Ee===0||X,'cannot specify divisor for attribute "'+b+'", instancing not supported',n.commandStr),f.command(Ee>=0,'invalid divisor for attribute "'+b+'"',n.commandStr));var ye=n.commandStr,oe=["buffer","offset","divisor","normalized","type","size","stride"];Object.keys(y).forEach(function(M){f.command(oe.indexOf(M)>=0,'unknown parameter "'+M+'" for attribute pointer "'+b+'" (valid parameters are '+oe+")",ye)})}),u.buffer=d,u.state=kt,u.size=I,u.normalized=P,u.type=Q||d.dtype,u.offset=A,u.stride=x,u.divisor=Ee}}E[b]=ar(function(ye,oe){var M=ye.attribCache;if(_ in M)return M[_];var G={isStream:!1};return Object.keys(u).forEach(function(de){G[de]=u[de]}),u.buffer&&(G.buffer=ye.link(u.buffer),G.type=G.type||G.buffer+".dtype"),M[_]=G,G})}),Object.keys(p).forEach(function(b){var y=p[b];function _(u,d){var l=u.invoke(d,y),A=u.shared,x=u.constants,I=A.isBufferArgs,P=A.buffer;f.optional(function(){u.assert(d,l+"&&(typeof "+l+'==="object"||typeof '+l+'==="function")&&('+I+"("+l+")||"+P+".getBuffer("+l+")||"+P+".getBuffer("+l+".buffer)||"+I+"("+l+'.buffer)||("constant" in '+l+"&&(typeof "+l+'.constant==="number"||'+A.isArrayLike+"("+l+".constant))))",'invalid dynamic attribute "'+b+'"')});var Q={isStream:d.def(!1)},Ee=new g;Ee.state=kt,Object.keys(Ee).forEach(function(G){Q[G]=d.def(""+Ee[G])});var ye=Q.buffer,oe=Q.type;d("if(",I,"(",l,")){",Q.isStream,"=true;",ye,"=",P,".createStream(",Ut,",",l,");",oe,"=",ye,".dtype;","}else{",ye,"=",P,".getBuffer(",l,");","if(",ye,"){",oe,"=",ye,".dtype;",'}else if("constant" in ',l,"){",Q.state,"=",Ca,";","if(typeof "+l+'.constant === "number"){',Q[Nt[0]],"=",l,".constant;",Nt.slice(1).map(function(G){return Q[G]}).join("="),"=0;","}else{",Nt.map(function(G,de){return Q[G]+"="+l+".constant.length>"+de+"?"+l+".constant["+de+"]:0;"}).join(""),"}}else{","if(",I,"(",l,".buffer)){",ye,"=",P,".createStream(",Ut,",",l,".buffer);","}else{",ye,"=",P,".getBuffer(",l,".buffer);","}",oe,'="type" in ',l,"?",x.glTypes,"[",l,".type]:",ye,".dtype;",Q.normalized,"=!!",l,".normalized;");function M(G){d(Q[G],"=",l,".",G,"|0;")}return M("size"),M("offset"),M("stride"),M("divisor"),d("}}"),d.exit("if(",Q.isStream,"){",P,".destroyStream(",ye,");","}"),Q}E[b]=Ar(y,_)}),E}function ze(o){var n=o.static,v=o.dynamic,p={};return Object.keys(n).forEach(function(E){var b=n[E];p[E]=ar(function(y,_){return typeof b=="number"||typeof b=="boolean"?""+b:y.link(b)})}),Object.keys(v).forEach(function(E){var b=v[E];p[E]=Ar(b,function(y,_){return y.invoke(_,b)})}),p}function ir(o,n,v,p,E){var b=o.static,y=o.dynamic;f.optional(function(){var M=[yt,nn,an,bt,_t,Mn,pt,Un,tn,fn].concat(be);function G(de){Object.keys(de).forEach(function(ce){f.command(M.indexOf(ce)>=0,'unknown parameter "'+ce+'"',E.commandStr)})}G(b),G(y)});var _=we(o,n),u=ie(o),d=pe(o,u,E),l=We(o,E),A=Ye(o,E),x=Re(o,E,_);function I(M){var G=d[M];G&&(A[M]=G)}I(Yr),I(se(Pn));var P=Object.keys(A).length>0,Q={framebuffer:u,draw:l,shader:x,state:A,dirty:P,scopeVAO:null,drawVAO:null,useVAO:!1,attributes:{}};if(Q.profile=ne(o),Q.uniforms=De(v,E),Q.drawVAO=Q.scopeVAO=l.vao,!Q.drawVAO&&x.program&&!_&&m.angle_instanced_arrays&&l.static.elements){var Ee=!0,ye=x.program.attributes.map(function(M){var G=n.static[M];return Ee=Ee&&!!G,G});if(Ee&&ye.length>0){var oe=q.getVAO(q.createVAO({attributes:ye,elements:l.static.elements}));Q.drawVAO=new lr(null,null,null,function(M,G){return M.link(oe)}),Q.useVAO=!0}}return _?Q.useVAO=!0:Q.attributes=fr(n,E),Q.context=ze(p),Q}function or(o,n,v){var p=o.shared,E=p.context,b=o.scope();Object.keys(v).forEach(function(y){n.save(E,"."+y);var _=v[y],u=_.append(o,n);Array.isArray(u)?b(E,".",y,"=[",u.join(),"];"):b(E,".",y,"=",u,";")}),n(b)}function ur(o,n,v,p){var E=o.shared,b=E.gl,y=E.framebuffer,_;fe&&(_=n.def(E.extensions,".webgl_draw_buffers"));var u=o.constants,d=u.drawBuffer,l=u.backBuffer,A;v?A=v.append(o,n):A=n.def(y,".next"),p||n("if(",A,"!==",y,".cur){"),n("if(",A,"){",b,".bindFramebuffer(",oo,",",A,".framebuffer);"),fe&&n(_,".drawBuffersWEBGL(",d,"[",A,".colorAttachments.length]);"),n("}else{",b,".bindFramebuffer(",oo,",null);"),fe&&n(_,".drawBuffersWEBGL(",l,");"),n("}",y,".cur=",A,";"),p||n("}")}function cr(o,n,v){var p=o.shared,E=p.gl,b=o.current,y=o.next,_=p.current,u=p.next,d=o.cond(_,".dirty");be.forEach(function(l){var A=se(l);if(!(A in v.state)){var x,I;if(A in y){x=y[A],I=b[A];var P=Or(ae[A].length,function(Ee){return d.def(x,"[",Ee,"]")});d(o.cond(P.map(function(Ee,ye){return Ee+"!=="+I+"["+ye+"]"}).join("||")).then(E,".",F[A],"(",P,");",P.map(function(Ee,ye){return I+"["+ye+"]="+Ee}).join(";"),";"))}else{x=d.def(u,".",A);var Q=o.cond(x,"!==",_,".",A);d(Q),A in k?Q(o.cond(x).then(E,".enable(",k[A],");").else(E,".disable(",k[A],");"),_,".",A,"=",x,";"):Q(E,".",F[A],"(",x,");",_,".",A,"=",x,";")}}}),Object.keys(v.state).length===0&&d(_,".dirty=false;"),n(d)}function hr(o,n,v,p){var E=o.shared,b=o.current,y=E.current,_=E.gl;lo(Object.keys(v)).forEach(function(u){var d=v[u];if(!(p&&!p(d))){var l=d.append(o,n);if(k[u]){var A=k[u];it(d)?l?n(_,".enable(",A,");"):n(_,".disable(",A,");"):n(o.cond(l).then(_,".enable(",A,");").else(_,".disable(",A,");")),n(y,".",u,"=",l,";")}else if(Xe(l)){var x=b[u];n(_,".",F[u],"(",l,");",l.map(function(I,P){return x+"["+P+"]="+I}).join(";"),";")}else n(_,".",F[u],"(",l,");",y,".",u,"=",l,";")}})}function er(o,n){X&&(o.instancing=n.def(o.shared.extensions,".angle_instanced_arrays"))}function Le(o,n,v,p,E){var b=o.shared,y=o.stats,_=b.current,u=b.timer,d=v.profile;function l(){return typeof performance>"u"?"Date.now()":"performance.now()"}var A,x;function I(M){A=n.def(),M(A,"=",l(),";"),typeof E=="string"?M(y,".count+=",E,";"):M(y,".count++;"),j&&(p?(x=n.def(),M(x,"=",u,".getNumPendingQueries();")):M(u,".beginQuery(",y,");"))}function P(M){M(y,".cpuTime+=",l(),"-",A,";"),j&&(p?M(u,".pushScopeStats(",x,",",u,".getNumPendingQueries(),",y,");"):M(u,".endQuery();"))}function Q(M){var G=n.def(_,".profile");n(_,".profile=",M,";"),n.exit(_,".profile=",G,";")}var Ee;if(d){if(it(d)){d.enable?(I(n),P(n.exit),Q("true")):Q("false");return}Ee=d.append(o,n),Q(Ee)}else Ee=n.def(_,".profile");var ye=o.block();I(ye),n("if(",Ee,"){",ye,"}");var oe=o.block();P(oe),n.exit("if(",Ee,"){",oe,"}")}function vr(o,n,v,p,E){var b=o.shared;function y(u){switch(u){case Vn:case Hn:case qn:return 2;case zn:case Xn:case Yn:return 3;case jn:case Wn:case Kn:return 4;default:return 1}}function _(u,d,l){var A=b.gl,x=n.def(u,".location"),I=n.def(b.attributes,"[",x,"]"),P=l.state,Q=l.buffer,Ee=[l.x,l.y,l.z,l.w],ye=["buffer","normalized","offset","stride"];function oe(){n("if(!",I,".buffer){",A,".enableVertexAttribArray(",x,");}");var G=l.type,de;if(l.size?de=n.def(l.size,"||",d):de=d,n("if(",I,".type!==",G,"||",I,".size!==",de,"||",ye.map(function(ge){return I+"."+ge+"!=="+l[ge]}).join("||"),"){",A,".bindBuffer(",Ut,",",Q,".buffer);",A,".vertexAttribPointer(",[x,de,G,l.normalized,l.stride,l.offset],");",I,".type=",G,";",I,".size=",de,";",ye.map(function(ge){return I+"."+ge+"="+l[ge]+";"}).join(""),"}"),X){var ce=l.divisor;n("if(",I,".divisor!==",ce,"){",o.instancing,".vertexAttribDivisorANGLE(",[x,ce],");",I,".divisor=",ce,";}")}}function M(){n("if(",I,".buffer){",A,".disableVertexAttribArray(",x,");",I,".buffer=null;","}if(",Nt.map(function(G,de){return I+"."+G+"!=="+Ee[de]}).join("||"),"){",A,".vertexAttrib4f(",x,",",Ee,");",Nt.map(function(G,de){return I+"."+G+"="+Ee[de]+";"}).join(""),"}")}P===kt?oe():P===Ca?M():(n("if(",P,"===",kt,"){"),oe(),n("}else{"),M(),n("}"))}p.forEach(function(u){var d=u.name,l=v.attributes[d],A;if(l){if(!E(l))return;A=l.append(o,n)}else{if(!E(co))return;var x=o.scopeAttrib(d);f.optional(function(){o.assert(n,x+".state","missing attribute "+d)}),A={},Object.keys(new g).forEach(function(I){A[I]=n.def(x,".",I)})}_(o.link(u),y(u.info.type),A)})}function Ne(o,n,v,p,E,b){for(var y=o.shared,_=y.gl,u={},d,l=0;l<p.length;++l){var A=p[l],x=A.name,I=A.info.type,P=A.info.size,Q=v.uniforms[x];if(P>1){if(!Q)continue;var Ee=x.replace("[0]","");if(u[Ee])continue;u[Ee]=1}var ye=o.link(A),oe=ye+".location",M;if(Q){if(!E(Q))continue;if(it(Q)){var G=Q.value;if(f.command(G!==null&&typeof G<"u",'missing uniform "'+x+'"',o.commandStr),I===ln||I===cn){f.command(typeof G=="function"&&(I===ln&&(G._reglType==="texture2d"||G._reglType==="framebuffer")||I===cn&&(G._reglType==="textureCube"||G._reglType==="framebufferCube")),"invalid texture for uniform "+x,o.commandStr);var de=o.link(G._texture||G.color[0]._texture);n(_,".uniform1i(",oe,",",de+".bind());"),n.exit(de,".unbind();")}else if(I===on||I===un||I===sn){f.optional(function(){f.command(Xe(G),"invalid matrix for uniform "+x,o.commandStr),f.command(I===on&&G.length===4||I===un&&G.length===9||I===sn&&G.length===16,"invalid length for matrix uniform "+x,o.commandStr)});var ce=o.global.def("new Float32Array(["+Array.prototype.slice.call(G)+"])"),ge=2;I===un?ge=3:I===sn&&(ge=4),n(_,".uniformMatrix",ge,"fv(",oe,",false,",ce,");")}else{switch(I){case Wa:P===1?f.commandType(G,"number","uniform "+x,o.commandStr):f.command(Xe(G)&&G.length===P,"uniform "+x,o.commandStr),d="1f";break;case Vn:f.command(Xe(G)&&G.length&&G.length%2===0&&G.length<=P*2,"uniform "+x,o.commandStr),d="2f";break;case zn:f.command(Xe(G)&&G.length&&G.length%3===0&&G.length<=P*3,"uniform "+x,o.commandStr),d="3f";break;case jn:f.command(Xe(G)&&G.length&&G.length%4===0&&G.length<=P*4,"uniform "+x,o.commandStr),d="4f";break;case Ya:P===1?f.commandType(G,"boolean","uniform "+x,o.commandStr):f.command(Xe(G)&&G.length===P,"uniform "+x,o.commandStr),d="1i";break;case qa:P===1?f.commandType(G,"number","uniform "+x,o.commandStr):f.command(Xe(G)&&G.length===P,"uniform "+x,o.commandStr),d="1i";break;case qn:f.command(Xe(G)&&G.length&&G.length%2===0&&G.length<=P*2,"uniform "+x,o.commandStr),d="2i";break;case Hn:f.command(Xe(G)&&G.length&&G.length%2===0&&G.length<=P*2,"uniform "+x,o.commandStr),d="2i";break;case Yn:f.command(Xe(G)&&G.length&&G.length%3===0&&G.length<=P*3,"uniform "+x,o.commandStr),d="3i";break;case Xn:f.command(Xe(G)&&G.length&&G.length%3===0&&G.length<=P*3,"uniform "+x,o.commandStr),d="3i";break;case Kn:f.command(Xe(G)&&G.length&&G.length%4===0&&G.length<=P*4,"uniform "+x,o.commandStr),d="4i";break;case Wn:f.command(Xe(G)&&G.length&&G.length%4===0&&G.length<=P*4,"uniform "+x,o.commandStr),d="4i";break}P>1?(d+="v",G=o.global.def("["+Array.prototype.slice.call(G)+"]")):G=Xe(G)?Array.prototype.slice.call(G):G,n(_,".uniform",d,"(",oe,",",G,");")}continue}else M=Q.append(o,n)}else{if(!E(co))continue;M=n.def(y.uniforms,"[",i.id(x),"]")}I===ln?(f(!Array.isArray(M),"must specify a scalar prop for textures"),n("if(",M,"&&",M,'._reglType==="framebuffer"){',M,"=",M,".color[0];","}")):I===cn&&(f(!Array.isArray(M),"must specify a scalar prop for cube maps"),n("if(",M,"&&",M,'._reglType==="framebufferCube"){',M,"=",M,".color[0];","}")),f.optional(function(){function Rr(Tr,Qn){o.assert(n,Tr,'bad data or missing for uniform "'+x+'".  '+Qn)}function Tt(Tr,Qn){Qn===1&&f(!Array.isArray(M),"must not specify an array type for uniform"),Rr("Array.isArray("+M+") && typeof "+M+'[0]===" '+Tr+'" || typeof '+M+'==="'+Tr+'"',"invalid type, expected "+Tr)}function Nr(Tr,Qn,Jn){Array.isArray(M)?f(M.length&&M.length%Tr===0&&M.length<=Tr*Jn,"must have length of "+(Jn===1?"":"n * ")+Tr):Rr(y.isArrayLike+"("+M+")&&"+M+".length && "+M+".length % "+Tr+" === 0 && "+M+".length<="+Tr*Jn,"invalid vector, should have length of "+(Jn===1?"":"n * ")+Tr,o.commandStr)}function po(Tr){f(!Array.isArray(M),"must not specify a value type"),Rr("typeof "+M+'==="function"&&'+M+'._reglType==="texture'+(Tr===to?"2d":"Cube")+'"',"invalid texture type",o.commandStr)}switch(I){case qa:Tt("number",P);break;case Hn:Nr(2,"number",P);break;case Xn:Nr(3,"number",P);break;case Wn:Nr(4,"number",P);break;case Wa:Tt("number",P);break;case Vn:Nr(2,"number",P);break;case zn:Nr(3,"number",P);break;case jn:Nr(4,"number",P);break;case Ya:Tt("boolean",P);break;case qn:Nr(2,"boolean",P);break;case Yn:Nr(3,"boolean",P);break;case Kn:Nr(4,"boolean",P);break;case on:Nr(4,"number",P);break;case un:Nr(9,"number",P);break;case sn:Nr(16,"number",P);break;case ln:po(to);break;case cn:po(Pl);break}});var Pe=1;switch(I){case ln:case cn:var yr=n.def(M,"._texture");n(_,".uniform1i(",oe,",",yr,".bind());"),n.exit(yr,".unbind();");continue;case qa:case Ya:d="1i";break;case Hn:case qn:d="2i",Pe=2;break;case Xn:case Yn:d="3i",Pe=3;break;case Wn:case Kn:d="4i",Pe=4;break;case Wa:d="1f";break;case Vn:d="2f",Pe=2;break;case zn:d="3f",Pe=3;break;case jn:d="4f",Pe=4;break;case on:d="Matrix2fv";break;case un:d="Matrix3fv";break;case sn:d="Matrix4fv";break}if(d.indexOf("Matrix")===-1&&P>1&&(d+="v",Pe=1),d.charAt(0)==="M"){n(_,".uniform",d,"(",oe,",");var xt=Math.pow(I-on+2,2),Kr=o.global.def("new Float32Array(",xt,")");Array.isArray(M)?n("false,(",Or(xt,function(Rr){return Kr+"["+Rr+"]="+M[Rr]}),",",Kr,")"):n("false,(Array.isArray(",M,")||",M," instanceof Float32Array)?",M,":(",Or(xt,function(Rr){return Kr+"["+Rr+"]="+M+"["+Rr+"]"}),",",Kr,")"),n(");")}else if(Pe>1){for(var Wr=[],ft=[],At=0;At<Pe;++At)Array.isArray(M)?ft.push(M[At]):ft.push(n.def(M+"["+At+"]")),b&&Wr.push(n.def());b&&n("if(!",o.batchId,"||",Wr.map(function(Rr,Tt){return Rr+"!=="+ft[Tt]}).join("||"),"){",Wr.map(function(Rr,Tt){return Rr+"="+ft[Tt]+";"}).join("")),n(_,".uniform",d,"(",oe,",",ft.join(","),");"),b&&n("}")}else{if(f(!Array.isArray(M),"uniform value must not be an array"),b){var _o=n.def();n("if(!",o.batchId,"||",_o,"!==",M,"){",_o,"=",M,";")}n(_,".uniform",d,"(",oe,",",M,");"),b&&n("}")}}}function _e(o,n,v,p){var E=o.shared,b=E.gl,y=E.draw,_=p.draw;function u(){var de=_.elements,ce,ge=n;return de?((de.contextDep&&p.contextDynamic||de.propDep)&&(ge=v),ce=de.append(o,ge),_.elementsActive&&ge("if("+ce+")"+b+".bindBuffer("+Xa+","+ce+".buffer.buffer);")):(ce=ge.def(),ge(ce,"=",y,".",bt,";","if(",ce,"){",b,".bindBuffer(",Xa,",",ce,".buffer.buffer);}","else if(",E.vao,".currentVAO){",ce,"=",o.shared.elements+".getElements("+E.vao,".currentVAO.elements);",U?"":"if("+ce+")"+b+".bindBuffer("+Xa+","+ce+".buffer.buffer);","}")),ce}function d(){var de=_.count,ce,ge=n;return de?((de.contextDep&&p.contextDynamic||de.propDep)&&(ge=v),ce=de.append(o,ge),f.optional(function(){de.MISSING&&o.assert(n,"false","missing vertex count"),de.DYNAMIC&&o.assert(ge,ce+">=0","missing vertex count")})):(ce=ge.def(y,".",pt),f.optional(function(){o.assert(ge,ce+">=0","missing vertex count")})),ce}var l=u();function A(de){var ce=_[de];return ce?ce.contextDep&&p.contextDynamic||ce.propDep?ce.append(o,v):ce.append(o,n):n.def(y,".",de)}var x=A(_t),I=A(Mn),P=d();if(typeof P=="number"){if(P===0)return}else v("if(",P,"){"),v.exit("}");var Q,Ee;X&&(Q=A(Un),Ee=o.instancing);var ye=l+".type",oe=_.elements&&it(_.elements)&&!_.vaoActive;function M(){function de(){v(Ee,".drawElementsInstancedANGLE(",[x,P,ye,I+"<<(("+ye+"-"+Bf+")>>1)",Q],");")}function ce(){v(Ee,".drawArraysInstancedANGLE(",[x,I,P,Q],");")}l&&l!=="null"?oe?de():(v("if(",l,"){"),de(),v("}else{"),ce(),v("}")):ce()}function G(){function de(){v(b+".drawElements("+[x,P,ye,I+"<<(("+ye+"-"+Bf+")>>1)"]+");")}function ce(){v(b+".drawArrays("+[x,I,P]+");")}l&&l!=="null"?oe?de():(v("if(",l,"){"),de(),v("}else{"),ce(),v("}")):ce()}X&&(typeof Q!="number"||Q>=0)?typeof Q=="string"?(v("if(",Q,">0){"),M(),v("}else if(",Q,"<0){"),G(),v("}")):M():G()}function Ge(o,n,v,p,E){var b=xe(),y=b.proc("body",E);return f.optional(function(){b.commandStr=n.commandStr,b.command=b.link(n.commandStr)}),X&&(b.instancing=y.def(b.shared.extensions,".angle_instanced_arrays")),o(b,y,v,p),b.compile().body}function Ie(o,n,v,p){er(o,n),v.useVAO?v.drawVAO?n(o.shared.vao,".setVAO(",v.drawVAO.append(o,n),");"):n(o.shared.vao,".setVAO(",o.shared.vao,".targetVAO);"):(n(o.shared.vao,".setVAO(null);"),vr(o,n,v,p.attributes,function(){return!0})),Ne(o,n,v,p.uniforms,function(){return!0},!1),_e(o,n,n,v)}function rr(o,n){var v=o.proc("draw",1);er(o,v),or(o,v,n.context),ur(o,v,n.framebuffer),cr(o,v,n),hr(o,v,n.state),Le(o,v,n,!1,!0);var p=n.shader.progVar.append(o,v);if(v(o.shared.gl,".useProgram(",p,".program);"),n.shader.program)Ie(o,v,n,n.shader.program);else{v(o.shared.vao,".setVAO(null);");var E=o.global.def("{}"),b=v.def(p,".id"),y=v.def(E,"[",b,"]");v(o.cond(y).then(y,".call(this,a0);").else(y,"=",E,"[",b,"]=",o.link(function(_){return Ge(Ie,o,n,_,1)}),"(",p,");",y,".call(this,a0);"))}Object.keys(n.state).length>0&&v(o.shared.current,".dirty=true;"),o.shared.vao&&v(o.shared.vao,".setVAO(null);")}function Xr(o,n,v,p){o.batchId="a1",er(o,n);function E(){return!0}vr(o,n,v,p.attributes,E),Ne(o,n,v,p.uniforms,E,!1),_e(o,n,n,v)}function Et(o,n,v,p){er(o,n);var E=v.contextDep,b=n.def(),y="a0",_="a1",u=n.def();o.shared.props=u,o.batchId=b;var d=o.scope(),l=o.scope();n(d.entry,"for(",b,"=0;",b,"<",_,";++",b,"){",u,"=",y,"[",b,"];",l,"}",d.exit);function A(ye){return ye.contextDep&&E||ye.propDep}function x(ye){return!A(ye)}if(v.needsContext&&or(o,l,v.context),v.needsFramebuffer&&ur(o,l,v.framebuffer),hr(o,l,v.state,A),v.profile&&A(v.profile)&&Le(o,l,v,!1,!0),p)v.useVAO?v.drawVAO?A(v.drawVAO)?l(o.shared.vao,".setVAO(",v.drawVAO.append(o,l),");"):d(o.shared.vao,".setVAO(",v.drawVAO.append(o,d),");"):d(o.shared.vao,".setVAO(",o.shared.vao,".targetVAO);"):(d(o.shared.vao,".setVAO(null);"),vr(o,d,v,p.attributes,x),vr(o,l,v,p.attributes,A)),Ne(o,d,v,p.uniforms,x,!1),Ne(o,l,v,p.uniforms,A,!0),_e(o,d,l,v);else{var I=o.global.def("{}"),P=v.shader.progVar.append(o,l),Q=l.def(P,".id"),Ee=l.def(I,"[",Q,"]");l(o.shared.gl,".useProgram(",P,".program);","if(!",Ee,"){",Ee,"=",I,"[",Q,"]=",o.link(function(ye){return Ge(Xr,o,v,ye,2)}),"(",P,");}",Ee,".call(this,a0[",b,"],",b,");")}}function c(o,n){var v=o.proc("batch",2);o.batchId="0",er(o,v);var p=!1,E=!0;Object.keys(n.context).forEach(function(I){p=p||n.context[I].propDep}),p||(or(o,v,n.context),E=!1);var b=n.framebuffer,y=!1;b?(b.propDep?p=y=!0:b.contextDep&&p&&(y=!0),y||ur(o,v,b)):ur(o,v,null),n.state.viewport&&n.state.viewport.propDep&&(p=!0);function _(I){return I.contextDep&&p||I.propDep}cr(o,v,n),hr(o,v,n.state,function(I){return!_(I)}),(!n.profile||!_(n.profile))&&Le(o,v,n,!1,"a1"),n.contextDep=p,n.needsContext=E,n.needsFramebuffer=y;var u=n.shader.progVar;if(u.contextDep&&p||u.propDep)Et(o,v,n,null);else{var d=u.append(o,v);if(v(o.shared.gl,".useProgram(",d,".program);"),n.shader.program)Et(o,v,n,n.shader.program);else{v(o.shared.vao,".setVAO(null);");var l=o.global.def("{}"),A=v.def(d,".id"),x=v.def(l,"[",A,"]");v(o.cond(x).then(x,".call(this,a0,a1);").else(x,"=",l,"[",A,"]=",o.link(function(I){return Ge(Et,o,n,I,2)}),"(",d,");",x,".call(this,a0,a1);"))}}Object.keys(n.state).length>0&&v(o.shared.current,".dirty=true;"),o.shared.vao&&v(o.shared.vao,".setVAO(null);")}function L(o,n){var v=o.proc("scope",3);o.batchId="a2";var p=o.shared,E=p.current;or(o,v,n.context),n.framebuffer&&n.framebuffer.append(o,v),lo(Object.keys(n.state)).forEach(function(y){var _=n.state[y],u=_.append(o,v);Xe(u)?u.forEach(function(d,l){v.set(o.next[y],"["+l+"]",d)}):v.set(p.next,"."+y,u)}),Le(o,v,n,!0,!0),[bt,Mn,pt,Un,_t].forEach(function(y){var _=n.draw[y];_&&v.set(p.draw,"."+y,""+_.append(o,v))}),Object.keys(n.uniforms).forEach(function(y){var _=n.uniforms[y].append(o,v);Array.isArray(_)&&(_="["+_.join()+"]"),v.set(p.uniforms,"["+i.id(y)+"]",_)}),Object.keys(n.attributes).forEach(function(y){var _=n.attributes[y].append(o,v),u=o.scopeAttrib(y);Object.keys(new g).forEach(function(d){v.set(u,"."+d,_[d])})}),n.scopeVAO&&v.set(p.vao,".targetVAO",n.scopeVAO.append(o,v));function b(y){var _=n.shader[y];_&&v.set(p.shader,"."+y,_.append(o,v))}b(nn),b(an),Object.keys(n.state).length>0&&(v(E,".dirty=true;"),v.exit(E,".dirty=true;")),v("a1(",o.shared.context,",a0,",o.batchId,");")}function T(o){if(!(typeof o!="object"||Xe(o))){for(var n=Object.keys(o),v=0;v<n.length;++v)if(Lr.isDynamic(o[n[v]]))return!0;return!1}}function ue(o,n,v){var p=n.static[v];if(!p||!T(p))return;var E=o.global,b=Object.keys(p),y=!1,_=!1,u=!1,d=o.global.def("{}");b.forEach(function(A){var x=p[A];if(Lr.isDynamic(x)){typeof x=="function"&&(x=p[A]=Lr.unbox(x));var I=Ar(x,null);y=y||I.thisDep,u=u||I.propDep,_=_||I.contextDep}else{switch(E(d,".",A,"="),typeof x){case"number":E(x);break;case"string":E('"',x,'"');break;case"object":Array.isArray(x)&&E("[",x.join(),"]");break;default:E(o.link(x));break}E(";")}});function l(A,x){b.forEach(function(I){var P=p[I];if(Lr.isDynamic(P)){var Q=A.invoke(x,P);x(d,".",I,"=",Q,";")}})}n.dynamic[v]=new Lr.DynamicVariable(kn,{thisDep:y,contextDep:_,propDep:u,ref:d,append:l}),delete n.static[v]}function Ce(o,n,v,p,E){var b=xe();b.stats=b.link(E),Object.keys(n.static).forEach(function(_){ue(b,n,_)}),Bl.forEach(function(_){ue(b,o,_)});var y=ir(o,n,v,p,b);return rr(b,y),L(b,y),c(b,y),s(b.compile(),{destroy:function(){y.shader.program.destroy()}})}return{next:te,current:ae,procs:function(){var o=xe(),n=o.proc("poll"),v=o.proc("refresh"),p=o.block();n(p),v(p);var E=o.shared,b=E.gl,y=E.next,_=E.current;p(_,".dirty=false;"),ur(o,n),ur(o,v,null,!0);var u;X&&(u=o.link(X)),m.oes_vertex_array_object&&v(o.link(m.oes_vertex_array_object),".bindVertexArrayOES(null);");for(var d=0;d<w.maxAttributes;++d){var l=v.def(E.attributes,"[",d,"]"),A=o.cond(l,".buffer");A.then(b,".enableVertexAttribArray(",d,");",b,".bindBuffer(",Ut,",",l,".buffer.buffer);",b,".vertexAttribPointer(",d,",",l,".size,",l,".type,",l,".normalized,",l,".stride,",l,".offset);").else(b,".disableVertexAttribArray(",d,");",b,".vertexAttrib4f(",d,",",l,".x,",l,".y,",l,".z,",l,".w);",l,".buffer=null;"),v(A),X&&v(u,".vertexAttribDivisorANGLE(",d,",",l,".divisor);")}return v(o.shared.vao,".currentVAO=null;",o.shared.vao,".setVAO(",o.shared.vao,".targetVAO);"),Object.keys(k).forEach(function(x){var I=k[x],P=p.def(y,".",x),Q=o.block();Q("if(",P,"){",b,".enable(",I,")}else{",b,".disable(",I,")}",_,".",x,"=",P,";"),v(Q),n("if(",P,"!==",_,".",x,"){",Q,"}")}),Object.keys(F).forEach(function(x){var I=F[x],P=ae[x],Q,Ee,ye=o.block();if(ye(b,".",I,"("),Xe(P)){var oe=P.length;Q=o.global.def(y,".",x),Ee=o.global.def(_,".",x),ye(Or(oe,function(M){return Q+"["+M+"]"}),");",Or(oe,function(M){return Ee+"["+M+"]="+Q+"["+M+"];"}).join("")),n("if(",Or(oe,function(M){return Q+"["+M+"]!=="+Ee+"["+M+"]"}).join("||"),"){",ye,"}")}else Q=p.def(y,".",x),Ee=p.def(_,".",x),ye(Q,");",_,".",x,"=",Q,";"),n("if(",Q,"!==",Ee,"){",ye,"}");v(ye)}),o.compile()}(),compile:Ce}}function ec(){return{vaoCount:0,bufferCount:0,elementsCount:0,framebufferCount:0,shaderCount:0,textureCount:0,cubeCount:0,renderbufferCount:0,maxTextureUnits:0}}var rc=34918,tc=34919,mo=35007,nc=function(e,i){if(!i.ext_disjoint_timer_query)return null;var m=[];function w(){return m.pop()||i.ext_disjoint_timer_query.createQueryEXT()}function B(X){m.push(X)}var S=[];function C(X){var fe=w();i.ext_disjoint_timer_query.beginQueryEXT(mo,fe),S.push(fe),j(S.length-1,S.length,X)}function z(){i.ext_disjoint_timer_query.endQueryEXT(mo)}function V(){this.startQueryIndex=-1,this.endQueryIndex=-1,this.sum=0,this.stats=null}var q=[];function K(){return q.pop()||new V}function Y(X){q.push(X)}var J=[];function j(X,fe,U){var ae=K();ae.startQueryIndex=X,ae.endQueryIndex=fe,ae.sum=0,ae.stats=U,J.push(ae)}var W=[],g=[];function O(){var X,fe,U=S.length;if(U!==0){g.length=Math.max(g.length,U+1),W.length=Math.max(W.length,U+1),W[0]=0,g[0]=0;var ae=0;for(X=0,fe=0;fe<S.length;++fe){var te=S[fe];i.ext_disjoint_timer_query.getQueryObjectEXT(te,tc)?(ae+=i.ext_disjoint_timer_query.getQueryObjectEXT(te,rc),B(te)):S[X++]=te,W[fe+1]=ae,g[fe+1]=X}for(S.length=X,X=0,fe=0;fe<J.length;++fe){var be=J[fe],k=be.startQueryIndex,F=be.endQueryIndex;be.sum+=W[F]-W[k];var se=g[k],$=g[F];$===se?(be.stats.gpuTime+=be.sum/1e6,Y(be)):(be.startQueryIndex=se,be.endQueryIndex=$,J[X++]=be)}J.length=X}}return{beginQuery:C,endQuery:z,pushScopeStats:j,update:O,getNumPendingQueries:function(){return S.length},clear:function(){m.push.apply(m,S);for(var X=0;X<m.length;X++)i.ext_disjoint_timer_query.deleteQueryEXT(m[X]);S.length=0,m.length=0},restore:function(){S.length=0,m.length=0}}},ac=16384,ic=256,fc=1024,oc=34962,ho="webglcontextlost",vo="webglcontextrestored",yo=1,uc=2,sc=3;function bo(e,i){for(var m=0;m<e.length;++m)if(e[m]===i)return m;return-1}function lc(e){var i=uu(e);if(!i)return null;var m=i.gl,w=m.getContextAttributes(),B=m.isContextLost(),S=su(m,i);if(!S)return null;var C=nu(),z=ec(),V=S.extensions,q=nc(m,V),K=Ai(),Y=m.drawingBufferWidth,J=m.drawingBufferHeight,j={tick:0,time:0,viewportWidth:Y,viewportHeight:J,framebufferWidth:Y,framebufferHeight:J,drawingBufferWidth:Y,drawingBufferHeight:J,pixelRatio:i.pixelRatio},W={},g={elements:null,primitive:4,count:-1,offset:0,instances:-1},O=Zu(m,V),X=ds(m,z,i,ae),fe=Ts(m,V,X,z),U=Tl(m,V,O,z,X,fe,g);function ae(_e){return U.destroyBuffer(_e)}var te=Ol(m,C,z,i),be=rl(m,V,O,function(){se.procs.poll()},j,z,i),k=tl(m,V,O,z,i),F=xl(m,V,O,be,k,z),se=$l(m,C,V,O,X,fe,be,F,W,U,te,g,j,q,i),$=Gl(m,F,se.procs.poll,j,w,V,O),H=se.next,ee=m.canvas,re=[],Se=[],xe=[],ne=[i.onDestroy],ie=null;function pe(){if(re.length===0){q&&q.update(),ie=null;return}ie=ra.next(pe),hr();for(var _e=re.length-1;_e>=0;--_e){var Ge=re[_e];Ge&&Ge(j,null,0)}m.flush(),q&&q.update()}function we(){!ie&&re.length>0&&(ie=ra.next(pe))}function Re(){ie&&(ra.cancel(pe),ie=null)}function We(_e){_e.preventDefault(),B=!0,Re(),Se.forEach(function(Ge){Ge()})}function Ye(_e){m.getError(),B=!1,S.restore(),te.restore(),X.restore(),be.restore(),k.restore(),F.restore(),U.restore(),q&&q.restore(),se.procs.refresh(),we(),xe.forEach(function(Ge){Ge()})}ee&&(ee.addEventListener(ho,We,!1),ee.addEventListener(vo,Ye,!1));function De(){re.length=0,Re(),ee&&(ee.removeEventListener(ho,We),ee.removeEventListener(vo,Ye)),te.clear(),F.clear(),k.clear(),U.clear(),be.clear(),fe.clear(),X.clear(),q&&q.clear(),ne.forEach(function(_e){_e()})}function fr(_e){f(!!_e,"invalid args to regl({...})"),f.type(_e,"object","invalid args to regl({...})");function Ge(E){var b=s({},E);delete b.uniforms,delete b.attributes,delete b.context,delete b.vao,"stencil"in b&&b.stencil.op&&(b.stencil.opBack=b.stencil.opFront=b.stencil.op,delete b.stencil.op);function y(_){if(_ in b){var u=b[_];delete b[_],Object.keys(u).forEach(function(d){b[_+"."+d]=u[d]})}}return y("blend"),y("depth"),y("cull"),y("stencil"),y("polygonOffset"),y("scissor"),y("sample"),"vao"in E&&(b.vao=E.vao),b}function Ie(E,b){var y={},_={};return Object.keys(E).forEach(function(u){var d=E[u];if(Lr.isDynamic(d)){_[u]=Lr.unbox(d,u);return}else if(b&&Array.isArray(d)){for(var l=0;l<d.length;++l)if(Lr.isDynamic(d[l])){_[u]=Lr.unbox(d,u);return}}y[u]=d}),{dynamic:_,static:y}}var rr=Ie(_e.context||{},!0),Xr=Ie(_e.uniforms||{},!0),Et=Ie(_e.attributes||{},!1),c=Ie(Ge(_e),!1),L={gpuTime:0,cpuTime:0,count:0},T=se.compile(c,Et,Xr,rr,L),ue=T.draw,Ce=T.batch,o=T.scope,n=[];function v(E){for(;n.length<E;)n.push(null);return n}function p(E,b){var y;if(B&&f.raise("context lost"),typeof E=="function")return o.call(this,null,E,0);if(typeof b=="function")if(typeof E=="number")for(y=0;y<E;++y)o.call(this,null,b,y);else if(Array.isArray(E))for(y=0;y<E.length;++y)o.call(this,E[y],b,y);else return o.call(this,E,b,0);else if(typeof E=="number"){if(E>0)return Ce.call(this,v(E|0),E|0)}else if(Array.isArray(E)){if(E.length)return Ce.call(this,E,E.length)}else return ue.call(this,E)}return s(p,{stats:L,destroy:function(){T.destroy()}})}var ze=F.setFBO=fr({framebuffer:Lr.define.call(null,yo,"framebuffer")});function ir(_e,Ge){var Ie=0;se.procs.poll();var rr=Ge.color;rr&&(m.clearColor(+rr[0]||0,+rr[1]||0,+rr[2]||0,+rr[3]||0),Ie|=ac),"depth"in Ge&&(m.clearDepth(+Ge.depth),Ie|=ic),"stencil"in Ge&&(m.clearStencil(Ge.stencil|0),Ie|=fc),f(!!Ie,"called regl.clear with no buffer specified"),m.clear(Ie)}function or(_e){if(f(typeof _e=="object"&&_e,"regl.clear() takes an object as input"),"framebuffer"in _e)if(_e.framebuffer&&_e.framebuffer_reglType==="framebufferCube")for(var Ge=0;Ge<6;++Ge)ze(s({framebuffer:_e.framebuffer.faces[Ge]},_e),ir);else ze(_e,ir);else ir(null,_e)}function ur(_e){f.type(_e,"function","regl.frame() callback must be a function"),re.push(_e);function Ge(){var Ie=bo(re,_e);f(Ie>=0,"cannot cancel a frame twice");function rr(){var Xr=bo(re,rr);re[Xr]=re[re.length-1],re.length-=1,re.length<=0&&Re()}re[Ie]=rr}return we(),{cancel:Ge}}function cr(){var _e=H.viewport,Ge=H.scissor_box;_e[0]=_e[1]=Ge[0]=Ge[1]=0,j.viewportWidth=j.framebufferWidth=j.drawingBufferWidth=_e[2]=Ge[2]=m.drawingBufferWidth,j.viewportHeight=j.framebufferHeight=j.drawingBufferHeight=_e[3]=Ge[3]=m.drawingBufferHeight}function hr(){j.tick+=1,j.time=Le(),cr(),se.procs.poll()}function er(){be.refresh(),cr(),se.procs.refresh(),q&&q.update()}function Le(){return(Ai()-K)/1e3}er();function vr(_e,Ge){f.type(Ge,"function","listener callback must be a function");var Ie;switch(_e){case"frame":return ur(Ge);case"lost":Ie=Se;break;case"restore":Ie=xe;break;case"destroy":Ie=ne;break;default:f.raise("invalid event, must be one of frame,lost,restore,destroy")}return Ie.push(Ge),{cancel:function(){for(var rr=0;rr<Ie.length;++rr)if(Ie[rr]===Ge){Ie[rr]=Ie[Ie.length-1],Ie.pop();return}}}}var Ne=s(fr,{clear:or,prop:Lr.define.bind(null,yo),context:Lr.define.bind(null,uc),this:Lr.define.bind(null,sc),draw:fr({}),buffer:function(_e){return X.create(_e,oc,!1,!1)},elements:function(_e){return fe.create(_e,!1)},texture:be.create2D,cube:be.createCube,renderbuffer:k.create,framebuffer:F.create,framebufferCube:F.createCube,vao:U.createVAO,attributes:w,frame:ur,on:vr,limits:O,hasExtension:function(_e){return O.extensions.indexOf(_e.toLowerCase())>=0},read:$,destroy:De,_gl:m,_refresh:er,poll:function(){hr(),q&&q.update()},now:Le,stats:z});return i.onDone(null,Ne),Ne}return lc})})(Fo);var Ec=Fo.exports;const km=_n(Ec);/*!
 * strip-comments <https://github.com/jonschlinkert/strip-comments>
 *
 * Copyright (c) 2014-2015 Jon Schlinkert.
 * Licensed under the MIT license.
 */var xc=/\/\*(?!\/)(.|[\r\n]|\n)+?\*\/\n?\n?/gm,Ac=/\/\*(?!(\*?\/|\*?\!))(.|[\r\n]|\n)+?\*\/\n?\n?/gm,Tc=/(^|[^\S\n])(?:\/\/)([\s\S]+?)$/gm,Sc=/(^|[^\S\n])(?:\/\/[^!])([\s\S]+?)$/gm;function bn(r,t){return r?bn.block(bn.line(r,t),t):""}bn.block=function(r,t){t=t||{};var a=xc;return t.safe&&(a=Ac),r?r.replace(a,""):""};bn.line=function(r,t){t=t||{};var a=Tc;return t.safe&&(a=Sc),r?r.replace(a,""):""};var wc=bn;const Pm=_n(wc);function Lc(r,t,a){return r*(1-a)+t*a}var Oc=Lc;const Mm=_n(Oc);function Cc(r){for(var t=!1,a=0;a<r.length;a++){var s=r.charAt(a);t&&/[a-zA-Z]/.test(s)&&s.toUpperCase()===s?(r=r.substr(0,a)+"-"+r.substr(a),t=!1,a++):t=s.toLowerCase()===s}return r}var Rc=function(){var r=[].map.call(arguments,function(t){return t.trim()}).filter(function(t){return t.length}).join("-");return r.length?r.length===1?r.toLowerCase():/[_.\- ]+/.test(r)?(r=Cc(r),r.replace(/^[_.\- ]+/,"").toLowerCase().replace(/[_.\- ]+(\w|$)/g,function(t,a){return a.toUpperCase()})):r===r.toUpperCase()?r.toLowerCase():r[0]!==r[0].toLowerCase()?r[0].toLowerCase()+r.slice(1):r:""};const Um=_n(Rc);function Gc(r){var t=2.5949095;return(r*=2)<1?.5*(r*r*((t+1)*r-t)):.5*((r-=2)*r*((t+1)*r+t)+2)}var Dc=Gc;function Ic(r){var t=1.70158;return r*r*((t+1)*r-t)}var Fc=Ic;function Bc(r){var t=1.70158;return--r*r*((t+1)*r+t)+1}var Nc=Bc;function kc(r){var t=.36363636363636365,a=8/11,s=9/10,h=4356/361,R=35442/1805,D=16061/1805,N=r*r;return r<t?7.5625*N:r<a?9.075*N-9.9*r+3.4:r<s?h*N-R*r+D:10.8*r*r-20.52*r+10.72}var mi=kc,Ao=mi;function Pc(r){return r<.5?.5*(1-Ao(1-r*2)):.5*Ao(r*2-1)+.5}var Mc=Pc,Uc=mi;function Vc(r){return 1-Uc(1-r)}var zc=Vc;function jc(r){return(r*=2)<1?-.5*(Math.sqrt(1-r*r)-1):.5*(Math.sqrt(1-(r-=2)*r)+1)}var Hc=jc;function Xc(r){return 1-Math.sqrt(1-r*r)}var Wc=Xc;function qc(r){return Math.sqrt(1- --r*r)}var Yc=qc;function Kc(r){return r<.5?4*r*r*r:.5*Math.pow(2*r-2,3)+1}var Zc=Kc;function Qc(r){return r*r*r}var Jc=Qc;function $c(r){var t=r-1;return t*t*t+1}var ed=$c;function rd(r){return r<.5?.5*Math.sin(13*Math.PI/2*2*r)*Math.pow(2,10*(2*r-1)):.5*Math.sin(-13*Math.PI/2*(2*r-1+1))*Math.pow(2,-10*(2*r-1))+1}var td=rd;function nd(r){return Math.sin(13*r*Math.PI/2)*Math.pow(2,10*(r-1))}var ad=nd;function id(r){return Math.sin(-13*(r+1)*Math.PI/2)*Math.pow(2,-10*r)+1}var fd=id;function od(r){return r===0||r===1?r:r<.5?.5*Math.pow(2,20*r-10):-.5*Math.pow(2,10-r*20)+1}var ud=od;function sd(r){return r===0?r:Math.pow(2,10*(r-1))}var ld=sd;function cd(r){return r===1?r:1-Math.pow(2,-10*r)}var dd=cd;function md(r){return r}var hd=md;function vd(r){return r/=.5,r<1?.5*r*r:(r--,-.5*(r*(r-2)-1))}var yd=vd;function bd(r){return r*r}var _d=bd;function pd(r){return-r*(r-2)}var gd=pd;function Ed(r){return r<.5?8*Math.pow(r,4):-8*Math.pow(r-1,4)+1}var xd=Ed;function Ad(r){return Math.pow(r,4)}var Td=Ad;function Sd(r){return Math.pow(r-1,3)*(1-r)+1}var wd=Sd;function Ld(r){return(r*=2)<1?.5*r*r*r*r*r:.5*((r-=2)*r*r*r*r+2)}var Od=Ld;function Cd(r){return r*r*r*r*r}var Rd=Cd;function Gd(r){return--r*r*r*r*r+1}var Dd=Gd;function Id(r){return-.5*(Math.cos(Math.PI*r)-1)}var Fd=Id;function Bd(r){var t=Math.cos(r*Math.PI*.5);return Math.abs(t)<1e-14?1:1-t}var Nd=Bd;function kd(r){return Math.sin(r*Math.PI/2)}var Pd=kd,Md={backInOut:Dc,backIn:Fc,backOut:Nc,bounceInOut:Mc,bounceIn:zc,bounceOut:mi,circInOut:Hc,circIn:Wc,circOut:Yc,cubicInOut:Zc,cubicIn:Jc,cubicOut:ed,elasticInOut:td,elasticIn:ad,elasticOut:fd,expoInOut:ud,expoIn:ld,expoOut:dd,linear:hd,quadInOut:yd,quadIn:_d,quadOut:gd,quartInOut:xd,quartIn:Td,quartOut:wd,quintInOut:Od,quintIn:Rd,quintOut:Dd,sineInOut:Fd,sineIn:Nd,sineOut:Pd};const Vm=_n(Md);var Er=(r,t,a)=>new Promise((s,h)=>{var R=Z=>{try{N(a.next(Z))}catch(Ae){h(Ae)}},D=Z=>{try{N(a.throw(Z))}catch(Ae){h(Ae)}},N=Z=>Z.done?s(Z.value):Promise.resolve(Z.value).then(R,D);N((a=a.apply(r,t)).next())}),Dr=Uint8Array,Xt=Uint16Array,Ud=Int32Array,Bo=new Dr([0,0,0,0,0,0,0,0,1,1,1,1,2,2,2,2,3,3,3,3,4,4,4,4,5,5,5,5,0,0,0,0]),No=new Dr([0,0,0,0,1,1,2,2,3,3,4,4,5,5,6,6,7,7,8,8,9,9,10,10,11,11,12,12,13,13,0,0]),Vd=new Dr([16,17,18,0,8,7,9,6,10,5,11,4,12,3,13,2,14,1,15]),ko=function(r,t){for(var a=new Xt(31),s=0;s<31;++s)a[s]=t+=1<<r[s-1];for(var h=new Ud(a[30]),s=1;s<30;++s)for(var R=a[s];R<a[s+1];++R)h[R]=R-a[s]<<5|s;return{b:a,r:h}},Po=ko(Bo,2),Mo=Po.b,zd=Po.r;Mo[28]=258,zd[258]=28;var jd=ko(No,0),Hd=jd.b,ti=new Xt(32768);for(Ve=0;Ve<32768;++Ve)Zr=(Ve&43690)>>1|(Ve&21845)<<1,Zr=(Zr&52428)>>2|(Zr&13107)<<2,Zr=(Zr&61680)>>4|(Zr&3855)<<4,ti[Ve]=((Zr&65280)>>8|(Zr&255)<<8)>>1;var Zr,Ve,yn=function(r,t,a){for(var s=r.length,h=0,R=new Xt(t);h<s;++h)r[h]&&++R[r[h]-1];var D=new Xt(t);for(h=1;h<t;++h)D[h]=D[h-1]+R[h-1]<<1;var N;if(a){N=new Xt(1<<t);var Z=15-t;for(h=0;h<s;++h)if(r[h])for(var Ae=h<<4|r[h],he=t-r[h],me=D[r[h]-1]++<<he,Fe=me|(1<<he)-1;me<=Fe;++me)N[ti[me]>>Z]=Ae}else for(N=new Xt(s),h=0;h<s;++h)r[h]&&(N[h]=ti[D[r[h]-1]++]>>15-r[h]);return N},pn=new Dr(288);for(Ve=0;Ve<144;++Ve)pn[Ve]=8;var Ve;for(Ve=144;Ve<256;++Ve)pn[Ve]=9;var Ve;for(Ve=256;Ve<280;++Ve)pn[Ve]=7;var Ve;for(Ve=280;Ve<288;++Ve)pn[Ve]=8;var Ve,Uo=new Dr(32);for(Ve=0;Ve<32;++Ve)Uo[Ve]=5;var Ve,Xd=yn(pn,9,1),Wd=yn(Uo,5,1),Ja=function(r){for(var t=r[0],a=1;a<r.length;++a)r[a]>t&&(t=r[a]);return t},Ur=function(r,t,a){var s=t/8|0;return(r[s]|r[s+1]<<8)>>(t&7)&a},$a=function(r,t){var a=t/8|0;return(r[a]|r[a+1]<<8|r[a+2]<<16)>>(t&7)},qd=function(r){return(r+7)/8|0},Yd=function(r,t,a){(t==null||t<0)&&(t=0),(a==null||a>r.length)&&(a=r.length);var s=new Dr(a-t);return s.set(r.subarray(t,a)),s},Kd=["unexpected EOF","invalid block type","invalid length/literal","invalid distance","stream finished","no stream handler",,"no callback","invalid UTF-8 data","extra field too long","date not in range 1980-2099","filename too long","stream finishing","invalid zip data"],Gr=function(r,t,a){var s=new Error(t||Kd[r]);if(s.code=r,Error.captureStackTrace&&Error.captureStackTrace(s,Gr),!a)throw s;return s},hi=function(r,t,a,s){var h=r.length,R=s?s.length:0;if(!h||t.f&&!t.l)return a||new Dr(0);var D=!a||t.i!=2,N=t.i;a||(a=new Dr(h*3));var Z=function($e){var xr=a.length;if($e>xr){var qt=new Dr(Math.max(xr*2,$e));qt.set(a),a=qt}},Ae=t.f||0,he=t.p||0,me=t.b||0,Fe=t.l,Me=t.d,Ue=t.m,Be=t.n,qe=h*8;do{if(!Fe){Ae=Ur(r,he,1);var Qe=Ur(r,he+1,3);if(he+=3,Qe)if(Qe==1)Fe=Xd,Me=Wd,Ue=9,Be=5;else if(Qe==2){var tr=Ur(r,he,31)+257,je=Ur(r,he+10,15)+4,br=tr+Ur(r,he+5,31)+1;he+=14;for(var ve=new Dr(br),He=new Dr(19),sr=0;sr<je;++sr)He[Vd[sr]]=Ur(r,he+sr*3,7);he+=je*3;for(var kr=Ja(He),Te=(1<<kr)-1,Ze=yn(He,kr,1),sr=0;sr<br;){var Ir=Ze[Ur(r,he,Te)];he+=Ir&15;var Oe=Ir>>4;if(Oe<16)ve[sr++]=Oe;else{var Je=0,Jr=0;for(Oe==16?(Jr=3+Ur(r,he,3),he+=2,Je=ve[sr-1]):Oe==17?(Jr=3+Ur(r,he,7),he+=3):Oe==18&&(Jr=11+Ur(r,he,127),he+=7);Jr--;)ve[sr++]=Je}}var ot=ve.subarray(0,tr),pr=ve.subarray(tr);Ue=Ja(ot),Be=Ja(pr),Fe=yn(ot,Ue,1),Me=yn(pr,Be,1)}else Gr(1);else{var Oe=qd(he)+4,dr=r[Oe-4]|r[Oe-3]<<8,Ke=Oe+dr;if(Ke>h){N&&Gr(0);break}D&&Z(me+dr),a.set(r.subarray(Oe,Ke),me),t.b=me+=dr,t.p=he=Ke*8,t.f=Ae;continue}if(he>qe){N&&Gr(0);break}}D&&Z(me+131072);for(var ke=(1<<Ue)-1,Fr=(1<<Be)-1,gr=he;;gr=he){var Je=Fe[$a(r,he)&ke],_r=Je>>4;if(he+=Je&15,he>qe){N&&Gr(0);break}if(Je||Gr(2),_r<256)a[me++]=_r;else if(_r==256){gr=he,Fe=null;break}else{var zr=_r-254;if(_r>264){var sr=_r-257,Sr=Bo[sr];zr=Ur(r,he,(1<<Sr)-1)+Mo[sr],he+=Sr}var $r=Me[$a(r,he)&Fr],ut=$r>>4;$r||Gr(3),he+=$r&15;var pr=Hd[ut];if(ut>3){var Sr=No[ut];pr+=$a(r,he)&(1<<Sr)-1,he+=Sr}if(he>qe){N&&Gr(0);break}D&&Z(me+131072);var st=me+zr;if(me<pr){var wt=R-pr,le=Math.min(pr,st);for(wt+me<0&&Gr(3);me<le;++me)a[me]=s[wt+me]}for(;me<st;me+=4)a[me]=a[me-pr],a[me+1]=a[me+1-pr],a[me+2]=a[me+2-pr],a[me+3]=a[me+3-pr];me=st}}t.l=Fe,t.p=gr,t.b=me,t.f=Ae,Fe&&(Ae=1,t.m=Ue,t.d=Me,t.n=Be)}while(!Ae);return me==a.length?a:Yd(a,0,me)},Zd=new Dr(0),Qd=function(r){(r[0]!=31||r[1]!=139||r[2]!=8)&&Gr(6,"invalid gzip data");var t=r[3],a=10;t&4&&(a+=(r[10]|r[11]<<8)+2);for(var s=(t>>3&1)+(t>>4&1);s>0;s-=!r[a++]);return a+(t&2)},Jd=function(r){var t=r.length;return(r[t-4]|r[t-3]<<8|r[t-2]<<16|r[t-1]<<24)>>>0},$d=function(r,t){return((r[0]&15)!=8||r[0]>>4>7||(r[0]<<8|r[1])%31)&&Gr(6,"invalid zlib data"),(r[1]>>5&1)==+!t&&Gr(6,"invalid zlib data: "+(r[1]&32?"need":"unexpected")+" dictionary"),(r[1]>>3&4)+2};function em(r,t){return hi(r,{i:2},t&&t.out,t&&t.dictionary)}function rm(r,t){var a=Qd(r);return a+8>r.length&&Gr(6,"invalid gzip data"),hi(r.subarray(a,-8),{i:2},t&&t.out||new Dr(Jd(r)),t&&t.dictionary)}function tm(r,t){return hi(r.subarray($d(r,t&&t.dictionary),-4),{i:2},t&&t.out,t&&t.dictionary)}function ni(r,t){return r[0]==31&&r[1]==139&&r[2]==8?rm(r,t):(r[0]&15)!=8||r[0]>>4>7||(r[0]<<8|r[1])%31?em(r,t):tm(r,t)}var nm=typeof TextDecoder<"u"&&new TextDecoder,am=0;try{nm.decode(Zd,{stream:!0}),am=1}catch{}var Vo=(r,t)=>r*Math.pow(2,t),hn=(r,t)=>Math.floor(r/Math.pow(2,t)),ea=(r,t)=>Vo(r.getUint16(t+1,!0),8)+r.getUint8(t),zo=(r,t)=>Vo(r.getUint32(t+2,!0),16)+r.getUint16(t,!0),im=(r,t,a,s,h)=>{if(r!=s.getUint8(h))return r-s.getUint8(h);const R=ea(s,h+1);if(t!=R)return t-R;const D=ea(s,h+4);return a!=D?a-D:0},fm=(r,t,a,s)=>{const h=jo(r,t|128,a,s);return h?{z:t,x:a,y:s,offset:h[0],length:h[1],is_dir:!0}:null},To=(r,t,a,s)=>{const h=jo(r,t,a,s);return h?{z:t,x:a,y:s,offset:h[0],length:h[1],is_dir:!1}:null},jo=(r,t,a,s)=>{let h=0,R=r.byteLength/17-1;for(;h<=R;){const D=R+h>>1,N=im(t,a,s,r,D*17);if(N>0)h=D+1;else if(N<0)R=D-1;else return[zo(r,D*17+7),r.getUint32(D*17+13,!0)]}return null},om=(r,t)=>r.is_dir&&!t.is_dir?1:!r.is_dir&&t.is_dir?-1:r.z!==t.z?r.z-t.z:r.x!==t.x?r.x-t.x:r.y-t.y,Ho=(r,t)=>{const a=r.getUint8(t*17);return{z:a&127,x:ea(r,t*17+1),y:ea(r,t*17+4),offset:zo(r,t*17+7),length:r.getUint32(t*17+13,!0),is_dir:a>>7===1}},So=r=>{const t=[],a=new DataView(r);for(let s=0;s<a.byteLength/17;s++)t.push(Ho(a,s));return um(t)},um=r=>{r.sort(om);const t=new ArrayBuffer(17*r.length),a=new Uint8Array(t);for(let s=0;s<r.length;s++){const h=r[s];let R=h.z;h.is_dir&&(R=R|128),a[s*17]=R,a[s*17+1]=h.x&255,a[s*17+2]=h.x>>8&255,a[s*17+3]=h.x>>16&255,a[s*17+4]=h.y&255,a[s*17+5]=h.y>>8&255,a[s*17+6]=h.y>>16&255,a[s*17+7]=h.offset&255,a[s*17+8]=hn(h.offset,8)&255,a[s*17+9]=hn(h.offset,16)&255,a[s*17+10]=hn(h.offset,24)&255,a[s*17+11]=hn(h.offset,32)&255,a[s*17+12]=hn(h.offset,48)&255,a[s*17+13]=h.length&255,a[s*17+14]=h.length>>8&255,a[s*17+15]=h.length>>16&255,a[s*17+16]=h.length>>24&255}return t},sm=(r,t)=>{if(r.byteLength<17)return null;const a=r.byteLength/17,s=Ho(r,a-1);if(s.is_dir){const h=s.z,R=t.z-h,D=Math.trunc(t.x/(1<<R)),N=Math.trunc(t.y/(1<<R));return{z:h,x:D,y:N}}return null};function lm(r){return Er(this,null,function*(){const t=yield r.getBytes(0,512e3),a=new DataView(t.data),s=a.getUint32(4,!0),h=a.getUint16(8,!0),R=new TextDecoder("utf-8"),D=JSON.parse(R.decode(new DataView(t.data,10,s)));let N=0;D.compression==="gzip"&&(N=2);let Z=0;"minzoom"in D&&(Z=+D.minzoom);let Ae=0;"maxzoom"in D&&(Ae=+D.maxzoom);let he=0,me=0,Fe=0,Me=-180,Ue=-85,Be=180,qe=85;if(D.bounds){const Oe=D.bounds.split(",");Me=+Oe[0],Ue=+Oe[1],Be=+Oe[2],qe=+Oe[3]}if(D.center){const Oe=D.center.split(",");he=+Oe[0],me=+Oe[1],Fe=+Oe[2]}return{specVersion:a.getUint16(2,!0),rootDirectoryOffset:10+s,rootDirectoryLength:h*17,jsonMetadataOffset:10,jsonMetadataLength:s,leafDirectoryOffset:0,leafDirectoryLength:void 0,tileDataOffset:0,tileDataLength:void 0,numAddressedTiles:0,numTileEntries:0,numTileContents:0,clustered:!1,internalCompression:1,tileCompression:N,tileType:1,minZoom:Z,maxZoom:Ae,minLon:Me,minLat:Ue,maxLon:Be,maxLat:qe,centerZoom:Fe,centerLon:he,centerLat:me,etag:t.etag}})}function cm(r,t,a,s,h,R,D){return Er(this,null,function*(){let N=yield a.getArrayBuffer(t,r.rootDirectoryOffset,r.rootDirectoryLength,r);r.specVersion===1&&(N=So(N));const Z=To(new DataView(N),s,h,R);if(Z){let me=(yield t.getBytes(Z.offset,Z.length,D)).data;const Fe=new DataView(me);return Fe.getUint8(0)==31&&Fe.getUint8(1)==139&&(me=ni(new Uint8Array(me))),{data:me}}const Ae=sm(new DataView(N),{z:s,x:h,y:R});if(Ae){const he=fm(new DataView(N),Ae.z,Ae.x,Ae.y);if(he){let me=yield a.getArrayBuffer(t,he.offset,he.length,r);r.specVersion===1&&(me=So(me));const Fe=To(new DataView(me),s,h,R);if(Fe){let Ue=(yield t.getBytes(Fe.offset,Fe.length,D)).data;const Be=new DataView(Ue);return Be.getUint8(0)==31&&Be.getUint8(1)==139&&(Ue=ni(new Uint8Array(Ue))),{data:Ue}}}}})}var Xo={getHeader:lm,getZxy:cm},dm=class{constructor(){this.tile=(r,t)=>{if(r.type=="json"){const a=r.url.substr(10);let s=this.tiles.get(a);return s||(s=new wo(a),this.tiles.set(a,s)),s.getHeader().then(h=>{const R={tiles:[r.url+"/{z}/{x}/{y}"],minzoom:h.minZoom,maxzoom:h.maxZoom,bounds:[h.minLon,h.minLat,h.maxLon,h.maxLat]};t(null,R,null,null)}).catch(h=>{t(h,null,null,null)}),{cancel:()=>{}}}else{const a=new RegExp(/pmtiles:\/\/(.+)\/(\d+)\/(\d+)\/(\d+)/),s=r.url.match(a);if(!s)throw new Error("Invalid PMTiles protocol URL");const h=s[1];let R=this.tiles.get(h);R||(R=new wo(h),this.tiles.set(h,R));const D=s[2],N=s[3],Z=s[4],Ae=new AbortController,he=Ae.signal;let me=()=>{Ae.abort()};return R.getHeader().then(Fe=>{R.getZxy(+D,+N,+Z,he).then(Me=>{Me?t(null,new Uint8Array(Me.data),Me.cacheControl,Me.expires):Fe.tileType==1?t(null,new Uint8Array,null,null):t(null,null,null,null)}).catch(Me=>{Me.name!=="AbortError"&&t(Me,null,null,null)})}),{cancel:me}}},this.tiles=new Map}add(r){this.tiles.set(r.source.getKey(),r)}get(r){return this.tiles.get(r)}};function jt(r,t){return(t>>>0)*4294967296+(r>>>0)}function mm(r,t){const a=t.buf;let s,h;if(h=a[t.pos++],s=(h&112)>>4,h<128||(h=a[t.pos++],s|=(h&127)<<3,h<128)||(h=a[t.pos++],s|=(h&127)<<10,h<128)||(h=a[t.pos++],s|=(h&127)<<17,h<128)||(h=a[t.pos++],s|=(h&127)<<24,h<128)||(h=a[t.pos++],s|=(h&1)<<31,h<128))return jt(r,s);throw new Error("Expected varint not more than 10 bytes")}function vn(r){const t=r.buf;let a,s;return s=t[r.pos++],a=s&127,s<128||(s=t[r.pos++],a|=(s&127)<<7,s<128)||(s=t[r.pos++],a|=(s&127)<<14,s<128)||(s=t[r.pos++],a|=(s&127)<<21,s<128)?a:(s=t[r.pos],a|=(s&15)<<28,mm(a,r))}function hm(r,t,a,s){if(s==0){a==1&&(t[0]=r-1-t[0],t[1]=r-1-t[1]);const h=t[0];t[0]=t[1],t[1]=h}}var vm=[0,1,5,21,85,341,1365,5461,21845,87381,349525,1398101,5592405,22369621,89478485,357913941,1431655765,5726623061,22906492245,91625968981,366503875925,1466015503701,5864062014805,23456248059221,93824992236885,375299968947541,0x5555555555555];function ym(r,t,a){if(r>26)throw Error("Tile zoom level exceeds max safe number limit (26)");if(t>Math.pow(2,r)-1||a>Math.pow(2,r)-1)throw Error("tile x/y outside zoom level bounds");const s=vm[r],h=Math.pow(2,r);let R=0,D=0,N=0;const Z=[t,a];let Ae=h/2;for(;Ae>0;)R=(Z[0]&Ae)>0?1:0,D=(Z[1]&Ae)>0?1:0,N+=Ae*Ae*(3*R^D),hm(Ae,Z,R,D),Ae=Ae/2;return s+N}function Wo(r,t){return Er(this,null,function*(){if(t===1||t===0)return r;if(t===2){if(typeof globalThis.DecompressionStream>"u")return ni(new Uint8Array(r));{let s=new Response(r).body.pipeThrough(new globalThis.DecompressionStream("gzip"));return new Response(s).arrayBuffer()}}else throw Error("Compression method not supported")})}var bm=127;function _m(r,t){let a=0,s=r.length-1;for(;a<=s;){const h=s+a>>1,R=t-r[h].tileId;if(R>0)a=h+1;else if(R<0)s=h-1;else return r[h]}return s>=0&&(r[s].runLength===0||t-r[s].tileId<r[s].runLength)?r[s]:null}var pm=class{constructor(r){this.url=r}getKey(){return this.url}getBytes(r,t,a){return Er(this,null,function*(){let s;a||(s=new AbortController,a=s.signal);let h=yield fetch(this.url,{signal:a,headers:{Range:"bytes="+r+"-"+(r+t-1)}});if(h.status===416&&r===0){const N=h.headers.get("Content-Range");if(!N||!N.startsWith("bytes */"))throw Error("Missing content-length on 416 response");const Z=+N.substr(8);h=yield fetch(this.url,{signal:a,headers:{Range:"bytes=0-"+(Z-1)}})}if(h.status>=300)throw Error("Bad response code: "+h.status);const R=h.headers.get("Content-Length");if(h.status===200&&(!R||+R>t))throw s&&s.abort(),Error("Server returned no content-length header or content-length exceeding request. Check that your storage backend supports HTTP Byte Serving.");return{data:yield h.arrayBuffer(),etag:h.headers.get("ETag")||void 0,cacheControl:h.headers.get("Cache-Control")||void 0,expires:h.headers.get("Expires")||void 0}})}};function Vr(r,t){const a=r.getUint32(t+4,!0),s=r.getUint32(t+0,!0);return a*Math.pow(2,32)+s}function gm(r,t){const a=new DataView(r),s=a.getUint8(7);if(s>3)throw Error(`Archive is spec version ${s} but this library supports up to spec version 3`);return{specVersion:s,rootDirectoryOffset:Vr(a,8),rootDirectoryLength:Vr(a,16),jsonMetadataOffset:Vr(a,24),jsonMetadataLength:Vr(a,32),leafDirectoryOffset:Vr(a,40),leafDirectoryLength:Vr(a,48),tileDataOffset:Vr(a,56),tileDataLength:Vr(a,64),numAddressedTiles:Vr(a,72),numTileEntries:Vr(a,80),numTileContents:Vr(a,88),clustered:a.getUint8(96)===1,internalCompression:a.getUint8(97),tileCompression:a.getUint8(98),tileType:a.getUint8(99),minZoom:a.getUint8(100),maxZoom:a.getUint8(101),minLon:a.getInt32(102,!0)/1e7,minLat:a.getInt32(106,!0)/1e7,maxLon:a.getInt32(110,!0)/1e7,maxLat:a.getInt32(114,!0)/1e7,centerZoom:a.getUint8(118),centerLon:a.getInt32(119,!0)/1e7,centerLat:a.getInt32(123,!0)/1e7,etag:t}}function qo(r){const t={buf:new Uint8Array(r),pos:0},a=vn(t),s=[];let h=0;for(let R=0;R<a;R++){const D=vn(t);s.push({tileId:h+D,offset:0,length:0,runLength:1}),h+=D}for(let R=0;R<a;R++)s[R].runLength=vn(t);for(let R=0;R<a;R++)s[R].length=vn(t);for(let R=0;R<a;R++){const D=vn(t);D===0&&R>0?s[R].offset=s[R-1].offset+s[R-1].length:s[R].offset=D-1}return s}function Em(r){const t=new DataView(r);return t.getUint16(2,!0)===2?(console.warn("PMTiles spec version 2 has been deprecated; please see github.com/protomaps/PMTiles for tools to upgrade"),2):t.getUint16(2,!0)===1?(console.warn("PMTiles spec version 1 has been deprecated; please see github.com/protomaps/PMTiles for tools to upgrade"),1):3}var Wt=class extends Error{};function xm(r,t,a,s){return Er(this,null,function*(){const h=yield r.getBytes(0,16384);if(new DataView(h.data).getUint16(0,!0)!==19792)throw new Error("Wrong magic number for PMTiles archive");if(Em(h.data)<3)return[yield Xo.getHeader(r)];const D=h.data.slice(0,bm);let N=h.etag;s&&h.etag!=s&&(console.warn("ETag conflict detected; your HTTP server might not support content-based ETag headers. ETags disabled for "+r.getKey()),N=void 0);const Z=gm(D,N);if(a){const Ae=h.data.slice(Z.rootDirectoryOffset,Z.rootDirectoryOffset+Z.rootDirectoryLength),he=r.getKey()+"|"+(Z.etag||"")+"|"+Z.rootDirectoryOffset+"|"+Z.rootDirectoryLength,me=qo(yield t(Ae,Z.internalCompression));return[Z,[he,me.length,me]]}return[Z,void 0]})}function Am(r,t,a,s,h){return Er(this,null,function*(){const R=yield r.getBytes(a,s);if(h.etag&&h.etag!==R.etag)throw new Wt(R.etag);const D=yield t(R.data,h.internalCompression),N=qo(D);if(N.length===0)throw new Error("Empty directory is invalid");return N})}var Tm=class{constructor(r=100,t=!0,a=Wo){this.cache=new Map,this.maxCacheEntries=r,this.counter=1,this.prefetch=t,this.decompress=a}getHeader(r,t){return Er(this,null,function*(){const a=r.getKey();if(this.cache.has(a))return this.cache.get(a).lastUsed=this.counter++,yield this.cache.get(a).data;const s=new Promise((h,R)=>{xm(r,this.decompress,this.prefetch,t).then(D=>{D[1]&&this.cache.set(D[1][0],{lastUsed:this.counter++,data:Promise.resolve(D[1][2])}),h(D[0]),this.prune()}).catch(D=>{R(D)})});return this.cache.set(a,{lastUsed:this.counter++,data:s}),s})}getDirectory(r,t,a,s){return Er(this,null,function*(){const h=r.getKey()+"|"+(s.etag||"")+"|"+t+"|"+a;if(this.cache.has(h))return this.cache.get(h).lastUsed=this.counter++,yield this.cache.get(h).data;const R=new Promise((D,N)=>{Am(r,this.decompress,t,a,s).then(Z=>{D(Z),this.prune()}).catch(Z=>{N(Z)})});return this.cache.set(h,{lastUsed:this.counter++,data:R}),R})}getArrayBuffer(r,t,a,s){return Er(this,null,function*(){const h=r.getKey()+"|"+(s.etag||"")+"|"+t+"|"+a;if(this.cache.has(h))return this.cache.get(h).lastUsed=this.counter++,yield this.cache.get(h).data;const R=new Promise((D,N)=>{r.getBytes(t,a).then(Z=>{if(s.etag&&s.etag!==Z.etag)throw new Wt(Z.etag);D(Z.data),this.cache.has(h),this.prune()}).catch(Z=>{N(Z)})});return this.cache.set(h,{lastUsed:this.counter++,data:R}),R})}prune(){if(this.cache.size>=this.maxCacheEntries){let r=1/0,t;this.cache.forEach((a,s)=>{a.lastUsed<r&&(r=a.lastUsed,t=s)}),t&&this.cache.delete(t)}}invalidate(r,t){return Er(this,null,function*(){this.cache.delete(r.getKey()),yield this.getHeader(r,t)})}},wo=class{constructor(r,t,a){typeof r=="string"?this.source=new pm(r):this.source=r,a?this.decompress=a:this.decompress=Wo,t?this.cache=t:this.cache=new Tm}getHeader(){return Er(this,null,function*(){return yield this.cache.getHeader(this.source)})}getZxyAttempt(r,t,a,s){return Er(this,null,function*(){const h=ym(r,t,a),R=yield this.cache.getHeader(this.source);if(R.specVersion<3)return Xo.getZxy(R,this.source,this.cache,r,t,a,s);if(r<R.minZoom||r>R.maxZoom)return;let D=R.rootDirectoryOffset,N=R.rootDirectoryLength;for(let Z=0;Z<=3;Z++){const Ae=yield this.cache.getDirectory(this.source,D,N,R),he=_m(Ae,h);if(he)if(he.runLength>0){const me=yield this.source.getBytes(R.tileDataOffset+he.offset,he.length,s);if(R.etag&&R.etag!==me.etag)throw new Wt(me.etag);return{data:yield this.decompress(me.data,R.tileCompression),cacheControl:me.cacheControl,expires:me.expires}}else D=R.leafDirectoryOffset+he.offset,N=he.length;else return}throw Error("Maximum directory depth exceeded")})}getZxy(r,t,a,s){return Er(this,null,function*(){try{return yield this.getZxyAttempt(r,t,a,s)}catch(h){if(h instanceof Wt)return this.cache.invalidate(this.source,h.message),yield this.getZxyAttempt(r,t,a,s);throw h}})}getMetadataAttempt(){return Er(this,null,function*(){const r=yield this.cache.getHeader(this.source),t=yield this.source.getBytes(r.jsonMetadataOffset,r.jsonMetadataLength);if(r.etag&&r.etag!==t.etag)throw new Wt(t.etag);const a=yield this.decompress(t.data,r.internalCompression),s=new TextDecoder("utf-8");return JSON.parse(s.decode(a))})}getMetadata(){return Er(this,null,function*(){try{return yield this.getMetadataAttempt()}catch(r){if(r instanceof Wt)return this.cache.invalidate(this.source,r.message),yield this.getMetadataAttempt();throw r}})}};const{document:Lo}=bc;function Oo(r){let t;const a=r[20].default,s=si(a,r,r[19],null);return{c(){s&&s.c()},l(h){s&&s.l(h)},m(h,R){s&&s.m(h,R),t=!0},p(h,R){s&&s.p&&(!t||R&524288)&&li(s,a,h,h[19],t?di(a,h[19],R,null):ci(h[19]),null)},i(h){t||(Qr(s,h),t=!0)},o(h){St(s,h),t=!1},d(h){s&&s.d(h)}}}function Sm(r){let t,a,s,h,R,D=r[3]&&Oo(r);return{c(){t=go("link"),s=dc(),h=go("div"),D&&D.c(),this.h()},l(N){const Z=mc("svelte-19mu9pj",Lo.head);t=Eo(Z,"LINK",{rel:!0,href:!0}),Z.forEach(Ht),s=hc(N),h=Eo(N,"DIV",{id:!0,class:!0});var Ae=vc(h);D&&D.l(Ae),Ae.forEach(Ht),this.h()},h(){zt(t,"rel","stylesheet"),zt(t,"href",a=r[1]?r[1]:"https://unpkg.com/maplibre-gl@2.4.0/dist/maplibre-gl.css"),zt(h,"id",r[0]),zt(h,"class","map svelte-1tna482")},m(N,Z){yc(Lo.head,t),ei(N,s,Z),ei(N,h,Z),D&&D.m(h,null),r[21](h),R=!0},p(N,[Z]){(!R||Z&2&&a!==(a=N[1]?N[1]:"https://unpkg.com/maplibre-gl@2.4.0/dist/maplibre-gl.css"))&&zt(t,"href",a),N[3]?D?(D.p(N,Z),Z&8&&Qr(D,1)):(D=Oo(N),D.c(),Qr(D,1),D.m(h,null)):D&&(Go(),St(D,1,1,()=>{D=null}),Do()),(!R||Z&1)&&zt(h,"id",N[0])},i(N){R||(Qr(D),R=!0)},o(N){St(D),R=!1},d(N){Ht(t),N&&Ht(s),N&&Ht(h),D&&D.d(),r[21](null)}}}function wm(r=1e3){return new Promise(t=>setTimeout(t,r))}function Lm(r,t,a){let{$$slots:s={},$$scope:h}=t;const R=Io();let{map:D}=t,{id:N="map"}=t,{location:Z={lng:15,lat:45,zoom:1}}=t,{style:Ae={version:8,sources:{},layers:[{id:"background",type:"background",paint:{"background-color":"lightgrey"}}]}}=t,{css:he=null}=t,{pmtiles:me=!1}=t,{options:Fe={}}=t,{minzoom:Me=0}=t,{maxzoom:Ue=14}=t,{controls:Be=!1}=t,{tabbable:qe=!1}=t,{zoom:Qe=null}=t,{center:Oe=null}=t,{pitch:dr=null}=t,{bearing:Ke=null}=t,{interactive:tr=!0}=t,{attribution:je=!0}=t,br,ve={},He=!1;$n("map",{getMap:()=>D}),Z.bounds?ve.bounds=Z.bounds:Z.lng&&Z.lat&&(ve.center=[+Z.lng,+Z.lat],Z.zoom&&(ve.zoom=+Z.zoom),Z.pitch&&(ve.pitch=+Z.pitch),Z.bearing&&(ve.bearing=+Z.bearing)),je||(ve.attributionControl=!1),ve={...ve,...Fe},oi(()=>{if(me){let Te=new dm;mn.addProtocol("pmtiles",Te.tile)}a(4,D=new mn.Map({container:br,style:Ae,minZoom:Me,maxZoom:Ue,interactive:tr,...ve})),Be&&!Array.isArray(Be)?D.addControl(new mn.NavigationControl({showCompass:!1})):Array.isArray(Be)&&Be!=["locate"]&&D.addControl(new mn.NavigationControl({showCompass:Be.includes("compass"),visualizePitch:Be.includes("pitch")})),Array.isArray(Be)&&Be.includes("locate")&&D.addControl(new mn.GeolocateControl),D.on("load",Te=>{a(5,Qe=D.getZoom()),a(6,Oe=D.getCenter()),a(7,dr=D.getPitch()),a(8,Ke=D.getBearing()),a(3,He=!0),!qe&&document.querySelector(`#${N} canvas`)&&(document.querySelector(`#${N} canvas`).tabIndex="-1"),R("load",{event:Te})}),D.on("moveend",()=>{a(5,Qe=D.getZoom()),a(6,Oe=D.getCenter()),a(7,dr=D.getPitch()),a(8,Ke=D.getBearing())})}),ui(async()=>{await wm(250),D&&D.remove(),a(4,D=null)});function sr(Te){D&&D.setStyle(Te),R("style",{style:Te})}function kr(Te){_c[Te?"unshift":"push"](()=>{br=Te,a(2,br)})}return r.$$set=Te=>{"map"in Te&&a(4,D=Te.map),"id"in Te&&a(0,N=Te.id),"location"in Te&&a(9,Z=Te.location),"style"in Te&&a(10,Ae=Te.style),"css"in Te&&a(1,he=Te.css),"pmtiles"in Te&&a(11,me=Te.pmtiles),"options"in Te&&a(12,Fe=Te.options),"minzoom"in Te&&a(13,Me=Te.minzoom),"maxzoom"in Te&&a(14,Ue=Te.maxzoom),"controls"in Te&&a(15,Be=Te.controls),"tabbable"in Te&&a(16,qe=Te.tabbable),"zoom"in Te&&a(5,Qe=Te.zoom),"center"in Te&&a(6,Oe=Te.center),"pitch"in Te&&a(7,dr=Te.pitch),"bearing"in Te&&a(8,Ke=Te.bearing),"interactive"in Te&&a(17,tr=Te.interactive),"attribution"in Te&&a(18,je=Te.attribution),"$$scope"in Te&&a(19,h=Te.$$scope)},r.$$.update=()=>{r.$$.dirty&1024&&sr(Ae)},[N,he,br,He,D,Qe,Oe,dr,Ke,Z,Ae,me,Fe,Me,Ue,Be,qe,tr,je,h,s,kr]}let zm=class extends ai{constructor(t){super(),ii(this,t,Lm,Sm,fi,{map:4,id:0,location:9,style:10,css:1,pmtiles:11,options:12,minzoom:13,maxzoom:14,controls:15,tabbable:16,zoom:5,center:6,pitch:7,bearing:8,interactive:17,attribution:18})}};function Co(r){let t;const a=r[12].default,s=si(a,r,r[11],null);return{c(){s&&s.c()},l(h){s&&s.l(h)},m(h,R){s&&s.m(h,R),t=!0},p(h,R){s&&s.p&&(!t||R&2048)&&li(s,a,h,h[11],t?di(a,h[11],R,null):ci(h[11]),null)},i(h){t||(Qr(s,h),t=!0)},o(h){St(s,h),t=!1},d(h){s&&s.d(h)}}}function Om(r){let t,a,s=r[0]&&Co(r);return{c(){s&&s.c(),t=xo()},l(h){s&&s.l(h),t=xo()},m(h,R){s&&s.m(h,R),ei(h,t,R),a=!0},p(h,[R]){h[0]?s?(s.p(h,R),R&1&&Qr(s,1)):(s=Co(h),s.c(),Qr(s,1),s.m(t.parentNode,t)):s&&(Go(),St(s,1,1,()=>{s=null}),Do())},i(h){a||(Qr(s),a=!0)},o(h){St(s),a=!1},d(h){s&&s.d(h),h&&Ht(t)}}}function Cm(r=1e3){return new Promise(t=>setTimeout(t,r))}function Rm(r,t,a){let{$$slots:s={},$$scope:h}=t,{id:R}=t,{type:D}=t,{url:N=null}=t,{props:Z={}}=t,{data:Ae=null}=t,{layer:he=null}=t,{promoteId:me=null}=t,{minzoom:Fe=null}=t,{maxzoom:Me=null}=t,{tilesize:Ue=256}=t,Be=!1,qe=N;const{getMap:Qe}=ri("map"),Oe=Qe();$n("source",{source:R,layer:he,promoteId:me}),Oe.getSource(R)&&Oe.removeSource(R);async function dr(){await Cm(100),Oe.isSourceLoaded(R)?(a(0,Be=!0),console.log(R+" map source loaded!")):(console.log("..."),dr())}Fe&&(Z.minzoom=Fe),Me&&(Z.maxzoom=Me),he&&me?(Z.promoteId={},Z.promoteId[he]=me):me&&(Z.promoteId=me);function Ke(){console.log(R+" map source loading...");let ve;D=="geojson"?Ae?ve={type:D,data:Ae,...Z}:N&&(ve={type:D,data:N,...Z}):D=="vector"?(ve={type:D,...Z},N.slice(0,7)==="pmtiles"?ve.url=N:ve.tiles=[N]):D=="raster"?ve={type:D,tiles:[N],tileSize:Ue,...Z}:D=="raster-dem"&&(ve={type:D,tiles:[N],tileSize:Ue,...Z}),ve&&(console.log(ve),Oe.addSource(R,ve),dr())}function tr(ve){let He=Oe.getSource(R);He&&He.setData(ve)}function je(ve){if(ve!==qe){let He=Oe.getSource(R);He&&(ve.slice(0,7)==="pmtiles"?He.setUrl(ve):He.setTiles([ve])),qe=ve}}function br(ve){ve!==qe&&(Oe.getSource(R).tiles=[ve],Oe.style.sourceCaches[R].clearTiles(),Oe.style.sourceCaches[R].update(Oe.transform),Oe.triggerRepaint(),qe=ve)}return oi(Ke),ui(async()=>{Oe&&Oe.getSource(R)&&(Oe.getStyle().layers.filter(He=>He.source==R).forEach(He=>{Oe.removeLayer(He.id)}),Oe.removeSource(R))}),r.$$set=ve=>{"id"in ve&&a(2,R=ve.id),"type"in ve&&a(3,D=ve.type),"url"in ve&&a(4,N=ve.url),"props"in ve&&a(1,Z=ve.props),"data"in ve&&a(5,Ae=ve.data),"layer"in ve&&a(6,he=ve.layer),"promoteId"in ve&&a(7,me=ve.promoteId),"minzoom"in ve&&a(8,Fe=ve.minzoom),"maxzoom"in ve&&a(9,Me=ve.maxzoom),"tilesize"in ve&&a(10,Ue=ve.tilesize),"$$scope"in ve&&a(11,h=ve.$$scope)},r.$$.update=()=>{r.$$.dirty&41&&D=="geojson"&&Be&&tr(Ae),r.$$.dirty&25&&D=="vector"&&Be&&je(N),r.$$.dirty&25&&D=="raster"&&Be&&br(N)},[Be,Z,R,D,N,Ae,he,me,Fe,Me,Ue,h,s]}class Hm extends ai{constructor(t){super(),ii(this,t,Rm,Om,fi,{id:2,type:3,url:4,props:1,data:5,layer:6,promoteId:7,minzoom:8,maxzoom:9,tilesize:10})}}const Gm=r=>({hovered:r[0]&1}),Ro=r=>({hovered:r[0]});function Dm(r){let t;const a=r[30].default,s=si(a,r,r[29],Ro);return{c(){s&&s.c()},l(h){s&&s.l(h)},m(h,R){s&&s.m(h,R),t=!0},p(h,R){s&&s.p&&(!t||R[0]&536870913)&&li(s,a,h,h[29],t?di(a,h[29],R,Gm):ci(h[29]),Ro)},i(h){t||(Qr(s,h),t=!0)},o(h){St(s,h),t=!1},d(h){s&&s.d(h)}}}function Im(r,t,a){let s,{$$slots:h={},$$scope:R}=t;const D=Io();let{id:N}=t,{type:Z}=t,{filter:Ae=null}=t,{layout:he={}}=t,{paint:me={}}=t,{data:Fe=null}=t,{colorKey:Me="color"}=t,{nameKey:Ue=null}=t,{valueKey:Be=null}=t,{idKey:qe=null}=t,{select:Qe=!1}=t,{clickIgnore:Oe=!1}=t,{clickCenter:dr=!1}=t,{selected:Ke=null}=t,{hover:tr=!1}=t,{hovered:je=null}=t,{highlight:br=!1}=t,{highlightKey:ve="highlighted"}=t,{highlighted:He=[]}=t,{order:sr=null}=t,{maxzoom:kr=null}=t,{minzoom:Te=null}=t,{sourceLayer:Ze=null}=t,{visible:Ir=!0}=t;const{source:Je,layer:Jr,promoteId:ot}=ri("source"),{getMap:pr}=ri("map"),ke=pr();$n("layer",{layer:N});const Fr=gc({id:null,feature:null,event:null});pc(r,Fr,le=>a(32,s=le)),$n("hover",Fr),qe=qe||ot,Ze=Ze||Jr;let gr=null,_r=null,zr=[];he.visibility=Ir?"visible":"none";let Sr={id:N,type:Z,source:Je,paint:me,layout:he};Ae&&(Sr.filter=Ae),Ze&&(Sr["source-layer"]=Ze),kr&&(Sr.maxzoom=kr),Te&&(Sr.minzoom=Te),oi(()=>{ke.getLayer(N)&&ke.removeLayer(N),ke.addLayer(Sr,sr)});function $r(le,$e=Me){if(console.log("updating colors..."),Ue||Be)for(const xr of le)ke.setFeatureState({source:Je,sourceLayer:Ze,id:xr[qe]},{color:$e?xr[$e]:null,name:Ue?xr[Ue]:null,value:Be?xr[Be]:null});else for(const xr of le)ke.setFeatureState({source:Je,sourceLayer:Ze,id:xr[qe]},{color:xr[$e]})}function ut(le){ke.getLayer(N)&&ke.setFilter(N,le)}function st(le){if(ke.getLayer(N))for(const $e in le)ke.setPaintProperty(N,$e,le[$e])}function wt(le){ke.getLayer(N)&&ke.setLayoutProperty(N,"visibility",le?"visible":"none")}return Qe&&ke.on("click",N,le=>{if(le.features.length>0&&!Oe){let $e=le.features[0];if(a(2,Ke=$e.id),D("select",{id:Ke,feature:$e,event:le}),gr&&ke.setFeatureState({source:Je,sourceLayer:Ze,id:gr},{selected:!1}),ke.setFeatureState({source:Je,sourceLayer:Ze,id:Ke},{selected:!0}),dr){let xr=centroid(le.features[0].toJSON().geometry);ke.flyTo({center:xr.geometry.coordinates})}a(26,gr=Ke)}}),tr&&(ke.on("mousemove",N,le=>{if(le.features.length>0){je&&ke.setFeatureState({source:Je,sourceLayer:Ze,id:je},{hovered:!1});let $e=le.features[0];a(0,je=a(27,_r=$e.id)),Fr.set({id:je,feature:$e,event:le}),D("hover",s),ke.setFeatureState({source:Je,sourceLayer:Ze,id:je},{hovered:!0}),ke.getCanvas().style.cursor="pointer"}}),ke.on("mouseleave",N,le=>{je&&ke.setFeatureState({source:Je,sourceLayer:Ze,id:je},{hovered:!1}),a(0,je=a(27,_r=null)),Fr.set({id:null,feature:null,event:le}),D("hover",s),ke.getCanvas().style.cursor=""})),ui(async()=>{ke&&ke.getLayer(N)&&ke.removeLayer(N)}),r.$$set=le=>{"id"in le&&a(6,N=le.id),"type"in le&&a(7,Z=le.type),"filter"in le&&a(8,Ae=le.filter),"layout"in le&&a(4,he=le.layout),"paint"in le&&a(9,me=le.paint),"data"in le&&a(10,Fe=le.data),"colorKey"in le&&a(11,Me=le.colorKey),"nameKey"in le&&a(12,Ue=le.nameKey),"valueKey"in le&&a(13,Be=le.valueKey),"idKey"in le&&a(5,qe=le.idKey),"select"in le&&a(14,Qe=le.select),"clickIgnore"in le&&a(15,Oe=le.clickIgnore),"clickCenter"in le&&a(16,dr=le.clickCenter),"selected"in le&&a(2,Ke=le.selected),"hover"in le&&a(17,tr=le.hover),"hovered"in le&&a(0,je=le.hovered),"highlight"in le&&a(18,br=le.highlight),"highlightKey"in le&&a(19,ve=le.highlightKey),"highlighted"in le&&a(20,He=le.highlighted),"order"in le&&a(21,sr=le.order),"maxzoom"in le&&a(22,kr=le.maxzoom),"minzoom"in le&&a(23,Te=le.minzoom),"sourceLayer"in le&&a(3,Ze=le.sourceLayer),"visible"in le&&a(24,Ir=le.visible),"$$scope"in le&&a(29,R=le.$$scope)},r.$$.update=()=>{if(r.$$.dirty[0]&3072&&Fe&&$r(Fe,Me),r.$$.dirty[0]&256&&ut(Ae),r.$$.dirty[0]&512&&st(me),r.$$.dirty[0]&16777216&&wt(Ir),r.$$.dirty[0]&270270472&&br&&He!=zr){if(zr[0])for(const le of zr){let $e={};$e[ve]=!1,ke.setFeatureState({source:Je,sourceLayer:Ze,id:le},$e)}if(a(28,zr=He),He[0])for(const le of He){let $e={};$e[ve]=!0,ke.setFeatureState({source:Je,sourceLayer:Ze,id:le},$e)}}r.$$.dirty[0]&67125260&&Qe&&Ke!=gr&&(gr&&ke.setFeatureState({source:Je,sourceLayer:Ze,id:gr},{selected:!1}),Ke&&ke.setFeatureState({source:Je,sourceLayer:Ze,id:Ke},{selected:!0}),a(26,gr=Ke)),r.$$.dirty[0]&134348809&&tr&&je!=_r&&(_r&&ke.setFeatureState({source:Je,sourceLayer:Ze,id:_r},{hovered:!1}),je&&ke.setFeatureState({source:Je,sourceLayer:Ze,id:je},{hovered:!0}),a(27,_r=je))},[je,Fr,Ke,Ze,he,qe,N,Z,Ae,me,Fe,Me,Ue,Be,Qe,Oe,dr,tr,br,ve,He,sr,kr,Te,Ir,$r,gr,_r,zr,R,h]}class Xm extends ai{constructor(t){super(),ii(this,t,Im,Dm,fi,{id:6,type:7,filter:8,layout:4,paint:9,data:10,colorKey:11,nameKey:12,valueKey:13,idKey:5,select:14,clickIgnore:15,clickCenter:16,selected:2,hover:17,hovered:0,highlight:18,highlightKey:19,highlighted:20,order:21,maxzoom:22,minzoom:23,sourceLayer:3,visible:24,updateColors:25},null,[-1,-1])}get updateColors(){return this.$$.ctx[25]}}export{zm as M,Hm as a,Xm as b,Um as c,Rc as d,Vm as e,Md as f,wc as g,Oc as h,Mm as l,km as r,Pm as s};
