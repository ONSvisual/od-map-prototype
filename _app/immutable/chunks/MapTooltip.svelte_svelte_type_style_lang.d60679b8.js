//js
import{h as Pl,g as Qt,f as Fn}from"./utils.368c67f1.js";import{s as Va,f as to,a as Bl,W as kl,g as no,d as Rt,c as Ml,h as Ul,j as Ot,x as Vl,i as ka,R as co,K as Dn,o as za,Y as Ha,r as ja,u as Xa,v as qa,w as Wa,p as zl,e as ao,N as Ma,z as Hl}from"./scheduler.3a2f20bc.js";import{S as Ya,i as Ka,a as Mr,g as mo,t as dt,c as ho}from"./index.b332e88e.js";import{w as jl}from"./index.694b0390.js";const Xl=typeof window<"u"?window:typeof globalThis<"u"?globalThis:global;function Nd(s){return(s==null?void 0:s.length)!==void 0?s:Array.from(s)}function Pd(s,E){const A={},P={},W={$$scope:1};let he=s.length;for(;he--;){const ne=s[he],Z=E[he];if(Z){for(const de in ne)de in Z||(P[de]=1);for(const de in Z)W[de]||(A[de]=Z[de],W[de]=1);s[he]=Z}else for(const de in ne)W[de]=1}for(const ne in P)ne in A||(A[ne]=void 0);return A}function Bd(s){return typeof s=="object"&&s!==null?s:{}}var vo={exports:{}};(function(s,E){(function(A,P){s.exports=P()})(Pl,function(){var A=function(e){return e instanceof Uint8Array||e instanceof Uint16Array||e instanceof Uint32Array||e instanceof Int8Array||e instanceof Int16Array||e instanceof Int32Array||e instanceof Float32Array||e instanceof Float64Array||e instanceof Uint8ClampedArray},P=function(e,t){for(var l=Object.keys(t),T=0;T<l.length;++T)e[l[T]]=t[l[T]];return e},W=`
`;function he(e){return typeof atob<"u"?atob(e):"base64:"+e}function ne(e){var t=new Error("(regl) "+e);throw console.error(t),t}function Z(e,t){e||ne(t)}function de(e){return e?": "+e:""}function Me(e,t,l){e in t||ne("unknown parameter ("+e+")"+de(l)+". possible values: "+Object.keys(t).join())}function He(e,t){A(e)||ne("invalid parameter type"+de(t)+". must be a typed array")}function Be(e,t){switch(t){case"number":return typeof e=="number";case"object":return typeof e=="object";case"string":return typeof e=="string";case"boolean":return typeof e=="boolean";case"function":return typeof e=="function";case"undefined":return typeof e>"u";case"symbol":return typeof e=="symbol"}}function Ae(e,t,l){Be(e,t)||ne("invalid parameter type"+de(l)+". expected "+t+", got "+typeof e)}function we(e,t){e>=0&&(e|0)===e||ne("invalid parameter type, ("+e+")"+de(t)+". must be a nonnegative integer")}function Ge(e,t,l){t.indexOf(e)<0&&ne("invalid value"+de(l)+". must be one of: "+t)}var je=["gl","canvas","container","attributes","pixelRatio","extensions","optionalExtensions","profile","onDone"];function Xe(e){Object.keys(e).forEach(function(t){je.indexOf(t)<0&&ne('invalid regl constructor argument "'+t+'". must be one of '+je)})}function We(e,t){for(e=e+"";e.length<t;)e=" "+e;return e}function De(){this.name="unknown",this.lines=[],this.index={},this.hasErrors=!1}function er(e,t){this.number=e,this.line=t,this.errors=[]}function rr(e,t,l){this.file=e,this.line=t,this.message=l}function lr(){var e=new Error,t=(e.stack||e).toString(),l=/compileProcedure.*\n\s*at.*\((.*)\)/.exec(t);if(l)return l[1];var T=/compileProcedure.*\n\s*at\s+(.*)(\n|$)/.exec(t);return T?T[1]:"unknown"}function qe(){var e=new Error,t=(e.stack||e).toString(),l=/at REGLCommand.*\n\s+at.*\((.*)\)/.exec(t);if(l)return l[1];var T=/at REGLCommand.*\n\s+at\s+(.*)\n/.exec(t);return T?T[1]:"unknown"}function or(e,t){var l=e.split(`
`),T=1,I=0,x={unknown:new De,0:new De};x.unknown.name=x[0].name=t||lr(),x.unknown.lines.push(new er(0,""));for(var L=0;L<l.length;++L){var k=l[L],B=/^\s*#\s*(\w+)\s+(.+)\s*$/.exec(k);if(B)switch(B[1]){case"line":var H=/(\d+)(\s+\d+)?/.exec(B[2]);H&&(T=H[1]|0,H[2]&&(I=H[2]|0,I in x||(x[I]=new De)));break;case"define":var X=/SHADER_NAME(_B64)?\s+(.*)$/.exec(B[2]);X&&(x[I].name=X[1]?he(X[2]):X[2]);break}x[I].lines.push(new er(T++,k))}return Object.keys(x).forEach(function(j){var Y=x[j];Y.lines.forEach(function(M){Y.index[M.number]=M})}),x}function xe(e){var t=[];return e.split(`
`).forEach(function(l){if(!(l.length<5)){var T=/^ERROR:\s+(\d+):(\d+):\s*(.*)$/.exec(l);T?t.push(new rr(T[1]|0,T[2]|0,T[3].trim())):l.length>0&&t.push(new rr("unknown",0,l))}}),t}function ir(e,t){t.forEach(function(l){var T=e[l.file];if(T){var I=T.index[l.line];if(I){I.errors.push(l),T.hasErrors=!0;return}}e.unknown.hasErrors=!0,e.unknown.lines[0].errors.push(l)})}function Wr(e,t,l,T,I){if(!e.getShaderParameter(t,e.COMPILE_STATUS)){var x=e.getShaderInfoLog(t),L=T===e.FRAGMENT_SHADER?"fragment":"vertex";Zt(l,"string",L+" shader source must be a string",I);var k=or(l,I),B=xe(x);ir(k,B),Object.keys(k).forEach(function(H){var X=k[H];if(!X.hasErrors)return;var j=[""],Y=[""];function M(z,b){j.push(z),Y.push(b||"")}M("file number "+H+": "+X.name+`
`,"color:red;text-decoration:underline;font-weight:bold"),X.lines.forEach(function(z){if(z.errors.length>0){M(We(z.number,4)+"|  ","background-color:yellow; font-weight:bold"),M(z.line+W,"color:red; background-color:yellow; font-weight:bold");var b=0;z.errors.forEach(function(w){var V=w.message,ae=/^\s*'(.*)'\s*:\s*(.*)$/.exec(V);if(ae){var N=ae[1];switch(V=ae[2],N){case"assign":N="=";break}b=Math.max(z.line.indexOf(N,b),0)}else b=0;M(We("| ",6)),M(We("^^^",b+3)+W,"font-weight:bold"),M(We("| ",6)),M(V+W,"font-weight:bold")}),M(We("| ",6)+W)}else M(We(z.number,4)+"|  "),M(z.line+W,"color:red")}),typeof document<"u"&&!window.chrome?(Y[0]=j.join("%c"),console.log.apply(console,Y)):console.log(j.join(""))}),Z.raise("Error compiling "+L+" shader, "+k[0].name)}}function Se(e,t,l,T,I){if(!e.getProgramParameter(t,e.LINK_STATUS)){var x=e.getProgramInfoLog(t),L=or(l,I),k=or(T,I),B='Error linking program with vertex shader, "'+k[0].name+'", and fragment shader "'+L[0].name+'"';typeof document<"u"?console.log("%c"+B+W+"%c"+x,"color:red;text-decoration:underline;font-weight:bold","color:red"):console.log(B+W+x),Z.raise(B)}}function Yr(e){e._commandRef=lr()}function Qe(e,t,l,T){Yr(e);function I(B){return B?T.id(B):0}e._fragId=I(e.static.frag),e._vertId=I(e.static.vert);function x(B,H){Object.keys(H).forEach(function(X){B[T.id(X)]=!0})}var L=e._uniformSet={};x(L,t.static),x(L,t.dynamic);var k=e._attributeSet={};x(k,l.static),x(k,l.dynamic),e._hasCount="count"in e.static||"count"in e.dynamic||"elements"in e.static||"elements"in e.dynamic}function Dr(e,t){var l=qe();ne(e+" in command "+(t||lr())+(l==="unknown"?"":" called from "+l))}function vr(e,t,l){e||Dr(t,l||lr())}function Pn(e,t,l,T){e in t||Dr("unknown parameter ("+e+")"+de(l)+". possible values: "+Object.keys(t).join(),T||lr())}function Zt(e,t,l,T){Be(e,t)||Dr("invalid parameter type"+de(l)+". expected "+t+", got "+typeof e,T||lr())}function Bn(e){e()}function Pe(e,t,l){e.texture?Ge(e.texture._texture.internalformat,t,"unsupported texture format for attachment"):Ge(e.renderbuffer._renderbuffer.format,l,"unsupported renderbuffer format for attachment")}var Rr=33071,wr=9728,Nr=9984,Kr=9985,Qr=9986,Ct=9987,Jt=5120,kn=5121,Mn=5122,Un=5123,se=5124,ur=5125,xr=5126,Ja=32819,$a=32820,ei=33635,ri=34042,yo=36193,pr={};pr[Jt]=pr[kn]=1,pr[Mn]=pr[Un]=pr[yo]=pr[ei]=pr[Ja]=pr[$a]=2,pr[se]=pr[ur]=pr[xr]=pr[ri]=4;function ti(e,t){return e===$a||e===Ja||e===ei?2:e===ri?4:pr[e]*t}function $t(e){return!(e&e-1)&&!!e}function Eo(e,t,l){var T,I=t.width,x=t.height,L=t.channels;Z(I>0&&I<=l.maxTextureSize&&x>0&&x<=l.maxTextureSize,"invalid texture shape"),(e.wrapS!==Rr||e.wrapT!==Rr)&&Z($t(I)&&$t(x),"incompatible wrap mode for texture, both width and height must be power of 2"),t.mipmask===1?I!==1&&x!==1&&Z(e.minFilter!==Nr&&e.minFilter!==Qr&&e.minFilter!==Kr&&e.minFilter!==Ct,"min filter requires mipmap"):(Z($t(I)&&$t(x),"texture must be a square power of 2 to support mipmapping"),Z(t.mipmask===(I<<1)-1,"missing or incomplete mipmap data")),t.type===xr&&(l.extensions.indexOf("oes_texture_float_linear")<0&&Z(e.minFilter===wr&&e.magFilter===wr,"filter not supported, must enable oes_texture_float_linear"),Z(!e.genMipmaps,"mipmap generation not supported with float textures"));var k=t.images;for(T=0;T<16;++T)if(k[T]){var B=I>>T,H=x>>T;Z(t.mipmask&1<<T,"missing mipmap data");var X=k[T];if(Z(X.width===B&&X.height===H,"invalid shape for mip images"),Z(X.format===t.format&&X.internalformat===t.internalformat&&X.type===t.type,"incompatible type for mip image"),!X.compressed)if(X.data){var j=Math.ceil(ti(X.type,L)*B/X.unpackAlignment)*X.unpackAlignment;Z(X.data.byteLength===j*H,"invalid data for image, buffer size is inconsistent with image format")}else X.element||X.copy}else e.genMipmaps||Z((t.mipmask&1<<T)===0,"extra mipmap data");t.compressed&&Z(!e.genMipmaps,"mipmap generation for compressed images not supported")}function go(e,t,l,T){var I=e.width,x=e.height,L=e.channels;Z(I>0&&I<=T.maxTextureSize&&x>0&&x<=T.maxTextureSize,"invalid texture shape"),Z(I===x,"cube map must be square"),Z(t.wrapS===Rr&&t.wrapT===Rr,"wrap mode not supported by cube map");for(var k=0;k<l.length;++k){var B=l[k];Z(B.width===I&&B.height===x,"inconsistent cube map face shape"),t.genMipmaps&&(Z(!B.compressed,"can not generate mipmap for compressed textures"),Z(B.mipmask===1,"can not specify mipmaps and generate mipmaps"));for(var H=B.images,X=0;X<16;++X){var j=H[X];if(j){var Y=I>>X,M=x>>X;Z(B.mipmask&1<<X,"missing mipmap data"),Z(j.width===Y&&j.height===M,"invalid shape for mip images"),Z(j.format===e.format&&j.internalformat===e.internalformat&&j.type===e.type,"incompatible type for mip image"),j.compressed||(j.data?Z(j.data.byteLength===Y*M*Math.max(ti(j.type,L),j.unpackAlignment),"invalid data for image, buffer size is inconsistent with image format"):j.element||j.copy)}}}}var n=P(Z,{optional:Bn,raise:ne,commandRaise:Dr,command:vr,parameter:Me,commandParameter:Pn,constructor:Xe,type:Ae,commandType:Zt,isTypedArray:He,nni:we,oneOf:Ge,shaderError:Wr,linkError:Se,callSite:qe,saveCommandRef:Yr,saveDrawInfo:Qe,framebufferFormat:Pe,guessCommand:lr,texture2D:Eo,textureCube:go}),Ao=0,xo=0,To=5,So=6;function Zr(e,t){this.id=Ao++,this.type=e,this.data=t}function ni(e){return e.replace(/\\/g,"\\\\").replace(/"/g,'\\"')}function It(e){if(e.length===0)return[];var t=e.charAt(0),l=e.charAt(e.length-1);if(e.length>1&&t===l&&(t==='"'||t==="'"))return['"'+ni(e.substr(1,e.length-2))+'"'];var T=/\[(false|true|null|\d+|'[^']*'|"[^"]*")\]/.exec(e);if(T)return It(e.substr(0,T.index)).concat(It(T[1])).concat(It(e.substr(T.index+T[0].length)));var I=e.split(".");if(I.length===1)return['"'+ni(e)+'"'];for(var x=[],L=0;L<I.length;++L)x=x.concat(It(I[L]));return x}function ai(e){return"["+It(e).join("][")+"]"}function wo(e,t){return new Zr(e,ai(t+""))}function Lo(e){return typeof e=="function"&&!e._reglType||e instanceof Zr}function ii(e,t){if(typeof e=="function")return new Zr(xo,e);if(typeof e=="number"||typeof e=="boolean")return new Zr(To,e);if(Array.isArray(e))return new Zr(So,e.map(function(l,T){return ii(l,t+"["+T+"]")}));if(e instanceof Zr)return e;n(!1,"invalid option type in uniform "+t)}var yr={DynamicVariable:Zr,define:wo,isDynamic:Lo,unbox:ii,accessor:ai},Vn={next:typeof requestAnimationFrame=="function"?function(e){return requestAnimationFrame(e)}:function(e){return setTimeout(e,16)},cancel:typeof cancelAnimationFrame=="function"?function(e){return cancelAnimationFrame(e)}:clearTimeout},fi=typeof performance<"u"&&performance.now?function(){return performance.now()}:function(){return+new Date};function Oo(){var e={"":0},t=[""];return{id:function(l){var T=e[l];return T||(T=e[l]=t.length,t.push(l),T)},str:function(l){return t[l]}}}function Ro(e,t,l){var T=document.createElement("canvas");P(T.style,{border:0,margin:0,padding:0,top:0,left:0,width:"100%",height:"100%"}),e.appendChild(T),e===document.body&&(T.style.position="absolute",P(e.style,{margin:0,padding:0}));function I(){var k=window.innerWidth,B=window.innerHeight;if(e!==document.body){var H=T.getBoundingClientRect();k=H.right-H.left,B=H.bottom-H.top}T.width=l*k,T.height=l*B}var x;e!==document.body&&typeof ResizeObserver=="function"?(x=new ResizeObserver(function(){setTimeout(I)}),x.observe(e)):window.addEventListener("resize",I,!1);function L(){x?x.disconnect():window.removeEventListener("resize",I),e.removeChild(T)}return I(),{canvas:T,onDestroy:L}}function Co(e,t){function l(T){try{return e.getContext(T,t)}catch{return null}}return l("webgl")||l("experimental-webgl")||l("webgl-experimental")}function Io(e){return typeof e.nodeName=="string"&&typeof e.appendChild=="function"&&typeof e.getBoundingClientRect=="function"}function Go(e){return typeof e.drawArrays=="function"||typeof e.drawElements=="function"}function oi(e){return typeof e=="string"?e.split():(n(Array.isArray(e),"invalid extension array"),e)}function ui(e){return typeof e=="string"?(n(typeof document<"u","not supported outside of DOM"),document.querySelector(e)):e}function Fo(e){var t=e||{},l,T,I,x,L={},k=[],B=[],H=typeof window>"u"?1:window.devicePixelRatio,X=!1,j=function(z){z&&n.raise(z)},Y=function(){};if(typeof t=="string"?(n(typeof document<"u","selector queries only supported in DOM enviroments"),l=document.querySelector(t),n(l,"invalid query string for element")):typeof t=="object"?Io(t)?l=t:Go(t)?(x=t,I=x.canvas):(n.constructor(t),"gl"in t?x=t.gl:"canvas"in t?I=ui(t.canvas):"container"in t&&(T=ui(t.container)),"attributes"in t&&(L=t.attributes,n.type(L,"object","invalid context attributes")),"extensions"in t&&(k=oi(t.extensions)),"optionalExtensions"in t&&(B=oi(t.optionalExtensions)),"onDone"in t&&(n.type(t.onDone,"function","invalid or missing onDone callback"),j=t.onDone),"profile"in t&&(X=!!t.profile),"pixelRatio"in t&&(H=+t.pixelRatio,n(H>0,"invalid pixel ratio"))):n.raise("invalid arguments to regl"),l&&(l.nodeName.toLowerCase()==="canvas"?I=l:T=l),!x){if(!I){n(typeof document<"u","must manually specify webgl context outside of DOM environments");var M=Ro(T||document.body,j,H);if(!M)return null;I=M.canvas,Y=M.onDestroy}L.premultipliedAlpha===void 0&&(L.premultipliedAlpha=!0),x=Co(I,L)}return x?{gl:x,canvas:I,container:T,extensions:k,optionalExtensions:B,pixelRatio:H,profile:X,onDone:j,onDestroy:Y}:(Y(),j("webgl not supported, try upgrading your browser or graphics drivers http://get.webgl.org"),null)}function Do(e,t){var l={};function T(L){n.type(L,"string","extension name must be string");var k=L.toLowerCase(),B;try{B=l[k]=e.getExtension(k)}catch{}return!!B}for(var I=0;I<t.extensions.length;++I){var x=t.extensions[I];if(!T(x))return t.onDestroy(),t.onDone('"'+x+'" extension is not supported by the current WebGL context, try upgrading your system or a different browser'),null}return t.optionalExtensions.forEach(T),{extensions:l,restore:function(){Object.keys(l).forEach(function(L){if(l[L]&&!T(L))throw new Error("(regl): error restoring extension "+L)})}}}function Er(e,t){for(var l=Array(e),T=0;T<e;++T)l[T]=t(T);return l}var No=5120,Po=5121,Bo=5122,ko=5123,Mo=5124,Uo=5125,Vo=5126;function zo(e){for(var t=16;t<=1<<28;t*=16)if(e<=t)return t;return 0}function si(e){var t,l;return t=(e>65535)<<4,e>>>=t,l=(e>255)<<3,e>>>=l,t|=l,l=(e>15)<<2,e>>>=l,t|=l,l=(e>3)<<1,e>>>=l,t|=l,t|e>>1}function li(){var e=Er(8,function(){return[]});function t(x){var L=zo(x),k=e[si(L)>>2];return k.length>0?k.pop():new ArrayBuffer(L)}function l(x){e[si(x.byteLength)>>2].push(x)}function T(x,L){var k=null;switch(x){case No:k=new Int8Array(t(L),0,L);break;case Po:k=new Uint8Array(t(L),0,L);break;case Bo:k=new Int16Array(t(2*L),0,L);break;case ko:k=new Uint16Array(t(2*L),0,L);break;case Mo:k=new Int32Array(t(4*L),0,L);break;case Uo:k=new Uint32Array(t(4*L),0,L);break;case Vo:k=new Float32Array(t(4*L),0,L);break;default:return null}return k.length!==L?k.subarray(0,L):k}function I(x){l(x.buffer)}return{alloc:t,free:l,allocType:T,freeType:I}}var Ze=li();Ze.zero=li();var Ho=3408,jo=3410,Xo=3411,qo=3412,Wo=3413,Yo=3414,Ko=3415,Qo=33901,Zo=33902,Jo=3379,$o=3386,eu=34921,ru=36347,tu=36348,nu=35661,au=35660,iu=34930,fu=36349,ou=34076,uu=34024,su=7936,lu=7937,cu=7938,du=35724,mu=34047,hu=36063,vu=34852,en=3553,ci=34067,bu=34069,_u=33984,Gt=6408,zn=5126,di=5121,Hn=36160,pu=36053,yu=36064,Eu=16384,gu=function(e,t){var l=1;t.ext_texture_filter_anisotropic&&(l=e.getParameter(mu));var T=1,I=1;t.webgl_draw_buffers&&(T=e.getParameter(vu),I=e.getParameter(hu));var x=!!t.oes_texture_float;if(x){var L=e.createTexture();e.bindTexture(en,L),e.texImage2D(en,0,Gt,1,1,0,Gt,zn,null);var k=e.createFramebuffer();if(e.bindFramebuffer(Hn,k),e.framebufferTexture2D(Hn,yu,en,L,0),e.bindTexture(en,null),e.checkFramebufferStatus(Hn)!==pu)x=!1;else{e.viewport(0,0,1,1),e.clearColor(1,0,0,1),e.clear(Eu);var B=Ze.allocType(zn,4);e.readPixels(0,0,1,1,Gt,zn,B),e.getError()?x=!1:(e.deleteFramebuffer(k),e.deleteTexture(L),x=B[0]===1),Ze.freeType(B)}}var H=typeof navigator<"u"&&(/MSIE/.test(navigator.userAgent)||/Trident\//.test(navigator.appVersion)||/Edge/.test(navigator.userAgent)),X=!0;if(!H){var j=e.createTexture(),Y=Ze.allocType(di,36);e.activeTexture(_u),e.bindTexture(ci,j),e.texImage2D(bu,0,Gt,3,3,0,Gt,di,Y),Ze.freeType(Y),e.bindTexture(ci,null),e.deleteTexture(j),X=!e.getError()}return{colorBits:[e.getParameter(jo),e.getParameter(Xo),e.getParameter(qo),e.getParameter(Wo)],depthBits:e.getParameter(Yo),stencilBits:e.getParameter(Ko),subpixelBits:e.getParameter(Ho),extensions:Object.keys(t).filter(function(M){return!!t[M]}),maxAnisotropic:l,maxDrawbuffers:T,maxColorAttachments:I,pointSizeDims:e.getParameter(Qo),lineWidthDims:e.getParameter(Zo),maxViewportDims:e.getParameter($o),maxCombinedTextureUnits:e.getParameter(nu),maxCubeMapSize:e.getParameter(ou),maxRenderbufferSize:e.getParameter(uu),maxTextureUnits:e.getParameter(iu),maxTextureSize:e.getParameter(Jo),maxAttributes:e.getParameter(eu),maxVertexUniforms:e.getParameter(ru),maxVertexTextureUnits:e.getParameter(au),maxVaryingVectors:e.getParameter(tu),maxFragmentUniforms:e.getParameter(fu),glsl:e.getParameter(du),renderer:e.getParameter(lu),vendor:e.getParameter(su),version:e.getParameter(cu),readFloat:x,npotTextureCube:X}};function Lr(e){return!!e&&typeof e=="object"&&Array.isArray(e.shape)&&Array.isArray(e.stride)&&typeof e.offset=="number"&&e.shape.length===e.stride.length&&(Array.isArray(e.data)||A(e.data))}var gr=function(e){return Object.keys(e).map(function(t){return e[t]})},rn={shape:Su,flatten:Tu};function Au(e,t,l){for(var T=0;T<t;++T)l[T]=e[T]}function xu(e,t,l,T){for(var I=0,x=0;x<t;++x)for(var L=e[x],k=0;k<l;++k)T[I++]=L[k]}function mi(e,t,l,T,I,x){for(var L=x,k=0;k<t;++k)for(var B=e[k],H=0;H<l;++H)for(var X=B[H],j=0;j<T;++j)I[L++]=X[j]}function hi(e,t,l,T,I){for(var x=1,L=l+1;L<t.length;++L)x*=t[L];var k=t[l];if(t.length-l===4){var B=t[l+1],H=t[l+2],X=t[l+3];for(L=0;L<k;++L)mi(e[L],B,H,X,T,I),I+=x}else for(L=0;L<k;++L)hi(e[L],t,l+1,T,I),I+=x}function Tu(e,t,l,T){var I=1;if(t.length)for(var x=0;x<t.length;++x)I*=t[x];else I=0;var L=T||Ze.allocType(l,I);switch(t.length){case 0:break;case 1:Au(e,t[0],L);break;case 2:xu(e,t[0],t[1],L);break;case 3:mi(e,t[0],t[1],t[2],L,0);break;default:hi(e,t,0,L,0)}return L}function Su(e){for(var t=[],l=e;l.length;l=l[0])t.push(l.length);return t}var jn={"[object Int8Array]":5120,"[object Int16Array]":5122,"[object Int32Array]":5124,"[object Uint8Array]":5121,"[object Uint8ClampedArray]":5121,"[object Uint16Array]":5123,"[object Uint32Array]":5125,"[object Float32Array]":5126,"[object Float64Array]":5121,"[object ArrayBuffer]":5121},wu=5120,Lu=5122,Ou=5124,Ru=5121,Cu=5123,Iu=5125,Gu=5126,Fu=5126,Jr={int8:wu,int16:Lu,int32:Ou,uint8:Ru,uint16:Cu,uint32:Iu,float:Gu,float32:Fu},Du=35048,Nu=35040,tn={dynamic:Du,stream:Nu,static:35044},Xn=rn.flatten,vi=rn.shape,bi=35044,Pu=35040,qn=5121,Wn=5126,Ur=[];Ur[5120]=1,Ur[5122]=2,Ur[5124]=4,Ur[5121]=1,Ur[5123]=2,Ur[5125]=4,Ur[5126]=4;function nn(e){return jn[Object.prototype.toString.call(e)]|0}function _i(e,t){for(var l=0;l<t.length;++l)e[l]=t[l]}function pi(e,t,l,T,I,x,L){for(var k=0,B=0;B<l;++B)for(var H=0;H<T;++H)e[k++]=t[I*B+x*H+L]}function Bu(e,t,l,T){var I=0,x={};function L(b){this.id=I++,this.buffer=e.createBuffer(),this.type=b,this.usage=bi,this.byteLength=0,this.dimension=1,this.dtype=qn,this.persistentData=null,l.profile&&(this.stats={size:0})}L.prototype.bind=function(){e.bindBuffer(this.type,this.buffer)},L.prototype.destroy=function(){Y(this)};var k=[];function B(b,w){var V=k.pop();return V||(V=new L(b)),V.bind(),j(V,w,Pu,0,1,!1),V}function H(b){k.push(b)}function X(b,w,V){b.byteLength=w.byteLength,e.bufferData(b.type,w,V)}function j(b,w,V,ae,N,re){var $;if(b.usage=V,Array.isArray(w)){if(b.dtype=ae||Wn,w.length>0){var me;if(Array.isArray(w[0])){$=vi(w);for(var G=1,C=1;C<$.length;++C)G*=$[C];b.dimension=G,me=Xn(w,$,b.dtype),X(b,me,V),re?b.persistentData=me:Ze.freeType(me)}else if(typeof w[0]=="number"){b.dimension=N;var oe=Ze.allocType(b.dtype,w.length);_i(oe,w),X(b,oe,V),re?b.persistentData=oe:Ze.freeType(oe)}else A(w[0])?(b.dimension=w[0].length,b.dtype=ae||nn(w[0])||Wn,me=Xn(w,[w.length,w[0].length],b.dtype),X(b,me,V),re?b.persistentData=me:Ze.freeType(me)):n.raise("invalid buffer data")}}else if(A(w))b.dtype=ae||nn(w),b.dimension=N,X(b,w,V),re&&(b.persistentData=new Uint8Array(new Uint8Array(w.buffer)));else if(Lr(w)){$=w.shape;var K=w.stride,U=w.offset,Q=0,J=0,Ee=0,ye=0;$.length===1?(Q=$[0],J=1,Ee=K[0],ye=0):$.length===2?(Q=$[0],J=$[1],Ee=K[0],ye=K[1]):n.raise("invalid shape"),b.dtype=ae||nn(w.data)||Wn,b.dimension=J;var ee=Ze.allocType(b.dtype,Q*J);pi(ee,w.data,Q,J,Ee,ye,U),X(b,ee,V),re?b.persistentData=ee:Ze.freeType(ee)}else w instanceof ArrayBuffer?(b.dtype=qn,b.dimension=N,X(b,w,V),re&&(b.persistentData=new Uint8Array(new Uint8Array(w)))):n.raise("invalid buffer data")}function Y(b){t.bufferCount--,T(b);var w=b.buffer;n(w,"buffer must not be deleted already"),e.deleteBuffer(w),b.buffer=null,delete x[b.id]}function M(b,w,V,ae){t.bufferCount++;var N=new L(w);x[N.id]=N;function re(G){var C=bi,oe=null,K=0,U=0,Q=1;return Array.isArray(G)||A(G)||Lr(G)||G instanceof ArrayBuffer?oe=G:typeof G=="number"?K=G|0:G&&(n.type(G,"object","buffer arguments must be an object, a number or an array"),"data"in G&&(n(oe===null||Array.isArray(oe)||A(oe)||Lr(oe),"invalid data for buffer"),oe=G.data),"usage"in G&&(n.parameter(G.usage,tn,"invalid buffer usage"),C=tn[G.usage]),"type"in G&&(n.parameter(G.type,Jr,"invalid buffer type"),U=Jr[G.type]),"dimension"in G&&(n.type(G.dimension,"number","invalid dimension"),Q=G.dimension|0),"length"in G&&(n.nni(K,"buffer length must be a nonnegative integer"),K=G.length|0)),N.bind(),oe?j(N,oe,C,U,Q,ae):(K&&e.bufferData(N.type,K,C),N.dtype=U||qn,N.usage=C,N.dimension=Q,N.byteLength=K),l.profile&&(N.stats.size=N.byteLength*Ur[N.dtype]),re}function $(G,C){n(C+G.byteLength<=N.byteLength,"invalid buffer subdata call, buffer is too small.  Can't write data of size "+G.byteLength+" starting from offset "+C+" to a buffer of size "+N.byteLength),e.bufferSubData(N.type,C,G)}function me(G,C){var oe=(C||0)|0,K;if(N.bind(),A(G)||G instanceof ArrayBuffer)$(G,oe);else if(Array.isArray(G)){if(G.length>0)if(typeof G[0]=="number"){var U=Ze.allocType(N.dtype,G.length);_i(U,G),$(U,oe),Ze.freeType(U)}else if(Array.isArray(G[0])||A(G[0])){K=vi(G);var Q=Xn(G,K,N.dtype);$(Q,oe),Ze.freeType(Q)}else n.raise("invalid buffer data")}else if(Lr(G)){K=G.shape;var J=G.stride,Ee=0,ye=0,ee=0,te=0;K.length===1?(Ee=K[0],ye=1,ee=J[0],te=0):K.length===2?(Ee=K[0],ye=K[1],ee=J[0],te=J[1]):n.raise("invalid shape");var be=Array.isArray(G.data)?N.dtype:nn(G.data),ge=Ze.allocType(be,Ee*ye);pi(ge,G.data,Ee,ye,ee,te,G.offset),$(ge,oe),Ze.freeType(ge)}else n.raise("invalid data for buffer subdata");return re}return V||re(b),re._reglType="buffer",re._buffer=N,re.subdata=me,l.profile&&(re.stats=N.stats),re.destroy=function(){Y(N)},re}function z(){gr(x).forEach(function(b){b.buffer=e.createBuffer(),e.bindBuffer(b.type,b.buffer),e.bufferData(b.type,b.persistentData||b.byteLength,b.usage)})}return l.profile&&(t.getTotalBufferSize=function(){var b=0;return Object.keys(x).forEach(function(w){b+=x[w].stats.size}),b}),{create:M,createStream:B,destroyStream:H,clear:function(){gr(x).forEach(Y),k.forEach(Y)},getBuffer:function(b){return b&&b._buffer instanceof L?b._buffer:null},restore:z,_initBuffer:j}}var ku=0,Mu=0,Uu=1,Vu=1,zu=4,Hu=4,Vr={points:ku,point:Mu,lines:Uu,line:Vu,triangles:zu,triangle:Hu,"line loop":2,"line strip":3,"triangle strip":5,"triangle fan":6},ju=0,Xu=1,Ft=4,qu=5120,mt=5121,yi=5122,ht=5123,Ei=5124,$r=5125,Yn=34963,Wu=35040,Yu=35044;function Ku(e,t,l,T){var I={},x=0,L={uint8:mt,uint16:ht};t.oes_element_index_uint&&(L.uint32=$r);function k(z){this.id=x++,I[this.id]=this,this.buffer=z,this.primType=Ft,this.vertCount=0,this.type=0}k.prototype.bind=function(){this.buffer.bind()};var B=[];function H(z){var b=B.pop();return b||(b=new k(l.create(null,Yn,!0,!1)._buffer)),j(b,z,Wu,-1,-1,0,0),b}function X(z){B.push(z)}function j(z,b,w,V,ae,N,re){z.buffer.bind();var $;if(b){var me=re;!re&&(!A(b)||Lr(b)&&!A(b.data))&&(me=t.oes_element_index_uint?$r:ht),l._initBuffer(z.buffer,b,w,me,3)}else e.bufferData(Yn,N,w),z.buffer.dtype=$||mt,z.buffer.usage=w,z.buffer.dimension=3,z.buffer.byteLength=N;if($=re,!re){switch(z.buffer.dtype){case mt:case qu:$=mt;break;case ht:case yi:$=ht;break;case $r:case Ei:$=$r;break;default:n.raise("unsupported type for element array")}z.buffer.dtype=$}z.type=$,n($!==$r||!!t.oes_element_index_uint,"32 bit element buffers not supported, enable oes_element_index_uint first");var G=ae;G<0&&(G=z.buffer.byteLength,$===ht?G>>=1:$===$r&&(G>>=2)),z.vertCount=G;var C=V;if(V<0){C=Ft;var oe=z.buffer.dimension;oe===1&&(C=ju),oe===2&&(C=Xu),oe===3&&(C=Ft)}z.primType=C}function Y(z){T.elementsCount--,n(z.buffer!==null,"must not double destroy elements"),delete I[z.id],z.buffer.destroy(),z.buffer=null}function M(z,b){var w=l.create(null,Yn,!0),V=new k(w._buffer);T.elementsCount++;function ae(N){if(!N)w(),V.primType=Ft,V.vertCount=0,V.type=mt;else if(typeof N=="number")w(N),V.primType=Ft,V.vertCount=N|0,V.type=mt;else{var re=null,$=Yu,me=-1,G=-1,C=0,oe=0;Array.isArray(N)||A(N)||Lr(N)?re=N:(n.type(N,"object","invalid arguments for elements"),"data"in N&&(re=N.data,n(Array.isArray(re)||A(re)||Lr(re),"invalid data for element buffer")),"usage"in N&&(n.parameter(N.usage,tn,"invalid element buffer usage"),$=tn[N.usage]),"primitive"in N&&(n.parameter(N.primitive,Vr,"invalid element buffer primitive"),me=Vr[N.primitive]),"count"in N&&(n(typeof N.count=="number"&&N.count>=0,"invalid vertex count for elements"),G=N.count|0),"type"in N&&(n.parameter(N.type,L,"invalid buffer type"),oe=L[N.type]),"length"in N?C=N.length|0:(C=G,oe===ht||oe===yi?C*=2:(oe===$r||oe===Ei)&&(C*=4))),j(V,re,$,me,G,C,oe)}return ae}return ae(z),ae._reglType="elements",ae._elements=V,ae.subdata=function(N,re){return w.subdata(N,re),ae},ae.destroy=function(){Y(V)},ae}return{create:M,createStream:H,destroyStream:X,getElements:function(z){return typeof z=="function"&&z._elements instanceof k?z._elements:null},clear:function(){gr(I).forEach(Y)}}}var gi=new Float32Array(1),Qu=new Uint32Array(gi.buffer),Zu=5123;function Ai(e){for(var t=Ze.allocType(Zu,e.length),l=0;l<e.length;++l)if(isNaN(e[l]))t[l]=65535;else if(e[l]===1/0)t[l]=31744;else if(e[l]===-1/0)t[l]=64512;else{gi[0]=e[l];var T=Qu[0],I=T>>>31<<15,x=(T<<1>>>24)-127,L=T>>13&1024-1;if(x<-24)t[l]=I;else if(x<-14){var k=-14-x;t[l]=I+(L+1024>>k)}else x>15?t[l]=I+31744:t[l]=I+(x+15<<10)+L}return t}function Ue(e){return Array.isArray(e)||A(e)}var xi=function(e){return!(e&e-1)&&!!e},Ju=34467,Cr=3553,Kn=34067,an=34069,et=6408,Qn=6406,fn=6407,Dt=6409,on=6410,Ti=32854,Zn=32855,Si=36194,$u=32819,es=32820,rs=33635,ts=34042,Jn=6402,un=34041,$n=35904,ea=35906,vt=36193,ra=33776,ta=33777,na=33778,aa=33779,wi=35986,Li=35987,Oi=34798,Ri=35840,Ci=35841,Ii=35842,Gi=35843,Fi=36196,bt=5121,ia=5123,fa=5125,Nt=5126,ns=10242,as=10243,is=10497,oa=33071,fs=33648,os=10240,us=10241,ua=9728,ss=9729,sa=9984,Di=9985,Ni=9986,la=9987,ls=33170,sn=4352,cs=4353,ds=4354,ms=34046,hs=3317,vs=37440,bs=37441,_s=37443,Pi=37444,Pt=33984,ps=[sa,Ni,Di,la],ln=[0,Dt,on,fn,et],Tr={};Tr[Dt]=Tr[Qn]=Tr[Jn]=1,Tr[un]=Tr[on]=2,Tr[fn]=Tr[$n]=3,Tr[et]=Tr[ea]=4;function _t(e){return"[object "+e+"]"}var Bi=_t("HTMLCanvasElement"),ki=_t("OffscreenCanvas"),Mi=_t("CanvasRenderingContext2D"),Ui=_t("ImageBitmap"),Vi=_t("HTMLImageElement"),zi=_t("HTMLVideoElement"),ys=Object.keys(jn).concat([Bi,ki,Mi,Ui,Vi,zi]),pt=[];pt[bt]=1,pt[Nt]=4,pt[vt]=2,pt[ia]=2,pt[fa]=4;var cr=[];cr[Ti]=2,cr[Zn]=2,cr[Si]=2,cr[un]=4,cr[ra]=.5,cr[ta]=.5,cr[na]=1,cr[aa]=1,cr[wi]=.5,cr[Li]=1,cr[Oi]=1,cr[Ri]=.5,cr[Ci]=.25,cr[Ii]=.5,cr[Gi]=.25,cr[Fi]=.5;function Hi(e){return Array.isArray(e)&&(e.length===0||typeof e[0]=="number")}function ji(e){if(!Array.isArray(e))return!1;var t=e.length;return!(t===0||!Ue(e[0]))}function rt(e){return Object.prototype.toString.call(e)}function Xi(e){return rt(e)===Bi}function qi(e){return rt(e)===ki}function Es(e){return rt(e)===Mi}function gs(e){return rt(e)===Ui}function As(e){return rt(e)===Vi}function xs(e){return rt(e)===zi}function ca(e){if(!e)return!1;var t=rt(e);return ys.indexOf(t)>=0?!0:Hi(e)||ji(e)||Lr(e)}function Wi(e){return jn[Object.prototype.toString.call(e)]|0}function Ts(e,t){var l=t.length;switch(e.type){case bt:case ia:case fa:case Nt:var T=Ze.allocType(e.type,l);T.set(t),e.data=T;break;case vt:e.data=Ai(t);break;default:n.raise("unsupported texture type, must specify a typed array")}}function Yi(e,t){return Ze.allocType(e.type===vt?Nt:e.type,t)}function Ki(e,t){e.type===vt?(e.data=Ai(t),Ze.freeType(t)):e.data=t}function Ss(e,t,l,T,I,x){for(var L=e.width,k=e.height,B=e.channels,H=L*k*B,X=Yi(e,H),j=0,Y=0;Y<k;++Y)for(var M=0;M<L;++M)for(var z=0;z<B;++z)X[j++]=t[l*M+T*Y+I*z+x];Ki(e,X)}function cn(e,t,l,T,I,x){var L;if(typeof cr[e]<"u"?L=cr[e]:L=Tr[e]*pt[t],x&&(L*=6),I){for(var k=0,B=l;B>=1;)k+=L*B*B,B/=2;return k}else return L*l*T}function ws(e,t,l,T,I,x,L){var k={"don't care":sn,"dont care":sn,nice:ds,fast:cs},B={repeat:is,clamp:oa,mirror:fs},H={nearest:ua,linear:ss},X=P({mipmap:la,"nearest mipmap nearest":sa,"linear mipmap nearest":Di,"nearest mipmap linear":Ni,"linear mipmap linear":la},H),j={none:0,browser:Pi},Y={uint8:bt,rgba4:$u,rgb565:rs,"rgb5 a1":es},M={alpha:Qn,luminance:Dt,"luminance alpha":on,rgb:fn,rgba:et,rgba4:Ti,"rgb5 a1":Zn,rgb565:Si},z={};t.ext_srgb&&(M.srgb=$n,M.srgba=ea),t.oes_texture_float&&(Y.float32=Y.float=Nt),t.oes_texture_half_float&&(Y.float16=Y["half float"]=vt),t.webgl_depth_texture&&(P(M,{depth:Jn,"depth stencil":un}),P(Y,{uint16:ia,uint32:fa,"depth stencil":ts})),t.webgl_compressed_texture_s3tc&&P(z,{"rgb s3tc dxt1":ra,"rgba s3tc dxt1":ta,"rgba s3tc dxt3":na,"rgba s3tc dxt5":aa}),t.webgl_compressed_texture_atc&&P(z,{"rgb atc":wi,"rgba atc explicit alpha":Li,"rgba atc interpolated alpha":Oi}),t.webgl_compressed_texture_pvrtc&&P(z,{"rgb pvrtc 4bppv1":Ri,"rgb pvrtc 2bppv1":Ci,"rgba pvrtc 4bppv1":Ii,"rgba pvrtc 2bppv1":Gi}),t.webgl_compressed_texture_etc1&&(z["rgb etc1"]=Fi);var b=Array.prototype.slice.call(e.getParameter(Ju));Object.keys(z).forEach(function(o){var S=z[o];b.indexOf(S)>=0&&(M[o]=S)});var w=Object.keys(M);l.textureFormats=w;var V=[];Object.keys(M).forEach(function(o){var S=M[o];V[S]=o});var ae=[];Object.keys(Y).forEach(function(o){var S=Y[o];ae[S]=o});var N=[];Object.keys(H).forEach(function(o){var S=H[o];N[S]=o});var re=[];Object.keys(X).forEach(function(o){var S=X[o];re[S]=o});var $=[];Object.keys(B).forEach(function(o){var S=B[o];$[S]=o});var me=w.reduce(function(o,S){var g=M[S];return g===Dt||g===Qn||g===Dt||g===on||g===Jn||g===un||t.ext_srgb&&(g===$n||g===ea)?o[g]=g:g===Zn||S.indexOf("rgba")>=0?o[g]=et:o[g]=fn,o},{});function G(){this.internalformat=et,this.format=et,this.type=bt,this.compressed=!1,this.premultiplyAlpha=!1,this.flipY=!1,this.unpackAlignment=1,this.colorSpace=Pi,this.width=0,this.height=0,this.channels=0}function C(o,S){o.internalformat=S.internalformat,o.format=S.format,o.type=S.type,o.compressed=S.compressed,o.premultiplyAlpha=S.premultiplyAlpha,o.flipY=S.flipY,o.unpackAlignment=S.unpackAlignment,o.colorSpace=S.colorSpace,o.width=S.width,o.height=S.height,o.channels=S.channels}function oe(o,S){if(!(typeof S!="object"||!S)){if("premultiplyAlpha"in S&&(n.type(S.premultiplyAlpha,"boolean","invalid premultiplyAlpha"),o.premultiplyAlpha=S.premultiplyAlpha),"flipY"in S&&(n.type(S.flipY,"boolean","invalid texture flip"),o.flipY=S.flipY),"alignment"in S&&(n.oneOf(S.alignment,[1,2,4,8],"invalid texture unpack alignment"),o.unpackAlignment=S.alignment),"colorSpace"in S&&(n.parameter(S.colorSpace,j,"invalid colorSpace"),o.colorSpace=j[S.colorSpace]),"type"in S){var g=S.type;n(t.oes_texture_float||!(g==="float"||g==="float32"),"you must enable the OES_texture_float extension in order to use floating point textures."),n(t.oes_texture_half_float||!(g==="half float"||g==="float16"),"you must enable the OES_texture_half_float extension in order to use 16-bit floating point textures."),n(t.webgl_depth_texture||!(g==="uint16"||g==="uint32"||g==="depth stencil"),"you must enable the WEBGL_depth_texture extension in order to use depth/stencil textures."),n.parameter(g,Y,"invalid texture type"),o.type=Y[g]}var fe=o.width,Le=o.height,a=o.channels,r=!1;"shape"in S?(n(Array.isArray(S.shape)&&S.shape.length>=2,"shape must be an array"),fe=S.shape[0],Le=S.shape[1],S.shape.length===3&&(a=S.shape[2],n(a>0&&a<=4,"invalid number of channels"),r=!0),n(fe>=0&&fe<=l.maxTextureSize,"invalid width"),n(Le>=0&&Le<=l.maxTextureSize,"invalid height")):("radius"in S&&(fe=Le=S.radius,n(fe>=0&&fe<=l.maxTextureSize,"invalid radius")),"width"in S&&(fe=S.width,n(fe>=0&&fe<=l.maxTextureSize,"invalid width")),"height"in S&&(Le=S.height,n(Le>=0&&Le<=l.maxTextureSize,"invalid height")),"channels"in S&&(a=S.channels,n(a>0&&a<=4,"invalid number of channels"),r=!0)),o.width=fe|0,o.height=Le|0,o.channels=a|0;var c=!1;if("format"in S){var v=S.format;n(t.webgl_depth_texture||!(v==="depth"||v==="depth stencil"),"you must enable the WEBGL_depth_texture extension in order to use depth/stencil textures."),n.parameter(v,M,"invalid texture format");var _=o.internalformat=M[v];o.format=me[_],v in Y&&("type"in S||(o.type=Y[v])),v in z&&(o.compressed=!0),c=!0}!r&&c?o.channels=Tr[o.format]:r&&!c?o.channels!==ln[o.format]&&(o.format=o.internalformat=ln[o.channels]):c&&r&&n(o.channels===Tr[o.format],"number of channels inconsistent with specified format")}}function K(o){e.pixelStorei(vs,o.flipY),e.pixelStorei(bs,o.premultiplyAlpha),e.pixelStorei(_s,o.colorSpace),e.pixelStorei(hs,o.unpackAlignment)}function U(){G.call(this),this.xOffset=0,this.yOffset=0,this.data=null,this.needsFree=!1,this.element=null,this.needsCopy=!1}function Q(o,S){var g=null;if(ca(S)?g=S:S&&(n.type(S,"object","invalid pixel data type"),oe(o,S),"x"in S&&(o.xOffset=S.x|0),"y"in S&&(o.yOffset=S.y|0),ca(S.data)&&(g=S.data)),n(!o.compressed||g instanceof Uint8Array,"compressed texture data must be stored in a uint8array"),S.copy){n(!g,"can not specify copy and data field for the same texture");var fe=I.viewportWidth,Le=I.viewportHeight;o.width=o.width||fe-o.xOffset,o.height=o.height||Le-o.yOffset,o.needsCopy=!0,n(o.xOffset>=0&&o.xOffset<fe&&o.yOffset>=0&&o.yOffset<Le&&o.width>0&&o.width<=fe&&o.height>0&&o.height<=Le,"copy texture read out of bounds")}else if(!g)o.width=o.width||1,o.height=o.height||1,o.channels=o.channels||4;else if(A(g))o.channels=o.channels||4,o.data=g,!("type"in S)&&o.type===bt&&(o.type=Wi(g));else if(Hi(g))o.channels=o.channels||4,Ts(o,g),o.alignment=1,o.needsFree=!0;else if(Lr(g)){var a=g.data;!Array.isArray(a)&&o.type===bt&&(o.type=Wi(a));var r=g.shape,c=g.stride,v,_,m,d,h,i;r.length===3?(m=r[2],i=c[2]):(n(r.length===2,"invalid ndarray pixel data, must be 2 or 3D"),m=1,i=1),v=r[0],_=r[1],d=c[0],h=c[1],o.alignment=1,o.width=v,o.height=_,o.channels=m,o.format=o.internalformat=ln[m],o.needsFree=!0,Ss(o,a,d,h,i,g.offset)}else if(Xi(g)||qi(g)||Es(g))Xi(g)||qi(g)?o.element=g:o.element=g.canvas,o.width=o.element.width,o.height=o.element.height,o.channels=4;else if(gs(g))o.element=g,o.width=g.width,o.height=g.height,o.channels=4;else if(As(g))o.element=g,o.width=g.naturalWidth,o.height=g.naturalHeight,o.channels=4;else if(xs(g))o.element=g,o.width=g.videoWidth,o.height=g.videoHeight,o.channels=4;else if(ji(g)){var u=o.width||g[0].length,f=o.height||g.length,y=o.channels;Ue(g[0][0])?y=y||g[0][0].length:y=y||1;for(var p=rn.shape(g),R=1,F=0;F<p.length;++F)R*=p[F];var q=Yi(o,R);rn.flatten(g,p,"",q),Ki(o,q),o.alignment=1,o.width=u,o.height=f,o.channels=y,o.format=o.internalformat=ln[y],o.needsFree=!0}o.type===Nt?n(l.extensions.indexOf("oes_texture_float")>=0,"oes_texture_float extension not enabled"):o.type===vt&&n(l.extensions.indexOf("oes_texture_half_float")>=0,"oes_texture_half_float extension not enabled")}function J(o,S,g){var fe=o.element,Le=o.data,a=o.internalformat,r=o.format,c=o.type,v=o.width,_=o.height;K(o),fe?e.texImage2D(S,g,r,r,c,fe):o.compressed?e.compressedTexImage2D(S,g,a,v,_,0,Le):o.needsCopy?(T(),e.copyTexImage2D(S,g,r,o.xOffset,o.yOffset,v,_,0)):e.texImage2D(S,g,r,v,_,0,r,c,Le||null)}function Ee(o,S,g,fe,Le){var a=o.element,r=o.data,c=o.internalformat,v=o.format,_=o.type,m=o.width,d=o.height;K(o),a?e.texSubImage2D(S,Le,g,fe,v,_,a):o.compressed?e.compressedTexSubImage2D(S,Le,g,fe,c,m,d,r):o.needsCopy?(T(),e.copyTexSubImage2D(S,Le,g,fe,o.xOffset,o.yOffset,m,d)):e.texSubImage2D(S,Le,g,fe,m,d,v,_,r)}var ye=[];function ee(){return ye.pop()||new U}function te(o){o.needsFree&&Ze.freeType(o.data),U.call(o),ye.push(o)}function be(){G.call(this),this.genMipmaps=!1,this.mipmapHint=sn,this.mipmask=0,this.images=Array(16)}function ge(o,S,g){var fe=o.images[0]=ee();o.mipmask=1,fe.width=o.width=S,fe.height=o.height=g,fe.channels=o.channels=4}function Oe(o,S){var g=null;if(ca(S))g=o.images[0]=ee(),C(g,o),Q(g,S),o.mipmask=1;else if(oe(o,S),Array.isArray(S.mipmap))for(var fe=S.mipmap,Le=0;Le<fe.length;++Le)g=o.images[Le]=ee(),C(g,o),g.width>>=Le,g.height>>=Le,Q(g,fe[Le]),o.mipmask|=1<<Le;else g=o.images[0]=ee(),C(g,o),Q(g,S),o.mipmask=1;C(o,o.images[0]),o.compressed&&(o.internalformat===ra||o.internalformat===ta||o.internalformat===na||o.internalformat===aa)&&n(o.width%4===0&&o.height%4===0,"for compressed texture formats, mipmap level 0 must have width and height that are a multiple of 4")}function Ve(o,S){for(var g=o.images,fe=0;fe<g.length;++fe){if(!g[fe])return;J(g[fe],S,fe)}}var ze=[];function Ce(){var o=ze.pop()||new be;G.call(o),o.mipmask=0;for(var S=0;S<16;++S)o.images[S]=null;return o}function tr(o){for(var S=o.images,g=0;g<S.length;++g)S[g]&&te(S[g]),S[g]=null;ze.push(o)}function ke(){this.minFilter=ua,this.magFilter=ua,this.wrapS=oa,this.wrapT=oa,this.anisotropic=1,this.genMipmaps=!1,this.mipmapHint=sn}function $e(o,S){if("min"in S){var g=S.min;n.parameter(g,X),o.minFilter=X[g],ps.indexOf(o.minFilter)>=0&&!("faces"in S)&&(o.genMipmaps=!0)}if("mag"in S){var fe=S.mag;n.parameter(fe,H),o.magFilter=H[fe]}var Le=o.wrapS,a=o.wrapT;if("wrap"in S){var r=S.wrap;typeof r=="string"?(n.parameter(r,B),Le=a=B[r]):Array.isArray(r)&&(n.parameter(r[0],B),n.parameter(r[1],B),Le=B[r[0]],a=B[r[1]])}else{if("wrapS"in S){var c=S.wrapS;n.parameter(c,B),Le=B[c]}if("wrapT"in S){var v=S.wrapT;n.parameter(v,B),a=B[v]}}if(o.wrapS=Le,o.wrapT=a,"anisotropic"in S){var _=S.anisotropic;n(typeof _=="number"&&_>=1&&_<=l.maxAnisotropic,"aniso samples must be between 1 and "),o.anisotropic=S.anisotropic}if("mipmap"in S){var m=!1;switch(typeof S.mipmap){case"string":n.parameter(S.mipmap,k,"invalid mipmap hint"),o.mipmapHint=k[S.mipmap],o.genMipmaps=!0,m=!0;break;case"boolean":m=o.genMipmaps=S.mipmap;break;case"object":n(Array.isArray(S.mipmap),"invalid mipmap type"),o.genMipmaps=!1,m=!0;break;default:n.raise("invalid mipmap type")}m&&!("min"in S)&&(o.minFilter=sa)}}function nr(o,S){e.texParameteri(S,us,o.minFilter),e.texParameteri(S,os,o.magFilter),e.texParameteri(S,ns,o.wrapS),e.texParameteri(S,as,o.wrapT),t.ext_texture_filter_anisotropic&&e.texParameteri(S,ms,o.anisotropic),o.genMipmaps&&(e.hint(ls,o.mipmapHint),e.generateMipmap(S))}var ar=0,sr={},dr=l.maxTextureUnits,Ye=Array(dr).map(function(){return null});function Te(o){G.call(this),this.mipmask=0,this.internalformat=et,this.id=ar++,this.refCount=1,this.target=o,this.texture=e.createTexture(),this.unit=-1,this.bindCount=0,this.texInfo=new ke,L.profile&&(this.stats={size:0})}function mr(o){e.activeTexture(Pt),e.bindTexture(o.target,o.texture)}function Fe(){var o=Ye[0];o?e.bindTexture(o.target,o.texture):e.bindTexture(Cr,null)}function ve(o){var S=o.texture;n(S,"must not double destroy texture");var g=o.unit,fe=o.target;g>=0&&(e.activeTexture(Pt+g),e.bindTexture(fe,null),Ye[g]=null),e.deleteTexture(S),o.texture=null,o.params=null,o.pixels=null,o.refCount=0,delete sr[o.id],x.textureCount--}P(Te.prototype,{bind:function(){var o=this;o.bindCount+=1;var S=o.unit;if(S<0){for(var g=0;g<dr;++g){var fe=Ye[g];if(fe){if(fe.bindCount>0)continue;fe.unit=-1}Ye[g]=o,S=g;break}S>=dr&&n.raise("insufficient number of texture units"),L.profile&&x.maxTextureUnits<S+1&&(x.maxTextureUnits=S+1),o.unit=S,e.activeTexture(Pt+S),e.bindTexture(o.target,o.texture)}return S},unbind:function(){this.bindCount-=1},decRef:function(){--this.refCount<=0&&ve(this)}});function Re(o,S){var g=new Te(Cr);sr[g.id]=g,x.textureCount++;function fe(r,c){var v=g.texInfo;ke.call(v);var _=Ce();return typeof r=="number"?typeof c=="number"?ge(_,r|0,c|0):ge(_,r|0,r|0):r?(n.type(r,"object","invalid arguments to regl.texture"),$e(v,r),Oe(_,r)):ge(_,1,1),v.genMipmaps&&(_.mipmask=(_.width<<1)-1),g.mipmask=_.mipmask,C(g,_),n.texture2D(v,_,l),g.internalformat=_.internalformat,fe.width=_.width,fe.height=_.height,mr(g),Ve(_,Cr),nr(v,Cr),Fe(),tr(_),L.profile&&(g.stats.size=cn(g.internalformat,g.type,_.width,_.height,v.genMipmaps,!1)),fe.format=V[g.internalformat],fe.type=ae[g.type],fe.mag=N[v.magFilter],fe.min=re[v.minFilter],fe.wrapS=$[v.wrapS],fe.wrapT=$[v.wrapT],fe}function Le(r,c,v,_){n(!!r,"must specify image data");var m=c|0,d=v|0,h=_|0,i=ee();return C(i,g),i.width=0,i.height=0,Q(i,r),i.width=i.width||(g.width>>h)-m,i.height=i.height||(g.height>>h)-d,n(g.type===i.type&&g.format===i.format&&g.internalformat===i.internalformat,"incompatible format for texture.subimage"),n(m>=0&&d>=0&&m+i.width<=g.width&&d+i.height<=g.height,"texture.subimage write out of bounds"),n(g.mipmask&1<<h,"missing mipmap data"),n(i.data||i.element||i.needsCopy,"missing image data"),mr(g),Ee(i,Cr,m,d,h),Fe(),te(i),fe}function a(r,c){var v=r|0,_=c|0||v;if(v===g.width&&_===g.height)return fe;fe.width=g.width=v,fe.height=g.height=_,mr(g);for(var m=0;g.mipmask>>m;++m){var d=v>>m,h=_>>m;if(!d||!h)break;e.texImage2D(Cr,m,g.format,d,h,0,g.format,g.type,null)}return Fe(),L.profile&&(g.stats.size=cn(g.internalformat,g.type,v,_,!1,!1)),fe}return fe(o,S),fe.subimage=Le,fe.resize=a,fe._reglType="texture2d",fe._texture=g,L.profile&&(fe.stats=g.stats),fe.destroy=function(){g.decRef()},fe}function Ie(o,S,g,fe,Le,a){var r=new Te(Kn);sr[r.id]=r,x.cubeCount++;var c=new Array(6);function v(d,h,i,u,f,y){var p,R=r.texInfo;for(ke.call(R),p=0;p<6;++p)c[p]=Ce();if(typeof d=="number"||!d){var F=d|0||1;for(p=0;p<6;++p)ge(c[p],F,F)}else if(typeof d=="object")if(h)Oe(c[0],d),Oe(c[1],h),Oe(c[2],i),Oe(c[3],u),Oe(c[4],f),Oe(c[5],y);else if($e(R,d),oe(r,d),"faces"in d){var q=d.faces;for(n(Array.isArray(q)&&q.length===6,"cube faces must be a length 6 array"),p=0;p<6;++p)n(typeof q[p]=="object"&&!!q[p],"invalid input for cube map face"),C(c[p],r),Oe(c[p],q[p])}else for(p=0;p<6;++p)Oe(c[p],d);else n.raise("invalid arguments to cube map");for(C(r,c[0]),n.optional(function(){l.npotTextureCube||n(xi(r.width)&&xi(r.height),"your browser does not support non power or two texture dimensions")}),R.genMipmaps?r.mipmask=(c[0].width<<1)-1:r.mipmask=c[0].mipmask,n.textureCube(r,R,c,l),r.internalformat=c[0].internalformat,v.width=c[0].width,v.height=c[0].height,mr(r),p=0;p<6;++p)Ve(c[p],an+p);for(nr(R,Kn),Fe(),L.profile&&(r.stats.size=cn(r.internalformat,r.type,v.width,v.height,R.genMipmaps,!0)),v.format=V[r.internalformat],v.type=ae[r.type],v.mag=N[R.magFilter],v.min=re[R.minFilter],v.wrapS=$[R.wrapS],v.wrapT=$[R.wrapT],p=0;p<6;++p)tr(c[p]);return v}function _(d,h,i,u,f){n(!!h,"must specify image data"),n(typeof d=="number"&&d===(d|0)&&d>=0&&d<6,"invalid face");var y=i|0,p=u|0,R=f|0,F=ee();return C(F,r),F.width=0,F.height=0,Q(F,h),F.width=F.width||(r.width>>R)-y,F.height=F.height||(r.height>>R)-p,n(r.type===F.type&&r.format===F.format&&r.internalformat===F.internalformat,"incompatible format for texture.subimage"),n(y>=0&&p>=0&&y+F.width<=r.width&&p+F.height<=r.height,"texture.subimage write out of bounds"),n(r.mipmask&1<<R,"missing mipmap data"),n(F.data||F.element||F.needsCopy,"missing image data"),mr(r),Ee(F,an+d,y,p,R),Fe(),te(F),v}function m(d){var h=d|0;if(h!==r.width){v.width=r.width=h,v.height=r.height=h,mr(r);for(var i=0;i<6;++i)for(var u=0;r.mipmask>>u;++u)e.texImage2D(an+i,u,r.format,h>>u,h>>u,0,r.format,r.type,null);return Fe(),L.profile&&(r.stats.size=cn(r.internalformat,r.type,v.width,v.height,!1,!0)),v}}return v(o,S,g,fe,Le,a),v.subimage=_,v.resize=m,v._reglType="textureCube",v._texture=r,L.profile&&(v.stats=r.stats),v.destroy=function(){r.decRef()},v}function Ke(){for(var o=0;o<dr;++o)e.activeTexture(Pt+o),e.bindTexture(Cr,null),Ye[o]=null;gr(sr).forEach(ve),x.cubeCount=0,x.textureCount=0}L.profile&&(x.getTotalTextureSize=function(){var o=0;return Object.keys(sr).forEach(function(S){o+=sr[S].stats.size}),o});function Gr(){for(var o=0;o<dr;++o){var S=Ye[o];S&&(S.bindCount=0,S.unit=-1,Ye[o]=null)}gr(sr).forEach(function(g){g.texture=e.createTexture(),e.bindTexture(g.target,g.texture);for(var fe=0;fe<32;++fe)if(g.mipmask&1<<fe)if(g.target===Cr)e.texImage2D(Cr,fe,g.internalformat,g.width>>fe,g.height>>fe,0,g.internalformat,g.type,null);else for(var Le=0;Le<6;++Le)e.texImage2D(an+Le,fe,g.internalformat,g.width>>fe,g.height>>fe,0,g.internalformat,g.type,null);nr(g.texInfo,g.target)})}function ut(){for(var o=0;o<dr;++o){var S=Ye[o];S&&(S.bindCount=0,S.unit=-1,Ye[o]=null),e.activeTexture(Pt+o),e.bindTexture(Cr,null),e.bindTexture(Kn,null)}}return{create2D:Re,createCube:Ie,clear:Ke,getTexture:function(o){return null},restore:Gr,refresh:ut}}var zr=36161,dn=32854,Qi=32855,Zi=36194,Ji=33189,$i=36168,ef=34041,rf=35907,tf=34836,nf=34842,af=34843,Or=[];Or[dn]=2,Or[Qi]=2,Or[Zi]=2,Or[Ji]=2,Or[$i]=1,Or[ef]=4,Or[rf]=4,Or[tf]=16,Or[nf]=8,Or[af]=6;function ff(e,t,l){return Or[e]*t*l}var Ls=function(e,t,l,T,I){var x={rgba4:dn,rgb565:Zi,"rgb5 a1":Qi,depth:Ji,stencil:$i,"depth stencil":ef};t.ext_srgb&&(x.srgba=rf),t.ext_color_buffer_half_float&&(x.rgba16f=nf,x.rgb16f=af),t.webgl_color_buffer_float&&(x.rgba32f=tf);var L=[];Object.keys(x).forEach(function(M){var z=x[M];L[z]=M});var k=0,B={};function H(M){this.id=k++,this.refCount=1,this.renderbuffer=M,this.format=dn,this.width=0,this.height=0,I.profile&&(this.stats={size:0})}H.prototype.decRef=function(){--this.refCount<=0&&X(this)};function X(M){var z=M.renderbuffer;n(z,"must not double destroy renderbuffer"),e.bindRenderbuffer(zr,null),e.deleteRenderbuffer(z),M.renderbuffer=null,M.refCount=0,delete B[M.id],T.renderbufferCount--}function j(M,z){var b=new H(e.createRenderbuffer());B[b.id]=b,T.renderbufferCount++;function w(ae,N){var re=0,$=0,me=dn;if(typeof ae=="object"&&ae){var G=ae;if("shape"in G){var C=G.shape;n(Array.isArray(C)&&C.length>=2,"invalid renderbuffer shape"),re=C[0]|0,$=C[1]|0}else"radius"in G&&(re=$=G.radius|0),"width"in G&&(re=G.width|0),"height"in G&&($=G.height|0);"format"in G&&(n.parameter(G.format,x,"invalid renderbuffer format"),me=x[G.format])}else typeof ae=="number"?(re=ae|0,typeof N=="number"?$=N|0:$=re):ae?n.raise("invalid arguments to renderbuffer constructor"):re=$=1;if(n(re>0&&$>0&&re<=l.maxRenderbufferSize&&$<=l.maxRenderbufferSize,"invalid renderbuffer size"),!(re===b.width&&$===b.height&&me===b.format))return w.width=b.width=re,w.height=b.height=$,b.format=me,e.bindRenderbuffer(zr,b.renderbuffer),e.renderbufferStorage(zr,me,re,$),n(e.getError()===0,"invalid render buffer format"),I.profile&&(b.stats.size=ff(b.format,b.width,b.height)),w.format=L[b.format],w}function V(ae,N){var re=ae|0,$=N|0||re;return re===b.width&&$===b.height||(n(re>0&&$>0&&re<=l.maxRenderbufferSize&&$<=l.maxRenderbufferSize,"invalid renderbuffer size"),w.width=b.width=re,w.height=b.height=$,e.bindRenderbuffer(zr,b.renderbuffer),e.renderbufferStorage(zr,b.format,re,$),n(e.getError()===0,"invalid render buffer format"),I.profile&&(b.stats.size=ff(b.format,b.width,b.height))),w}return w(M,z),w.resize=V,w._reglType="renderbuffer",w._renderbuffer=b,I.profile&&(w.stats=b.stats),w.destroy=function(){b.decRef()},w}I.profile&&(T.getTotalRenderbufferSize=function(){var M=0;return Object.keys(B).forEach(function(z){M+=B[z].stats.size}),M});function Y(){gr(B).forEach(function(M){M.renderbuffer=e.createRenderbuffer(),e.bindRenderbuffer(zr,M.renderbuffer),e.renderbufferStorage(zr,M.format,M.width,M.height)}),e.bindRenderbuffer(zr,null)}return{create:j,clear:function(){gr(B).forEach(X)},restore:Y}},Pr=36160,da=36161,tt=3553,mn=34069,of=36064,uf=36096,sf=36128,lf=33306,cf=36053,Os=36054,Rs=36055,Cs=36057,Is=36061,Gs=36193,Fs=5121,Ds=5126,df=6407,mf=6408,Ns=6402,Ps=[df,mf],ma=[];ma[mf]=4,ma[df]=3;var hn=[];hn[Fs]=1,hn[Ds]=4,hn[Gs]=2;var Bs=32854,ks=32855,Ms=36194,Us=33189,Vs=36168,hf=34041,zs=35907,Hs=34836,js=34842,Xs=34843,qs=[Bs,ks,Ms,zs,js,Xs,Hs],yt={};yt[cf]="complete",yt[Os]="incomplete attachment",yt[Cs]="incomplete dimensions",yt[Rs]="incomplete, missing attachment",yt[Is]="unsupported";function Ws(e,t,l,T,I,x){var L={cur:null,next:null,dirty:!1,setFBO:null},k=["rgba"],B=["rgba4","rgb565","rgb5 a1"];t.ext_srgb&&B.push("srgba"),t.ext_color_buffer_half_float&&B.push("rgba16f","rgb16f"),t.webgl_color_buffer_float&&B.push("rgba32f");var H=["uint8"];t.oes_texture_half_float&&H.push("half float","float16"),t.oes_texture_float&&H.push("float","float32");function X(U,Q,J){this.target=U,this.texture=Q,this.renderbuffer=J;var Ee=0,ye=0;Q?(Ee=Q.width,ye=Q.height):J&&(Ee=J.width,ye=J.height),this.width=Ee,this.height=ye}function j(U){U&&(U.texture&&U.texture._texture.decRef(),U.renderbuffer&&U.renderbuffer._renderbuffer.decRef())}function Y(U,Q,J){if(U)if(U.texture){var Ee=U.texture._texture,ye=Math.max(1,Ee.width),ee=Math.max(1,Ee.height);n(ye===Q&&ee===J,"inconsistent width/height for supplied texture"),Ee.refCount+=1}else{var te=U.renderbuffer._renderbuffer;n(te.width===Q&&te.height===J,"inconsistent width/height for renderbuffer"),te.refCount+=1}}function M(U,Q){Q&&(Q.texture?e.framebufferTexture2D(Pr,U,Q.target,Q.texture._texture.texture,0):e.framebufferRenderbuffer(Pr,U,da,Q.renderbuffer._renderbuffer.renderbuffer))}function z(U){var Q=tt,J=null,Ee=null,ye=U;typeof U=="object"&&(ye=U.data,"target"in U&&(Q=U.target|0)),n.type(ye,"function","invalid attachment data");var ee=ye._reglType;return ee==="texture2d"?(J=ye,n(Q===tt)):ee==="textureCube"?(J=ye,n(Q>=mn&&Q<mn+6,"invalid cube map target")):ee==="renderbuffer"?(Ee=ye,Q=da):n.raise("invalid regl object for attachment"),new X(Q,J,Ee)}function b(U,Q,J,Ee,ye){if(J){var ee=T.create2D({width:U,height:Q,format:Ee,type:ye});return ee._texture.refCount=0,new X(tt,ee,null)}else{var te=I.create({width:U,height:Q,format:Ee});return te._renderbuffer.refCount=0,new X(da,null,te)}}function w(U){return U&&(U.texture||U.renderbuffer)}function V(U,Q,J){U&&(U.texture?U.texture.resize(Q,J):U.renderbuffer&&U.renderbuffer.resize(Q,J),U.width=Q,U.height=J)}var ae=0,N={};function re(){this.id=ae++,N[this.id]=this,this.framebuffer=e.createFramebuffer(),this.width=0,this.height=0,this.colorAttachments=[],this.depthAttachment=null,this.stencilAttachment=null,this.depthStencilAttachment=null}function $(U){U.colorAttachments.forEach(j),j(U.depthAttachment),j(U.stencilAttachment),j(U.depthStencilAttachment)}function me(U){var Q=U.framebuffer;n(Q,"must not double destroy framebuffer"),e.deleteFramebuffer(Q),U.framebuffer=null,x.framebufferCount--,delete N[U.id]}function G(U){var Q;e.bindFramebuffer(Pr,U.framebuffer);var J=U.colorAttachments;for(Q=0;Q<J.length;++Q)M(of+Q,J[Q]);for(Q=J.length;Q<l.maxColorAttachments;++Q)e.framebufferTexture2D(Pr,of+Q,tt,null,0);e.framebufferTexture2D(Pr,lf,tt,null,0),e.framebufferTexture2D(Pr,uf,tt,null,0),e.framebufferTexture2D(Pr,sf,tt,null,0),M(uf,U.depthAttachment),M(sf,U.stencilAttachment),M(lf,U.depthStencilAttachment);var Ee=e.checkFramebufferStatus(Pr);!e.isContextLost()&&Ee!==cf&&n.raise("framebuffer configuration not supported, status = "+yt[Ee]),e.bindFramebuffer(Pr,L.next?L.next.framebuffer:null),L.cur=L.next,e.getError()}function C(U,Q){var J=new re;x.framebufferCount++;function Ee(ee,te){var be;n(L.next!==J,"can not update framebuffer which is currently in use");var ge=0,Oe=0,Ve=!0,ze=!0,Ce=null,tr=!0,ke="rgba",$e="uint8",nr=1,ar=null,sr=null,dr=null,Ye=!1;if(typeof ee=="number")ge=ee|0,Oe=te|0||ge;else if(!ee)ge=Oe=1;else{n.type(ee,"object","invalid arguments for framebuffer");var Te=ee;if("shape"in Te){var mr=Te.shape;n(Array.isArray(mr)&&mr.length>=2,"invalid shape for framebuffer"),ge=mr[0],Oe=mr[1]}else"radius"in Te&&(ge=Oe=Te.radius),"width"in Te&&(ge=Te.width),"height"in Te&&(Oe=Te.height);("color"in Te||"colors"in Te)&&(Ce=Te.color||Te.colors,Array.isArray(Ce)&&n(Ce.length===1||t.webgl_draw_buffers,"multiple render targets not supported")),Ce||("colorCount"in Te&&(nr=Te.colorCount|0,n(nr>0,"invalid color buffer count")),"colorTexture"in Te&&(tr=!!Te.colorTexture,ke="rgba4"),"colorType"in Te&&($e=Te.colorType,tr?(n(t.oes_texture_float||!($e==="float"||$e==="float32"),"you must enable OES_texture_float in order to use floating point framebuffer objects"),n(t.oes_texture_half_float||!($e==="half float"||$e==="float16"),"you must enable OES_texture_half_float in order to use 16-bit floating point framebuffer objects")):$e==="half float"||$e==="float16"?(n(t.ext_color_buffer_half_float,"you must enable EXT_color_buffer_half_float to use 16-bit render buffers"),ke="rgba16f"):($e==="float"||$e==="float32")&&(n(t.webgl_color_buffer_float,"you must enable WEBGL_color_buffer_float in order to use 32-bit floating point renderbuffers"),ke="rgba32f"),n.oneOf($e,H,"invalid color type")),"colorFormat"in Te&&(ke=Te.colorFormat,k.indexOf(ke)>=0?tr=!0:B.indexOf(ke)>=0?tr=!1:n.optional(function(){tr?n.oneOf(Te.colorFormat,k,"invalid color format for texture"):n.oneOf(Te.colorFormat,B,"invalid color format for renderbuffer")}))),("depthTexture"in Te||"depthStencilTexture"in Te)&&(Ye=!!(Te.depthTexture||Te.depthStencilTexture),n(!Ye||t.webgl_depth_texture,"webgl_depth_texture extension not supported")),"depth"in Te&&(typeof Te.depth=="boolean"?Ve=Te.depth:(ar=Te.depth,ze=!1)),"stencil"in Te&&(typeof Te.stencil=="boolean"?ze=Te.stencil:(sr=Te.stencil,Ve=!1)),"depthStencil"in Te&&(typeof Te.depthStencil=="boolean"?Ve=ze=Te.depthStencil:(dr=Te.depthStencil,Ve=!1,ze=!1))}var Fe=null,ve=null,Re=null,Ie=null;if(Array.isArray(Ce))Fe=Ce.map(z);else if(Ce)Fe=[z(Ce)];else for(Fe=new Array(nr),be=0;be<nr;++be)Fe[be]=b(ge,Oe,tr,ke,$e);n(t.webgl_draw_buffers||Fe.length<=1,"you must enable the WEBGL_draw_buffers extension in order to use multiple color buffers."),n(Fe.length<=l.maxColorAttachments,"too many color attachments, not supported"),ge=ge||Fe[0].width,Oe=Oe||Fe[0].height,ar?ve=z(ar):Ve&&!ze&&(ve=b(ge,Oe,Ye,"depth","uint32")),sr?Re=z(sr):ze&&!Ve&&(Re=b(ge,Oe,!1,"stencil","uint8")),dr?Ie=z(dr):!ar&&!sr&&ze&&Ve&&(Ie=b(ge,Oe,Ye,"depth stencil","depth stencil")),n(!!ar+!!sr+!!dr<=1,"invalid framebuffer configuration, can specify exactly one depth/stencil attachment");var Ke=null;for(be=0;be<Fe.length;++be)if(Y(Fe[be],ge,Oe),n(!Fe[be]||Fe[be].texture&&Ps.indexOf(Fe[be].texture._texture.format)>=0||Fe[be].renderbuffer&&qs.indexOf(Fe[be].renderbuffer._renderbuffer.format)>=0,"framebuffer color attachment "+be+" is invalid"),Fe[be]&&Fe[be].texture){var Gr=ma[Fe[be].texture._texture.format]*hn[Fe[be].texture._texture.type];Ke===null?Ke=Gr:n(Ke===Gr,"all color attachments much have the same number of bits per pixel.")}return Y(ve,ge,Oe),n(!ve||ve.texture&&ve.texture._texture.format===Ns||ve.renderbuffer&&ve.renderbuffer._renderbuffer.format===Us,"invalid depth attachment for framebuffer object"),Y(Re,ge,Oe),n(!Re||Re.renderbuffer&&Re.renderbuffer._renderbuffer.format===Vs,"invalid stencil attachment for framebuffer object"),Y(Ie,ge,Oe),n(!Ie||Ie.texture&&Ie.texture._texture.format===hf||Ie.renderbuffer&&Ie.renderbuffer._renderbuffer.format===hf,"invalid depth-stencil attachment for framebuffer object"),$(J),J.width=ge,J.height=Oe,J.colorAttachments=Fe,J.depthAttachment=ve,J.stencilAttachment=Re,J.depthStencilAttachment=Ie,Ee.color=Fe.map(w),Ee.depth=w(ve),Ee.stencil=w(Re),Ee.depthStencil=w(Ie),Ee.width=J.width,Ee.height=J.height,G(J),Ee}function ye(ee,te){n(L.next!==J,"can not resize a framebuffer which is currently in use");var be=Math.max(ee|0,1),ge=Math.max(te|0||be,1);if(be===J.width&&ge===J.height)return Ee;for(var Oe=J.colorAttachments,Ve=0;Ve<Oe.length;++Ve)V(Oe[Ve],be,ge);return V(J.depthAttachment,be,ge),V(J.stencilAttachment,be,ge),V(J.depthStencilAttachment,be,ge),J.width=Ee.width=be,J.height=Ee.height=ge,G(J),Ee}return Ee(U,Q),P(Ee,{resize:ye,_reglType:"framebuffer",_framebuffer:J,destroy:function(){me(J),$(J)},use:function(ee){L.setFBO({framebuffer:Ee},ee)}})}function oe(U){var Q=Array(6);function J(ye){var ee;n(Q.indexOf(L.next)<0,"can not update framebuffer which is currently in use");var te={color:null},be=0,ge=null,Oe="rgba",Ve="uint8",ze=1;if(typeof ye=="number")be=ye|0;else if(!ye)be=1;else{n.type(ye,"object","invalid arguments for framebuffer");var Ce=ye;if("shape"in Ce){var tr=Ce.shape;n(Array.isArray(tr)&&tr.length>=2,"invalid shape for framebuffer"),n(tr[0]===tr[1],"cube framebuffer must be square"),be=tr[0]}else"radius"in Ce&&(be=Ce.radius|0),"width"in Ce?(be=Ce.width|0,"height"in Ce&&n(Ce.height===be,"must be square")):"height"in Ce&&(be=Ce.height|0);("color"in Ce||"colors"in Ce)&&(ge=Ce.color||Ce.colors,Array.isArray(ge)&&n(ge.length===1||t.webgl_draw_buffers,"multiple render targets not supported")),ge||("colorCount"in Ce&&(ze=Ce.colorCount|0,n(ze>0,"invalid color buffer count")),"colorType"in Ce&&(n.oneOf(Ce.colorType,H,"invalid color type"),Ve=Ce.colorType),"colorFormat"in Ce&&(Oe=Ce.colorFormat,n.oneOf(Ce.colorFormat,k,"invalid color format for texture"))),"depth"in Ce&&(te.depth=Ce.depth),"stencil"in Ce&&(te.stencil=Ce.stencil),"depthStencil"in Ce&&(te.depthStencil=Ce.depthStencil)}var ke;if(ge)if(Array.isArray(ge))for(ke=[],ee=0;ee<ge.length;++ee)ke[ee]=ge[ee];else ke=[ge];else{ke=Array(ze);var $e={radius:be,format:Oe,type:Ve};for(ee=0;ee<ze;++ee)ke[ee]=T.createCube($e)}for(te.color=Array(ke.length),ee=0;ee<ke.length;++ee){var nr=ke[ee];n(typeof nr=="function"&&nr._reglType==="textureCube","invalid cube map"),be=be||nr.width,n(nr.width===be&&nr.height===be,"invalid cube map shape"),te.color[ee]={target:mn,data:ke[ee]}}for(ee=0;ee<6;++ee){for(var ar=0;ar<ke.length;++ar)te.color[ar].target=mn+ee;ee>0&&(te.depth=Q[0].depth,te.stencil=Q[0].stencil,te.depthStencil=Q[0].depthStencil),Q[ee]?Q[ee](te):Q[ee]=C(te)}return P(J,{width:be,height:be,color:ke})}function Ee(ye){var ee,te=ye|0;if(n(te>0&&te<=l.maxCubeMapSize,"invalid radius for cube fbo"),te===J.width)return J;var be=J.color;for(ee=0;ee<be.length;++ee)be[ee].resize(te);for(ee=0;ee<6;++ee)Q[ee].resize(te);return J.width=J.height=te,J}return J(U),P(J,{faces:Q,resize:Ee,_reglType:"framebufferCube",destroy:function(){Q.forEach(function(ye){ye.destroy()})}})}function K(){L.cur=null,L.next=null,L.dirty=!0,gr(N).forEach(function(U){U.framebuffer=e.createFramebuffer(),G(U)})}return P(L,{getFramebuffer:function(U){if(typeof U=="function"&&U._reglType==="framebuffer"){var Q=U._framebuffer;if(Q instanceof re)return Q}return null},create:C,createCube:oe,clear:function(){gr(N).forEach(me)},restore:K})}var Ys=5126,vf=34962,vn=34963,bf=["attributes","elements","offset","count","primitive","instances"];function ha(){this.state=0,this.x=0,this.y=0,this.z=0,this.w=0,this.buffer=null,this.size=0,this.normalized=!1,this.type=Ys,this.offset=0,this.stride=0,this.divisor=0}function Ks(e,t,l,T,I,x,L){for(var k=l.maxAttributes,B=new Array(k),H=0;H<k;++H)B[H]=new ha;var X=0,j={},Y={Record:ha,scope:{},state:B,currentVAO:null,targetVAO:null,restore:z()?$:function(){},createVAO:me,getVAO:w,destroyBuffer:M,setVAO:z()?V:ae,clear:z()?N:function(){}};function M(G){for(var C=0;C<B.length;++C){var oe=B[C];oe.buffer===G&&(e.disableVertexAttribArray(C),oe.buffer=null)}}function z(){return t.oes_vertex_array_object}function b(){return t.angle_instanced_arrays}function w(G){return typeof G=="function"&&G._vao?G._vao:null}function V(G){if(G!==Y.currentVAO){var C=z();G?C.bindVertexArrayOES(G.vao):C.bindVertexArrayOES(null),Y.currentVAO=G}}function ae(G){if(G!==Y.currentVAO){if(G)G.bindAttrs();else{for(var C=b(),oe=0;oe<B.length;++oe){var K=B[oe];K.buffer?(e.enableVertexAttribArray(oe),K.buffer.bind(),e.vertexAttribPointer(oe,K.size,K.type,K.normalized,K.stride,K.offfset),C&&K.divisor&&C.vertexAttribDivisorANGLE(oe,K.divisor)):(e.disableVertexAttribArray(oe),e.vertexAttrib4f(oe,K.x,K.y,K.z,K.w))}L.elements?e.bindBuffer(vn,L.elements.buffer.buffer):e.bindBuffer(vn,null)}Y.currentVAO=G}}function N(){gr(j).forEach(function(G){G.destroy()})}function re(){this.id=++X,this.attributes=[],this.elements=null,this.ownsElements=!1,this.count=0,this.offset=0,this.instances=-1,this.primitive=4;var G=z();G?this.vao=G.createVertexArrayOES():this.vao=null,j[this.id]=this,this.buffers=[]}re.prototype.bindAttrs=function(){for(var G=b(),C=this.attributes,oe=0;oe<C.length;++oe){var K=C[oe];K.buffer?(e.enableVertexAttribArray(oe),e.bindBuffer(vf,K.buffer.buffer),e.vertexAttribPointer(oe,K.size,K.type,K.normalized,K.stride,K.offset),G&&K.divisor&&G.vertexAttribDivisorANGLE(oe,K.divisor)):(e.disableVertexAttribArray(oe),e.vertexAttrib4f(oe,K.x,K.y,K.z,K.w))}for(var U=C.length;U<k;++U)e.disableVertexAttribArray(U);var Q=x.getElements(this.elements);Q?e.bindBuffer(vn,Q.buffer.buffer):e.bindBuffer(vn,null)},re.prototype.refresh=function(){var G=z();G&&(G.bindVertexArrayOES(this.vao),this.bindAttrs(),Y.currentVAO=null,G.bindVertexArrayOES(null))},re.prototype.destroy=function(){if(this.vao){var G=z();this===Y.currentVAO&&(Y.currentVAO=null,G.bindVertexArrayOES(null)),G.deleteVertexArrayOES(this.vao),this.vao=null}this.ownsElements&&(this.elements.destroy(),this.elements=null,this.ownsElements=!1),j[this.id]&&(delete j[this.id],T.vaoCount-=1)};function $(){var G=z();G&&gr(j).forEach(function(C){C.refresh()})}function me(G){var C=new re;T.vaoCount+=1;function oe(K){var U;if(Array.isArray(K))U=K,C.elements&&C.ownsElements&&C.elements.destroy(),C.elements=null,C.ownsElements=!1,C.offset=0,C.count=0,C.instances=-1,C.primitive=4;else{if(n(typeof K=="object","invalid arguments for create vao"),n("attributes"in K,"must specify attributes for vao"),K.elements){var Q=K.elements;C.ownsElements?typeof Q=="function"&&Q._reglType==="elements"?(C.elements.destroy(),C.ownsElements=!1):(C.elements(Q),C.ownsElements=!1):x.getElements(K.elements)?(C.elements=K.elements,C.ownsElements=!1):(C.elements=x.create(K.elements),C.ownsElements=!0)}else C.elements=null,C.ownsElements=!1;U=K.attributes,C.offset=0,C.count=-1,C.instances=-1,C.primitive=4,C.elements&&(C.count=C.elements._elements.vertCount,C.primitive=C.elements._elements.primType),"offset"in K&&(C.offset=K.offset|0),"count"in K&&(C.count=K.count|0),"instances"in K&&(C.instances=K.instances|0),"primitive"in K&&(n(K.primitive in Vr,"bad primitive type: "+K.primitive),C.primitive=Vr[K.primitive]),n.optional(()=>{for(var Ve=Object.keys(K),ze=0;ze<Ve.length;++ze)n(bf.indexOf(Ve[ze])>=0,'invalid option for vao: "'+Ve[ze]+'" valid options are '+bf)}),n(Array.isArray(U),"attributes must be an array")}n(U.length<k,"too many attributes"),n(U.length>0,"must specify at least one attribute");var J={},Ee=C.attributes;Ee.length=U.length;for(var ye=0;ye<U.length;++ye){var ee=U[ye],te=Ee[ye]=new ha,be=ee.data||ee;if(Array.isArray(be)||A(be)||Lr(be)){var ge;C.buffers[ye]&&(ge=C.buffers[ye],A(be)&&ge._buffer.byteLength>=be.byteLength?ge.subdata(be):(ge.destroy(),C.buffers[ye]=null)),C.buffers[ye]||(ge=C.buffers[ye]=I.create(ee,vf,!1,!0)),te.buffer=I.getBuffer(ge),te.size=te.buffer.dimension|0,te.normalized=!1,te.type=te.buffer.dtype,te.offset=0,te.stride=0,te.divisor=0,te.state=1,J[ye]=1}else I.getBuffer(ee)?(te.buffer=I.getBuffer(ee),te.size=te.buffer.dimension|0,te.normalized=!1,te.type=te.buffer.dtype,te.offset=0,te.stride=0,te.divisor=0,te.state=1):I.getBuffer(ee.buffer)?(te.buffer=I.getBuffer(ee.buffer),te.size=(+ee.size||te.buffer.dimension)|0,te.normalized=!!ee.normalized||!1,"type"in ee?(n.parameter(ee.type,Jr,"invalid buffer type"),te.type=Jr[ee.type]):te.type=te.buffer.dtype,te.offset=(ee.offset||0)|0,te.stride=(ee.stride||0)|0,te.divisor=(ee.divisor||0)|0,te.state=1,n(te.size>=1&&te.size<=4,"size must be between 1 and 4"),n(te.offset>=0,"invalid offset"),n(te.stride>=0&&te.stride<=255,"stride must be between 0 and 255"),n(te.divisor>=0,"divisor must be positive"),n(!te.divisor||!!t.angle_instanced_arrays,"ANGLE_instanced_arrays must be enabled to use divisor")):"x"in ee?(n(ye>0,"first attribute must not be a constant"),te.x=+ee.x||0,te.y=+ee.y||0,te.z=+ee.z||0,te.w=+ee.w||0,te.state=2):n(!1,"invalid attribute spec for location "+ye)}for(var Oe=0;Oe<C.buffers.length;++Oe)!J[Oe]&&C.buffers[Oe]&&(C.buffers[Oe].destroy(),C.buffers[Oe]=null);return C.refresh(),oe}return oe.destroy=function(){for(var K=0;K<C.buffers.length;++K)C.buffers[K]&&C.buffers[K].destroy();C.buffers.length=0,C.ownsElements&&(C.elements.destroy(),C.elements=null,C.ownsElements=!1),C.destroy()},oe._vao=C,oe._reglType="vao",oe(G)}return Y}var _f=35632,Qs=35633,Zs=35718,Js=35721;function $s(e,t,l,T){var I={},x={};function L(b,w,V,ae){this.name=b,this.id=w,this.location=V,this.info=ae}function k(b,w){for(var V=0;V<b.length;++V)if(b[V].id===w.id){b[V].location=w.location;return}b.push(w)}function B(b,w,V){var ae=b===_f?I:x,N=ae[w];if(!N){var re=t.str(w);N=e.createShader(b),e.shaderSource(N,re),e.compileShader(N),n.shaderError(e,N,re,b,V),ae[w]=N}return N}var H={},X=[],j=0;function Y(b,w){this.id=j++,this.fragId=b,this.vertId=w,this.program=null,this.uniforms=[],this.attributes=[],this.refCount=1,T.profile&&(this.stats={uniformsCount:0,attributesCount:0})}function M(b,w,V){var ae,N,re=B(_f,b.fragId),$=B(Qs,b.vertId),me=b.program=e.createProgram();if(e.attachShader(me,re),e.attachShader(me,$),V)for(ae=0;ae<V.length;++ae){var G=V[ae];e.bindAttribLocation(me,G[0],G[1])}e.linkProgram(me),n.linkError(e,me,t.str(b.fragId),t.str(b.vertId),w);var C=e.getProgramParameter(me,Zs);T.profile&&(b.stats.uniformsCount=C);var oe=b.uniforms;for(ae=0;ae<C;++ae)if(N=e.getActiveUniform(me,ae),N){if(N.size>1)for(var K=0;K<N.size;++K){var U=N.name.replace("[0]","["+K+"]");k(oe,new L(U,t.id(U),e.getUniformLocation(me,U),N))}var Q=N.name;N.size>1&&(Q=Q.replace("[0]","")),k(oe,new L(Q,t.id(Q),e.getUniformLocation(me,Q),N))}var J=e.getProgramParameter(me,Js);T.profile&&(b.stats.attributesCount=J);var Ee=b.attributes;for(ae=0;ae<J;++ae)N=e.getActiveAttrib(me,ae),N&&k(Ee,new L(N.name,t.id(N.name),e.getAttribLocation(me,N.name),N))}T.profile&&(l.getMaxUniformsCount=function(){var b=0;return X.forEach(function(w){w.stats.uniformsCount>b&&(b=w.stats.uniformsCount)}),b},l.getMaxAttributesCount=function(){var b=0;return X.forEach(function(w){w.stats.attributesCount>b&&(b=w.stats.attributesCount)}),b});function z(){I={},x={};for(var b=0;b<X.length;++b)M(X[b],null,X[b].attributes.map(function(w){return[w.location,w.name]}))}return{clear:function(){var b=e.deleteShader.bind(e);gr(I).forEach(b),I={},gr(x).forEach(b),x={},X.forEach(function(w){e.deleteProgram(w.program)}),X.length=0,H={},l.shaderCount=0},program:function(b,w,V,ae){n.command(b>=0,"missing vertex shader",V),n.command(w>=0,"missing fragment shader",V);var N=H[w];N||(N=H[w]={});var re=N[b];if(re&&(re.refCount++,!ae))return re;var $=new Y(w,b);return l.shaderCount++,M($,V,ae),re||(N[b]=$),X.push($),P($,{destroy:function(){if($.refCount--,$.refCount<=0){e.deleteProgram($.program);var me=X.indexOf($);X.splice(me,1),l.shaderCount--}N[$.vertId].refCount<=0&&(e.deleteShader(x[$.vertId]),delete x[$.vertId],delete H[$.fragId][$.vertId]),Object.keys(H[$.fragId]).length||(e.deleteShader(I[$.fragId]),delete I[$.fragId],delete H[$.fragId])}})},restore:z,shader:B,frag:-1,vert:-1}}var el=6408,Bt=5121,rl=3333,bn=5126;function tl(e,t,l,T,I,x,L){function k(X){var j;t.next===null?(n(I.preserveDrawingBuffer,'you must create a webgl context with "preserveDrawingBuffer":true in order to read pixels from the drawing buffer'),j=Bt):(n(t.next.colorAttachments[0].texture!==null,"You cannot read from a renderbuffer"),j=t.next.colorAttachments[0].texture._texture.type,n.optional(function(){x.oes_texture_float?(n(j===Bt||j===bn,"Reading from a framebuffer is only allowed for the types 'uint8' and 'float'"),j===bn&&n(L.readFloat,"Reading 'float' values is not permitted in your browser. For a fallback, please see: https://www.npmjs.com/package/glsl-read-float")):n(j===Bt,"Reading from a framebuffer is only allowed for the type 'uint8'")}));var Y=0,M=0,z=T.framebufferWidth,b=T.framebufferHeight,w=null;A(X)?w=X:X&&(n.type(X,"object","invalid arguments to regl.read()"),Y=X.x|0,M=X.y|0,n(Y>=0&&Y<T.framebufferWidth,"invalid x offset for regl.read"),n(M>=0&&M<T.framebufferHeight,"invalid y offset for regl.read"),z=(X.width||T.framebufferWidth-Y)|0,b=(X.height||T.framebufferHeight-M)|0,w=X.data||null),w&&(j===Bt?n(w instanceof Uint8Array,"buffer must be 'Uint8Array' when reading from a framebuffer of type 'uint8'"):j===bn&&n(w instanceof Float32Array,"buffer must be 'Float32Array' when reading from a framebuffer of type 'float'")),n(z>0&&z+Y<=T.framebufferWidth,"invalid width for read pixels"),n(b>0&&b+M<=T.framebufferHeight,"invalid height for read pixels"),l();var V=z*b*4;return w||(j===Bt?w=new Uint8Array(V):j===bn&&(w=w||new Float32Array(V))),n.isTypedArray(w,"data buffer for regl.read() must be a typedarray"),n(w.byteLength>=V,"data buffer for regl.read() too small"),e.pixelStorei(rl,4),e.readPixels(Y,M,z,b,el,j,w),w}function B(X){var j;return t.setFBO({framebuffer:X.framebuffer},function(){j=k(X)}),j}function H(X){return!X||!("framebuffer"in X)?k(X):B(X)}return H}function Et(e){return Array.prototype.slice.call(e)}function gt(e){return Et(e).join("")}function nl(){var e=0,t=[],l=[];function T(j){for(var Y=0;Y<l.length;++Y)if(l[Y]===j)return t[Y];var M="g"+e++;return t.push(M),l.push(j),M}function I(){var j=[];function Y(){j.push.apply(j,Et(arguments))}var M=[];function z(){var b="v"+e++;return M.push(b),arguments.length>0&&(j.push(b,"="),j.push.apply(j,Et(arguments)),j.push(";")),b}return P(Y,{def:z,toString:function(){return gt([M.length>0?"var "+M.join(",")+";":"",gt(j)])}})}function x(){var j=I(),Y=I(),M=j.toString,z=Y.toString;function b(w,V){Y(w,V,"=",j.def(w,V),";")}return P(function(){j.apply(j,Et(arguments))},{def:j.def,entry:j,exit:Y,save:b,set:function(w,V,ae){b(w,V),j(w,V,"=",ae,";")},toString:function(){return M()+z()}})}function L(){var j=gt(arguments),Y=x(),M=x(),z=Y.toString,b=M.toString;return P(Y,{then:function(){return Y.apply(Y,Et(arguments)),this},else:function(){return M.apply(M,Et(arguments)),this},toString:function(){var w=b();return w&&(w="else{"+w+"}"),gt(["if(",j,"){",z(),"}",w])}})}var k=I(),B={};function H(j,Y){var M=[];function z(){var N="a"+M.length;return M.push(N),N}Y=Y||0;for(var b=0;b<Y;++b)z();var w=x(),V=w.toString,ae=B[j]=P(w,{arg:z,toString:function(){return gt(["function(",M.join(),"){",V(),"}"])}});return ae}function X(){var j=['"use strict";',k,"return {"];Object.keys(B).forEach(function(z){j.push('"',z,'":',B[z].toString(),",")}),j.push("}");var Y=gt(j).replace(/;/g,`;
`).replace(/}/g,`}
`).replace(/{/g,`{
`),M=Function.apply(null,t.concat(Y));return M.apply(null,l)}return{global:k,link:T,block:I,proc:H,scope:x,cond:L,compile:X}}var At="xyzw".split(""),pf=5121,xt=1,va=2,ba=0,_a=1,pa=2,ya=3,_n=4,yf=5,Ef=6,gf="dither",Af="blend.enable",xf="blend.color",Ea="blend.equation",ga="blend.func",Tf="depth.enable",Sf="depth.func",wf="depth.range",Lf="depth.mask",Aa="colorMask",Of="cull.enable",Rf="cull.face",xa="frontFace",Ta="lineWidth",Cf="polygonOffset.enable",Sa="polygonOffset.offset",If="sample.alpha",Gf="sample.enable",wa="sample.coverage",Ff="stencil.enable",Df="stencil.mask",La="stencil.func",Oa="stencil.opFront",kt="stencil.opBack",Nf="scissor.enable",pn="scissor.box",Br="viewport",Mt="profile",nt="framebuffer",Ut="vert",Vt="frag",at="elements",it="primitive",ft="count",yn="offset",En="instances",zt="vao",Ra="Width",Ca="Height",Tt=nt+Ra,St=nt+Ca,al=Br+Ra,il=Br+Ca,Pf="drawingBuffer",Bf=Pf+Ra,kf=Pf+Ca,fl=[ga,Ea,La,Oa,kt,wa,Br,pn,Sa],wt=34962,Ia=34963,ol=35632,ul=35633,Mf=3553,sl=34067,ll=2884,cl=3042,dl=3024,ml=2960,hl=2929,vl=3089,bl=32823,_l=32926,pl=32928,Ga=5126,gn=35664,An=35665,xn=35666,Fa=5124,Tn=35667,Sn=35668,wn=35669,Da=35670,Ln=35671,On=35672,Rn=35673,Ht=35674,jt=35675,Xt=35676,qt=35678,Wt=35680,Na=4,Yt=1028,ot=1029,Uf=2304,Pa=2305,yl=32775,El=32776,gl=519,Hr=7680,Vf=0,zf=1,Hf=32774,Al=513,jf=36160,xl=36064,Ir={0:0,1:1,zero:0,one:1,"src color":768,"one minus src color":769,"src alpha":770,"one minus src alpha":771,"dst color":774,"one minus dst color":775,"dst alpha":772,"one minus dst alpha":773,"constant color":32769,"one minus constant color":32770,"constant alpha":32771,"one minus constant alpha":32772,"src alpha saturate":776},Xf=["constant color, constant alpha","one minus constant color, constant alpha","constant color, one minus constant alpha","one minus constant color, one minus constant alpha","constant alpha, constant color","constant alpha, one minus constant color","one minus constant alpha, constant color","one minus constant alpha, one minus constant color"],Lt={never:512,less:513,"<":513,equal:514,"=":514,"==":514,"===":514,lequal:515,"<=":515,greater:516,">":516,notequal:517,"!=":517,"!==":517,gequal:518,">=":518,always:519},jr={0:0,zero:0,keep:7680,replace:7681,increment:7682,decrement:7683,"increment wrap":34055,"decrement wrap":34056,invert:5386},qf={frag:ol,vert:ul},Ba={cw:Uf,ccw:Pa};function Cn(e){return Array.isArray(e)||A(e)||Lr(e)}function Wf(e){return e.sort(function(t,l){return t===Br?-1:l===Br?1:t<l?-1:1})}function fr(e,t,l,T){this.thisDep=e,this.contextDep=t,this.propDep=l,this.append=T}function Xr(e){return e&&!(e.thisDep||e.contextDep||e.propDep)}function Je(e){return new fr(!1,!1,!1,e)}function br(e,t){var l=e.type;if(l===ba){var T=e.data.length;return new fr(!0,T>=1,T>=2,t)}else if(l===_n){var I=e.data;return new fr(I.thisDep,I.contextDep,I.propDep,t)}else{if(l===yf)return new fr(!1,!1,!1,t);if(l===Ef){for(var x=!1,L=!1,k=!1,B=0;B<e.data.length;++B){var H=e.data[B];if(H.type===_a)k=!0;else if(H.type===pa)L=!0;else if(H.type===ya)x=!0;else if(H.type===ba){x=!0;var X=H.data;X>=1&&(L=!0),X>=2&&(k=!0)}else H.type===_n&&(x=x||H.data.thisDep,L=L||H.data.contextDep,k=k||H.data.propDep)}return new fr(x,L,k,t)}else return new fr(l===ya,l===pa,l===_a,t)}}var Yf=new fr(!1,!1,!1,function(){});function Tl(e,t,l,T,I,x,L,k,B,H,X,j,Y,M,z){var b=H.Record,w={add:32774,subtract:32778,"reverse subtract":32779};l.ext_blend_minmax&&(w.min=yl,w.max=El);var V=l.angle_instanced_arrays,ae=l.webgl_draw_buffers,N=l.oes_vertex_array_object,re={dirty:!0,profile:z.profile},$={},me=[],G={},C={};function oe(a){return a.replace(".","_")}function K(a,r,c){var v=oe(a);me.push(a),$[v]=re[v]=!!c,G[v]=r}function U(a,r,c){var v=oe(a);me.push(a),Array.isArray(c)?(re[v]=c.slice(),$[v]=c.slice()):re[v]=$[v]=c,C[v]=r}K(gf,dl),K(Af,cl),U(xf,"blendColor",[0,0,0,0]),U(Ea,"blendEquationSeparate",[Hf,Hf]),U(ga,"blendFuncSeparate",[zf,Vf,zf,Vf]),K(Tf,hl,!0),U(Sf,"depthFunc",Al),U(wf,"depthRange",[0,1]),U(Lf,"depthMask",!0),U(Aa,Aa,[!0,!0,!0,!0]),K(Of,ll),U(Rf,"cullFace",ot),U(xa,xa,Pa),U(Ta,Ta,1),K(Cf,bl),U(Sa,"polygonOffset",[0,0]),K(If,_l),K(Gf,pl),U(wa,"sampleCoverage",[1,!1]),K(Ff,ml),U(Df,"stencilMask",-1),U(La,"stencilFunc",[gl,0,-1]),U(Oa,"stencilOpSeparate",[Yt,Hr,Hr,Hr]),U(kt,"stencilOpSeparate",[ot,Hr,Hr,Hr]),K(Nf,vl),U(pn,"scissor",[0,0,e.drawingBufferWidth,e.drawingBufferHeight]),U(Br,Br,[0,0,e.drawingBufferWidth,e.drawingBufferHeight]);var Q={gl:e,context:Y,strings:t,next:$,current:re,draw:j,elements:x,buffer:I,shader:X,attributes:H.state,vao:H,uniforms:B,framebuffer:k,extensions:l,timer:M,isBufferArgs:Cn},J={primTypes:Vr,compareFuncs:Lt,blendFuncs:Ir,blendEquations:w,stencilOps:jr,glTypes:Jr,orientationType:Ba};n.optional(function(){Q.isArrayLike=Ue}),ae&&(J.backBuffer=[ot],J.drawBuffer=Er(T.maxDrawbuffers,function(a){return a===0?[0]:Er(a,function(r){return xl+r})}));var Ee=0;function ye(){var a=nl(),r=a.link,c=a.global;a.id=Ee++,a.batchId="0";var v=r(Q),_=a.shared={props:"a0"};Object.keys(Q).forEach(function(u){_[u]=c.def(v,".",u)}),n.optional(function(){a.CHECK=r(n),a.commandStr=n.guessCommand(),a.command=r(a.commandStr),a.assert=function(u,f,y){u("if(!(",f,"))",this.CHECK,".commandRaise(",r(y),",",this.command,");")},J.invalidBlendCombinations=Xf});var m=a.next={},d=a.current={};Object.keys(C).forEach(function(u){Array.isArray(re[u])&&(m[u]=c.def(_.next,".",u),d[u]=c.def(_.current,".",u))});var h=a.constants={};Object.keys(J).forEach(function(u){h[u]=c.def(JSON.stringify(J[u]))}),a.invoke=function(u,f){switch(f.type){case ba:var y=["this",_.context,_.props,a.batchId];return u.def(r(f.data),".call(",y.slice(0,Math.max(f.data.length+1,4)),")");case _a:return u.def(_.props,f.data);case pa:return u.def(_.context,f.data);case ya:return u.def("this",f.data);case _n:return f.data.append(a,u),f.data.ref;case yf:return f.data.toString();case Ef:return f.data.map(function(p){return a.invoke(u,p)})}},a.attribCache={};var i={};return a.scopeAttrib=function(u){var f=t.id(u);if(f in i)return i[f];var y=H.scope[f];y||(y=H.scope[f]=new b);var p=i[f]=r(y);return p},a}function ee(a){var r=a.static,c=a.dynamic,v;if(Mt in r){var _=!!r[Mt];v=Je(function(d,h){return _}),v.enable=_}else if(Mt in c){var m=c[Mt];v=br(m,function(d,h){return d.invoke(h,m)})}return v}function te(a,r){var c=a.static,v=a.dynamic;if(nt in c){var _=c[nt];return _?(_=k.getFramebuffer(_),n.command(_,"invalid framebuffer object"),Je(function(d,h){var i=d.link(_),u=d.shared;h.set(u.framebuffer,".next",i);var f=u.context;return h.set(f,"."+Tt,i+".width"),h.set(f,"."+St,i+".height"),i})):Je(function(d,h){var i=d.shared;h.set(i.framebuffer,".next","null");var u=i.context;return h.set(u,"."+Tt,u+"."+Bf),h.set(u,"."+St,u+"."+kf),"null"})}else if(nt in v){var m=v[nt];return br(m,function(d,h){var i=d.invoke(h,m),u=d.shared,f=u.framebuffer,y=h.def(f,".getFramebuffer(",i,")");n.optional(function(){d.assert(h,"!"+i+"||"+y,"invalid framebuffer object")}),h.set(f,".next",y);var p=u.context;return h.set(p,"."+Tt,y+"?"+y+".width:"+p+"."+Bf),h.set(p,"."+St,y+"?"+y+".height:"+p+"."+kf),y})}else return null}function be(a,r,c){var v=a.static,_=a.dynamic;function m(i){if(i in v){var u=v[i];n.commandType(u,"object","invalid "+i,c.commandStr);var f=!0,y=u.x|0,p=u.y|0,R,F;return"width"in u?(R=u.width|0,n.command(R>=0,"invalid "+i,c.commandStr)):f=!1,"height"in u?(F=u.height|0,n.command(F>=0,"invalid "+i,c.commandStr)):f=!1,new fr(!f&&r&&r.thisDep,!f&&r&&r.contextDep,!f&&r&&r.propDep,function(ce,ie){var D=ce.shared.context,O=R;"width"in u||(O=ie.def(D,".",Tt,"-",y));var le=F;return"height"in u||(le=ie.def(D,".",St,"-",p)),[y,p,O,le]})}else if(i in _){var q=_[i],pe=br(q,function(ce,ie){var D=ce.invoke(ie,q);n.optional(function(){ce.assert(ie,D+"&&typeof "+D+'==="object"',"invalid "+i)});var O=ce.shared.context,le=ie.def(D,".x|0"),ue=ie.def(D,".y|0"),_e=ie.def('"width" in ',D,"?",D,".width|0:","(",O,".",Tt,"-",le,")"),Ne=ie.def('"height" in ',D,"?",D,".height|0:","(",O,".",St,"-",ue,")");return n.optional(function(){ce.assert(ie,_e+">=0&&"+Ne+">=0","invalid "+i)}),[le,ue,_e,Ne]});return r&&(pe.thisDep=pe.thisDep||r.thisDep,pe.contextDep=pe.contextDep||r.contextDep,pe.propDep=pe.propDep||r.propDep),pe}else return r?new fr(r.thisDep,r.contextDep,r.propDep,function(ce,ie){var D=ce.shared.context;return[0,0,ie.def(D,".",Tt),ie.def(D,".",St)]}):null}var d=m(Br);if(d){var h=d;d=new fr(d.thisDep,d.contextDep,d.propDep,function(i,u){var f=h.append(i,u),y=i.shared.context;return u.set(y,"."+al,f[2]),u.set(y,"."+il,f[3]),f})}return{viewport:d,scissor_box:m(pn)}}function ge(a,r){var c=a.static,v=typeof c[Vt]=="string"&&typeof c[Ut]=="string";if(v){if(Object.keys(r.dynamic).length>0)return null;var _=r.static,m=Object.keys(_);if(m.length>0&&typeof _[m[0]]=="number"){for(var d=[],h=0;h<m.length;++h)n(typeof _[m[h]]=="number","must specify all vertex attribute locations when using vaos"),d.push([_[m[h]]|0,m[h]]);return d}}return null}function Oe(a,r,c){var v=a.static,_=a.dynamic;function m(f){if(f in v){var y=t.id(v[f]);n.optional(function(){X.shader(qf[f],y,n.guessCommand())});var p=Je(function(){return y});return p.id=y,p}else if(f in _){var R=_[f];return br(R,function(F,q){var pe=F.invoke(q,R),ce=q.def(F.shared.strings,".id(",pe,")");return n.optional(function(){q(F.shared.shader,".shader(",qf[f],",",ce,",",F.command,");")}),ce})}return null}var d=m(Vt),h=m(Ut),i=null,u;return Xr(d)&&Xr(h)?(i=X.program(h.id,d.id,null,c),u=Je(function(f,y){return f.link(i)})):u=new fr(d&&d.thisDep||h&&h.thisDep,d&&d.contextDep||h&&h.contextDep,d&&d.propDep||h&&h.propDep,function(f,y){var p=f.shared.shader,R;d?R=d.append(f,y):R=y.def(p,".",Vt);var F;h?F=h.append(f,y):F=y.def(p,".",Ut);var q=p+".program("+F+","+R;return n.optional(function(){q+=","+f.command}),y.def(q+")")}),{frag:d,vert:h,progVar:u,program:i}}function Ve(a,r){var c=a.static,v=a.dynamic,_={},m=!1;function d(){if(zt in c){var ie=c[zt];return ie!==null&&H.getVAO(ie)===null&&(ie=H.createVAO(ie)),m=!0,_.vao=ie,Je(function(O){var le=H.getVAO(ie);return le?O.link(le):"null"})}else if(zt in v){m=!0;var D=v[zt];return br(D,function(O,le){var ue=O.invoke(le,D);return le.def(O.shared.vao+".getVAO("+ue+")")})}return null}var h=d(),i=!1;function u(){if(at in c){var ie=c[at];if(_.elements=ie,Cn(ie)){var D=_.elements=x.create(ie,!0);ie=x.getElements(D),i=!0}else ie&&(ie=x.getElements(ie),i=!0,n.command(ie,"invalid elements",r.commandStr));var O=Je(function(ue,_e){if(ie){var Ne=ue.link(ie);return ue.ELEMENTS=Ne,Ne}return ue.ELEMENTS=null,null});return O.value=ie,O}else if(at in v){i=!0;var le=v[at];return br(le,function(ue,_e){var Ne=ue.shared,hr=Ne.isBufferArgs,st=Ne.elements,kr=ue.invoke(_e,le),Fr=_e.def("null"),qr=_e.def(hr,"(",kr,")"),lt=ue.cond(qr).then(Fr,"=",st,".createStream(",kr,");").else(Fr,"=",st,".getElements(",kr,");");return n.optional(function(){ue.assert(lt.else,"!"+kr+"||"+Fr,"invalid elements")}),_e.entry(lt),_e.exit(ue.cond(qr).then(st,".destroyStream(",Fr,");")),ue.ELEMENTS=Fr,Fr})}else if(m)return new fr(h.thisDep,h.contextDep,h.propDep,function(ue,_e){return _e.def(ue.shared.vao+".currentVAO?"+ue.shared.elements+".getElements("+ue.shared.vao+".currentVAO.elements):null")});return null}var f=u();function y(){if(it in c){var ie=c[it];return _.primitive=ie,n.commandParameter(ie,Vr,"invalid primitve",r.commandStr),Je(function(O,le){return Vr[ie]})}else if(it in v){var D=v[it];return br(D,function(O,le){var ue=O.constants.primTypes,_e=O.invoke(le,D);return n.optional(function(){O.assert(le,_e+" in "+ue,"invalid primitive, must be one of "+Object.keys(Vr))}),le.def(ue,"[",_e,"]")})}else{if(i)return Xr(f)?f.value?Je(function(O,le){return le.def(O.ELEMENTS,".primType")}):Je(function(){return Na}):new fr(f.thisDep,f.contextDep,f.propDep,function(O,le){var ue=O.ELEMENTS;return le.def(ue,"?",ue,".primType:",Na)});if(m)return new fr(h.thisDep,h.contextDep,h.propDep,function(O,le){return le.def(O.shared.vao+".currentVAO?"+O.shared.vao+".currentVAO.primitive:"+Na)})}return null}function p(ie,D){if(ie in c){var O=c[ie]|0;return D?_.offset=O:_.instances=O,n.command(!D||O>=0,"invalid "+ie,r.commandStr),Je(function(ue,_e){return D&&(ue.OFFSET=O),O})}else if(ie in v){var le=v[ie];return br(le,function(ue,_e){var Ne=ue.invoke(_e,le);return D&&(ue.OFFSET=Ne,n.optional(function(){ue.assert(_e,Ne+">=0","invalid "+ie)})),Ne})}else if(D){if(i)return Je(function(ue,_e){return ue.OFFSET=0,0});if(m)return new fr(h.thisDep,h.contextDep,h.propDep,function(ue,_e){return _e.def(ue.shared.vao+".currentVAO?"+ue.shared.vao+".currentVAO.offset:0")})}else if(m)return new fr(h.thisDep,h.contextDep,h.propDep,function(ue,_e){return _e.def(ue.shared.vao+".currentVAO?"+ue.shared.vao+".currentVAO.instances:-1")});return null}var R=p(yn,!0);function F(){if(ft in c){var ie=c[ft]|0;return _.count=ie,n.command(typeof ie=="number"&&ie>=0,"invalid vertex count",r.commandStr),Je(function(){return ie})}else if(ft in v){var D=v[ft];return br(D,function(_e,Ne){var hr=_e.invoke(Ne,D);return n.optional(function(){_e.assert(Ne,"typeof "+hr+'==="number"&&'+hr+">=0&&"+hr+"===("+hr+"|0)","invalid vertex count")}),hr})}else if(i)if(Xr(f)){if(f)return R?new fr(R.thisDep,R.contextDep,R.propDep,function(_e,Ne){var hr=Ne.def(_e.ELEMENTS,".vertCount-",_e.OFFSET);return n.optional(function(){_e.assert(Ne,hr+">=0","invalid vertex offset/element buffer too small")}),hr}):Je(function(_e,Ne){return Ne.def(_e.ELEMENTS,".vertCount")});var O=Je(function(){return-1});return n.optional(function(){O.MISSING=!0}),O}else{var le=new fr(f.thisDep||R.thisDep,f.contextDep||R.contextDep,f.propDep||R.propDep,function(_e,Ne){var hr=_e.ELEMENTS;return _e.OFFSET?Ne.def(hr,"?",hr,".vertCount-",_e.OFFSET,":-1"):Ne.def(hr,"?",hr,".vertCount:-1")});return n.optional(function(){le.DYNAMIC=!0}),le}else if(m){var ue=new fr(h.thisDep,h.contextDep,h.propDep,function(_e,Ne){return Ne.def(_e.shared.vao,".currentVAO?",_e.shared.vao,".currentVAO.count:-1")});return ue}return null}var q=y(),pe=F(),ce=p(En,!1);return{elements:f,primitive:q,count:pe,instances:ce,offset:R,vao:h,vaoActive:m,elementsActive:i,static:_}}function ze(a,r){var c=a.static,v=a.dynamic,_={};return me.forEach(function(m){var d=oe(m);function h(i,u){if(m in c){var f=i(c[m]);_[d]=Je(function(){return f})}else if(m in v){var y=v[m];_[d]=br(y,function(p,R){return u(p,R,p.invoke(R,y))})}}switch(m){case Of:case Af:case gf:case Ff:case Tf:case Nf:case Cf:case If:case Gf:case Lf:return h(function(i){return n.commandType(i,"boolean",m,r.commandStr),i},function(i,u,f){return n.optional(function(){i.assert(u,"typeof "+f+'==="boolean"',"invalid flag "+m,i.commandStr)}),f});case Sf:return h(function(i){return n.commandParameter(i,Lt,"invalid "+m,r.commandStr),Lt[i]},function(i,u,f){var y=i.constants.compareFuncs;return n.optional(function(){i.assert(u,f+" in "+y,"invalid "+m+", must be one of "+Object.keys(Lt))}),u.def(y,"[",f,"]")});case wf:return h(function(i){return n.command(Ue(i)&&i.length===2&&typeof i[0]=="number"&&typeof i[1]=="number"&&i[0]<=i[1],"depth range is 2d array",r.commandStr),i},function(i,u,f){n.optional(function(){i.assert(u,i.shared.isArrayLike+"("+f+")&&"+f+".length===2&&typeof "+f+'[0]==="number"&&typeof '+f+'[1]==="number"&&'+f+"[0]<="+f+"[1]","depth range must be a 2d array")});var y=u.def("+",f,"[0]"),p=u.def("+",f,"[1]");return[y,p]});case ga:return h(function(i){n.commandType(i,"object","blend.func",r.commandStr);var u="srcRGB"in i?i.srcRGB:i.src,f="srcAlpha"in i?i.srcAlpha:i.src,y="dstRGB"in i?i.dstRGB:i.dst,p="dstAlpha"in i?i.dstAlpha:i.dst;return n.commandParameter(u,Ir,d+".srcRGB",r.commandStr),n.commandParameter(f,Ir,d+".srcAlpha",r.commandStr),n.commandParameter(y,Ir,d+".dstRGB",r.commandStr),n.commandParameter(p,Ir,d+".dstAlpha",r.commandStr),n.command(Xf.indexOf(u+", "+y)===-1,"unallowed blending combination (srcRGB, dstRGB) = ("+u+", "+y+")",r.commandStr),[Ir[u],Ir[y],Ir[f],Ir[p]]},function(i,u,f){var y=i.constants.blendFuncs;n.optional(function(){i.assert(u,f+"&&typeof "+f+'==="object"',"invalid blend func, must be an object")});function p(D,O){var le=u.def('"',D,O,'" in ',f,"?",f,".",D,O,":",f,".",D);return n.optional(function(){i.assert(u,le+" in "+y,"invalid "+m+"."+D+O+", must be one of "+Object.keys(Ir))}),le}var R=p("src","RGB"),F=p("dst","RGB");n.optional(function(){var D=i.constants.invalidBlendCombinations;i.assert(u,D+".indexOf("+R+'+", "+'+F+") === -1 ","unallowed blending combination for (srcRGB, dstRGB)")});var q=u.def(y,"[",R,"]"),pe=u.def(y,"[",p("src","Alpha"),"]"),ce=u.def(y,"[",F,"]"),ie=u.def(y,"[",p("dst","Alpha"),"]");return[q,ce,pe,ie]});case Ea:return h(function(i){if(typeof i=="string")return n.commandParameter(i,w,"invalid "+m,r.commandStr),[w[i],w[i]];if(typeof i=="object")return n.commandParameter(i.rgb,w,m+".rgb",r.commandStr),n.commandParameter(i.alpha,w,m+".alpha",r.commandStr),[w[i.rgb],w[i.alpha]];n.commandRaise("invalid blend.equation",r.commandStr)},function(i,u,f){var y=i.constants.blendEquations,p=u.def(),R=u.def(),F=i.cond("typeof ",f,'==="string"');return n.optional(function(){function q(pe,ce,ie){i.assert(pe,ie+" in "+y,"invalid "+ce+", must be one of "+Object.keys(w))}q(F.then,m,f),i.assert(F.else,f+"&&typeof "+f+'==="object"',"invalid "+m),q(F.else,m+".rgb",f+".rgb"),q(F.else,m+".alpha",f+".alpha")}),F.then(p,"=",R,"=",y,"[",f,"];"),F.else(p,"=",y,"[",f,".rgb];",R,"=",y,"[",f,".alpha];"),u(F),[p,R]});case xf:return h(function(i){return n.command(Ue(i)&&i.length===4,"blend.color must be a 4d array",r.commandStr),Er(4,function(u){return+i[u]})},function(i,u,f){return n.optional(function(){i.assert(u,i.shared.isArrayLike+"("+f+")&&"+f+".length===4","blend.color must be a 4d array")}),Er(4,function(y){return u.def("+",f,"[",y,"]")})});case Df:return h(function(i){return n.commandType(i,"number",d,r.commandStr),i|0},function(i,u,f){return n.optional(function(){i.assert(u,"typeof "+f+'==="number"',"invalid stencil.mask")}),u.def(f,"|0")});case La:return h(function(i){n.commandType(i,"object",d,r.commandStr);var u=i.cmp||"keep",f=i.ref||0,y="mask"in i?i.mask:-1;return n.commandParameter(u,Lt,m+".cmp",r.commandStr),n.commandType(f,"number",m+".ref",r.commandStr),n.commandType(y,"number",m+".mask",r.commandStr),[Lt[u],f,y]},function(i,u,f){var y=i.constants.compareFuncs;n.optional(function(){function q(){i.assert(u,Array.prototype.join.call(arguments,""),"invalid stencil.func")}q(f+"&&typeof ",f,'==="object"'),q('!("cmp" in ',f,")||(",f,".cmp in ",y,")")});var p=u.def('"cmp" in ',f,"?",y,"[",f,".cmp]",":",Hr),R=u.def(f,".ref|0"),F=u.def('"mask" in ',f,"?",f,".mask|0:-1");return[p,R,F]});case Oa:case kt:return h(function(i){n.commandType(i,"object",d,r.commandStr);var u=i.fail||"keep",f=i.zfail||"keep",y=i.zpass||"keep";return n.commandParameter(u,jr,m+".fail",r.commandStr),n.commandParameter(f,jr,m+".zfail",r.commandStr),n.commandParameter(y,jr,m+".zpass",r.commandStr),[m===kt?ot:Yt,jr[u],jr[f],jr[y]]},function(i,u,f){var y=i.constants.stencilOps;n.optional(function(){i.assert(u,f+"&&typeof "+f+'==="object"',"invalid "+m)});function p(R){return n.optional(function(){i.assert(u,'!("'+R+'" in '+f+")||("+f+"."+R+" in "+y+")","invalid "+m+"."+R+", must be one of "+Object.keys(jr))}),u.def('"',R,'" in ',f,"?",y,"[",f,".",R,"]:",Hr)}return[m===kt?ot:Yt,p("fail"),p("zfail"),p("zpass")]});case Sa:return h(function(i){n.commandType(i,"object",d,r.commandStr);var u=i.factor|0,f=i.units|0;return n.commandType(u,"number",d+".factor",r.commandStr),n.commandType(f,"number",d+".units",r.commandStr),[u,f]},function(i,u,f){n.optional(function(){i.assert(u,f+"&&typeof "+f+'==="object"',"invalid "+m)});var y=u.def(f,".factor|0"),p=u.def(f,".units|0");return[y,p]});case Rf:return h(function(i){var u=0;return i==="front"?u=Yt:i==="back"&&(u=ot),n.command(!!u,d,r.commandStr),u},function(i,u,f){return n.optional(function(){i.assert(u,f+'==="front"||'+f+'==="back"',"invalid cull.face")}),u.def(f,'==="front"?',Yt,":",ot)});case Ta:return h(function(i){return n.command(typeof i=="number"&&i>=T.lineWidthDims[0]&&i<=T.lineWidthDims[1],"invalid line width, must be a positive number between "+T.lineWidthDims[0]+" and "+T.lineWidthDims[1],r.commandStr),i},function(i,u,f){return n.optional(function(){i.assert(u,"typeof "+f+'==="number"&&'+f+">="+T.lineWidthDims[0]+"&&"+f+"<="+T.lineWidthDims[1],"invalid line width")}),f});case xa:return h(function(i){return n.commandParameter(i,Ba,d,r.commandStr),Ba[i]},function(i,u,f){return n.optional(function(){i.assert(u,f+'==="cw"||'+f+'==="ccw"',"invalid frontFace, must be one of cw,ccw")}),u.def(f+'==="cw"?'+Uf+":"+Pa)});case Aa:return h(function(i){return n.command(Ue(i)&&i.length===4,"color.mask must be length 4 array",r.commandStr),i.map(function(u){return!!u})},function(i,u,f){return n.optional(function(){i.assert(u,i.shared.isArrayLike+"("+f+")&&"+f+".length===4","invalid color.mask")}),Er(4,function(y){return"!!"+f+"["+y+"]"})});case wa:return h(function(i){n.command(typeof i=="object"&&i,d,r.commandStr);var u="value"in i?i.value:1,f=!!i.invert;return n.command(typeof u=="number"&&u>=0&&u<=1,"sample.coverage.value must be a number between 0 and 1",r.commandStr),[u,f]},function(i,u,f){n.optional(function(){i.assert(u,f+"&&typeof "+f+'==="object"',"invalid sample.coverage")});var y=u.def('"value" in ',f,"?+",f,".value:1"),p=u.def("!!",f,".invert");return[y,p]})}}),_}function Ce(a,r){var c=a.static,v=a.dynamic,_={};return Object.keys(c).forEach(function(m){var d=c[m],h;if(typeof d=="number"||typeof d=="boolean")h=Je(function(){return d});else if(typeof d=="function"){var i=d._reglType;i==="texture2d"||i==="textureCube"?h=Je(function(u){return u.link(d)}):i==="framebuffer"||i==="framebufferCube"?(n.command(d.color.length>0,'missing color attachment for framebuffer sent to uniform "'+m+'"',r.commandStr),h=Je(function(u){return u.link(d.color[0])})):n.commandRaise('invalid data for uniform "'+m+'"',r.commandStr)}else Ue(d)?h=Je(function(u){var f=u.global.def("[",Er(d.length,function(y){return n.command(typeof d[y]=="number"||typeof d[y]=="boolean","invalid uniform "+m,u.commandStr),d[y]}),"]");return f}):n.commandRaise('invalid or missing data for uniform "'+m+'"',r.commandStr);h.value=d,_[m]=h}),Object.keys(v).forEach(function(m){var d=v[m];_[m]=br(d,function(h,i){return h.invoke(i,d)})}),_}function tr(a,r){var c=a.static,v=a.dynamic,_={};return Object.keys(c).forEach(function(m){var d=c[m],h=t.id(m),i=new b;if(Cn(d))i.state=xt,i.buffer=I.getBuffer(I.create(d,wt,!1,!0)),i.type=0;else{var u=I.getBuffer(d);if(u)i.state=xt,i.buffer=u,i.type=0;else if(n.command(typeof d=="object"&&d,"invalid data for attribute "+m,r.commandStr),"constant"in d){var f=d.constant;i.buffer="null",i.state=va,typeof f=="number"?i.x=f:(n.command(Ue(f)&&f.length>0&&f.length<=4,"invalid constant for attribute "+m,r.commandStr),At.forEach(function(ce,ie){ie<f.length&&(i[ce]=f[ie])}))}else{Cn(d.buffer)?u=I.getBuffer(I.create(d.buffer,wt,!1,!0)):u=I.getBuffer(d.buffer),n.command(!!u,'missing buffer for attribute "'+m+'"',r.commandStr);var y=d.offset|0;n.command(y>=0,'invalid offset for attribute "'+m+'"',r.commandStr);var p=d.stride|0;n.command(p>=0&&p<256,'invalid stride for attribute "'+m+'", must be integer betweeen [0, 255]',r.commandStr);var R=d.size|0;n.command(!("size"in d)||R>0&&R<=4,'invalid size for attribute "'+m+'", must be 1,2,3,4',r.commandStr);var F=!!d.normalized,q=0;"type"in d&&(n.commandParameter(d.type,Jr,"invalid type for attribute "+m,r.commandStr),q=Jr[d.type]);var pe=d.divisor|0;n.optional(function(){"divisor"in d&&(n.command(pe===0||V,'cannot specify divisor for attribute "'+m+'", instancing not supported',r.commandStr),n.command(pe>=0,'invalid divisor for attribute "'+m+'"',r.commandStr));var ce=r.commandStr,ie=["buffer","offset","divisor","normalized","type","size","stride"];Object.keys(d).forEach(function(D){n.command(ie.indexOf(D)>=0,'unknown parameter "'+D+'" for attribute pointer "'+m+'" (valid parameters are '+ie+")",ce)})}),i.buffer=u,i.state=xt,i.size=R,i.normalized=F,i.type=q||u.dtype,i.offset=y,i.stride=p,i.divisor=pe}}_[m]=Je(function(ce,ie){var D=ce.attribCache;if(h in D)return D[h];var O={isStream:!1};return Object.keys(i).forEach(function(le){O[le]=i[le]}),i.buffer&&(O.buffer=ce.link(i.buffer),O.type=O.type||O.buffer+".dtype"),D[h]=O,O})}),Object.keys(v).forEach(function(m){var d=v[m];function h(i,u){var f=i.invoke(u,d),y=i.shared,p=i.constants,R=y.isBufferArgs,F=y.buffer;n.optional(function(){i.assert(u,f+"&&(typeof "+f+'==="object"||typeof '+f+'==="function")&&('+R+"("+f+")||"+F+".getBuffer("+f+")||"+F+".getBuffer("+f+".buffer)||"+R+"("+f+'.buffer)||("constant" in '+f+"&&(typeof "+f+'.constant==="number"||'+y.isArrayLike+"("+f+".constant))))",'invalid dynamic attribute "'+m+'"')});var q={isStream:u.def(!1)},pe=new b;pe.state=xt,Object.keys(pe).forEach(function(O){q[O]=u.def(""+pe[O])});var ce=q.buffer,ie=q.type;u("if(",R,"(",f,")){",q.isStream,"=true;",ce,"=",F,".createStream(",wt,",",f,");",ie,"=",ce,".dtype;","}else{",ce,"=",F,".getBuffer(",f,");","if(",ce,"){",ie,"=",ce,".dtype;",'}else if("constant" in ',f,"){",q.state,"=",va,";","if(typeof "+f+'.constant === "number"){',q[At[0]],"=",f,".constant;",At.slice(1).map(function(O){return q[O]}).join("="),"=0;","}else{",At.map(function(O,le){return q[O]+"="+f+".constant.length>"+le+"?"+f+".constant["+le+"]:0;"}).join(""),"}}else{","if(",R,"(",f,".buffer)){",ce,"=",F,".createStream(",wt,",",f,".buffer);","}else{",ce,"=",F,".getBuffer(",f,".buffer);","}",ie,'="type" in ',f,"?",p.glTypes,"[",f,".type]:",ce,".dtype;",q.normalized,"=!!",f,".normalized;");function D(O){u(q[O],"=",f,".",O,"|0;")}return D("size"),D("offset"),D("stride"),D("divisor"),u("}}"),u.exit("if(",q.isStream,"){",F,".destroyStream(",ce,");","}"),q}_[m]=br(d,h)}),_}function ke(a){var r=a.static,c=a.dynamic,v={};return Object.keys(r).forEach(function(_){var m=r[_];v[_]=Je(function(d,h){return typeof m=="number"||typeof m=="boolean"?""+m:d.link(m)})}),Object.keys(c).forEach(function(_){var m=c[_];v[_]=br(m,function(d,h){return d.invoke(h,m)})}),v}function $e(a,r,c,v,_){var m=a.static,d=a.dynamic;n.optional(function(){var D=[nt,Ut,Vt,at,it,yn,ft,En,Mt,zt].concat(me);function O(le){Object.keys(le).forEach(function(ue){n.command(D.indexOf(ue)>=0,'unknown parameter "'+ue+'"',_.commandStr)})}O(m),O(d)});var h=ge(a,r),i=te(a),u=be(a,i,_),f=Ve(a,_),y=ze(a,_),p=Oe(a,_,h);function R(D){var O=u[D];O&&(y[D]=O)}R(Br),R(oe(pn));var F=Object.keys(y).length>0,q={framebuffer:i,draw:f,shader:p,state:y,dirty:F,scopeVAO:null,drawVAO:null,useVAO:!1,attributes:{}};if(q.profile=ee(a),q.uniforms=Ce(c,_),q.drawVAO=q.scopeVAO=f.vao,!q.drawVAO&&p.program&&!h&&l.angle_instanced_arrays&&f.static.elements){var pe=!0,ce=p.program.attributes.map(function(D){var O=r.static[D];return pe=pe&&!!O,O});if(pe&&ce.length>0){var ie=H.getVAO(H.createVAO({attributes:ce,elements:f.static.elements}));q.drawVAO=new fr(null,null,null,function(D,O){return D.link(ie)}),q.useVAO=!0}}return h?q.useVAO=!0:q.attributes=tr(r,_),q.context=ke(v),q}function nr(a,r,c){var v=a.shared,_=v.context,m=a.scope();Object.keys(c).forEach(function(d){r.save(_,"."+d);var h=c[d],i=h.append(a,r);Array.isArray(i)?m(_,".",d,"=[",i.join(),"];"):m(_,".",d,"=",i,";")}),r(m)}function ar(a,r,c,v){var _=a.shared,m=_.gl,d=_.framebuffer,h;ae&&(h=r.def(_.extensions,".webgl_draw_buffers"));var i=a.constants,u=i.drawBuffer,f=i.backBuffer,y;c?y=c.append(a,r):y=r.def(d,".next"),v||r("if(",y,"!==",d,".cur){"),r("if(",y,"){",m,".bindFramebuffer(",jf,",",y,".framebuffer);"),ae&&r(h,".drawBuffersWEBGL(",u,"[",y,".colorAttachments.length]);"),r("}else{",m,".bindFramebuffer(",jf,",null);"),ae&&r(h,".drawBuffersWEBGL(",f,");"),r("}",d,".cur=",y,";"),v||r("}")}function sr(a,r,c){var v=a.shared,_=v.gl,m=a.current,d=a.next,h=v.current,i=v.next,u=a.cond(h,".dirty");me.forEach(function(f){var y=oe(f);if(!(y in c.state)){var p,R;if(y in d){p=d[y],R=m[y];var F=Er(re[y].length,function(pe){return u.def(p,"[",pe,"]")});u(a.cond(F.map(function(pe,ce){return pe+"!=="+R+"["+ce+"]"}).join("||")).then(_,".",C[y],"(",F,");",F.map(function(pe,ce){return R+"["+ce+"]="+pe}).join(";"),";"))}else{p=u.def(i,".",y);var q=a.cond(p,"!==",h,".",y);u(q),y in G?q(a.cond(p).then(_,".enable(",G[y],");").else(_,".disable(",G[y],");"),h,".",y,"=",p,";"):q(_,".",C[y],"(",p,");",h,".",y,"=",p,";")}}}),Object.keys(c.state).length===0&&u(h,".dirty=false;"),r(u)}function dr(a,r,c,v){var _=a.shared,m=a.current,d=_.current,h=_.gl;Wf(Object.keys(c)).forEach(function(i){var u=c[i];if(!(v&&!v(u))){var f=u.append(a,r);if(G[i]){var y=G[i];Xr(u)?f?r(h,".enable(",y,");"):r(h,".disable(",y,");"):r(a.cond(f).then(h,".enable(",y,");").else(h,".disable(",y,");")),r(d,".",i,"=",f,";")}else if(Ue(f)){var p=m[i];r(h,".",C[i],"(",f,");",f.map(function(R,F){return p+"["+F+"]="+R}).join(";"),";")}else r(h,".",C[i],"(",f,");",d,".",i,"=",f,";")}})}function Ye(a,r){V&&(a.instancing=r.def(a.shared.extensions,".angle_instanced_arrays"))}function Te(a,r,c,v,_){var m=a.shared,d=a.stats,h=m.current,i=m.timer,u=c.profile;function f(){return typeof performance>"u"?"Date.now()":"performance.now()"}var y,p;function R(D){y=r.def(),D(y,"=",f(),";"),typeof _=="string"?D(d,".count+=",_,";"):D(d,".count++;"),M&&(v?(p=r.def(),D(p,"=",i,".getNumPendingQueries();")):D(i,".beginQuery(",d,");"))}function F(D){D(d,".cpuTime+=",f(),"-",y,";"),M&&(v?D(i,".pushScopeStats(",p,",",i,".getNumPendingQueries(),",d,");"):D(i,".endQuery();"))}function q(D){var O=r.def(h,".profile");r(h,".profile=",D,";"),r.exit(h,".profile=",O,";")}var pe;if(u){if(Xr(u)){u.enable?(R(r),F(r.exit),q("true")):q("false");return}pe=u.append(a,r),q(pe)}else pe=r.def(h,".profile");var ce=a.block();R(ce),r("if(",pe,"){",ce,"}");var ie=a.block();F(ie),r.exit("if(",pe,"){",ie,"}")}function mr(a,r,c,v,_){var m=a.shared;function d(i){switch(i){case gn:case Tn:case Ln:return 2;case An:case Sn:case On:return 3;case xn:case wn:case Rn:return 4;default:return 1}}function h(i,u,f){var y=m.gl,p=r.def(i,".location"),R=r.def(m.attributes,"[",p,"]"),F=f.state,q=f.buffer,pe=[f.x,f.y,f.z,f.w],ce=["buffer","normalized","offset","stride"];function ie(){r("if(!",R,".buffer){",y,".enableVertexAttribArray(",p,");}");var O=f.type,le;if(f.size?le=r.def(f.size,"||",u):le=u,r("if(",R,".type!==",O,"||",R,".size!==",le,"||",ce.map(function(_e){return R+"."+_e+"!=="+f[_e]}).join("||"),"){",y,".bindBuffer(",wt,",",q,".buffer);",y,".vertexAttribPointer(",[p,le,O,f.normalized,f.stride,f.offset],");",R,".type=",O,";",R,".size=",le,";",ce.map(function(_e){return R+"."+_e+"="+f[_e]+";"}).join(""),"}"),V){var ue=f.divisor;r("if(",R,".divisor!==",ue,"){",a.instancing,".vertexAttribDivisorANGLE(",[p,ue],");",R,".divisor=",ue,";}")}}function D(){r("if(",R,".buffer){",y,".disableVertexAttribArray(",p,");",R,".buffer=null;","}if(",At.map(function(O,le){return R+"."+O+"!=="+pe[le]}).join("||"),"){",y,".vertexAttrib4f(",p,",",pe,");",At.map(function(O,le){return R+"."+O+"="+pe[le]+";"}).join(""),"}")}F===xt?ie():F===va?D():(r("if(",F,"===",xt,"){"),ie(),r("}else{"),D(),r("}"))}v.forEach(function(i){var u=i.name,f=c.attributes[u],y;if(f){if(!_(f))return;y=f.append(a,r)}else{if(!_(Yf))return;var p=a.scopeAttrib(u);n.optional(function(){a.assert(r,p+".state","missing attribute "+u)}),y={},Object.keys(new b).forEach(function(R){y[R]=r.def(p,".",R)})}h(a.link(i),d(i.info.type),y)})}function Fe(a,r,c,v,_,m){for(var d=a.shared,h=d.gl,i={},u,f=0;f<v.length;++f){var y=v[f],p=y.name,R=y.info.type,F=y.info.size,q=c.uniforms[p];if(F>1){if(!q)continue;var pe=p.replace("[0]","");if(i[pe])continue;i[pe]=1}var ce=a.link(y),ie=ce+".location",D;if(q){if(!_(q))continue;if(Xr(q)){var O=q.value;if(n.command(O!==null&&typeof O<"u",'missing uniform "'+p+'"',a.commandStr),R===qt||R===Wt){n.command(typeof O=="function"&&(R===qt&&(O._reglType==="texture2d"||O._reglType==="framebuffer")||R===Wt&&(O._reglType==="textureCube"||O._reglType==="framebufferCube")),"invalid texture for uniform "+p,a.commandStr);var le=a.link(O._texture||O.color[0]._texture);r(h,".uniform1i(",ie,",",le+".bind());"),r.exit(le,".unbind();")}else if(R===Ht||R===jt||R===Xt){n.optional(function(){n.command(Ue(O),"invalid matrix for uniform "+p,a.commandStr),n.command(R===Ht&&O.length===4||R===jt&&O.length===9||R===Xt&&O.length===16,"invalid length for matrix uniform "+p,a.commandStr)});var ue=a.global.def("new Float32Array(["+Array.prototype.slice.call(O)+"])"),_e=2;R===jt?_e=3:R===Xt&&(_e=4),r(h,".uniformMatrix",_e,"fv(",ie,",false,",ue,");")}else{switch(R){case Ga:F===1?n.commandType(O,"number","uniform "+p,a.commandStr):n.command(Ue(O)&&O.length===F,"uniform "+p,a.commandStr),u="1f";break;case gn:n.command(Ue(O)&&O.length&&O.length%2===0&&O.length<=F*2,"uniform "+p,a.commandStr),u="2f";break;case An:n.command(Ue(O)&&O.length&&O.length%3===0&&O.length<=F*3,"uniform "+p,a.commandStr),u="3f";break;case xn:n.command(Ue(O)&&O.length&&O.length%4===0&&O.length<=F*4,"uniform "+p,a.commandStr),u="4f";break;case Da:F===1?n.commandType(O,"boolean","uniform "+p,a.commandStr):n.command(Ue(O)&&O.length===F,"uniform "+p,a.commandStr),u="1i";break;case Fa:F===1?n.commandType(O,"number","uniform "+p,a.commandStr):n.command(Ue(O)&&O.length===F,"uniform "+p,a.commandStr),u="1i";break;case Ln:n.command(Ue(O)&&O.length&&O.length%2===0&&O.length<=F*2,"uniform "+p,a.commandStr),u="2i";break;case Tn:n.command(Ue(O)&&O.length&&O.length%2===0&&O.length<=F*2,"uniform "+p,a.commandStr),u="2i";break;case On:n.command(Ue(O)&&O.length&&O.length%3===0&&O.length<=F*3,"uniform "+p,a.commandStr),u="3i";break;case Sn:n.command(Ue(O)&&O.length&&O.length%3===0&&O.length<=F*3,"uniform "+p,a.commandStr),u="3i";break;case Rn:n.command(Ue(O)&&O.length&&O.length%4===0&&O.length<=F*4,"uniform "+p,a.commandStr),u="4i";break;case wn:n.command(Ue(O)&&O.length&&O.length%4===0&&O.length<=F*4,"uniform "+p,a.commandStr),u="4i";break}F>1?(u+="v",O=a.global.def("["+Array.prototype.slice.call(O)+"]")):O=Ue(O)?Array.prototype.slice.call(O):O,r(h,".uniform",u,"(",ie,",",O,");")}continue}else D=q.append(a,r)}else{if(!_(Yf))continue;D=r.def(d.uniforms,"[",t.id(p),"]")}R===qt?(n(!Array.isArray(D),"must specify a scalar prop for textures"),r("if(",D,"&&",D,'._reglType==="framebuffer"){',D,"=",D,".color[0];","}")):R===Wt&&(n(!Array.isArray(D),"must specify a scalar prop for cube maps"),r("if(",D,"&&",D,'._reglType==="framebufferCube"){',D,"=",D,".color[0];","}")),n.optional(function(){function Ar(_r,In){a.assert(r,_r,'bad data or missing for uniform "'+p+'".  '+In)}function ct(_r,In){In===1&&n(!Array.isArray(D),"must not specify an array type for uniform"),Ar("Array.isArray("+D+") && typeof "+D+'[0]===" '+_r+'" || typeof '+D+'==="'+_r+'"',"invalid type, expected "+_r)}function Sr(_r,In,Gn){Array.isArray(D)?n(D.length&&D.length%_r===0&&D.length<=_r*Gn,"must have length of "+(Gn===1?"":"n * ")+_r):Ar(d.isArrayLike+"("+D+")&&"+D+".length && "+D+".length % "+_r+" === 0 && "+D+".length<="+_r*Gn,"invalid vector, should have length of "+(Gn===1?"":"n * ")+_r,a.commandStr)}function ro(_r){n(!Array.isArray(D),"must not specify a value type"),Ar("typeof "+D+'==="function"&&'+D+'._reglType==="texture'+(_r===Mf?"2d":"Cube")+'"',"invalid texture type",a.commandStr)}switch(R){case Fa:ct("number",F);break;case Tn:Sr(2,"number",F);break;case Sn:Sr(3,"number",F);break;case wn:Sr(4,"number",F);break;case Ga:ct("number",F);break;case gn:Sr(2,"number",F);break;case An:Sr(3,"number",F);break;case xn:Sr(4,"number",F);break;case Da:ct("boolean",F);break;case Ln:Sr(2,"boolean",F);break;case On:Sr(3,"boolean",F);break;case Rn:Sr(4,"boolean",F);break;case Ht:Sr(4,"number",F);break;case jt:Sr(9,"number",F);break;case Xt:Sr(16,"number",F);break;case qt:ro(Mf);break;case Wt:ro(sl);break}});var Ne=1;switch(R){case qt:case Wt:var hr=r.def(D,"._texture");r(h,".uniform1i(",ie,",",hr,".bind());"),r.exit(hr,".unbind();");continue;case Fa:case Da:u="1i";break;case Tn:case Ln:u="2i",Ne=2;break;case Sn:case On:u="3i",Ne=3;break;case wn:case Rn:u="4i",Ne=4;break;case Ga:u="1f";break;case gn:u="2f",Ne=2;break;case An:u="3f",Ne=3;break;case xn:u="4f",Ne=4;break;case Ht:u="Matrix2fv";break;case jt:u="Matrix3fv";break;case Xt:u="Matrix4fv";break}if(u.indexOf("Matrix")===-1&&F>1&&(u+="v",Ne=1),u.charAt(0)==="M"){r(h,".uniform",u,"(",ie,",");var st=Math.pow(R-Ht+2,2),kr=a.global.def("new Float32Array(",st,")");Array.isArray(D)?r("false,(",Er(st,function(Ar){return kr+"["+Ar+"]="+D[Ar]}),",",kr,")"):r("false,(Array.isArray(",D,")||",D," instanceof Float32Array)?",D,":(",Er(st,function(Ar){return kr+"["+Ar+"]="+D+"["+Ar+"]"}),",",kr,")"),r(");")}else if(Ne>1){for(var Fr=[],qr=[],lt=0;lt<Ne;++lt)Array.isArray(D)?qr.push(D[lt]):qr.push(r.def(D+"["+lt+"]")),m&&Fr.push(r.def());m&&r("if(!",a.batchId,"||",Fr.map(function(Ar,ct){return Ar+"!=="+qr[ct]}).join("||"),"){",Fr.map(function(Ar,ct){return Ar+"="+qr[ct]+";"}).join("")),r(h,".uniform",u,"(",ie,",",qr.join(","),");"),m&&r("}")}else{if(n(!Array.isArray(D),"uniform value must not be an array"),m){var eo=r.def();r("if(!",a.batchId,"||",eo,"!==",D,"){",eo,"=",D,";")}r(h,".uniform",u,"(",ie,",",D,");"),m&&r("}")}}}function ve(a,r,c,v){var _=a.shared,m=_.gl,d=_.draw,h=v.draw;function i(){var le=h.elements,ue,_e=r;return le?((le.contextDep&&v.contextDynamic||le.propDep)&&(_e=c),ue=le.append(a,_e),h.elementsActive&&_e("if("+ue+")"+m+".bindBuffer("+Ia+","+ue+".buffer.buffer);")):(ue=_e.def(),_e(ue,"=",d,".",at,";","if(",ue,"){",m,".bindBuffer(",Ia,",",ue,".buffer.buffer);}","else if(",_.vao,".currentVAO){",ue,"=",a.shared.elements+".getElements("+_.vao,".currentVAO.elements);",N?"":"if("+ue+")"+m+".bindBuffer("+Ia+","+ue+".buffer.buffer);","}")),ue}function u(){var le=h.count,ue,_e=r;return le?((le.contextDep&&v.contextDynamic||le.propDep)&&(_e=c),ue=le.append(a,_e),n.optional(function(){le.MISSING&&a.assert(r,"false","missing vertex count"),le.DYNAMIC&&a.assert(_e,ue+">=0","missing vertex count")})):(ue=_e.def(d,".",ft),n.optional(function(){a.assert(_e,ue+">=0","missing vertex count")})),ue}var f=i();function y(le){var ue=h[le];return ue?ue.contextDep&&v.contextDynamic||ue.propDep?ue.append(a,c):ue.append(a,r):r.def(d,".",le)}var p=y(it),R=y(yn),F=u();if(typeof F=="number"){if(F===0)return}else c("if(",F,"){"),c.exit("}");var q,pe;V&&(q=y(En),pe=a.instancing);var ce=f+".type",ie=h.elements&&Xr(h.elements)&&!h.vaoActive;function D(){function le(){c(pe,".drawElementsInstancedANGLE(",[p,F,ce,R+"<<(("+ce+"-"+pf+")>>1)",q],");")}function ue(){c(pe,".drawArraysInstancedANGLE(",[p,R,F,q],");")}f&&f!=="null"?ie?le():(c("if(",f,"){"),le(),c("}else{"),ue(),c("}")):ue()}function O(){function le(){c(m+".drawElements("+[p,F,ce,R+"<<(("+ce+"-"+pf+")>>1)"]+");")}function ue(){c(m+".drawArrays("+[p,R,F]+");")}f&&f!=="null"?ie?le():(c("if(",f,"){"),le(),c("}else{"),ue(),c("}")):ue()}V&&(typeof q!="number"||q>=0)?typeof q=="string"?(c("if(",q,">0){"),D(),c("}else if(",q,"<0){"),O(),c("}")):D():O()}function Re(a,r,c,v,_){var m=ye(),d=m.proc("body",_);return n.optional(function(){m.commandStr=r.commandStr,m.command=m.link(r.commandStr)}),V&&(m.instancing=d.def(m.shared.extensions,".angle_instanced_arrays")),a(m,d,c,v),m.compile().body}function Ie(a,r,c,v){Ye(a,r),c.useVAO?c.drawVAO?r(a.shared.vao,".setVAO(",c.drawVAO.append(a,r),");"):r(a.shared.vao,".setVAO(",a.shared.vao,".targetVAO);"):(r(a.shared.vao,".setVAO(null);"),mr(a,r,c,v.attributes,function(){return!0})),Fe(a,r,c,v.uniforms,function(){return!0},!1),ve(a,r,r,c)}function Ke(a,r){var c=a.proc("draw",1);Ye(a,c),nr(a,c,r.context),ar(a,c,r.framebuffer),sr(a,c,r),dr(a,c,r.state),Te(a,c,r,!1,!0);var v=r.shader.progVar.append(a,c);if(c(a.shared.gl,".useProgram(",v,".program);"),r.shader.program)Ie(a,c,r,r.shader.program);else{c(a.shared.vao,".setVAO(null);");var _=a.global.def("{}"),m=c.def(v,".id"),d=c.def(_,"[",m,"]");c(a.cond(d).then(d,".call(this,a0);").else(d,"=",_,"[",m,"]=",a.link(function(h){return Re(Ie,a,r,h,1)}),"(",v,");",d,".call(this,a0);"))}Object.keys(r.state).length>0&&c(a.shared.current,".dirty=true;"),a.shared.vao&&c(a.shared.vao,".setVAO(null);")}function Gr(a,r,c,v){a.batchId="a1",Ye(a,r);function _(){return!0}mr(a,r,c,v.attributes,_),Fe(a,r,c,v.uniforms,_,!1),ve(a,r,r,c)}function ut(a,r,c,v){Ye(a,r);var _=c.contextDep,m=r.def(),d="a0",h="a1",i=r.def();a.shared.props=i,a.batchId=m;var u=a.scope(),f=a.scope();r(u.entry,"for(",m,"=0;",m,"<",h,";++",m,"){",i,"=",d,"[",m,"];",f,"}",u.exit);function y(ce){return ce.contextDep&&_||ce.propDep}function p(ce){return!y(ce)}if(c.needsContext&&nr(a,f,c.context),c.needsFramebuffer&&ar(a,f,c.framebuffer),dr(a,f,c.state,y),c.profile&&y(c.profile)&&Te(a,f,c,!1,!0),v)c.useVAO?c.drawVAO?y(c.drawVAO)?f(a.shared.vao,".setVAO(",c.drawVAO.append(a,f),");"):u(a.shared.vao,".setVAO(",c.drawVAO.append(a,u),");"):u(a.shared.vao,".setVAO(",a.shared.vao,".targetVAO);"):(u(a.shared.vao,".setVAO(null);"),mr(a,u,c,v.attributes,p),mr(a,f,c,v.attributes,y)),Fe(a,u,c,v.uniforms,p,!1),Fe(a,f,c,v.uniforms,y,!0),ve(a,u,f,c);else{var R=a.global.def("{}"),F=c.shader.progVar.append(a,f),q=f.def(F,".id"),pe=f.def(R,"[",q,"]");f(a.shared.gl,".useProgram(",F,".program);","if(!",pe,"){",pe,"=",R,"[",q,"]=",a.link(function(ce){return Re(Gr,a,c,ce,2)}),"(",F,");}",pe,".call(this,a0[",m,"],",m,");")}}function o(a,r){var c=a.proc("batch",2);a.batchId="0",Ye(a,c);var v=!1,_=!0;Object.keys(r.context).forEach(function(R){v=v||r.context[R].propDep}),v||(nr(a,c,r.context),_=!1);var m=r.framebuffer,d=!1;m?(m.propDep?v=d=!0:m.contextDep&&v&&(d=!0),d||ar(a,c,m)):ar(a,c,null),r.state.viewport&&r.state.viewport.propDep&&(v=!0);function h(R){return R.contextDep&&v||R.propDep}sr(a,c,r),dr(a,c,r.state,function(R){return!h(R)}),(!r.profile||!h(r.profile))&&Te(a,c,r,!1,"a1"),r.contextDep=v,r.needsContext=_,r.needsFramebuffer=d;var i=r.shader.progVar;if(i.contextDep&&v||i.propDep)ut(a,c,r,null);else{var u=i.append(a,c);if(c(a.shared.gl,".useProgram(",u,".program);"),r.shader.program)ut(a,c,r,r.shader.program);else{c(a.shared.vao,".setVAO(null);");var f=a.global.def("{}"),y=c.def(u,".id"),p=c.def(f,"[",y,"]");c(a.cond(p).then(p,".call(this,a0,a1);").else(p,"=",f,"[",y,"]=",a.link(function(R){return Re(ut,a,r,R,2)}),"(",u,");",p,".call(this,a0,a1);"))}}Object.keys(r.state).length>0&&c(a.shared.current,".dirty=true;"),a.shared.vao&&c(a.shared.vao,".setVAO(null);")}function S(a,r){var c=a.proc("scope",3);a.batchId="a2";var v=a.shared,_=v.current;nr(a,c,r.context),r.framebuffer&&r.framebuffer.append(a,c),Wf(Object.keys(r.state)).forEach(function(d){var h=r.state[d],i=h.append(a,c);Ue(i)?i.forEach(function(u,f){c.set(a.next[d],"["+f+"]",u)}):c.set(v.next,"."+d,i)}),Te(a,c,r,!0,!0),[at,yn,ft,En,it].forEach(function(d){var h=r.draw[d];h&&c.set(v.draw,"."+d,""+h.append(a,c))}),Object.keys(r.uniforms).forEach(function(d){var h=r.uniforms[d].append(a,c);Array.isArray(h)&&(h="["+h.join()+"]"),c.set(v.uniforms,"["+t.id(d)+"]",h)}),Object.keys(r.attributes).forEach(function(d){var h=r.attributes[d].append(a,c),i=a.scopeAttrib(d);Object.keys(new b).forEach(function(u){c.set(i,"."+u,h[u])})}),r.scopeVAO&&c.set(v.vao,".targetVAO",r.scopeVAO.append(a,c));function m(d){var h=r.shader[d];h&&c.set(v.shader,"."+d,h.append(a,c))}m(Ut),m(Vt),Object.keys(r.state).length>0&&(c(_,".dirty=true;"),c.exit(_,".dirty=true;")),c("a1(",a.shared.context,",a0,",a.batchId,");")}function g(a){if(!(typeof a!="object"||Ue(a))){for(var r=Object.keys(a),c=0;c<r.length;++c)if(yr.isDynamic(a[r[c]]))return!0;return!1}}function fe(a,r,c){var v=r.static[c];if(!v||!g(v))return;var _=a.global,m=Object.keys(v),d=!1,h=!1,i=!1,u=a.global.def("{}");m.forEach(function(y){var p=v[y];if(yr.isDynamic(p)){typeof p=="function"&&(p=v[y]=yr.unbox(p));var R=br(p,null);d=d||R.thisDep,i=i||R.propDep,h=h||R.contextDep}else{switch(_(u,".",y,"="),typeof p){case"number":_(p);break;case"string":_('"',p,'"');break;case"object":Array.isArray(p)&&_("[",p.join(),"]");break;default:_(a.link(p));break}_(";")}});function f(y,p){m.forEach(function(R){var F=v[R];if(yr.isDynamic(F)){var q=y.invoke(p,F);p(u,".",R,"=",q,";")}})}r.dynamic[c]=new yr.DynamicVariable(_n,{thisDep:d,contextDep:h,propDep:i,ref:u,append:f}),delete r.static[c]}function Le(a,r,c,v,_){var m=ye();m.stats=m.link(_),Object.keys(r.static).forEach(function(h){fe(m,r,h)}),fl.forEach(function(h){fe(m,a,h)});var d=$e(a,r,c,v,m);return Ke(m,d),S(m,d),o(m,d),P(m.compile(),{destroy:function(){d.shader.program.destroy()}})}return{next:$,current:re,procs:function(){var a=ye(),r=a.proc("poll"),c=a.proc("refresh"),v=a.block();r(v),c(v);var _=a.shared,m=_.gl,d=_.next,h=_.current;v(h,".dirty=false;"),ar(a,r),ar(a,c,null,!0);var i;V&&(i=a.link(V)),l.oes_vertex_array_object&&c(a.link(l.oes_vertex_array_object),".bindVertexArrayOES(null);");for(var u=0;u<T.maxAttributes;++u){var f=c.def(_.attributes,"[",u,"]"),y=a.cond(f,".buffer");y.then(m,".enableVertexAttribArray(",u,");",m,".bindBuffer(",wt,",",f,".buffer.buffer);",m,".vertexAttribPointer(",u,",",f,".size,",f,".type,",f,".normalized,",f,".stride,",f,".offset);").else(m,".disableVertexAttribArray(",u,");",m,".vertexAttrib4f(",u,",",f,".x,",f,".y,",f,".z,",f,".w);",f,".buffer=null;"),c(y),V&&c(i,".vertexAttribDivisorANGLE(",u,",",f,".divisor);")}return c(a.shared.vao,".currentVAO=null;",a.shared.vao,".setVAO(",a.shared.vao,".targetVAO);"),Object.keys(G).forEach(function(p){var R=G[p],F=v.def(d,".",p),q=a.block();q("if(",F,"){",m,".enable(",R,")}else{",m,".disable(",R,")}",h,".",p,"=",F,";"),c(q),r("if(",F,"!==",h,".",p,"){",q,"}")}),Object.keys(C).forEach(function(p){var R=C[p],F=re[p],q,pe,ce=a.block();if(ce(m,".",R,"("),Ue(F)){var ie=F.length;q=a.global.def(d,".",p),pe=a.global.def(h,".",p),ce(Er(ie,function(D){return q+"["+D+"]"}),");",Er(ie,function(D){return pe+"["+D+"]="+q+"["+D+"];"}).join("")),r("if(",Er(ie,function(D){return q+"["+D+"]!=="+pe+"["+D+"]"}).join("||"),"){",ce,"}")}else q=v.def(d,".",p),pe=v.def(h,".",p),ce(q,");",h,".",p,"=",q,";"),r("if(",q,"!==",pe,"){",ce,"}");c(ce)}),a.compile()}(),compile:Le}}function Sl(){return{vaoCount:0,bufferCount:0,elementsCount:0,framebufferCount:0,shaderCount:0,textureCount:0,cubeCount:0,renderbufferCount:0,maxTextureUnits:0}}var wl=34918,Ll=34919,Kf=35007,Ol=function(e,t){if(!t.ext_disjoint_timer_query)return null;var l=[];function T(){return l.pop()||t.ext_disjoint_timer_query.createQueryEXT()}function I(V){l.push(V)}var x=[];function L(V){var ae=T();t.ext_disjoint_timer_query.beginQueryEXT(Kf,ae),x.push(ae),M(x.length-1,x.length,V)}function k(){t.ext_disjoint_timer_query.endQueryEXT(Kf)}function B(){this.startQueryIndex=-1,this.endQueryIndex=-1,this.sum=0,this.stats=null}var H=[];function X(){return H.pop()||new B}function j(V){H.push(V)}var Y=[];function M(V,ae,N){var re=X();re.startQueryIndex=V,re.endQueryIndex=ae,re.sum=0,re.stats=N,Y.push(re)}var z=[],b=[];function w(){var V,ae,N=x.length;if(N!==0){b.length=Math.max(b.length,N+1),z.length=Math.max(z.length,N+1),z[0]=0,b[0]=0;var re=0;for(V=0,ae=0;ae<x.length;++ae){var $=x[ae];t.ext_disjoint_timer_query.getQueryObjectEXT($,Ll)?(re+=t.ext_disjoint_timer_query.getQueryObjectEXT($,wl),I($)):x[V++]=$,z[ae+1]=re,b[ae+1]=V}for(x.length=V,V=0,ae=0;ae<Y.length;++ae){var me=Y[ae],G=me.startQueryIndex,C=me.endQueryIndex;me.sum+=z[C]-z[G];var oe=b[G],K=b[C];K===oe?(me.stats.gpuTime+=me.sum/1e6,j(me)):(me.startQueryIndex=oe,me.endQueryIndex=K,Y[V++]=me)}Y.length=V}}return{beginQuery:L,endQuery:k,pushScopeStats:M,update:w,getNumPendingQueries:function(){return x.length},clear:function(){l.push.apply(l,x);for(var V=0;V<l.length;V++)t.ext_disjoint_timer_query.deleteQueryEXT(l[V]);x.length=0,l.length=0},restore:function(){x.length=0,l.length=0}}},Rl=16384,Cl=256,Il=1024,Gl=34962,Qf="webglcontextlost",Zf="webglcontextrestored",Jf=1,Fl=2,Dl=3;function $f(e,t){for(var l=0;l<e.length;++l)if(e[l]===t)return l;return-1}function Nl(e){var t=Fo(e);if(!t)return null;var l=t.gl,T=l.getContextAttributes(),I=l.isContextLost(),x=Do(l,t);if(!x)return null;var L=Oo(),k=Sl(),B=x.extensions,H=Ol(l,B),X=fi(),j=l.drawingBufferWidth,Y=l.drawingBufferHeight,M={tick:0,time:0,viewportWidth:j,viewportHeight:Y,framebufferWidth:j,framebufferHeight:Y,drawingBufferWidth:j,drawingBufferHeight:Y,pixelRatio:t.pixelRatio},z={},b={elements:null,primitive:4,count:-1,offset:0,instances:-1},w=gu(l,B),V=Bu(l,k,t,re),ae=Ku(l,B,V,k),N=Ks(l,B,w,k,V,ae,b);function re(ve){return N.destroyBuffer(ve)}var $=$s(l,L,k,t),me=ws(l,B,w,function(){oe.procs.poll()},M,k,t),G=Ls(l,B,w,k,t),C=Ws(l,B,w,me,G,k),oe=Tl(l,L,B,w,V,ae,me,C,z,N,$,b,M,H,t),K=tl(l,C,oe.procs.poll,M,T,B,w),U=oe.next,Q=l.canvas,J=[],Ee=[],ye=[],ee=[t.onDestroy],te=null;function be(){if(J.length===0){H&&H.update(),te=null;return}te=Vn.next(be),dr();for(var ve=J.length-1;ve>=0;--ve){var Re=J[ve];Re&&Re(M,null,0)}l.flush(),H&&H.update()}function ge(){!te&&J.length>0&&(te=Vn.next(be))}function Oe(){te&&(Vn.cancel(be),te=null)}function Ve(ve){ve.preventDefault(),I=!0,Oe(),Ee.forEach(function(Re){Re()})}function ze(ve){l.getError(),I=!1,x.restore(),$.restore(),V.restore(),me.restore(),G.restore(),C.restore(),N.restore(),H&&H.restore(),oe.procs.refresh(),ge(),ye.forEach(function(Re){Re()})}Q&&(Q.addEventListener(Qf,Ve,!1),Q.addEventListener(Zf,ze,!1));function Ce(){J.length=0,Oe(),Q&&(Q.removeEventListener(Qf,Ve),Q.removeEventListener(Zf,ze)),$.clear(),C.clear(),G.clear(),N.clear(),me.clear(),ae.clear(),V.clear(),H&&H.clear(),ee.forEach(function(ve){ve()})}function tr(ve){n(!!ve,"invalid args to regl({...})"),n.type(ve,"object","invalid args to regl({...})");function Re(_){var m=P({},_);delete m.uniforms,delete m.attributes,delete m.context,delete m.vao,"stencil"in m&&m.stencil.op&&(m.stencil.opBack=m.stencil.opFront=m.stencil.op,delete m.stencil.op);function d(h){if(h in m){var i=m[h];delete m[h],Object.keys(i).forEach(function(u){m[h+"."+u]=i[u]})}}return d("blend"),d("depth"),d("cull"),d("stencil"),d("polygonOffset"),d("scissor"),d("sample"),"vao"in _&&(m.vao=_.vao),m}function Ie(_,m){var d={},h={};return Object.keys(_).forEach(function(i){var u=_[i];if(yr.isDynamic(u)){h[i]=yr.unbox(u,i);return}else if(m&&Array.isArray(u)){for(var f=0;f<u.length;++f)if(yr.isDynamic(u[f])){h[i]=yr.unbox(u,i);return}}d[i]=u}),{dynamic:h,static:d}}var Ke=Ie(ve.context||{},!0),Gr=Ie(ve.uniforms||{},!0),ut=Ie(ve.attributes||{},!1),o=Ie(Re(ve),!1),S={gpuTime:0,cpuTime:0,count:0},g=oe.compile(o,ut,Gr,Ke,S),fe=g.draw,Le=g.batch,a=g.scope,r=[];function c(_){for(;r.length<_;)r.push(null);return r}function v(_,m){var d;if(I&&n.raise("context lost"),typeof _=="function")return a.call(this,null,_,0);if(typeof m=="function")if(typeof _=="number")for(d=0;d<_;++d)a.call(this,null,m,d);else if(Array.isArray(_))for(d=0;d<_.length;++d)a.call(this,_[d],m,d);else return a.call(this,_,m,0);else if(typeof _=="number"){if(_>0)return Le.call(this,c(_|0),_|0)}else if(Array.isArray(_)){if(_.length)return Le.call(this,_,_.length)}else return fe.call(this,_)}return P(v,{stats:S,destroy:function(){g.destroy()}})}var ke=C.setFBO=tr({framebuffer:yr.define.call(null,Jf,"framebuffer")});function $e(ve,Re){var Ie=0;oe.procs.poll();var Ke=Re.color;Ke&&(l.clearColor(+Ke[0]||0,+Ke[1]||0,+Ke[2]||0,+Ke[3]||0),Ie|=Rl),"depth"in Re&&(l.clearDepth(+Re.depth),Ie|=Cl),"stencil"in Re&&(l.clearStencil(Re.stencil|0),Ie|=Il),n(!!Ie,"called regl.clear with no buffer specified"),l.clear(Ie)}function nr(ve){if(n(typeof ve=="object"&&ve,"regl.clear() takes an object as input"),"framebuffer"in ve)if(ve.framebuffer&&ve.framebuffer_reglType==="framebufferCube")for(var Re=0;Re<6;++Re)ke(P({framebuffer:ve.framebuffer.faces[Re]},ve),$e);else ke(ve,$e);else $e(null,ve)}function ar(ve){n.type(ve,"function","regl.frame() callback must be a function"),J.push(ve);function Re(){var Ie=$f(J,ve);n(Ie>=0,"cannot cancel a frame twice");function Ke(){var Gr=$f(J,Ke);J[Gr]=J[J.length-1],J.length-=1,J.length<=0&&Oe()}J[Ie]=Ke}return ge(),{cancel:Re}}function sr(){var ve=U.viewport,Re=U.scissor_box;ve[0]=ve[1]=Re[0]=Re[1]=0,M.viewportWidth=M.framebufferWidth=M.drawingBufferWidth=ve[2]=Re[2]=l.drawingBufferWidth,M.viewportHeight=M.framebufferHeight=M.drawingBufferHeight=ve[3]=Re[3]=l.drawingBufferHeight}function dr(){M.tick+=1,M.time=Te(),sr(),oe.procs.poll()}function Ye(){me.refresh(),sr(),oe.procs.refresh(),H&&H.update()}function Te(){return(fi()-X)/1e3}Ye();function mr(ve,Re){n.type(Re,"function","listener callback must be a function");var Ie;switch(ve){case"frame":return ar(Re);case"lost":Ie=Ee;break;case"restore":Ie=ye;break;case"destroy":Ie=ee;break;default:n.raise("invalid event, must be one of frame,lost,restore,destroy")}return Ie.push(Re),{cancel:function(){for(var Ke=0;Ke<Ie.length;++Ke)if(Ie[Ke]===Re){Ie[Ke]=Ie[Ie.length-1],Ie.pop();return}}}}var Fe=P(tr,{clear:nr,prop:yr.define.bind(null,Jf),context:yr.define.bind(null,Fl),this:yr.define.bind(null,Dl),draw:tr({}),buffer:function(ve){return V.create(ve,Gl,!1,!1)},elements:function(ve){return ae.create(ve,!1)},texture:me.create2D,cube:me.createCube,renderbuffer:G.create,framebuffer:C.create,framebufferCube:C.createCube,vao:N.createVAO,attributes:T,frame:ar,on:mr,limits:w,hasExtension:function(ve){return w.extensions.indexOf(ve.toLowerCase())>=0},read:K,destroy:Ce,_gl:l,_refresh:Ye,poll:function(){dr(),H&&H.update()},now:Te,stats:k});return t.onDone(null,Fe),Fe}return Nl})})(vo);var ql=vo.exports;const kd=Qt(ql);/*!
 * strip-comments <https://github.com/jonschlinkert/strip-comments>
 *
 * Copyright (c) 2014-2015 Jon Schlinkert.
 * Licensed under the MIT license.
 */var Wl=/\/\*(?!\/)(.|[\r\n]|\n)+?\*\/\n?\n?/gm,Yl=/\/\*(?!(\*?\/|\*?\!))(.|[\r\n]|\n)+?\*\/\n?\n?/gm,Kl=/(^|[^\S\n])(?:\/\/)([\s\S]+?)$/gm,Ql=/(^|[^\S\n])(?:\/\/[^!])([\s\S]+?)$/gm;function Kt(s,E){return s?Kt.block(Kt.line(s,E),E):""}Kt.block=function(s,E){E=E||{};var A=Wl;return E.safe&&(A=Yl),s?s.replace(A,""):""};Kt.line=function(s,E){E=E||{};var A=Kl;return E.safe&&(A=Ql),s?s.replace(A,""):""};var Zl=Kt;const Jl=Qt(Zl);function $l(s,E,A){return s*(1-A)+E*A}var ec=$l;const rc=Qt(ec);function tc(s){for(var E=!1,A=0;A<s.length;A++){var P=s.charAt(A);E&&/[a-zA-Z]/.test(P)&&P.toUpperCase()===P?(s=s.substr(0,A)+"-"+s.substr(A),E=!1,A++):E=P.toLowerCase()===P}return s}var nc=function(){var s=[].map.call(arguments,function(E){return E.trim()}).filter(function(E){return E.length}).join("-");return s.length?s.length===1?s.toLowerCase():/[_.\- ]+/.test(s)?(s=tc(s),s.replace(/^[_.\- ]+/,"").toLowerCase().replace(/[_.\- ]+(\w|$)/g,function(E,A){return A.toUpperCase()})):s===s.toUpperCase()?s.toLowerCase():s[0]!==s[0].toLowerCase()?s[0].toLowerCase()+s.slice(1):s:""};const Qa=Qt(nc);function ac(s){var E=2.5949095;return(s*=2)<1?.5*(s*s*((E+1)*s-E)):.5*((s-=2)*s*((E+1)*s+E)+2)}var ic=ac;function fc(s){var E=1.70158;return s*s*((E+1)*s-E)}var oc=fc;function uc(s){var E=1.70158;return--s*s*((E+1)*s+E)+1}var sc=uc;function lc(s){var E=.36363636363636365,A=8/11,P=9/10,W=4356/361,he=35442/1805,ne=16061/1805,Z=s*s;return s<E?7.5625*Z:s<A?9.075*Z-9.9*s+3.4:s<P?W*Z-he*s+ne:10.8*s*s-20.52*s+10.72}var Za=lc,io=Za;function cc(s){return s<.5?.5*(1-io(1-s*2)):.5*io(s*2-1)+.5}var dc=cc,mc=Za;function hc(s){return 1-mc(1-s)}var vc=hc;function bc(s){return(s*=2)<1?-.5*(Math.sqrt(1-s*s)-1):.5*(Math.sqrt(1-(s-=2)*s)+1)}var _c=bc;function pc(s){return 1-Math.sqrt(1-s*s)}var yc=pc;function Ec(s){return Math.sqrt(1- --s*s)}var gc=Ec;function Ac(s){return s<.5?4*s*s*s:.5*Math.pow(2*s-2,3)+1}var xc=Ac;function Tc(s){return s*s*s}var Sc=Tc;function wc(s){var E=s-1;return E*E*E+1}var Lc=wc;function Oc(s){return s<.5?.5*Math.sin(13*Math.PI/2*2*s)*Math.pow(2,10*(2*s-1)):.5*Math.sin(-13*Math.PI/2*(2*s-1+1))*Math.pow(2,-10*(2*s-1))+1}var Rc=Oc;function Cc(s){return Math.sin(13*s*Math.PI/2)*Math.pow(2,10*(s-1))}var Ic=Cc;function Gc(s){return Math.sin(-13*(s+1)*Math.PI/2)*Math.pow(2,-10*s)+1}var Fc=Gc;function Dc(s){return s===0||s===1?s:s<.5?.5*Math.pow(2,20*s-10):-.5*Math.pow(2,10-s*20)+1}var Nc=Dc;function Pc(s){return s===0?s:Math.pow(2,10*(s-1))}var Bc=Pc;function kc(s){return s===1?s:1-Math.pow(2,-10*s)}var Mc=kc;function Uc(s){return s}var Vc=Uc;function zc(s){return s/=.5,s<1?.5*s*s:(s--,-.5*(s*(s-2)-1))}var Hc=zc;function jc(s){return s*s}var Xc=jc;function qc(s){return-s*(s-2)}var Wc=qc;function Yc(s){return s<.5?8*Math.pow(s,4):-8*Math.pow(s-1,4)+1}var Kc=Yc;function Qc(s){return Math.pow(s,4)}var Zc=Qc;function Jc(s){return Math.pow(s-1,3)*(1-s)+1}var $c=Jc;function ed(s){return(s*=2)<1?.5*s*s*s*s*s:.5*((s-=2)*s*s*s*s+2)}var rd=ed;function td(s){return s*s*s*s*s}var nd=td;function ad(s){return--s*s*s*s*s+1}var id=ad;function fd(s){return-.5*(Math.cos(Math.PI*s)-1)}var od=fd;function ud(s){var E=Math.cos(s*Math.PI*.5);return Math.abs(E)<1e-14?1:1-E}var sd=ud;function ld(s){return Math.sin(s*Math.PI/2)}var cd=ld,dd={backInOut:ic,backIn:oc,backOut:sc,bounceInOut:dc,bounceIn:vc,bounceOut:Za,circInOut:_c,circIn:yc,circOut:gc,cubicInOut:xc,cubicIn:Sc,cubicOut:Lc,elasticInOut:Rc,elasticIn:Ic,elasticOut:Fc,expoInOut:Nc,expoIn:Bc,expoOut:Mc,linear:Vc,quadInOut:Hc,quadIn:Xc,quadOut:Wc,quartInOut:Kc,quartIn:Zc,quartOut:$c,quintInOut:rd,quintIn:nd,quintOut:id,sineInOut:od,sineIn:sd,sineOut:cd};const md=Qt(dd),hd=`#define GLSLIFY 1
#ifndef PI
#define PI 3.141592653589793
#endif

float backOut_1(float t) {
  float f = t < 0.5
    ? 2.0 * t
    : 1.0 - (2.0 * t - 1.0);

  float g = pow(f, 3.0) - f * sin(f * PI);

  return t < 0.5
    ? 0.5 * g
    : 0.5 * (1.0 - g) + 0.5;
}

#ifndef PI
#define PI 3.141592653589793
#endif

float backIn(float t) {
  return pow(t, 3.0) - t * sin(t * PI);
}

#ifndef PI
#define PI 3.141592653589793
#endif

float backOut_0(float t) {
  float f = 1.0 - t;
  return 1.0 - (pow(f, 3.0) - f * sin(f * PI));
}

#ifndef PI
#define PI 3.141592653589793
#endif

float bounceOut(float t) {
  const float a = 4.0 / 11.0;
  const float b = 8.0 / 11.0;
  const float c = 9.0 / 10.0;

  const float ca = 4356.0 / 361.0;
  const float cb = 35442.0 / 1805.0;
  const float cc = 16061.0 / 1805.0;

  float t2 = t * t;

  return t < a
    ? 7.5625 * t2
    : t < b
      ? 9.075 * t2 - 9.9 * t + 3.4
      : t < c
        ? ca * t2 - cb * t + cc
        : 10.8 * t * t - 20.52 * t + 10.72;
}

float bounceInOut(float t) {
  return t < 0.5
    ? 0.5 * (1.0 - bounceOut(1.0 - t * 2.0))
    : 0.5 * bounceOut(t * 2.0 - 1.0) + 0.5;
}

float bounceIn(float t) {
  return 1.0 - bounceOut(1.0 - t);
}

float circularInOut(float t) {
  return t < 0.5
    ? 0.5 * (1.0 - sqrt(1.0 - 4.0 * t * t))
    : 0.5 * (sqrt((3.0 - 2.0 * t) * (2.0 * t - 1.0)) + 1.0);
}

float circularIn(float t) {
  return 1.0 - sqrt(1.0 - t * t);
}

float circularOut(float t) {
  return sqrt((2.0 - t) * t);
}

float cubicInOut(float t) {
  return t < 0.5
    ? 4.0 * t * t * t
    : 0.5 * pow(2.0 * t - 2.0, 3.0) + 1.0;
}

float cubicIn(float t) {
  return t * t * t;
}

float cubicOut(float t) {
  float f = t - 1.0;
  return f * f * f + 1.0;
}

#ifndef HALF_PI
#define HALF_PI 1.5707963267948966
#endif

float elasticInOut(float t) {
  return t < 0.5
    ? 0.5 * sin(+13.0 * HALF_PI * 2.0 * t) * pow(2.0, 10.0 * (2.0 * t - 1.0))
    : 0.5 * sin(-13.0 * HALF_PI * ((2.0 * t - 1.0) + 1.0)) * pow(2.0, -10.0 * (2.0 * t - 1.0)) + 1.0;
}

#ifndef HALF_PI
#define HALF_PI 1.5707963267948966
#endif

float elasticIn(float t) {
  return sin(13.0 * t * HALF_PI) * pow(2.0, 10.0 * (t - 1.0));
}

#ifndef HALF_PI
#define HALF_PI 1.5707963267948966
#endif

float elasticOut(float t) {
  return sin(-13.0 * (t + 1.0) * HALF_PI) * pow(2.0, -10.0 * t) + 1.0;
}

float exponentialInOut(float t) {
  return t == 0.0 || t == 1.0
    ? t
    : t < 0.5
      ? +0.5 * pow(2.0, (20.0 * t) - 10.0)
      : -0.5 * pow(2.0, 10.0 - (t * 20.0)) + 1.0;
}

float exponentialIn(float t) {
  return t == 0.0 ? t : pow(2.0, 10.0 * (t - 1.0));
}

float exponentialOut(float t) {
  return t == 1.0 ? t : 1.0 - pow(2.0, -10.0 * t);
}

float linear(float t) {
  return t;
}

float quadraticInOut(float t) {
  float p = 2.0 * t * t;
  return t < 0.5 ? p : -p + (4.0 * t) - 1.0;
}

float quadraticIn(float t) {
  return t * t;
}

float quadraticOut(float t) {
  return -t * (t - 2.0);
}

float quarticInOut(float t) {
  return t < 0.5
    ? +8.0 * pow(t, 4.0)
    : -8.0 * pow(t - 1.0, 4.0) + 1.0;
}

float quarticIn(float t) {
  return pow(t, 4.0);
}

float quarticOut(float t) {
  return pow(t - 1.0, 3.0) * (1.0 - t) + 1.0;
}

float qinticInOut(float t) {
  return t < 0.5
    ? +16.0 * pow(t, 5.0)
    : -0.5 * pow(2.0 * t - 2.0, 5.0) + 1.0;
}

float qinticIn(float t) {
  return pow(t, 5.0);
}

float qinticOut(float t) {
  return 1.0 - (pow(t - 1.0, 5.0));
}

#ifndef PI
#define PI 3.141592653589793
#endif

float sineInOut(float t) {
  return -0.5 * (cos(PI * t) - 1.0);
}

#ifndef HALF_PI
#define HALF_PI 1.5707963267948966
#endif

float sineIn(float t) {
  return sin((t - 1.0) * HALF_PI) + 1.0;
}

#ifndef HALF_PI
#define HALF_PI 1.5707963267948966
#endif

float sineOut(float t) {
  return sin(t * HALF_PI);
}`;var vd=[["quad-","quadratic-"],["circ-","circular-"],["expo-","exponential-"],["quart-","quartic-"],["quint-","quintic-"]],bd=function(s){return Qa(s)},_d=function(s){return vd.forEach(function(E){s=s.replace(E[0],E[1])}),Qa(s)},pd=function(s){return md[Qa(s)]},yd=function(s){return hd};const Ua={getEasingFunction:pd,getEasingName:bd,getShaderEasings:yd,getGLSLEasingName:_d};var Nn="_rtb",bo=function(s,E){return Nn+"_"+E+"_previous_"+s},Ed=function(s,E){return Nn+"_"+E+"_current_"+s},_o=function(s,E){return Nn+"_"+E+"_next_"+s},po=function(s,E){return Nn+"_"+E+"_t_"+s},gd=function(s,E,A,P){var W=Ua.getGLSLEasingName(P),he=Ua.getShaderEasings();E=Jl(E);var ne=bo(s,A),Z=_o(s,A),de=Ed(s,A),Me=po(s,A),He=new RegExp(";([^;]*"+s+"[^;]*;)"),Be=E.match(He);if(!Be||Be.length<2)return E;var Ae=Be[1],we=Ae.replace(s,ne),Ge=Ae.replace(s,Z),je=`
`+Ae.replace(s,de).replace("attribute","").replace("uniform","").trim(),Xe=`
uniform float `+Me+";",We=we+Ge+je+Xe;if(E=E.replace(Ae,We),He=new RegExp("main\\s*\\(\\s*\\)\\s*{"),Be=E.match(He),Be&&Be.length){var De=de+" = mix("+ne+", "+Z+", "+W+"("+Me+"));";E=E.replace(Be[0],Be[0]+`
  `+De)}return He=new RegExp("\\b"+s+"\\b","g"),E=E.replace(He,de),E=he+`
`+E,E},fo=function(s,E){this.data=s,this.previousData=s,this.defaultOptions=Object.assign({},{duration:750,ease:"quad-in-out"},E||{}),this.options={...this.defaultOptions}};function Md(s){var E=function(A){if(A.uniforms=A.uniforms||{},A.attributes=A.attributes||{},A.vert=A.vert||"",A.frag=A.frag||"",!A.vert||!A.frag)throw new Error("Must provide vert and frag shaders!");var P={uniforms:[],attributes:[]},W={uniforms:{},attributes:{}},he={uniforms:{},attributes:{}},ne={uniforms:{},attributes:{}},Z={uniforms:{},attributes:{}},de={uniforms:{},attributes:{}},Me=function(Ae,we=null){var Ge=ne[this.type][this.key];if(we&&(this.options=Object.assign({},this.defaultOptions,we)),console.log("buffer update",we,this.defaultOptions,this.options),Ge<1){var je=Ua.getEasingFunction(this.options.ease)(Ge),Xe=this.previousData;this.previousData=this.data.map(function(We,De){return We.map(function(er,rr){return rc(Xe[De][rr],er,je)})})}else this.previousData=this.data;this.data=Ae,W[this.type][this.key].previous({usage:"dynamic",data:this.previousData}),W[this.type][this.key].next({usage:"dynamic",data:Ae}),Z[this.type][this.key]=!0},He=function(Ae){Object.keys(A[Ae]||{}).filter(function(we){return A[Ae][we]instanceof fo}).map(function(we){P[Ae].push(we);var Ge=A[Ae][we];Ge.type=Ae,Ge.key=we,Ge.update=Me,he[Ae][we]=Ge,ne[Ae][we]=1,Z[Ae][we]=!1,W[Ae][we]={previous:s.buffer({usage:"dynamic",data:Ge.data}),next:s.buffer({usage:"dynamic",data:Ge.data})}})};He("attributes"),He("uniforms");var Be=function(Ae){P[Ae].forEach(function(we){var Ge=he[Ae][we];A.vert=gd(we,A.vert||"",Ae,Ge.options.ease),delete A.attributes[we],A[Ae][bo(we,Ae)]=W[Ae][we].previous,A[Ae][_o(we,Ae)]=W[Ae][we].next,A.uniforms[po(we,Ae)]=function(je,Xe,We){Z[Ae][we]&&(ne[Ae][we]=0,de[Ae][we]=je.time);var De=de[Ae][we],er=ne[Ae][we];return er<1&&(er=Math.min(1,1e3*(je.time-De)/Ge.options.duration)),ne[Ae][we]=er,Z[Ae][we]=!1,er}})};return Be("attributes"),Be("uniforms"),s(A)};return E.buffer=function(A,P){return new fo(A,P)},E}const{document:oo}=Xl;function uo(s){let E;const A=s[19].default,P=ja(A,s,s[18],null);return{c(){P&&P.c()},l(W){P&&P.l(W)},m(W,he){P&&P.m(W,he),E=!0},p(W,he){P&&P.p&&(!E||he&262144)&&Xa(P,A,W,W[18],E?Wa(A,W[18],he,null):qa(W[18]),null)},i(W){E||(Mr(P,W),E=!0)},o(W){dt(P,W),E=!1},d(W){P&&P.d(W)}}}function Ad(s){let E,A,P,W,he,ne=s[3]&&uo(s);return{c(){E=to("link"),P=Bl(),W=to("div"),ne&&ne.c(),this.h()},l(Z){const de=kl("svelte-12hmray",oo.head);E=no(de,"LINK",{rel:!0,href:!0}),de.forEach(Rt),P=Ml(Z),W=no(Z,"DIV",{id:!0,class:!0});var Me=Ul(W);ne&&ne.l(Me),Me.forEach(Rt),this.h()},h(){Ot(E,"rel","stylesheet"),Ot(E,"href",A=s[1]?s[1]:"https://unpkg.com/maplibre-gl@3.3.1/dist/maplibre-gl.css"),Ot(W,"id",s[0]),Ot(W,"class","map svelte-1tna482")},m(Z,de){Vl(oo.head,E),ka(Z,P,de),ka(Z,W,de),ne&&ne.m(W,null),s[20](W),he=!0},p(Z,[de]){(!he||de&2&&A!==(A=Z[1]?Z[1]:"https://unpkg.com/maplibre-gl@3.3.1/dist/maplibre-gl.css"))&&Ot(E,"href",A),Z[3]?ne?(ne.p(Z,de),de&8&&Mr(ne,1)):(ne=uo(Z),ne.c(),Mr(ne,1),ne.m(W,null)):ne&&(mo(),dt(ne,1,1,()=>{ne=null}),ho()),(!he||de&1)&&Ot(W,"id",Z[0])},i(Z){he||(Mr(ne),he=!0)},o(Z){dt(ne),he=!1},d(Z){Z&&(Rt(P),Rt(W)),Rt(E),ne&&ne.d(),s[20](null)}}}function xd(s=1e3){return new Promise(E=>setTimeout(E,s))}function Td(s,E,A){let{$$slots:P={},$$scope:W}=E;const he=co();let{map:ne}=E,{id:Z="map"}=E,{location:de={lng:15,lat:45,zoom:1}}=E,{style:Me={version:8,sources:{},layers:[{id:"background",type:"background",paint:{"background-color":"lightgrey"}}]}}=E,{css:He=null}=E,{options:Be={}}=E,{minzoom:Ae=0}=E,{maxzoom:we=14}=E,{controls:Ge=!1}=E,{tabbable:je=!1}=E,{zoom:Xe=null}=E,{center:We=null}=E,{pitch:De=null}=E,{bearing:er=null}=E,{interactive:rr=!0}=E,{attribution:lr=!0}=E,qe,or={},xe=!1;Dn("map",{getMap:()=>ne}),de.bounds?or.bounds=de.bounds:de.lng&&de.lat&&(or.center=[+de.lng,+de.lat],de.zoom&&(or.zoom=+de.zoom),de.pitch&&(or.pitch=+de.pitch),de.bearing&&(or.bearing=+de.bearing)),lr||(or.attributionControl=!1),or={...or,...Be},za(()=>{A(4,ne=new Fn.Map({container:qe,style:Me,minZoom:Ae,maxZoom:we,interactive:rr,...or})),Ge&&!Array.isArray(Ge)?ne.addControl(new Fn.NavigationControl({showCompass:!1})):Array.isArray(Ge)&&Ge!=["locate"]&&ne.addControl(new Fn.NavigationControl({showCompass:Ge.includes("compass"),visualizePitch:Ge.includes("pitch")})),Array.isArray(Ge)&&Ge.includes("locate")&&ne.addControl(new Fn.GeolocateControl),ne.on("load",Se=>{A(5,Xe=ne.getZoom()),A(6,We=ne.getCenter()),A(7,De=ne.getPitch()),A(8,er=ne.getBearing()),A(3,xe=!0),!je&&document.querySelector(`#${Z} canvas`)&&(document.querySelector(`#${Z} canvas`).tabIndex="-1"),he("load",{event:Se})}),ne.on("moveend",()=>{A(5,Xe=ne.getZoom()),A(6,We=ne.getCenter()),A(7,De=ne.getPitch()),A(8,er=ne.getBearing())})}),Ha(async()=>{await xd(250),ne&&ne.remove(),A(4,ne=null)});function ir(Se){ne&&ne.setStyle(Se),he("style",{style:Se})}function Wr(Se){zl[Se?"unshift":"push"](()=>{qe=Se,A(2,qe)})}return s.$$set=Se=>{"map"in Se&&A(4,ne=Se.map),"id"in Se&&A(0,Z=Se.id),"location"in Se&&A(9,de=Se.location),"style"in Se&&A(10,Me=Se.style),"css"in Se&&A(1,He=Se.css),"options"in Se&&A(11,Be=Se.options),"minzoom"in Se&&A(12,Ae=Se.minzoom),"maxzoom"in Se&&A(13,we=Se.maxzoom),"controls"in Se&&A(14,Ge=Se.controls),"tabbable"in Se&&A(15,je=Se.tabbable),"zoom"in Se&&A(5,Xe=Se.zoom),"center"in Se&&A(6,We=Se.center),"pitch"in Se&&A(7,De=Se.pitch),"bearing"in Se&&A(8,er=Se.bearing),"interactive"in Se&&A(16,rr=Se.interactive),"attribution"in Se&&A(17,lr=Se.attribution),"$$scope"in Se&&A(18,W=Se.$$scope)},s.$$.update=()=>{s.$$.dirty&1024&&ir(Me)},[Z,He,qe,xe,ne,Xe,We,De,er,de,Me,Be,Ae,we,Ge,je,rr,lr,W,P,Wr]}let Ud=class extends Ya{constructor(E){super(),Ka(this,E,Td,Ad,Va,{map:4,id:0,location:9,style:10,css:1,options:11,minzoom:12,maxzoom:13,controls:14,tabbable:15,zoom:5,center:6,pitch:7,bearing:8,interactive:16,attribution:17})}};function so(s){let E;const A=s[12].default,P=ja(A,s,s[11],null);return{c(){P&&P.c()},l(W){P&&P.l(W)},m(W,he){P&&P.m(W,he),E=!0},p(W,he){P&&P.p&&(!E||he&2048)&&Xa(P,A,W,W[11],E?Wa(A,W[11],he,null):qa(W[11]),null)},i(W){E||(Mr(P,W),E=!0)},o(W){dt(P,W),E=!1},d(W){P&&P.d(W)}}}function Sd(s){let E,A,P=s[0]&&so(s);return{c(){P&&P.c(),E=ao()},l(W){P&&P.l(W),E=ao()},m(W,he){P&&P.m(W,he),ka(W,E,he),A=!0},p(W,[he]){W[0]?P?(P.p(W,he),he&1&&Mr(P,1)):(P=so(W),P.c(),Mr(P,1),P.m(E.parentNode,E)):P&&(mo(),dt(P,1,1,()=>{P=null}),ho())},i(W){A||(Mr(P),A=!0)},o(W){dt(P),A=!1},d(W){W&&Rt(E),P&&P.d(W)}}}function wd(s=1e3){return new Promise(E=>setTimeout(E,s))}function Ld(s,E,A){let{$$slots:P={},$$scope:W}=E,{id:he}=E,{type:ne}=E,{url:Z=null}=E,{props:de={}}=E,{data:Me=null}=E,{layer:He=null}=E,{promoteId:Be=null}=E,{minzoom:Ae=null}=E,{maxzoom:we=null}=E,{tilesize:Ge=256}=E,je=!1,Xe=Z;const{getMap:We}=Ma("map"),De=We();Dn("source",{source:he,layer:He,promoteId:Be}),De.getSource(he)&&De.removeSource(he);async function er(){await wd(100),De.isSourceLoaded(he)?(A(0,je=!0),console.debug(he+" map source loaded!")):(console.debug("..."),er())}Ae&&(de.minzoom=Ae),we&&(de.maxzoom=we),He&&Be?(de.promoteId={},de.promoteId[He]=Be):Be&&(de.promoteId=Be);function rr(){console.debug(he+" map source loading...");let xe;ne=="geojson"?Me?xe={type:ne,data:Me,...de}:Z&&(xe={type:ne,data:Z,...de}):ne=="vector"?xe={type:ne,tiles:[Z],...de}:ne=="raster"?xe={type:ne,tiles:[Z],tileSize:Ge,...de}:ne=="raster-dem"&&(xe={type:ne,tiles:[Z],tileSize:Ge,...de}),xe&&(De.addSource(he,xe),er())}function lr(xe){let ir=De.getSource(he);ir&&ir.setData(xe)}function qe(xe){if(xe!==Xe){let ir=De.getSource(he);ir&&ir.setTiles([xe]),Xe=xe}}function or(xe){xe!==Xe&&(De.getSource(he).tiles=[xe],De.style.sourceCaches[he].clearTiles(),De.style.sourceCaches[he].update(De.transform),De.triggerRepaint(),Xe=xe)}return za(rr),Ha(async()=>{De&&De.getSource(he)&&(De.getStyle().layers.filter(ir=>ir.source==he).forEach(ir=>{De.removeLayer(ir.id)}),De.removeSource(he))}),s.$$set=xe=>{"id"in xe&&A(2,he=xe.id),"type"in xe&&A(3,ne=xe.type),"url"in xe&&A(4,Z=xe.url),"props"in xe&&A(1,de=xe.props),"data"in xe&&A(5,Me=xe.data),"layer"in xe&&A(6,He=xe.layer),"promoteId"in xe&&A(7,Be=xe.promoteId),"minzoom"in xe&&A(8,Ae=xe.minzoom),"maxzoom"in xe&&A(9,we=xe.maxzoom),"tilesize"in xe&&A(10,Ge=xe.tilesize),"$$scope"in xe&&A(11,W=xe.$$scope)},s.$$.update=()=>{s.$$.dirty&41&&ne=="geojson"&&je&&lr(Me),s.$$.dirty&25&&ne=="vector"&&je&&qe(Z),s.$$.dirty&25&&ne=="raster"&&je&&or(Z)},[je,de,he,ne,Z,Me,He,Be,Ae,we,Ge,W,P]}class zd extends Ya{constructor(E){super(),Ka(this,E,Ld,Sd,Va,{id:2,type:3,url:4,props:1,data:5,layer:6,promoteId:7,minzoom:8,maxzoom:9,tilesize:10})}}const Od=s=>({hovered:s[0]&1}),lo=s=>({hovered:s[0]});function Rd(s){let E;const A=s[30].default,P=ja(A,s,s[29],lo);return{c(){P&&P.c()},l(W){P&&P.l(W)},m(W,he){P&&P.m(W,he),E=!0},p(W,he){P&&P.p&&(!E||he[0]&536870913)&&Xa(P,A,W,W[29],E?Wa(A,W[29],he,Od):qa(W[29]),lo)},i(W){E||(Mr(P,W),E=!0)},o(W){dt(P,W),E=!1},d(W){P&&P.d(W)}}}function Cd(s,E,A){let P,{$$slots:W={},$$scope:he}=E;const ne=co();let{id:Z}=E,{type:de}=E,{filter:Me=null}=E,{layout:He={}}=E,{paint:Be={}}=E,{data:Ae=null}=E,{colorKey:we="color"}=E,{nameKey:Ge=null}=E,{valueKey:je=null}=E,{idKey:Xe=null}=E,{select:We=!1}=E,{clickIgnore:De=!1}=E,{clickCenter:er=!1}=E,{selected:rr=null}=E,{hover:lr=!1}=E,{hovered:qe=null}=E,{highlight:or=!1}=E,{highlightKey:xe="highlighted"}=E,{highlighted:ir=[]}=E,{order:Wr=null}=E,{maxzoom:Se=null}=E,{minzoom:Yr=null}=E,{sourceLayer:Qe=null}=E,{visible:Dr=!0}=E;const{source:vr,layer:Pn,promoteId:Zt}=Ma("source"),{getMap:Bn}=Ma("map"),Pe=Bn();Dn("layer",{layer:Z});const Rr=jl({id:null,feature:null,event:null});Hl(s,Rr,se=>A(33,P=se)),Dn("hover",Rr),Xe=Xe||Zt,Qe=Qe||Pn;let wr=null,Nr=null,Kr=[];He.visibility=Dr?"visible":"none";let Qr={id:Z,type:de,source:vr,paint:Be,layout:He};Me&&(Qr.filter=Me),Qe&&(Qr["source-layer"]=Qe),Se&&(Qr.maxzoom=Se),Yr&&(Qr.minzoom=Yr),za(()=>{Pe.getLayer(Z)&&Pe.removeLayer(Z),Pe.addLayer(Qr,Wr)});let Ct=[];function Jt(se,ur=we){console.debug("updating colors...");for(const xr of Ct)Pe.setFeatureState({source:vr,sourceLayer:Qe,id:xr},{color:null,value:null});Ct=[];for(const xr of se)Pe.setFeatureState({source:vr,sourceLayer:Qe,id:xr[Xe]},{color:ur?xr[ur]:null,value:je?xr[je]:null,name:Ge?xr[Ge]:null}),Ct.push(xr[Xe])}function kn(se){Pe.getLayer(Z)&&Pe.setFilter(Z,se)}function Mn(se){if(Pe.getLayer(Z))for(const ur in se)Pe.setPaintProperty(Z,ur,se[ur])}function Un(se){Pe.getLayer(Z)&&Pe.setLayoutProperty(Z,"visibility",se?"visible":"none")}return We&&Pe.on("click",Z,se=>{if(se.features.length>0&&!De){let ur=se.features[0];if(A(2,rr=ur.id),ne("select",{id:rr,feature:ur,event:se}),wr&&Pe.setFeatureState({source:vr,sourceLayer:Qe,id:wr},{selected:!1}),Pe.setFeatureState({source:vr,sourceLayer:Qe,id:rr},{selected:!0}),er){let xr=centroid(se.features[0].toJSON().geometry);Pe.flyTo({center:xr.geometry.coordinates})}A(26,wr=rr)}}),lr&&(Pe.on("mousemove",Z,se=>{if(se.features.length>0){qe&&Pe.setFeatureState({source:vr,sourceLayer:Qe,id:qe},{hovered:!1});let ur=se.features[0];A(0,qe=A(27,Nr=ur.id)),Rr.set({id:qe,feature:ur,event:se}),ne("hover",P),Pe.setFeatureState({source:vr,sourceLayer:Qe,id:qe},{hovered:!0}),Pe.getCanvas().style.cursor="pointer"}}),Pe.on("mouseleave",Z,se=>{qe&&Pe.setFeatureState({source:vr,sourceLayer:Qe,id:qe},{hovered:!1}),A(0,qe=A(27,Nr=null)),Rr.set({id:null,feature:null,event:se}),ne("hover",P),Pe.getCanvas().style.cursor=""})),Ha(async()=>{Pe&&Pe.getLayer(Z)&&Pe.removeLayer(Z)}),s.$$set=se=>{"id"in se&&A(6,Z=se.id),"type"in se&&A(7,de=se.type),"filter"in se&&A(8,Me=se.filter),"layout"in se&&A(4,He=se.layout),"paint"in se&&A(9,Be=se.paint),"data"in se&&A(10,Ae=se.data),"colorKey"in se&&A(11,we=se.colorKey),"nameKey"in se&&A(12,Ge=se.nameKey),"valueKey"in se&&A(13,je=se.valueKey),"idKey"in se&&A(5,Xe=se.idKey),"select"in se&&A(14,We=se.select),"clickIgnore"in se&&A(15,De=se.clickIgnore),"clickCenter"in se&&A(16,er=se.clickCenter),"selected"in se&&A(2,rr=se.selected),"hover"in se&&A(17,lr=se.hover),"hovered"in se&&A(0,qe=se.hovered),"highlight"in se&&A(18,or=se.highlight),"highlightKey"in se&&A(19,xe=se.highlightKey),"highlighted"in se&&A(20,ir=se.highlighted),"order"in se&&A(21,Wr=se.order),"maxzoom"in se&&A(22,Se=se.maxzoom),"minzoom"in se&&A(23,Yr=se.minzoom),"sourceLayer"in se&&A(3,Qe=se.sourceLayer),"visible"in se&&A(24,Dr=se.visible),"$$scope"in se&&A(29,he=se.$$scope)},s.$$.update=()=>{if(s.$$.dirty[0]&3072&&Ae&&Jt(Ae,we),s.$$.dirty[0]&256&&kn(Me),s.$$.dirty[0]&512&&Mn(Be),s.$$.dirty[0]&16777216&&Un(Dr),s.$$.dirty[0]&270270472&&or&&ir!=Kr){if(Kr[0])for(const se of Kr){let ur={};ur[xe]=!1,Pe.setFeatureState({source:vr,sourceLayer:Qe,id:se},ur)}if(A(28,Kr=ir),ir[0])for(const se of ir){let ur={};ur[xe]=!0,Pe.setFeatureState({source:vr,sourceLayer:Qe,id:se},ur)}}s.$$.dirty[0]&67125260&&We&&rr!=wr&&(wr&&Pe.setFeatureState({source:vr,sourceLayer:Qe,id:wr},{selected:!1}),rr&&Pe.setFeatureState({source:vr,sourceLayer:Qe,id:rr},{selected:!0}),A(26,wr=rr)),s.$$.dirty[0]&134348809&&lr&&qe!=Nr&&(Nr&&Pe.setFeatureState({source:vr,sourceLayer:Qe,id:Nr},{hovered:!1}),qe&&Pe.setFeatureState({source:vr,sourceLayer:Qe,id:qe},{hovered:!0}),A(27,Nr=qe))},[qe,Rr,rr,Qe,He,Xe,Z,de,Me,Be,Ae,we,Ge,je,We,De,er,lr,or,xe,ir,Wr,Se,Yr,Dr,Jt,wr,Nr,Kr,he,W]}class Hd extends Ya{constructor(E){super(),Ka(this,E,Cd,Rd,Va,{id:6,type:7,filter:8,layout:4,paint:9,data:10,colorKey:11,nameKey:12,valueKey:13,idKey:5,select:14,clickIgnore:15,clickCenter:16,selected:2,hover:17,hovered:0,highlight:18,highlightKey:19,highlighted:20,order:21,maxzoom:22,minzoom:23,sourceLayer:3,visible:24,updateColors:25},null,[-1,-1])}get updateColors(){return this.$$.ctx[25]}}export{Ud as M,Md as a,zd as b,Bd as c,Hd as d,Nd as e,Xl as f,Pd as g,kd as r};
