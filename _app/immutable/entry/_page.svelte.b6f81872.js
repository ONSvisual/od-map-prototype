//js
import{S as Pe,i as Me,s as We,f as K,v as ue,m as P,o as N,n as ge,l as h,I as de,e as w,h as E,j as I,z as V,d as C,k as H,A as Z,J as Re,p as m,q as re,C as ze,K as Ae,E as ne,F as se,L as ae,G as fe,M as ie,t as F,w as ve,N as Oe,b as Y,H as ce,O as Ue,B as be,P as Ge,Q as je,R as Ze}from"../chunks/index.6f8491ba.js";import{M as Fe,r as Je,a as Qe,b as Xe,c as pe}from"../chunks/MapTooltip.svelte_svelte_type_style_lang.fd8d3218.js";import{b as Ce,s as Ye}from"../chunks/utils.e78e8001.js";function ke(t,e,i){const a=t.slice();return a[16]=e[i],a}function ye(t,e,i){const a=t.slice();return a[19]=e[i],a[21]=i,a}function we(t,e,i){const a=t.slice();return a[19]=e[i],a[21]=i,a}function Ee(t,e,i){const a=t.slice();return a[16]=e[i],a[21]=i,a}function Le(t){let e,i=t[9],a=[];for(let l=0;l<i.length;l+=1)a[l]=De(Ee(t,i,l));return{c(){e=w("ul");for(let l=0;l<a.length;l+=1)a[l].c();this.h()},l(l){e=E(l,"UL",{class:!0});var r=I(e);for(let o=0;o<a.length;o+=1)a[o].l(r);r.forEach(h),this.h()},h(){V(e,"class","legend-block svelte-v05hvd")},m(l,r){N(l,e,r);for(let o=0;o<a.length;o+=1)a[o]&&a[o].m(e,null)},p(l,r){if(r&576){i=l[9];let o;for(o=0;o<i.length;o+=1){const c=Ee(l,i,o);a[o]?a[o].p(c,r):(a[o]=De(c),a[o].c(),a[o].m(e,null))}for(;o<a.length;o+=1)a[o].d(1);a.length=i.length}},d(l){l&&h(e),de(a,l)}}}function De(t){let e,i,a,l,r=t[16]+"",o,c;return{c(){e=w("li"),i=w("div"),a=K(),l=w("span"),o=C(r),c=K(),this.h()},l(s){e=E(s,"LI",{class:!0});var v=I(e);i=E(v,"DIV",{class:!0}),I(i).forEach(h),a=P(v),l=E(v,"SPAN",{class:!0});var g=I(l);o=H(g,r),g.forEach(h),c=P(v),v.forEach(h),this.h()},h(){V(i,"class","legend-vis "+(t[21]==0?"bar":"marker")+" svelte-v05hvd"),Z(i,"height","1rem"),Z(i,"width",t[21]==0?"1rem":t[6]+"px"),V(l,"class",Re(t[21]==0?"bold":"brackets")+" svelte-v05hvd"),V(e,"class","svelte-v05hvd")},m(s,v){N(s,e,v),m(e,i),m(e,a),m(e,l),m(l,o),m(e,c)},p(s,v){v&64&&Z(i,"width",s[21]==0?"1rem":s[6]+"px"),v&512&&r!==(r=s[16]+"")&&re(o,r)},d(s){s&&h(e)}}}function Ie(t){let e,i=t[3](t[19][t[0]])+"",a,l;return{c(){e=w("span"),a=C(i),l=C(t[4]),this.h()},l(r){e=E(r,"SPAN",{class:!0});var o=I(e);a=H(o,i),l=H(o,t[4]),o.forEach(h),this.h()},h(){V(e,"class","label "+(t[21]==0?"bold":"sml brackets")+" svelte-v05hvd")},m(r,o){N(r,e,o),m(e,a),m(e,l)},p(r,o){o&137&&i!==(i=r[3](r[19][r[0]])+"")&&re(a,i),o&16&&re(l,r[4])},d(r){r&&h(e)}}}function xe(t){let e,i=`calc(${t[8](t[19][t[0]])}% - ${t[6]/2}px)`,a=`${t[6]}px`;return{c(){e=w("div"),this.h()},l(l){e=E(l,"DIV",{class:!0}),I(e).forEach(h),this.h()},h(){V(e,"class","marker svelte-v05hvd"),Z(e,"left",i),Z(e,"border-left-width",a)},m(l,r){N(l,e,r)},p(l,r){r&449&&i!==(i=`calc(${l[8](l[19][l[0]])}% - ${l[6]/2}px)`)&&Z(e,"left",i),r&64&&a!==(a=`${l[6]}px`)&&Z(e,"border-left-width",a)},d(l){l&&h(e)}}}function et(t){let e,i=`${t[8](t[19][t[0]])}%`;return{c(){e=w("div"),this.h()},l(a){e=E(a,"DIV",{class:!0}),I(e).forEach(h),this.h()},h(){V(e,"class","bar svelte-v05hvd"),Z(e,"left","0"),Z(e,"width",i),Z(e,"background-color",typeof t[19][t[1]]=="number"?t[2][t[19][t[1]]]:null)},m(a,l){N(a,e,l)},p(a,l){l&385&&i!==(i=`${a[8](a[19][a[0]])}%`)&&Z(e,"width",i),l&134&&Z(e,"background-color",typeof a[19][a[1]]=="number"?a[2][a[19][a[1]]]:null)},d(a){a&&h(e)}}}function Se(t){let e;function i(r,o){return r[21]==0?et:xe}let l=i(t)(t);return{c(){l.c(),e=ue()},l(r){l.l(r),e=ue()},m(r,o){l.m(r,o),N(r,e,o)},p(r,o){l.p(r,o)},d(r){l.d(r),r&&h(e)}}}function Te(t){let e,i=t[10](t[16].label)+"",a,l,r,o,c,s=`${t[5]}px`,v=t[16].values,g=[];for(let n=0;n<v.length;n+=1)g[n]=Ie(we(t,v,n));let S=t[16].values,p=[];for(let n=0;n<S.length;n+=1)p[n]=Se(ye(t,S,n));return{c(){e=w("div"),a=C(i),l=K();for(let n=0;n<g.length;n+=1)g[n].c();r=K(),o=w("div");for(let n=0;n<p.length;n+=1)p[n].c();c=K(),this.h()},l(n){e=E(n,"DIV",{class:!0});var _=I(e);a=H(_,i),l=P(_);for(let L=0;L<g.length;L+=1)g[L].l(_);_.forEach(h),r=P(n),o=E(n,"DIV",{class:!0});var u=I(o);for(let L=0;L<p.length;L+=1)p[L].l(u);c=P(u),u.forEach(h),this.h()},h(){V(e,"class","label-group svelte-v05hvd"),V(o,"class","bar-group svelte-v05hvd"),Z(o,"height",s)},m(n,_){N(n,e,_),m(e,a),m(e,l);for(let u=0;u<g.length;u+=1)g[u]&&g[u].m(e,null);N(n,r,_),N(n,o,_);for(let u=0;u<p.length;u+=1)p[u]&&p[u].m(o,null);m(o,c)},p(n,_){if(_&128&&i!==(i=n[10](n[16].label)+"")&&re(a,i),_&153){v=n[16].values;let u;for(u=0;u<v.length;u+=1){const L=we(n,v,u);g[u]?g[u].p(L,_):(g[u]=Ie(L),g[u].c(),g[u].m(e,null))}for(;u<g.length;u+=1)g[u].d(1);g.length=v.length}if(_&455){S=n[16].values;let u;for(u=0;u<S.length;u+=1){const L=ye(n,S,u);p[u]?p[u].p(L,_):(p[u]=Se(L),p[u].c(),p[u].m(o,c))}for(;u<p.length;u+=1)p[u].d(1);p.length=S.length}_&32&&s!==(s=`${n[5]}px`)&&Z(o,"height",s)},d(n){n&&h(e),de(g,n),n&&h(r),n&&h(o),de(p,n)}}}function tt(t){let e,i,a=t[9][1]&&Le(t),l=t[7],r=[];for(let o=0;o<l.length;o+=1)r[o]=Te(ke(t,l,o));return{c(){a&&a.c(),e=K();for(let o=0;o<r.length;o+=1)r[o].c();i=ue()},l(o){a&&a.l(o),e=P(o);for(let c=0;c<r.length;c+=1)r[c].l(o);i=ue()},m(o,c){a&&a.m(o,c),N(o,e,c);for(let s=0;s<r.length;s+=1)r[s]&&r[s].m(o,c);N(o,i,c)},p(o,[c]){if(o[9][1]?a?a.p(o,c):(a=Le(o),a.c(),a.m(e.parentNode,e)):a&&(a.d(1),a=null),c&1535){l=o[7];let s;for(s=0;s<l.length;s+=1){const v=ke(o,l,s);r[s]?r[s].p(v,c):(r[s]=Te(v),r[s].c(),r[s].m(i.parentNode,i))}for(;s<r.length;s+=1)r[s].d(1);r.length=l.length}},i:ge,o:ge,d(o){a&&a.d(o),o&&h(e),de(r,o),o&&h(i)}}}function lt(t,e,i){let a,l,r,o,{data:c}=e,{xKey:s="value"}=e,{yKey:v="category"}=e,{zKey:g="group"}=e,{colorKey:S="color"}=e,{colors:p=["white","#888","#444"]}=e,{formatTick:n=d=>d.toLocaleString()}=e,{suffix:_=""}=e,{barHeight:u=20}=e,{markerWidth:L=3}=e;function B(d,A){let W={};for(const y of d)W[y[A]]||(W[y[A]]={label:y[A],values:[]}),W[y[A]].values.push(y);let U=[];for(const y in W)U.push(W[y]);return U}const M=d=>d.charAt(0).toUpperCase()+d.slice(1);return t.$$set=d=>{"data"in d&&i(11,c=d.data),"xKey"in d&&i(0,s=d.xKey),"yKey"in d&&i(12,v=d.yKey),"zKey"in d&&i(13,g=d.zKey),"colorKey"in d&&i(1,S=d.colorKey),"colors"in d&&i(2,p=d.colors),"formatTick"in d&&i(3,n=d.formatTick),"suffix"in d&&i(4,_=d.suffix),"barHeight"in d&&i(5,u=d.barHeight),"markerWidth"in d&&i(6,L=d.markerWidth)},t.$$.update=()=>{t.$$.dirty&2049&&i(14,a=[0,Math.max(...c.map(d=>d[s]))]),t.$$.dirty&10240&&i(9,l=c.map(d=>d[g]).filter((d,A,W)=>W.indexOf(d)===A)),t.$$.dirty&16384&&i(8,r=d=>d/a[1]*100),t.$$.dirty&6144&&i(7,o=B(c,v))},[s,S,p,n,_,u,L,o,r,l,M,c,v,g,a]}class He extends Pe{constructor(e){super(),Me(this,e,lt,tt,We,{data:11,xKey:0,yKey:12,zKey:13,colorKey:1,colors:2,formatTick:3,suffix:4,barHeight:5,markerWidth:6})}}function Be(t,e,i){const a=t.slice();return a[41]=e[i],a}function qe(t,e,i){const a=t.slice();return a[44]=e[i],a}function Ne(t){let e,i,a,l;return{c(){e=w("button"),i=C("Deselect"),this.h()},l(r){e=E(r,"BUTTON",{class:!0});var o=I(e);i=H(o,"Deselect"),o.forEach(h),this.h()},h(){V(e,"class","btn-link svelte-1egxxhq")},m(r,o){N(r,e,o),m(e,i),a||(l=ie(e,"click",t[13]),a=!0)},p:ge,d(r){r&&h(e),a=!1,l()}}}function at(t){let e,i;function a(...l){return t[23](t[44],...l)}return e=new He({props:{data:[{category:"Works from home",value:t[8][t[44]].home,color:0},{category:`Lives within ${t[9][t[44]].areanm}`,value:t[8][t[44]].within,color:0},...[1,2,3,4,5].map(a),{category:"Lives in another location",value:t[8][t[44]].fromother,color:2}]}}),{c(){ne(e.$$.fragment)},l(l){se(e.$$.fragment,l)},m(l,r){fe(e,l,r),i=!0},p(l,r){t=l;const o={};r[0]&6&&(o.data=[{category:"Works from home",value:t[8][t[44]].home,color:0},{category:`Lives within ${t[9][t[44]].areanm}`,value:t[8][t[44]].within,color:0},...[1,2,3,4,5].map(a),{category:"Lives in another location",value:t[8][t[44]].fromother,color:2}]),e.$set(o)},i(l){i||(F(e.$$.fragment,l),i=!0)},o(l){Y(e.$$.fragment,l),i=!1},d(l){ce(e,l)}}}function ot(t){let e,i;function a(...l){return t[22](t[44],...l)}return e=new He({props:{data:[{category:"Works from home",value:t[8][t[44]].home,color:0},{category:`Works within ${t[9][t[44]].areanm}`,value:t[8][t[44]].within,color:0},...[1,2,3,4,5].map(a),{category:"Works in another location",value:t[8][t[44]].toother,color:2}]}}),{c(){ne(e.$$.fragment)},l(l){se(e.$$.fragment,l)},m(l,r){fe(e,l,r),i=!0},p(l,r){t=l;const o={};r[0]&6&&(o.data=[{category:"Works from home",value:t[8][t[44]].home,color:0},{category:`Works within ${t[9][t[44]].areanm}`,value:t[8][t[44]].within,color:0},...[1,2,3,4,5].map(a),{category:"Works in another location",value:t[8][t[44]].toother,color:2}]),e.$set(o)},i(l){i||(F(e.$$.fragment,l),i=!0)},o(l){Y(e.$$.fragment,l),i=!1},d(l){ce(e,l)}}}function $e(t){let e,i=t[9][t[44]].areanm+"",a,l,r,o,c,s,v=t[8][t[44]].resident.toLocaleString()+"",g,S,p,n,_,u=t[8][t[44]].workday.toLocaleString()+"",L,B,M,d=(t[8][t[44]].workday-t[8][t[44]].resident).toLocaleString("en-GB",{signDisplay:"exceptZero"})+"",A,W,U,y,O,X,ee,te,G,q,J,z,me,R=t[44]===t[1]&&Ne(t);const k=[ot,at],D=[];function Q(f,T){return f[6]==="from"?0:1}return y=Q(t),O=D[y]=k[y](t),{c(){e=w("div"),a=C(i),l=K(),R&&R.c(),r=K(),o=w("button"),c=C(`Resident population
				`),s=w("div"),g=C(v),S=K(),p=w("button"),n=C(`Workday population
				`),_=w("div"),L=C(u),B=K(),M=w("div"),A=C(d),W=K(),U=w("div"),O.c(),X=K(),ee=w("div"),te=w("label"),G=w("input"),q=C(`
					Highlight points for this area on map`),this.h()},l(f){e=E(f,"DIV",{class:!0});var T=I(e);a=H(T,i),l=P(T),R&&R.l(T),T.forEach(h),r=P(f),o=E(f,"BUTTON",{class:!0});var le=I(o);c=H(le,`Resident population
				`),s=E(le,"DIV",{class:!0});var oe=I(s);g=H(oe,v),oe.forEach(h),le.forEach(h),S=P(f),p=E(f,"BUTTON",{class:!0});var x=I(p);n=H(x,`Workday population
				`),_=E(x,"DIV",{class:!0});var he=I(_);L=H(he,u),he.forEach(h),B=P(x),M=E(x,"DIV",{class:!0});var _e=I(M);A=H(_e,d),_e.forEach(h),x.forEach(h),W=P(f),U=E(f,"DIV",{});var b=I(U);O.l(b),b.forEach(h),X=P(f),ee=E(f,"DIV",{});var $=I(ee);te=E($,"LABEL",{});var j=I(te);G=E(j,"INPUT",{type:!0}),q=H(j,`
					Highlight points for this area on map`),j.forEach(h),$.forEach(h),this.h()},h(){V(e,"class","big-text svelte-1egxxhq"),Z(e,"grid-column","span 2"),V(s,"class","big-text svelte-1egxxhq"),V(o,"class","svelte-1egxxhq"),ae(o,"btn-active",t[6]==="from"),V(_,"class","big-text svelte-1egxxhq"),V(M,"class","small-text svelte-1egxxhq"),V(p,"class","svelte-1egxxhq"),ae(p,"btn-active",t[6]==="to"),Z(U,"grid-column","span 2"),V(G,"type","checkbox"),Z(ee,"grid-column","span 2")},m(f,T){N(f,e,T),m(e,a),m(e,l),R&&R.m(e,null),N(f,r,T),N(f,o,T),m(o,c),m(o,s),m(s,g),N(f,S,T),N(f,p,T),m(p,n),m(p,_),m(_,L),m(p,B),m(p,M),m(M,A),N(f,W,T),N(f,U,T),D[y].m(U,null),N(f,X,T),N(f,ee,T),m(ee,te),m(te,G),G.checked=t[7],m(te,q),J=!0,z||(me=[ie(o,"click",t[20]),ie(p,"click",t[21]),ie(G,"change",t[24]),ie(G,"change",t[25])],z=!0)},p(f,T){(!J||T[0]&6)&&i!==(i=f[9][f[44]].areanm+"")&&re(a,i),f[44]===f[1]?R?R.p(f,T):(R=Ne(f),R.c(),R.m(e,null)):R&&(R.d(1),R=null),(!J||T[0]&6)&&v!==(v=f[8][f[44]].resident.toLocaleString()+"")&&re(g,v),(!J||T[0]&64)&&ae(o,"btn-active",f[6]==="from"),(!J||T[0]&6)&&u!==(u=f[8][f[44]].workday.toLocaleString()+"")&&re(L,u),(!J||T[0]&6)&&d!==(d=(f[8][f[44]].workday-f[8][f[44]].resident).toLocaleString("en-GB",{signDisplay:"exceptZero"})+"")&&re(A,d),(!J||T[0]&64)&&ae(p,"btn-active",f[6]==="to");let le=y;y=Q(f),y===le?D[y].p(f,T):(be(),Y(D[le],1,1,()=>{D[le]=null}),ve(),O=D[y],O?O.p(f,T):(O=D[y]=k[y](f),O.c()),F(O,1),O.m(U,null)),T[0]&128&&(G.checked=f[7])},i(f){J||(F(O),J=!0)},o(f){Y(O),J=!1},d(f){f&&h(e),R&&R.d(),f&&h(r),f&&h(o),f&&h(S),f&&h(p),f&&h(W),f&&h(U),D[y].d(),f&&h(X),f&&h(ee),z=!1,Ue(me)}}}function Ve(t){let e,i,a,l,r,o,c,s,v,g,S,p,n,_,u,L;return{c(){e=w("div"),i=C("2011 Census travel to work data"),a=K(),l=w("div"),r=w("p"),o=C("Using this experimental tool, you can:"),c=K(),s=w("ul"),v=w("li"),g=C('animate commutes on a map, by clicking "place of work".'),S=K(),p=w("li"),n=C("see commutes for individual area, by hovering or clicking an area on the map."),_=K(),u=w("p"),L=C("Note: The data in this tool is from 2011, not the latest 2021 census."),this.h()},l(B){e=E(B,"DIV",{class:!0});var M=I(e);i=H(M,"2011 Census travel to work data"),M.forEach(h),a=P(B),l=E(B,"DIV",{});var d=I(l);r=E(d,"P",{});var A=I(r);o=H(A,"Using this experimental tool, you can:"),A.forEach(h),c=P(d),s=E(d,"UL",{});var W=I(s);v=E(W,"LI",{});var U=I(v);g=H(U,'animate commutes on a map, by clicking "place of work".'),U.forEach(h),S=P(W),p=E(W,"LI",{});var y=I(p);n=H(y,"see commutes for individual area, by hovering or clicking an area on the map."),y.forEach(h),W.forEach(h),_=P(d),u=E(d,"P",{});var O=I(u);L=H(O,"Note: The data in this tool is from 2011, not the latest 2021 census."),O.forEach(h),d.forEach(h),this.h()},h(){V(e,"class","big-text svelte-1egxxhq"),Z(e,"grid-column","span 2"),Z(l,"grid-column","span 2")},m(B,M){N(B,e,M),m(e,i),N(B,a,M),N(B,l,M),m(l,r),m(r,o),m(l,c),m(l,s),m(s,v),m(v,g),m(s,S),m(s,p),m(p,n),m(l,_),m(l,u),m(u,L)},d(B){B&&h(e),B&&h(a),B&&h(l)}}}function it(t){let e,i,a=t[10],l=[];for(let o=0;o<a.length;o+=1)l[o]=Ke(Be(t,a,o));const r=o=>Y(l[o],1,1,()=>{l[o]=null});return{c(){for(let o=0;o<l.length;o+=1)l[o].c();e=ue()},l(o){for(let c=0;c<l.length;c+=1)l[c].l(o);e=ue()},m(o,c){for(let s=0;s<l.length;s+=1)l[s]&&l[s].m(o,c);N(o,e,c),i=!0},p(o,c){if(c[0]&5150){a=o[10];let s;for(s=0;s<a.length;s+=1){const v=Be(o,a,s);l[s]?(l[s].p(v,c),F(l[s],1)):(l[s]=Ke(v),l[s].c(),F(l[s],1),l[s].m(e.parentNode,e))}for(be(),s=a.length;s<l.length;s+=1)r(s);ve()}},i(o){if(!i){for(let c=0;c<a.length;c+=1)F(l[c]);i=!0}},o(o){l=l.filter(Boolean);for(let c=0;c<l.length;c+=1)Y(l[c]);i=!1},d(o){de(l,o),o&&h(e)}}}function rt(t){let e,i,a,l,r,o,c,s,v,g;function S(n){t[28](n)}let p={id:t[41].key+"-fill",type:"fill",paint:{"fill-color":"rgba(0,0,0,0)"},order:"water",hover:!0,select:!0,selected:t[1],highlight:!0,highlighted:t[3],visible:t[4]===t[41].key};return t[2]!==void 0&&(p.hovered=t[2]),e=new pe({props:p}),ze.push(()=>Ae(e,"hovered",S)),e.$on("select",t[12]),l=new pe({props:{id:t[41].key+"-line",type:"line",paint:{"line-color":"#555","line-width":.5},order:"place_other",visible:t[4]===t[41].key}}),o=new pe({props:{id:t[41].key+"-highlighted",type:"line",paint:{"line-color":["case",["==",["feature-state","highlighted"],!0],"#aaa","rgba(0,0,0,0)"],"line-width":1},order:"place_other",visible:t[4]===t[41].key}}),s=new pe({props:{id:t[41].key+"-selected",type:"line",paint:{"line-color":["case",["==",["feature-state","selected"],!0],"white",["==",["feature-state","hovered"],!0],"white","rgba(0,0,0,0)"],"line-width":["case",["==",["feature-state","selected"],!0],2.5,1]},order:"place_other",visible:t[4]===t[41].key}}),{c(){ne(e.$$.fragment),a=K(),ne(l.$$.fragment),r=K(),ne(o.$$.fragment),c=K(),ne(s.$$.fragment),v=K()},l(n){se(e.$$.fragment,n),a=P(n),se(l.$$.fragment,n),r=P(n),se(o.$$.fragment,n),c=P(n),se(s.$$.fragment,n),v=P(n)},m(n,_){fe(e,n,_),N(n,a,_),fe(l,n,_),N(n,r,_),fe(o,n,_),N(n,c,_),fe(s,n,_),N(n,v,_),g=!0},p(n,_){const u={};_[0]&2&&(u.selected=n[1]),_[0]&8&&(u.highlighted=n[3]),_[0]&16&&(u.visible=n[4]===n[41].key),!i&&_[0]&4&&(i=!0,u.hovered=n[2],Oe(()=>i=!1)),e.$set(u);const L={};_[0]&16&&(L.visible=n[4]===n[41].key),l.$set(L);const B={};_[0]&16&&(B.visible=n[4]===n[41].key),o.$set(B);const M={};_[0]&16&&(M.visible=n[4]===n[41].key),s.$set(M)},i(n){g||(F(e.$$.fragment,n),F(l.$$.fragment,n),F(o.$$.fragment,n),F(s.$$.fragment,n),g=!0)},o(n){Y(e.$$.fragment,n),Y(l.$$.fragment,n),Y(o.$$.fragment,n),Y(s.$$.fragment,n),g=!1},d(n){ce(e,n),n&&h(a),ce(l,n),n&&h(r),ce(o,n),n&&h(c),ce(s,n),n&&h(v)}}}function Ke(t){let e,i;const a=[{id:t[41].key},{type:t[41].type},{promoteId:"areacd"},t[41].props];let l={$$slots:{default:[rt]},$$scope:{ctx:t}};for(let r=0;r<a.length;r+=1)l=Ge(l,a[r]);return e=new Xe({props:l}),{c(){ne(e.$$.fragment)},l(r){se(e.$$.fragment,r)},m(r,o){fe(e,r,o),i=!0},p(r,o){const c=o[0]&1024?je(a,[{id:r[41].key},{type:r[41].type},a[2],Ze(r[41].props)]):{};o[0]&30|o[1]&65536&&(c.$$scope={dirty:o,ctx:r}),e.$set(c)},i(r){i||(F(e.$$.fragment,r),i=!0)},o(r){Y(e.$$.fragment,r),i=!1},d(r){ce(e,r)}}}function nt(t){let e,i,a=t[10][1].props.data&&it(t);return{c(){a&&a.c(),e=ue()},l(l){a&&a.l(l),e=ue()},m(l,r){a&&a.m(l,r),N(l,e,r),i=!0},p(l,r){l[10][1].props.data&&a.p(l,r)},i(l){i||(F(a),i=!0)},o(l){Y(a),i=!1},d(l){a&&a.d(l),l&&h(e)}}}function st(t){let e,i,a,l,r,o,c,s,v,g,S,p,n,_,u,L,B,M,d,A,W,U,y,O,X,ee,te,G=t[2]?[t[2]]:t[1]?[t[1]]:[],q=[];for(let k=0;k<G.length;k+=1)q[k]=$e(qe(t,G,k));const J=k=>Y(q[k],1,1,()=>{q[k]=null});let z=!t[1]&&!t[2]&&Ve();function me(k){t[29](k)}let R={style:"https://bothness.github.io/ons-basemaps/data/style-dark.json",location:{bounds:Ce.ew},options:{antialias:!0},minzoom:6,controls:!0,$$slots:{default:[nt]},$$scope:{ctx:t}};return t[0]!==void 0&&(R.map=t[0]),y=new Fe({props:R}),ze.push(()=>Ae(y,"map",me)),y.$on("load",t[11]),{c(){e=w("main"),i=w("div"),a=w("div"),l=w("button"),r=C("Local authorities"),o=K(),c=w("button"),s=C("Neighbourhoods"),v=K();for(let k=0;k<q.length;k+=1)q[k].c();g=K(),z&&z.c(),S=K(),p=w("div"),n=w("div"),_=w("button"),u=C("Place of residence"),L=K(),B=w("button"),M=C("Place of work"),d=K(),A=w("span"),W=C("1 dot = 100 working people"),U=K(),ne(y.$$.fragment),this.h()},l(k){e=E(k,"MAIN",{class:!0});var D=I(e);i=E(D,"DIV",{class:!0});var Q=I(i);a=E(Q,"DIV",{class:!0});var f=I(a);l=E(f,"BUTTON",{class:!0});var T=I(l);r=H(T,"Local authorities"),T.forEach(h),o=P(f),c=E(f,"BUTTON",{class:!0});var le=I(c);s=H(le,"Neighbourhoods"),le.forEach(h),v=P(f);for(let $=0;$<q.length;$+=1)q[$].l(f);g=P(f),z&&z.l(f),f.forEach(h),Q.forEach(h),S=P(D),p=E(D,"DIV",{class:!0});var oe=I(p);n=E(oe,"DIV",{class:!0});var x=I(n);_=E(x,"BUTTON",{class:!0});var he=I(_);u=H(he,"Place of residence"),he.forEach(h),L=P(x),B=E(x,"BUTTON",{class:!0});var _e=I(B);M=H(_e,"Place of work"),_e.forEach(h),d=P(x),A=E(x,"SPAN",{class:!0});var b=I(A);W=H(b,"1 dot = 100 working people"),b.forEach(h),x.forEach(h),U=P(oe),se(y.$$.fragment,oe),oe.forEach(h),D.forEach(h),this.h()},h(){V(l,"class","svelte-1egxxhq"),ae(l,"btn-active",t[4]==="lad"),V(c,"class","svelte-1egxxhq"),ae(c,"btn-active",t[4]==="msoa"),V(a,"class","grid svelte-1egxxhq"),V(i,"class","info svelte-1egxxhq"),V(_,"class","svelte-1egxxhq"),ae(_,"btn-active",t[5]==="from"),V(B,"class","svelte-1egxxhq"),ae(B,"btn-active",t[5]==="to"),V(A,"class","svelte-1egxxhq"),V(n,"class","map-legend svelte-1egxxhq"),V(p,"class","map svelte-1egxxhq"),V(e,"class","container svelte-1egxxhq")},m(k,D){N(k,e,D),m(e,i),m(i,a),m(a,l),m(l,r),m(a,o),m(a,c),m(c,s),m(a,v);for(let Q=0;Q<q.length;Q+=1)q[Q]&&q[Q].m(a,null);m(a,g),z&&z.m(a,null),m(e,S),m(e,p),m(p,n),m(n,_),m(_,u),m(n,L),m(n,B),m(B,M),m(n,d),m(n,A),m(A,W),m(p,U),fe(y,p,null),X=!0,ee||(te=[ie(l,"click",t[18]),ie(c,"click",t[19]),ie(_,"click",t[26]),ie(B,"click",t[27])],ee=!0)},p(k,D){if((!X||D[0]&16)&&ae(l,"btn-active",k[4]==="lad"),(!X||D[0]&16)&&ae(c,"btn-active",k[4]==="msoa"),D[0]&74694){G=k[2]?[k[2]]:k[1]?[k[1]]:[];let f;for(f=0;f<G.length;f+=1){const T=qe(k,G,f);q[f]?(q[f].p(T,D),F(q[f],1)):(q[f]=$e(T),q[f].c(),F(q[f],1),q[f].m(a,g))}for(be(),f=G.length;f<q.length;f+=1)J(f);ve()}!k[1]&&!k[2]?z||(z=Ve(),z.c(),z.m(a,null)):z&&(z.d(1),z=null),(!X||D[0]&32)&&ae(_,"btn-active",k[5]==="from"),(!X||D[0]&32)&&ae(B,"btn-active",k[5]==="to");const Q={};D[0]&30|D[1]&65536&&(Q.$$scope={dirty:D,ctx:k}),!O&&D[0]&1&&(O=!0,Q.map=k[0],Oe(()=>O=!1)),y.$set(Q)},i(k){if(!X){for(let D=0;D<G.length;D+=1)F(q[D]);F(y.$$.fragment,k),X=!0}},o(k){q=q.filter(Boolean);for(let D=0;D<q.length;D+=1)Y(q[D]);Y(y.$$.fragment,k),X=!1},d(k){k&&h(e),de(q,k),z&&z.d(),ce(y),ee=!1,Ue(te)}}}function ft(t,e,i){return[1,2,3,4,5].map(a=>t[e][`${i==="to"?"from":"to"}${a}cd`])}function ct(t,e,i){let{data:a}=e;const{areadata:l,metadata:r,sources:o,points:c}=a,s=c.array.length,v=Ye([5,14],[.5,4]);let g,S,p,n,_,u,L,B,M,d,A,W="lad",U="from",y="from",O=!0;function X(b){const $=[Math.min(...b.map(j=>j.xmin)),Math.min(...b.map(j=>j.ymin)),Math.max(...b.map(j=>j.xmax)),Math.max(...b.map(j=>j.ymax))];g.fitBounds($,{padding:50})}async function ee(){const b=$=>(u=Je($),L=Qe(u),M=L.buffer(c.from,{duration:5e3,ease:"linear"}),d=u.buffer(Array.from({length:s},()=>.7)),{render:L({vert:`
      uniform mat4 uMatrix;
      uniform float pointSize;
      precision lowp float;
      attribute vec2 position;
			attribute float opacity;
			varying float fragOpacity;

      void main() {
        gl_PointSize = pointSize;
        gl_Position = uMatrix * vec4(position, 0, 1);
				fragOpacity = opacity;
      }
        `,frag:`
      precision lowp float;
			varying float fragOpacity;

      void main() {
        if (length(gl_PointCoord.xy - 0.5) > 0.5) {
          discard;
        }
        gl_FragColor = vec4(0.145, 0.627, 0.8, fragOpacity);
      }
      `,attributes:{position:M,opacity:d},uniforms:{pointSize:u.prop("pointSize")||2,uMatrix:u.prop("uMatrix")},blend:{enable:!0,func:{srcRGB:"src alpha",srcAlpha:"src alpha",dstRGB:"one minus src alpha",dstAlpha:"one minus src alpha"}},depth:{enable:!1},count:s,primitive:"points"})});g.addLayer({id:"custom_layer",type:"custom",onAdd:($,j)=>{B=b(j),u.frame(()=>{$&&_&&$.triggerRepaint()})},render($,j){A=j,_=g.getZoom(),B.render({uMatrix:A,pointSize:v(_)*window.devicePixelRatio})}},"place_suburb")}function te(b){var j;const $=typeof b=="string"?b:(j=b==null?void 0:b.detail)==null?void 0:j.id;$&&(i(1,S=$),z())}function G(b){i(1,S=null),i(3,n=[]),d({data:Array.from({length:c.array.length},()=>.7)}),b&&g.fitBounds(Ce.ew)}function q(b,$){U!==b&&(M.update(c[b],$?{duration:$}:null),i(5,U=b))}function J(b){W!==b&&(i(4,W=b),S&&b==="lad"?te(r[S].parentcd):G())}function z(b=y){S&&(d({data:O?c.array.map($=>$[`${b}_${W}`]===S?1:.1):Array.from({length:c.array.length},()=>.7)}),i(3,n=ft(l,S,b)),i(6,y=b),X([r[S],...n.map($=>r[$])]))}const me=()=>J("lad"),R=()=>J("msoa"),k=()=>z("from"),D=()=>z("to"),Q=(b,$)=>({category:`Works in ${r[l[b][`to${$}cd`]].areanm}`,value:l[b][`to${$}`],color:1}),f=(b,$)=>({category:`Lives in ${r[l[b][`from${$}cd`]].areanm}`,value:l[b][`from${$}`],color:1});function T(){O=this.checked,i(7,O)}const le=()=>z(),oe=()=>q("from"),x=()=>q("to");function he(b){p=b,i(2,p)}function _e(b){g=b,i(0,g)}return t.$$set=b=>{"data"in b&&i(17,a=b.data)},[g,S,p,n,W,U,y,O,l,r,o,ee,te,G,q,J,z,a,me,R,k,D,Q,f,T,le,oe,x,he,_e]}class mt extends Pe{constructor(e){super(),Me(this,e,ct,st,We,{data:17},null,[-1,-1])}}export{mt as default};
